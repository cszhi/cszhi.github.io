<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[mysql sync_binlog innodb_flush_log_at_trx_commit 深入理解]]></title>
    <url>%2F2019%2F08%2F29%2Fmysql%20sync_binlog%20innodb_flush_log_at_trx_commit%20%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[innodb_flush_log_at_trx_commit&#x548C;sync_binlog &#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x63A7;&#x5236;MySQL &#x78C1;&#x76D8;&#x5199;&#x5165;&#x7B56;&#x7565;&#x4EE5;&#x53CA;&#x6570;&#x636E;&#x5B89;&#x5168;&#x6027;&#x7684;&#x5173;&#x952E;&#x53C2;&#x6570;&#x3002;&#x672C;&#x6587;&#x4ECE;&#x53C2;&#x6570;&#x542B;&#x4E49;&#xFF0C;&#x6027;&#x80FD;&#xFF0C;&#x5B89;&#x5168;&#x89D2;&#x5EA6;&#x9610;&#x8FF0;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x4E3A;&#x4E0D;&#x540C;&#x7684;&#x503C;&#x65F6;&#x5BF9;db &#x6027;&#x80FD;,&#x6570;&#x636E;&#x7684;&#x5F71;&#x54CD;. &#x53C2;&#x6570;&#x610F;&#x4E49;innodb_flush_log_at_trx_commit 1&#xFF09;&#x5982;&#x679C;innodb_flush_log_at_trx_commit&#x8BBE;&#x7F6E;&#x4E3A;0&#xFF0C;log buffer&#x5C06;&#x6BCF;&#x79D2;&#x4E00;&#x6B21;&#x5730;&#x5199;&#x5165;log file&#x4E2D;&#xFF0C;&#x5E76;&#x4E14;log file&#x7684;flush(&#x5237;&#x5230;&#x78C1;&#x76D8;)&#x64CD;&#x4F5C;&#x540C;&#x65F6;&#x8FDB;&#x884C;.&#x8BE5;&#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;&#x5728;&#x4E8B;&#x52A1;&#x63D0;&#x4EA4;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E0D;&#x4F1A;&#x4E3B;&#x52A8;&#x89E6;&#x53D1;&#x5199;&#x5165;&#x78C1;&#x76D8;&#x7684;&#x64CD;&#x4F5C;&#x3002; 2&#xFF09; &#x5982;&#x679C;innodb_flush_log_at_trx_commit&#x8BBE;&#x7F6E;&#x4E3A;1&#xFF0C;&#x6BCF;&#x6B21;&#x4E8B;&#x52A1;&#x63D0;&#x4EA4;&#x65F6;MySQL&#x90FD;&#x4F1A;&#x628A;log buffer&#x7684;&#x6570;&#x636E;&#x5199;&#x5165;log file&#xFF0C;&#x5E76;&#x4E14;flush(&#x5237;&#x5230;&#x78C1;&#x76D8;)&#x4E2D;&#x53BB;. 3&#xFF09;&#x5982;&#x679C;innodb_flush_log_at_trx_commit&#x8BBE;&#x7F6E;&#x4E3A;2&#xFF0C;&#x6BCF;&#x6B21;&#x4E8B;&#x52A1;&#x63D0;&#x4EA4;&#x65F6;MySQL&#x90FD;&#x4F1A;&#x628A;log buffer&#x7684;&#x6570;&#x636E;&#x5199;&#x5165;log file.&#x4F46;&#x662F;flush(&#x5237;&#x5230;&#x78C1;&#x76D8;)&#x64CD;&#x4F5C;&#x5E76;&#x4E0D;&#x4F1A;&#x540C;&#x65F6;&#x8FDB;&#x884C;&#x3002;&#x8BE5;&#x6A21;&#x5F0F;&#x4E0B;,MySQL&#x4F1A;&#x6BCF;&#x79D2;&#x6267;&#x884C;&#x4E00;&#x6B21; flush(&#x5237;&#x5230;&#x78C1;&#x76D8;)&#x64CD;&#x4F5C;&#x3002; &#x6CE8;&#x610F;&#xFF1A;&#x7531;&#x4E8E;&#x8FDB;&#x7A0B;&#x8C03;&#x5EA6;&#x7B56;&#x7565;&#x95EE;&#x9898;,&#x8FD9;&#x4E2A;&#x201C;&#x6BCF;&#x79D2;&#x6267;&#x884C;&#x4E00;&#x6B21; flush(&#x5237;&#x5230;&#x78C1;&#x76D8;)&#x64CD;&#x4F5C;&#x201D;&#x5E76;&#x4E0D;&#x662F;&#x4FDD;&#x8BC1;100%&#x7684;&#x201C;&#x6BCF;&#x79D2;&#x201D;&#x3002; sync_binlog 1&#xFF09;sync_binlog &#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x662F;0&#xFF0C;&#x50CF;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5237;&#x5176;&#x4ED6;&#x6587;&#x4EF6;&#x7684;&#x673A;&#x5236;&#x4E00;&#x6837;&#xFF0C;MySQL&#x4E0D;&#x4F1A;&#x540C;&#x6B65;&#x5230;&#x78C1;&#x76D8;&#x4E2D;&#x53BB;&#x800C;&#x662F;&#x4F9D;&#x8D56;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x6765;&#x5237;&#x65B0;binary log&#x3002; 2&#xFF09;&#x5F53;sync_binlog =N (N&gt;0) &#xFF0C;MySQL &#x5728;&#x6BCF;&#x5199; N&#x6B21; &#x4E8C;&#x8FDB;&#x5236;&#x65E5;&#x5FD7;binary log&#x65F6;&#xFF0C;&#x4F1A;&#x4F7F;&#x7528;fdatasync()&#x51FD;&#x6570;&#x5C06;&#x5B83;&#x7684;&#x5199;&#x4E8C;&#x8FDB;&#x5236;&#x65E5;&#x5FD7;binary log&#x540C;&#x6B65;&#x5230;&#x78C1;&#x76D8;&#x4E2D;&#x53BB;&#x3002; &#x6CE8;:&#x5982;&#x679C;&#x542F;&#x7528;&#x4E86;autocommit&#xFF0C;&#x90A3;&#x4E48;&#x6BCF;&#x4E00;&#x4E2A;&#x8BED;&#x53E5;statement&#x5C31;&#x4F1A;&#x6709;&#x4E00;&#x6B21;&#x5199;&#x64CD;&#x4F5C;&#xFF1B;&#x5426;&#x5219;&#x6BCF;&#x4E2A;&#x4E8B;&#x52A1;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;&#x5199;&#x64CD;&#x4F5C;&#x3002;&#x6839;&#x636E;&#x4E0A;&#x8FF0;&#x63CF;&#x8FF0;&#xFF0C;&#x6211;&#x505A;&#x4E86;&#x4E00;&#x5F20;&#x56FE;&#xFF0C;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x5927;&#x5BB6;&#x67E5;&#x770B;&#x3002; &#x6027;&#x80FD;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x5728;&#x4E0D;&#x540C;&#x503C;&#x65F6;&#x5BF9;db&#x7684;&#x7EAF;&#x5199;&#x5165;&#x7684;&#x5F71;&#x54CD;&#x8868;&#x73B0;&#x5982;&#x4E0B;&#xFF1A; &#x6D4B;&#x8BD5;&#x573A;&#x666F;1 12innodb_flush_log_at_trx_commit=2 sync_binlog=1000 &#x6D4B;&#x8BD5;&#x573A;&#x666F;2 12innodb_flush_log_at_trx_commit=1 sync_binlog=1000 &#x6D4B;&#x8BD5;&#x573A;&#x666F;3 12innodb_flush_log_at_trx_commit=1 sync_binlog=1 &#x6D4B;&#x8BD5;&#x573A;&#x666F;4 12innodb_flush_log_at_trx_commit=1sync_binlog=1000 &#x573A;&#x666F; TPS &#x573A;&#x666F;1 41000 &#x573A;&#x666F;2 33000 &#x573A;&#x666F;3 26000 &#x573A;&#x666F;4 33000 &#x7531;&#x6B64;&#x53EF;&#x89C1;&#xFF0C;&#x5F53;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x8BBE;&#x7F6E;&#x4E3A;&#x53CC;1&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5199;&#x5165;&#x6027;&#x80FD;&#x6700;&#x5DEE;&#xFF0C;sync_binlog=N (N&gt;1 ) innodb_flush_log_at_trx_commit=2 &#x65F6;&#xFF0C;(&#x5728;&#x5F53;&#x524D;&#x6A21;&#x5F0F;&#x4E0B;)MySQL&#x7684;&#x5199;&#x64CD;&#x4F5C;&#x624D;&#x80FD;&#x8FBE;&#x5230;&#x6700;&#x9AD8;&#x6027;&#x80FD;&#x3002; &#x5B89;&#x5168; 1&#xFF09;&#x5F53;innodb_flush_log_at_trx_commit&#x548C;sync_binlog &#x90FD;&#x4E3A; 1 &#x65F6;&#x662F;&#x6700;&#x5B89;&#x5168;&#x7684;&#xFF0C;&#x4F46;&#x4E5F;&#x662F;&#x6700;&#x6162;&#x7684;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;&#x3002;&#x5728;mysqld &#x670D;&#x52A1;&#x5D29;&#x6E83;&#x6216;&#x8005;&#x670D;&#x52A1;&#x5668;&#x4E3B;&#x673A;crash&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;binary log &#x53EA;&#x6709;&#x53EF;&#x80FD;&#x4E22;&#x5931;&#x6700;&#x591A;&#x4E00;&#x4E2A;&#x8BED;&#x53E5;&#x6216;&#x8005;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x3002;&#x4F46;&#x662F;&#x9C7C;&#x4E0E;&#x718A;&#x638C;&#x4E0D;&#x53EF;&#x517C;&#x5F97;&#xFF0C;&#x53CC;11 &#x4F1A;&#x5BFC;&#x81F4;&#x9891;&#x7E41;&#x7684;io&#x64CD;&#x4F5C;&#xFF0C;&#x56E0;&#x6B64;&#x8BE5;&#x6A21;&#x5F0F;&#x4E5F;&#x662F;&#x6700;&#x6162;&#x7684;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;&#x3002; 2&#xFF09;&#x5F53;innodb_flush_log_at_trx_commit&#x8BBE;&#x7F6E;&#x4E3A;0&#xFF0C;&#x8BE5;&#x6A21;&#x5F0F;&#x901F;&#x5EA6;&#x6700;&#x5FEB;&#xFF0C;&#x4F46;&#x4E0D;&#x592A;&#x5B89;&#x5168;&#xFF0C;mysqld&#x8FDB;&#x7A0B;&#x7684;&#x5D29;&#x6E83;&#x4F1A;&#x5BFC;&#x81F4;&#x4E0A;&#x4E00;&#x79D2;&#x949F;&#x6240;&#x6709;&#x4E8B;&#x52A1;&#x6570;&#x636E;&#x7684;&#x4E22;&#x5931;&#x3002; 3&#xFF09;&#x5F53;innodb_flush_log_at_trx_commit&#x8BBE;&#x7F6E;&#x4E3A;2&#xFF0C;&#x8BE5;&#x6A21;&#x5F0F;&#x901F;&#x5EA6;&#x8F83;&#x5FEB;&#xFF0C;&#x4E5F;&#x6BD4;0&#x5B89;&#x5168;&#xFF0C;&#x53EA;&#x6709;&#x5728;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5D29;&#x6E83;&#x6216;&#x8005;&#x7CFB;&#x7EDF;&#x65AD;&#x7535;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E0A;&#x4E00;&#x79D2;&#x949F;&#x6240;&#x6709;&#x4E8B;&#x52A1;&#x6570;&#x636E;&#x624D;&#x53EF;&#x80FD;&#x4E22;&#x5931;&#x3002; &#x53CC;1&#x9002;&#x5408;&#x6570;&#x636E;&#x5B89;&#x5168;&#x6027;&#x8981;&#x6C42;&#x975E;&#x5E38;&#x9AD8;&#xFF0C;&#x800C;&#x4E14;&#x78C1;&#x76D8;IO&#x5199;&#x80FD;&#x529B;&#x8DB3;&#x591F;&#x652F;&#x6301;&#x4E1A;&#x52A1;&#xFF0C;&#x6BD4;&#x5982;&#x8BA2;&#x5355;,&#x4EA4;&#x6613;,&#x5145;&#x503C;,&#x652F;&#x4ED8;&#x6D88;&#x8D39;&#x7CFB;&#x7EDF;&#x3002;&#x53CC;1&#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;&#x5F53;&#x78C1;&#x76D8;IO&#x65E0;&#x6CD5;&#x6EE1;&#x8DB3;&#x4E1A;&#x52A1;&#x9700;&#x6C42;&#x65F6; &#x6BD4;&#x5982;11.11 &#x6D3B;&#x52A8;&#x7684;&#x538B;&#x529B;&#x3002;&#x63A8;&#x8350;&#x7684;&#x505A;&#x6CD5;&#x662F; innodb_flush_log_at_trx_commit=2 &#xFF0C;sync_binlog=N (N&#x4E3A;500 &#x6216;1000) &#x4E14;&#x4F7F;&#x7528;&#x5E26;&#x84C4;&#x7535;&#x6C60;&#x540E;&#x5907;&#x7535;&#x6E90;&#x7684;&#x7F13;&#x5B58;cache&#xFF0C;&#x9632;&#x6B62;&#x7CFB;&#x7EDF;&#x65AD;&#x7535;&#x5F02;&#x5E38;&#x3002; &#x5C0F;&#x7ED3;&#x7CFB;&#x7EDF;&#x6027;&#x80FD;&#x548C;&#x6570;&#x636E;&#x5B89;&#x5168;&#x662F;&#x4E1A;&#x52A1;&#x7CFB;&#x7EDF;&#x9AD8;&#x53EF;&#x7528;&#x7A33;&#x5B9A;&#x7684;&#x5FC5;&#x8981;&#x56E0;&#x7D20;&#x3002;&#x6211;&#x4EEC;&#x5BF9;&#x7CFB;&#x7EDF;&#x7684;&#x4F18;&#x5316;&#x9700;&#x8981;&#x5BFB;&#x627E;&#x4E00;&#x4E2A;&#x5E73;&#x8861;&#x70B9;&#xFF0C;&#x5408;&#x9002;&#x7684;&#x624D;&#x662F;&#x6700;&#x597D;&#x7684;&#xFF0C;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#x9700;&#x6C42;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x505A;&#x7EC4;&#x5408;&#x8C03;&#x6574;&#xFF0C;&#x4EE5;&#x4FBF;&#x662F;db&#x7CFB;&#x7EDF;&#x7684;&#x6027;&#x80FD;&#x8FBE;&#x5230;&#x6700;&#x4F18;&#x5316;&#x3002; &#x8F6C;&#x81F3;https://www.jianshu.com/p/74b03a792ff8]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Cobbler部署及使用]]></title>
    <url>%2F2019%2F08%2F02%2FCobbler%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[&#x5B89;&#x88C5;123456curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repocurl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repoyum install cobbler cobbler-web python-pip httpd pykickstart cman xinetd dhcp -ypip install --upgrade pip -i https://pypi.tuna.tsinghua.edu.cn/simple requestspip install Django==1.8.9 -i https://pypi.tuna.tsinghua.edu.cn/simple requestsyum clean all &#x542F;&#x52A8;&#x670D;&#x52A1;1systemctl start httpd cobblerd &#x68C0;&#x67E5;&#x914D;&#x7F6E;1cobbler check &#x4FEE;&#x6539;&#x914D;&#x7F6E;1234567sed -i &apos;s/200/3000/g&apos; /etc/cobbler/pxe/pxedefault.templatesed -i &apos;s/server: 127.0.0.1/server: 192.168.1.10/&apos; /etc/cobbler/settingssed -i &apos;s/next_server: 127.0.0.1/next_server: 192.168.1.10/&apos; /etc/cobbler/settingssed -i &apos;s/manage_dhcp: 0/manage_dhcp: 1/&apos; /etc/cobbler/settingssed -i &apos;s/pxe_just_once: 0/pxe_just_once: 1/&apos; /etc/cobbler/settingssed -ri &quot;/default_password_crypted/s#(.*: ).*#\1\&quot;`openssl passwd -1 -salt &apos;huayun&apos; &apos;huayunOPS1123&apos;`\&quot;#&quot; /etc/cobbler/settingssed -i &apos;s#yes#no#&apos; /etc/xinetd.d/tftp &#x65F6;&#x533A;1timedatectl set-timezone Asia/Shanghai &#x83B7;&#x53D6;boot loaders1cobbler get-loaders &#x542F;&#x52A8;rsyncd1systemctl start rsyncd &#x91CD;&#x542F;cobblerd1systemctl restart cobblerd &#x540C;&#x6B65;&#x914D;&#x7F6E;1cobbler sync &#x518D;&#x6B21;&#x68C0;&#x67E5;1cobbler check &#x542F;&#x52A8;&#x5176;&#x4ED6;&#x670D;&#x52A1;12systemctl start xinetd dhcpd rsyncdsystemctl enable httpd cobblerd xinetd dhcpd rsyncd &#x5BFC;&#x5165;&#x7CFB;&#x7EDF;&#xFF1A;12345678mount -t iso9660 -o loop,ro /opt/CentOS-7-x86_64-DVD-1511.iso /mntcobbler import --path=/mnt --name=CentOS-7.2 --arch=x86_64umount /mntmount -t iso9660 -o loop,ro /opt/CentOS-7-x86_64-DVD-1804.iso /mntcobbler import --path=/mnt --name=CentOS-7.5 --arch=x86_64umount /mntmount -t iso9660 -o loop,ro /opt/CentOS-7-x86_64-DVD-1810.iso /mntcobbler import --path=/mnt --name=CentOS-7.6 --arch=x86_64 &#x67E5;&#x770B;&#x5217;&#x8868;1cobbler list web&#x9875;&#x9762;123cobbler_web(https)https://10.10.16.180/cobbler_webcobbler cobbler &#x81EA;&#x5B9A;&#x4E49;&#x7CFB;&#x7EDF;12345678cobbler system add --name=test2 --mac=22:da:49:2a:9e:52 --profile=CentOS-7.2-x86_64 \--hostname=test2 \--interface=eth0 \--ip-address=10.10.16.192 \--subnet=255.255.252.0 \--gateway=10.10.16.254 \--name-servers=&quot;114.114.114.114&quot; \--static=1 &#x91CD;&#x88C5;&#x7CFB;&#x7EDF;1&#x3001;&#x5B89;&#x88C5;koan&#x5DE5;&#x5177;123curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repocurl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repoyum install koan 2&#x3001;&#x7ED9;&#x670D;&#x52A1;&#x5668;&#x914D;&#x7F6E;&#x4E00;&#x4E2A;192.168.1&#x6BB5;&#x7684;ip1ifconfig eth0:0 192.168.1.21 3&#x3001;&#x67E5;&#x770B;&#x6709;&#x54EA;&#x4E9B;&#x7CFB;&#x7EDF;12345678910111213#&#x67E5;&#x770B;&#x6709;&#x54EA;&#x4E9B;&#x7CFB;&#x7EDF;[root@localhost ~]# koan --server 192.168.1.10 --list=profiles- looking for Cobbler at http://192.168.1.10:80/cobbler_apiCentOS-7.2-x86_64CentOS-7.5-x86_64CentOS-7.6-x86_64#&#x67E5;&#x770B;&#x6709;&#x54EA;&#x4E9B;&#x81EA;&#x5B9A;&#x4E49;&#x670D;&#x52A1;&#x5668;[root@localhost ~]# koan --server 192.168.1.10 --list=systems - looking for Cobbler at http://192.168.1.10:80/cobbler_apihuaweidellh3c 4&#x3001;&#x4F7F;&#x7528;h3c system&#x91CD;&#x88C5;&#x7CFB;&#x7EDF;12345678910111213[root@localhost ~]# koan --replace-self --server=192.168.1.10 --system=h3c- looking for Cobbler at http://192.168.1.10:80/cobbler_api- reading URL: http://192.168.1.10/cblr/svc/op/ks/system/h3cinstall_tree: http://192.168.1.10/cblr/links/CentOS-7.5-x86_64downloading initrd initrd.img to /boot/initrd.img_koanurl=http://192.168.1.10/cobbler/images/CentOS-7.5-x86_64/initrd.img- reading URL: http://192.168.1.10/cobbler/images/CentOS-7.5-x86_64/initrd.imgdownloading kernel vmlinuz to /boot/vmlinuz_koanurl=http://192.168.1.10/cobbler/images/CentOS-7.5-x86_64/vmlinuz- reading URL: http://192.168.1.10/cobbler/images/CentOS-7.5-x86_64/vmlinuz- [&apos;/sbin/grubby&apos;, &apos;--add-kernel&apos;, &apos;/boot/vmlinuz_koan&apos;, &apos;--initrd&apos;, &apos;/boot/initrd.img_koan&apos;, &apos;--args&apos;, &apos;&quot;ksdevice=link lang= text net.ifnames=0 ks=http://192.168.1.10/cblr/svc/op/ks/system/h3c biosdevname=0 kssendmac &quot;&apos;, &apos;--copy-default&apos;, &apos;--make-default&apos;, &apos;--title=kick1566199129&apos;]- [&apos;/sbin/grubby&apos;, &apos;--update-kernel&apos;, &apos;/boot/vmlinuz_koan&apos;, &apos;--remove-args=root&apos;]- reboot to apply changes]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>cobbler</tag>
        <tag>pxe</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Docker容器Removal In Progress删除方案]]></title>
    <url>%2F2019%2F05%2F20%2FDocker%E5%AE%B9%E5%99%A8Removal%20In%20Progress%E5%88%A0%E9%99%A4%E6%96%B9%E6%A1%88%2F</url>
    <content type="text"><![CDATA[1&#x3001;&#x5220;&#x9664;&#x65E0;&#x7528;&#x5BB9;&#x5668;&#x65F6;&#x62A5;&#x9519; 123[root@node3 ~]# docker rm ms-product.20190517ms-product.20190517Error response from daemon: container c4739fbec54da9ce6e18a14dc90a0f97da0d62a48df6f54c1e9ee94253e71ce8: driver &quot;overlay&quot; failed to remove root filesystem: remove /data/docker/overlay/abb6dcd4eebf472581036d0970829e9f1cecfcaa53b942a4ba29b8da143d9ac9/merged: device or resource busy 2&#x3001;&#x67E5;&#x770B;&#x8FD8;&#x6709;&#x54EA;&#x4E2A;&#x8FDB;&#x7A0B;&#x5360;&#x7528;&#x4E86;&#x5BB9;&#x5668;&#x8D44;&#x6E90; 1234567[root@node3 ~]# grep docker /proc/*/mountinfo | grep c4739fbec54d/proc/159001/mountinfo:1326 1301 0:183 / /var/lib/docker/containers/c4739fbec54da9ce6e18a14dc90a0f97da0d62a48df6f54c1e9ee94253e71ce8/mounts/shm rw,nosuid,nodev,noexec,relatime - tmpfs shm rw,size=65536k/proc/159001/mountinfo:1418 1393 0:183 / /var/lib/docker/overlay/8700c0ace6dc832714c7f9906423082f6c3345cc07b938f8a2515659f73f563e/merged/rootfs/data/docker/containers/c4739fbec54da9ce6e18a14dc90a0f97da0d62a48df6f54c1e9ee94253e71ce8/mounts/shm rw,nosuid,nodev,noexec,relatime - tmpfs shm rw,size=65536k[root@node3 ~]# ps auxwf |grep 159001root 181519 0.0 0.0 112648 980 pts/0 S+ 09:27 0:00 | \_ grep --color=auto 159001root 159001 7.7 0.1 6483088 104544 ? Ssl May07 1450:08 | | \_ /usr/bin/cadvisor -logtostderr &#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x662F;cadvisor&#x5BB9;&#x5668;&#x6B63;&#x5728;&#x5360;&#x7528;&#x4E86;&#x5176;&#x5B83;&#x5BB9;&#x5668;&#x7684;&#x8D44;&#x6E90; 3&#x3001;&#x505C;&#x6B62;cadvisor 1[root@node3 ~]# docker stop cadvisor 4&#x3001;&#x518D;&#x6B21;&#x6267;&#x884C;&#x5220;&#x9664; 12[root@node3 ~]# docker rm ms-product.20190517ms-product.20190517]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Docker CE 部署]]></title>
    <url>%2F2018%2F11%2F23%2FDocker%20CE%20%E9%83%A8%E7%BD%B2%2F</url>
    <content type="text"><![CDATA[&#x7CFB;&#x7EDF;&#xFF1A;CentOS7 &#x6700;&#x5C0F;&#x5316;&#x5B89;&#x88C5;&#x5378;&#x8F7D;&#x65E7;&#x7248;&#x672C;&#xFF08;&#x5982;&#x679C;&#x4E4B;&#x524D;&#x6709;&#x90E8;&#x7F72;&#xFF09;1yum remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-selinux docker-engine-selinux docker-engine &#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x5305;1yum install yum-utils device-mapper-persistent-data lvm2 &#x6DFB;&#x52A0;&#x56FD;&#x5185;&#x6E90;1yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo &#x5B89;&#x88C5;Docker CE1234yum install docker-ceCentOS7.4&#x4EE5;&#x4E0B;&#x7248;&#x672C;&#x5B89;&#x88C5;&#xFF1A;yum install docker-ce-18.06.2.ce-3.el7.x86_64 &#x542F;&#x52A8;Docker CE12systemctl enable dockersystemctl start docker Docker &#x662F;&#x5426;&#x5B89;&#x88C5;&#x6B63;&#x786E;1docker run hello-world &#x4F7F;&#x7528;&#x79C1;&#x6709;&#x955C;&#x50CF;&#x4ED3;&#x5E93;&#x51C6;&#x5907;&#x4F7F;&#x7528;&#x79C1;&#x6709;&#x955C;&#x50CF;&#x4ED3;&#x5E93;&#x524D;&#xFF0C;&#x5148;&#x7F16;&#x8F91;&#x6587;&#x4EF6; /etc/docker/daemon.json&#xFF0C;&#x914D;&#x7F6E;&#x5982;&#x4E0B;&#xFF1A; 1234[root@docker ~]# cat /etc/docker/daemon.json { &quot;insecure-registries&quot;:&quot;reg.cszhi.com&quot;]} &#x7F16;&#x8F91;&#x5B8C;&#x540E;&#x91CD;&#x542F;docker&#xFF1A; 1service docker restart]]></content>
      <categories>
        <category>DevOPS</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Nginx平滑升级]]></title>
    <url>%2F2018%2F11%2F03%2FNginx%E5%B9%B3%E6%BB%91%E5%8D%87%E7%BA%A7%2F</url>
    <content type="text"><![CDATA[Nginx&#x5E73;&#x6ED1;&#x5347;&#x7EA7;&#x5347;&#x7EA7;&#x76EE;&#x7684;&#x6DFB;&#x52A0;&#x6A21;&#x5757;nginx-module-vts&#xFF08;Nginx&#x7684;&#x76D1;&#x63A7;&#x6A21;&#x5757;&#xFF0C;&#x80FD;&#x591F;&#x8F93;&#x51FA;json&#x683C;&#x5F0F;&#x7684;&#x76D1;&#x63A7;&#x6570;&#x636E;&#xFF09; &#x5347;&#x7EA7;&#x6B65;&#x9AA4;&#x91CD;&#x65B0;&#x7F16;&#x8BD1;Nginx123git clone git://github.com/vozlt/nginx-module-vts.git./configure --prefix=/opt/nginx --with-http_stub_status_module --with-http_ssl_module --add-module=/opt/nginx-module-vts make &amp;&amp; make install &#x5907;&#x4EFD;&#x539F;&#x6765;&#x7684;Nginx&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x7F16;&#x8BD1;&#x597D;&#x7684;Nginx&#x6587;&#x4EF6;&#x62F7;&#x8D1D;&#x8FC7;&#x53BB;12mv /usr/sbin/nginx /usr/sbin/nginx.bkmv /opt/nginx /usr/sbin/nginx &#x6D4B;&#x8BD5;&#x4E00;&#x4E0B;&#x65B0;&#x7684;Nginx&#x6587;&#x4EF6;&#x662F;&#x5426;&#x751F;&#x6548;&#xFF1A;12nginx -tnginx -V &#x53D1;&#x9001;USR2&#x4FE1;&#x53F7;&#x7ED9;Nginx master &#x8FDB;&#x7A0B;12kill -USR2 `cat /run/nginx.pid`ps auxwf |grep nginx nginx&#x670D;&#x52A1;&#x63A5;&#x6536;&#x5230;USR2&#x4FE1;&#x53F7;&#x540E;&#xFF0C;&#x9996;&#x5148;&#x4F1A;&#x5C06;&#x65E7;&#x7684;nginx.pid&#x6587;&#x4EF6;&#x6DFB;&#x52A0;&#x540E;&#x7F00;.oldbin&#xFF0C;&#x53D8;&#x4E3A;nginx.pid.oldbin&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;&#x65B0;&#x7248;&#x672C;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#x542F;&#x52A8;&#x670D;&#x52A1;&#xFF0C;&#x5982;&#x679C;&#x65B0;&#x7684;&#x670D;&#x52A1;&#x542F;&#x52A8;&#x6210;&#x529F;&#xFF0C;&#x7CFB;&#x7EDF;&#x4E2D;&#x5C06;&#x6709;&#x65B0;&#x65E7;&#x4E24;&#x4E2A;nginx&#x670D;&#x52A1;&#x5171;&#x540C;&#x63D0;&#x4F9B;web&#x670D;&#x52A1; &#x53D1;&#x9001;WINCH&#x4FE1;&#x53F7;&#xFF08;&#x5E73;&#x7F13;&#x505C;&#x6B62;worker process&#xFF09;&#x548C;QUIT&#x4FE1;&#x53F7;&#xFF08;&#x5E73;&#x7F13;&#x505C;&#x6B62;nginx&#x670D;&#x52A1;&#xFF09;&#x505C;&#x6B62;&#x65E7;&#x7684;Nginx&#x670D;&#x52A1;&#x8FDB;&#x7A0B;123kill -WINCH `cat /run/nginx.pid.oldbin` kill -QUIT `cat /run/nginx.pid.oldbin` ps auxwf &#x5347;&#x7EA7;&#x5B8C;&#x6210;&#xFF0C;&#x67E5;&#x770B;&#x5347;&#x7EA7;&#x6548;&#x679C;12nginx -Vps auxwf]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CentOS7系统优化]]></title>
    <url>%2F2018%2F09%2F18%2FCentOS7%E7%B3%BB%E7%BB%9F%E4%BC%98%E5%8C%96%2F</url>
    <content type="text"><![CDATA[&#x963F;&#x91CC;&#x4E91;&#x6E90;&#xFF08;&#x53EF;&#x9009;&#xFF09;CentOS7&#x548C;epel-7 12wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repowget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo &#x5173;&#x95ED;selinux12sed -i &apos;s/SELINUX=enforcing/SELINUX=disabled/g&apos; /etc/selinux/configsetenforce 0 &#x914D;&#x7F6E;&#x6700;&#x5927;&#x6587;&#x4EF6;&#x6253;&#x5F00;&#x6570;&#x548C;&#x7528;&#x6237;&#x6700;&#x5927;&#x8FDB;&#x7A0B;&#x6570;123456echo -ne &quot; * soft nofile 65535 * hard nofile 65535* soft nproc 65535 * hard nproc 65535&quot; &gt;&gt;/etc/security/limits.conf ssh&#x4F18;&#x5316;12sed -i -e &apos;s/#Port 22/Port 2012/&apos; /etc/ssh/sshd_configecho &quot;UseDNS no&quot; &gt;&gt;/etc/ssh/sshd_config &#x505C;&#x7528;&#x81EA;&#x5E26;&#x9632;&#x706B;&#x5899;12systemctl stop firewalldsystemctl disable firewalld &#x5B89;&#x88C5;&#x5E38;&#x7528;&#x5DE5;&#x5177;&#xFF08;&#x53EF;&#x9009;&#xFF09;1yum install net-tools lrzsz lsof telnet wget nmap dos2unix screen tcpdump vim sysstat bind-utils ntpdate -y &#x547D;&#x4EE4;&#x5386;&#x53F2;&#x8BB0;&#x5F55;&#xFF08;&#x53EF;&#x9009;&#xFF09;1234cat &gt;&gt; /etc/profile &lt;&lt;&apos;EOF&apos;export PROMPT_COMMAND=&apos;{ date &quot;+[ %Y%m%d %H:%M:%S `whoami` `echo $SSH_CLIENT`] `history 1 | { read x cmd; echo &quot;$cmd&quot;; }`&quot;; } &gt;&gt; /opt/.history&apos;EOFtouch /opt/.history &amp;&amp; chmod 777 /opt/.history &#x5B89;&#x88C5;iptables&#x9632;&#x706B;&#x5899;&#xFF08;&#x53EF;&#x9009;&#xFF09;1yum install iptables-services]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>centos</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Apache2.4+PHP7.1部署]]></title>
    <url>%2F2018%2F04%2F22%2FApache2.4%2BPHP7.1%E9%83%A8%E7%BD%B2%2F</url>
    <content type="text"><![CDATA[&#x5B89;&#x88C5;apache1yum install httpd &#x8BBE;&#x7F6E;apache&#x5F00;&#x673A;&#x542F;&#x52A8;1chkconfig httpd on &#x914D;&#x7F6E;apachevi /etc/httpd/conf/httpd.conf &#x4FEE;&#x6539;&#x9ED8;&#x8BA4;&#x76D1;&#x542C;&#x7AEF;&#x53E3;&#x4E3A;88 80&#x7AEF;&#x53E3;&#x7ED9;nginx&#x7528; 1Listen 88 &#x8BBE;&#x7F6E;ServerName1ServerName localhost:80 &#x5F00;&#x542F;apache rewrite12345&lt;Directory &quot;/var/www/html&quot;&gt; ...... AllowOverride All ......&lt;/Directory&gt; &#x914D;&#x7F6E;&#x7AD9;&#x70B9;&#xFF08;&#x865A;&#x62DF;&#x4E3B;&#x673A;&#xFF09;&#xFF0C;&#x4EE5;&#x7528;&#x63A7;&#x4E3A;&#x4F8B;123456[root@host-10-10-10-4 conf.d]# cd /etc/httpd/conf.d[root@host-10-10-10-4 conf.d]# vi console.conflisten 8081&lt;VirtualHost *:8081&gt; DocumentRoot /var/www/html/console&lt;/VirtualHost&gt; &#x5B89;&#x88C5;php7.1&#x8BBE;&#x7F6E;&#x6E90;1234wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.reporpm -ivh http://rpms.famillecollet.com/enterprise/remi-release-7.rpmyum clean allyum makecache &#x5B89;&#x88C5;php7.1&#x53CA;&#x76F8;&#x5173;&#x6269;&#x5C55;1yum install --enablerepo=remi-php71 php php-opcache php-devel php-mbstring php-mcrypt php-pecl-xdebug php-openssl php-pear php-bcmath php-mysqlnd php-gd php-common php-fpm php-intl php-cli php-xml php-pecl-apcu php-pdo php-gmp php-process php-pecl-imagick &#x4FEE;&#x6539;php&#x914D;&#x7F6E;123vi /etc/php.iniupload_max_filesize = 100Mpost_max_size=110M &#x7981;&#x7528;&#x5371;&#x9669;&#x51FD;&#x6570;&#xFF08;&#x9700;&#x7814;&#x53D1;&#x786E;&#x8BA4;&#xFF09;&#xFF1A; 1disable_functions = exec,system,passthru,shell_exec,escapeshellarg,escapeshellcmd,proc_close,proc_open,dl,popen,show_source,pcntl_exec,mail swoole&#x6269;&#x5C55;&#x5B89;&#x88C5;&#xFF08;&#x63A8;&#x9001;&#x670D;&#x52A1;&#x9700;&#x8981;&#xFF09;&#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x5305;1yum install openssl-devel &#x4E0B;&#x8F7D;swoole&#x6E90;&#x7801;&#x5305;1wget https://github.com/swoole/swoole-src/archive/v2.0.8.tar.gz -O swoole-src-2.0.8.tar.gz &#x89E3;&#x538B;1tar zxvf swoole-src-2.0.8.tar.gz &#x7F16;&#x8BD1;&#x5B89;&#x88C5;1234cd swoole-src-2.0.8phpize./configure --enable-opensslmake &amp;&amp; make install &#x914D;&#x7F6E;&#x4FEE;&#x6539;php.ini&#xFF0C;&#x5728;&#x6587;&#x4EF6;&#x7ED3;&#x5C3E;&#x52A0;&#x4E0A;&#xFF1A;extension=swoole.so 1echo &quot;extension=[swoole.so](http://swoole.so/)&quot; &gt;&gt;/etc/php.ini &#x91CD;&#x542F;apahce&#xFF0C;&#x786E;&#x8BA4;swoole&#x5B89;&#x88C5;&#x6210;&#x529F;123[root@host-10-10-10-4 swoole-src-2.0.8]# systemctl restart httpd[root@host-10-10-10-4 swoole-src-2.0.8]# php -m |grep swooleswoole]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>apache</tag>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[TinyProxy http代理]]></title>
    <url>%2F2018%2F02%2F21%2FTinyProxy%20http%E4%BB%A3%E7%90%86%2F</url>
    <content type="text"><![CDATA[Tinyproxy &#x662F;&#x4E00;&#x4E2A;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;&#x5F00;&#x6E90; web &#x4EE3;&#x7406;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#xFF0C;&#x5176;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;&#x662F;&#x5FEB;&#x800C;&#x5C0F;&#x3002;&#x5B83;&#x9002;&#x7528;&#x4E8E;&#x9700;&#x8981;&#x5B8C;&#x6574; HTTP &#x4EE3;&#x7406;&#x7279;&#x6027;&#xFF0C;&#x4F46;&#x7CFB;&#x7EDF;&#x8D44;&#x6E90;&#x53C8;&#x4E0D;&#x8DB3;&#x4EE5;&#x8FD0;&#x884C;&#x5927;&#x578B;&#x4EE3;&#x7406;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x6BD4;&#x5982;&#x5D4C;&#x5165;&#x5F0F;&#x90E8;&#x7F72;&#x3002; Tinyproxy &#x5BF9;&#x5C0F;&#x89C4;&#x6A21;&#x7F51;&#x7EDC;&#x975E;&#x5E38;&#x6709;&#x7528;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x573A;&#x5408;&#x4E0B;&#x5927;&#x578B;&#x4EE3;&#x7406;&#x4F1A;&#x4F7F;&#x7CFB;&#x7EDF;&#x8D44;&#x6E90;&#x7D27;&#x5F20;&#xFF0C;&#x6216;&#x6709;&#x5B89;&#x5168;&#x98CE;&#x9669;&#x3002;Tinyproxy &#x7684;&#x4E00;&#x4E2A;&#x5173;&#x952E;&#x7279;&#x6027;&#x662F;&#x5176;&#x7F13;&#x51B2;&#x8FDE;&#x63A5;&#x7684;&#x7406;&#x5FF5;&#x3002;&#x4ECE;&#x6548;&#x679C;&#x4E0A;&#x770B;&#xFF0C; Tinyproxy &#x5BF9;&#x670D;&#x52A1;&#x5668;&#x7684;&#x54CD;&#x5E94;&#x8FDB;&#x884C;&#x4E86;&#x9AD8;&#x901F;&#x7F13;&#x51B2;&#xFF0C;&#x7136;&#x540E;&#x6309;&#x7167;&#x5BA2;&#x6237;&#x7AEF;&#x80FD;&#x591F;&#x5904;&#x7406;&#x7684;&#x6700;&#x9AD8;&#x901F;&#x5EA6;&#x8FDB;&#x884C;&#x54CD;&#x5E94;&#x3002;&#x8BE5;&#x7279;&#x6027;&#x6781;&#x5927;&#x7684;&#x964D;&#x4F4E;&#x4E86;&#x7F51;&#x7EDC;&#x5EF6;&#x6EDE;&#x5E26;&#x6765;&#x7684;&#x95EE;&#x9898;&#x3002; &#x5B89;&#x88C5; TinyProxy1yum -y install tinyproxy debian&#x7CFB;&#xFF1A;apt-get install tinyproxy &#x914D;&#x7F6E; TinyProxy1vim /etc/tinyproxy/tinyproxy.conf &#x4FEE;&#x6539; Port &#x7AEF;&#x53E3;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A; 88881Port 8888 &#x6CE8;&#x91CA;&#x6389; Allow1#Allow 127.0.0.1 &#x8868;&#x793A;&#x5141;&#x8BB8;&#x6240;&#x6709;&#x4EBA;&#x8BBF;&#x95EE;&#x4EE3;&#x7406; &#x9690;&#x85CF;&#x6389;Via&#x8BF7;&#x6C42;&#x5934;&#x90E8;&#xFF0C;&#x53BB;&#x6389;&#x4E0B;&#x9762;&#x7684;&#x6CE8;&#x91CA;1DisableViaHeader Yes &#x66F4;&#x591A;&#x914D;&#x7F6E;&#x9879;&#xFF0C;&#x4E0B;&#x9762;&#x662F;&#x5217;&#x4E3E;&#x4E00;&#x4E9B;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x9ED8;&#x8BA4;&#x7684;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x914D;&#x7F6E;1234567PidFile &quot;/var/run/tinyproxy/tinyproxy.pid&quot;LogFile &quot;/var/log/tinyproxy/tinyproxy.log&quot;LogLevel InfoMaxClients 100MinSpareServers 5MaxSpareServers 20StartServers 10 &#x542F;&#x52A8; TinyProxy12345systemctl start tinyproxy.service systemctl restart tinyproxy.service systemctl stop tinyproxy.service systemctl status tinyproxy.service systemctl enable tinyproxy.service &#x914D;&#x7F6E;&#x9632;&#x706B;&#x5899;12firewall-cmd --add-port=8888/tcp --permanentfirewall-cmd --reload linux&#x670D;&#x52A1;&#x5668;&#x914D;&#x7F6E;&#x4F7F;&#x7528;&#x4EE3;&#x7406;12export http_proxy=http://xxxxxx:xxxxexport https_proxy=http://xxxxxx:xxxx &#x53D6;&#x6D88;&#x4EE3;&#x7406;1unset http_proxy https_proxy]]></content>
      <categories>
        <category>技巧</category>
      </categories>
      <tags>
        <tag>代理</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redis之数据持久化RDB与AOF]]></title>
    <url>%2F2017%2F08%2F13%2FRedis%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96RDB%E4%B8%8EAOF%2F</url>
    <content type="text"><![CDATA[&#x5927;&#x5BB6;&#x90FD;&#x77E5;&#x9053;&#xFF0C;Redis&#x4E4B;&#x6240;&#x4EE5;&#x6027;&#x80FD;&#x597D;&#xFF0C;&#x8BFB;&#x5199;&#x5FEB;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;Redis&#x662F;&#x4E00;&#x4E2A;&#x5185;&#x5B58;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5B83;&#x7684;&#x64CD;&#x4F5C;&#x90FD;&#x51E0;&#x4E4E;&#x57FA;&#x4E8E;&#x5185;&#x5B58;&#x3002;&#x4F46;&#x662F;&#x5185;&#x5B58;&#x578B;&#x6570;&#x636E;&#x5E93;&#x6709;&#x4E00;&#x4E2A;&#x5F88;&#x5927;&#x7684;&#x5F0A;&#x7AEF;&#xFF0C;&#x5C31;&#x662F;&#x5F53;&#x6570;&#x636E;&#x5E93;&#x8FDB;&#x7A0B;&#x5D29;&#x6E83;&#x6216;&#x7CFB;&#x7EDF;&#x91CD;&#x542F;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;&#x5185;&#x5B58;&#x6570;&#x636E;&#x4E0D;&#x4FDD;&#x5B58;&#x7684;&#x8BDD;&#xFF0C;&#x91CC;&#x9762;&#x7684;&#x6570;&#x636E;&#x5C31;&#x4F1A;&#x4E22;&#x5931;&#x4E0D;&#x89C1;&#x4E86;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x6570;&#x636E;&#x5E93;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x53EF;&#x9760;&#x7684;&#x6570;&#x636E;&#x5E93;&#x3002; &#x6240;&#x4EE5;&#x6570;&#x636E;&#x7684;&#x6301;&#x4E45;&#x5316;&#x662F;&#x5185;&#x5B58;&#x578B;&#x6570;&#x636E;&#x5E93;&#x7684;&#x91CD;&#x4E2D;&#x4E4B;&#x91CD;&#x3002;&#x5B83;&#x4E0D;&#x4EC5;&#x63D0;&#x4F9B;&#x6570;&#x636E;&#x4FDD;&#x5B58;&#x786C;&#x76D8;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x501F;&#x6B64;&#x7528;&#x786C;&#x76D8;&#x5BB9;&#x91CF;&#x6269;&#x5C55;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#xFF0C;&#x4F7F;&#x5F97;Redis&#x7684;&#x53EF;&#x4EE5;&#x5B58;&#x50A8;&#x8D85;&#x8FC7;&#x673A;&#x5668;&#x672C;&#x8EAB;&#x5185;&#x5B58;&#x5927;&#x5C0F;&#x7684;&#x6570;&#x636E;&#x3002; Redis&#x5BF9;&#x4E8E;&#x6570;&#x636E;&#x6301;&#x4E45;&#x5316;&#x63D0;&#x4F9B;&#x4E86;&#x4E24;&#x79CD;&#x6301;&#x4E45;&#x5316;&#x7684;&#x65B9;&#x6848;&#xFF0C;RDB&#x4E0E;AOF&#x3002;&#x5B83;&#x4EEC;&#x7684;&#x539F;&#x7406;&#x548C;&#x4F7F;&#x7528;&#x573A;&#x666F;&#x90FD;&#x5927;&#x4E0D;&#x76F8;&#x540C;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x8BE6;&#x7EC6;&#x5730;&#x4E86;&#x89E3;&#x4E0B;&#x3002; RDB&#x2014;&#x2014;&#x6570;&#x636E;&#x5FEB;&#x7167;&#xFF08;Snapshot&#xFF09;RDB&#xFF0C;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x67D0;&#x4E2A;&#x65F6;&#x95F4;&#x70B9;&#x7684;&#x6570;&#x636E;&#x7684;Snapshot&#xFF0C;&#x4FDD;&#x5B58;&#x5728;RDB&#x6587;&#x4EF6;&#x4E2D;&#x3002;&#x5B83;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;SAVE/BGSAVE&#x547D;&#x4EE4;&#x624B;&#x52A8;&#x6267;&#x884C;&#xFF0C;&#x628A;&#x6570;&#x636E;Snapshot&#x5199;&#x5230;RDB&#x6587;&#x4EF6;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x914D;&#x7F6E;&#xFF0C;&#x5B9A;&#x65F6;&#x6267;&#x884C;&#x3002; Redis&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x52A0;&#x8F7D;RDB&#x6587;&#x4EF6;&#xFF0C;&#x628A;&#x6570;&#x636E;&#x4ECE;&#x78C1;&#x76D8;&#x52A0;&#x8F7D;&#x8BFB;&#x53D6;&#x5230;Redis&#x4E2D;&#x3002; RDB&#x6587;&#x4EF6;&#x521B;&#x5EFA;&#x8FDE;&#x4E0A;Redis&#xFF0C;&#x8BBE;&#x503C;&#x4E00;&#x4E9B;&#x503C;&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;SAVE&#x547D;&#x4EE4;&#x3002; &#x7136;&#x540E;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x4E0B;redis.conf&#x7684;&#x6301;&#x4E45;&#x5316;&#x5DE5;&#x4F5C;&#x76EE;&#x5F55;&#x3002;&#x8FDB;&#x5165;&#x76EE;&#x5F55;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4FDD;&#x5B58;&#x4E86;&#x4E00;&#x4E2A;dump.rdb&#x6587;&#x4EF6;&#x3002;&#x8BE5;&#x6587;&#x4EF6;&#x662F;&#x4E00;&#x4E2A;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#xFF0C;&#x65E0;&#x6CD5;&#x76F4;&#x63A5;&#x6B63;&#x5E38;&#x6253;&#x5F00;&#x3002; &#x81F3;&#x4E8E;SAVE/BGSAVE&#x7684;&#x533A;&#x522B;&#xFF0C;&#x5C31;&#x662F;&#x524D;&#x7F6E;&#x662F;&#x963B;&#x585E;&#x6267;&#x884C;&#xFF0C;&#x6B64;&#x65F6;&#x670D;&#x52A1;&#x4E0D;&#x4F1A;&#x63A5;&#x53D7;&#x8BF7;&#x6C42;&#xFF0C;&#x540E;&#x8005;&#x662F;Fork&#x4E00;&#x4E2A;&#x5B50;&#x8FDB;&#x7A0B;&#x51FA;&#x6765;&#xFF0C;&#x7531;&#x8BE5;&#x8FDB;&#x7A0B;&#x53BB;&#x6267;&#x884C;&#x4FDD;&#x5B58;RDB&#x6587;&#x4EF6;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x4E0D;&#x5F71;&#x54CD;&#x7528;&#x6237;&#x8BF7;&#x6C42;&#x3002; P.S. Redis&#x662F;&#x5355;&#x8FDB;&#x7A0B;&#x7684;&#xFF0C;&#x6240;&#x4EE5;BGSAVE&#x53EA;&#x80FD;Fork&#x4E00;&#x4E2A;&#x5B50;&#x8FDB;&#x7A0B;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5904;&#x7406;&#x3002; &#x4EE5;&#x4E0A;&#x662F;&#x624B;&#x52A8;&#x6267;&#x884C;&#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x4F46;&#x5728;&#x751F;&#x4EA7;&#x6211;&#x4EEC;&#x5F88;&#x5C11;&#x4F1A;&#x624B;&#x52A8;&#x767B;&#x4E0A;&#x670D;&#x52A1;&#x53BB;&#x6267;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x6240;&#x4EE5;&#x66F4;&#x591A;&#x7684;&#x65F6;&#x5019;&#x662F;&#x4F9D;&#x8D56;Redis&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x5B9A;&#x65F6;&#x4FDD;&#x5B58;RDB&#x6587;&#x4EF6;&#x3002; &#x6253;&#x5F00;redis.conf&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x627E;&#x5230;SNAPSHOTTING&#x7684;&#x914D;&#x7F6E;&#xFF0C;Save Point&#x7684;&#x8BBE;&#x7F6E;&#x3002; save 900 1 &#xFF1A; &#x8868;&#x793A;15&#x5206;&#x949F;&#xFF08;900&#x79D2;&#x949F;&#xFF09;&#x5185;&#x81F3;&#x5C11;1&#x4E2A;&#x952E;&#x88AB;&#x66F4;&#x6539;&#x5219;&#x8FDB;&#x884C;&#x5FEB;&#x7167;&#x3002; save 300 10 &#xFF1A; &#x8868;&#x793A;5&#x5206;&#x949F;&#xFF08;300&#x79D2;&#xFF09;&#x5185;&#x81F3;&#x5C11;10&#x4E2A;&#x952E;&#x88AB;&#x66F4;&#x6539;&#x5219;&#x8FDB;&#x884C;&#x5FEB;&#x7167;&#x3002; save 60 10000 &#xFF1A;&#x8868;&#x793A;1&#x5206;&#x949F;&#x5185;&#x81F3;&#x5C11;10000&#x4E2A;&#x952E;&#x88AB;&#x66F4;&#x6539;&#x5219;&#x8FDB;&#x884C;&#x5FEB;&#x7167;&#x3002; &#x8FD9;&#x91CC;&#x5C31;&#x662F; Redis &#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#xFF0C;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x591A;&#x4E2A;&#x6761;&#x4EF6;&#xFF08;&#x6BCF;&#x884C;&#x914D;&#x7F6E;&#x4E00;&#x4E2A;&#x6761;&#x4EF6;&#xFF09;&#xFF0C;&#x6BCF;&#x4E2A;&#x6761;&#x4EF6;&#x4E4B;&#x95F4;&#x662F;&#x201C;&#x6216;&#x201D;&#x7684;&#x5173;&#x7CFB;&#x3002; &#x5728;Redis&#x4E2D;&#xFF0C;&#x8FD9;&#x4E2A;&#x81EA;&#x52A8;&#x4FDD;&#x5B58;RDB&#x7684;&#x529F;&#x80FD;&#x662F;&#x9ED8;&#x8BA4;&#x5F00;&#x542F;&#x7684;&#x3002; RDB&#x539F;&#x7406; Redis &#x4F7F;&#x7528; fork &#x51FD;&#x6570;&#x590D;&#x5236;&#x4E00;&#x4EFD;&#x5F53;&#x524D;&#x8FDB;&#x7A0B;&#x7684;&#x526F;&#x672C;(&#x5B50;&#x8FDB;&#x7A0B;) &#x7236;&#x8FDB;&#x7A0B;&#x7EE7;&#x7EED;&#x63A5;&#x6536;&#x5E76;&#x5904;&#x7406;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x6765;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x800C;&#x5B50;&#x8FDB;&#x7A0B;&#x5F00;&#x59CB;&#x5C06;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x5199;&#x5165;&#x786C;&#x76D8;&#x4E2D;&#x7684;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x3002; &#x5F53;&#x5B50;&#x8FDB;&#x7A0B;&#x5199;&#x5165;&#x5B8C;&#x6240;&#x6709;&#x6570;&#x636E;&#x540E;&#x4F1A;&#x7528;&#x8BE5;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x66FF;&#x6362;&#x65E7;&#x7684;RDB&#x6587;&#x4EF6;&#xFF0C;&#x81F3;&#x6B64;&#xFF0C;&#x4E00;&#x6B21;&#x5FEB;&#x7167;&#x64CD;&#x4F5C;&#x5B8C;&#x6210;&#x3002; &#x6CE8;&#x610F;&#x4E8B;&#x9879; Redis &#x5728;&#x8FDB;&#x884C;&#x5FEB;&#x7167;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x4E0D;&#x4F1A;&#x4FEE;&#x6539; RDB &#x6587;&#x4EF6;&#xFF0C;&#x53EA;&#x6709;&#x5FEB;&#x7167;&#x7ED3;&#x675F;&#x540E;&#x624D;&#x4F1A;&#x5C06;&#x65E7;&#x7684;&#x6587;&#x4EF6;&#x66FF;&#x6362;&#x6210;&#x65B0;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x4EFB;&#x4F55;&#x65F6;&#x5019; RDB &#x6587;&#x4EF6;&#x90FD;&#x662F;&#x5B8C;&#x6574;&#x7684;&#x3002; &#x8FD9;&#x5C31;&#x4F7F;&#x5F97;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5B9A;&#x65F6;&#x5907;&#x4EFD; RDB &#x6587;&#x4EF6;&#x6765;&#x5B9E;&#x73B0; Redis &#x6570;&#x636E;&#x5E93;&#x7684;&#x5907;&#x4EFD;&#xFF0C; RDB &#x6587;&#x4EF6;&#x662F;&#x7ECF;&#x8FC7;&#x538B;&#x7F29;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#xFF0C;&#x5360;&#x7528;&#x7684;&#x7A7A;&#x95F4;&#x4F1A;&#x5C0F;&#x4E8E;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x66F4;&#x52A0;&#x5229;&#x4E8E;&#x4F20;&#x8F93;&#x3002; RDB&#x4F18;&#x7F3A;&#x70B9;&#x4F18;&#x70B9;&#xFF1A; RDB&#x662F;&#x67D0;&#x4E00;&#x65F6;&#x95F4;&#x70B9;&#x7684;&#x5FEB;&#x7167;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x7D27;&#x51D1;&#x7684;&#x5355;&#x6587;&#x4EF6;&#xFF0C;&#x66F4;&#x591A;&#x7528;&#x4E8E;&#x6570;&#x636E;&#x5907;&#x4EFD;&#x3002;&#x53EF;&#x4EE5;&#x6309;&#x6BCF;&#x5C0F;&#x65F6;&#x6216;&#x6BCF;&#x65E5;&#x6765;&#x5907;&#x4EFD;&#xFF0C;&#x65B9;&#x4FBF;&#x4ECE;&#x4E0D;&#x540C;&#x7684;&#x7248;&#x672C;&#x6062;&#x590D;&#x6570;&#x636E;&#x3002; &#x5355;&#x6587;&#x4EF6;&#x5BB9;&#x6613;&#x4F20;&#x8F93;&#x5230;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x505A;&#x6545;&#x969C;&#x6062;&#x590D;&#x3002; RDB&#x53EF;&#x4EE5;Fork&#x5B50;&#x8FDB;&#x7A0B;&#x8FDB;&#x884C;&#x6301;&#x4E45;&#x5316;&#xFF0C;&#x4F7F;Redis&#x53EF;&#x4EE5;&#x66F4;&#x597D;&#x5730;&#x5904;&#x7406;&#x7528;&#x6237;&#x8BF7;&#x6C42; &#x5728;&#x5927;&#x91CF;&#x6570;&#x636E;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;RDB&#x76F8;&#x6BD4;&#x8F83;&#x4E8E;AOF&#x4F1A;&#x66F4;&#x5FEB;&#x7684;&#x52A0;&#x8F7D;&#x3002; &#x7F3A;&#x70B9;&#xFF1A; &#x5982;&#x679C;Redis&#x4E0D;&#x53CA;&#x65F6;&#x4FDD;&#x5B58;RDB&#x6587;&#x4EF6;&#xFF0C;&#x4F1A;&#x9020;&#x6210;&#x6570;&#x636E;&#x7684;&#x4E22;&#x5931;&#x3002;&#x4F8B;&#x5982;&#x7CFB;&#x7EDF;&#x7A81;&#x7136;&#x65AD;&#x7535;&#xFF0C;&#x4F46;&#x672A;&#x6765;&#x5F97;&#x53CA;&#x4FDD;&#x5B58;&#x6570;&#x636E;&#x3002;&#x5373;&#x4F7F;&#x4F60;&#x8BBE;&#x7F6E;&#x66F4;&#x591A;&#x7684;Save point&#xFF0C;&#x4E5F;&#x65E0;&#x6CD5;&#x4FDD;&#x8BC1;100%&#x7684;&#x6570;&#x636E;&#x4E0D;&#x4E22;&#x5931;&#x3002; RDB&#x7ECF;&#x5E38;&#x9700;&#x8981;fork&#x5B50;&#x8FDB;&#x7A0B;&#x53BB;&#x6267;&#x884C;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x518D;&#x5927;&#x91CF;&#x6570;&#x636E;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x4E2A;fork&#x64CD;&#x4F5C;&#x4F1A;&#x975E;&#x5E38;&#x8017;CPU&#x8D44;&#x6E90;&#x7684;&#x3002;&#x5BF9;&#x6BD4;AOF&#x867D;&#x7136;&#x4E5F;&#x662F;fork&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x7684;&#x6570;&#x636E;&#x4FDD;&#x5B58;&#x5904;&#x7406;&#x662F;&#x53EF;&#x4EE5;&#x63A7;&#x5236;&#x7684;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x5168;&#x91CF;&#x4FDD;&#x5B58;&#x3002; AOF&#x2014;&#x2014;&#x65E5;&#x5FD7;&#x8FFD;&#x52A0;&#xFF08;Append-Only&#xFF09;Redis&#x7684;&#x53E6;&#x5916;&#x4E00;&#x79CD;&#x6301;&#x4E45;&#x5316;&#x65B9;&#x6848;&#x5C31;&#x662F;AOF&#xFF0C;Append Only File&#x3002;AOF&#x76F8;&#x5F53;&#x4E8E;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x7684;&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;&#xFF0C;&#x6BCF;&#x6B21;&#x5BF9;&#x4E8E;&#x6570;&#x636E;&#x7684;&#x53D8;&#x66F4;&#x90FD;&#x4F1A;&#x8BB0;&#x5F55;&#x8FFD;&#x52A0;&#x5230;AOF&#x65E5;&#x5FD7;&#x3002;&#x5F53;&#x670D;&#x52A1;&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x4F1A;&#x8BFB;&#x8FD9;&#x4E9B;&#x64CD;&#x4F5C;&#x65E5;&#x5FD7;&#xFF0C;&#x91CD;&#x65B0;&#x6267;&#x884C;&#x4E00;&#x6B21;&#x64CD;&#x4F5C;&#xFF0C;&#x4ECE;&#x800C;&#x6062;&#x590D;&#x539F;&#x59CB;&#x6570;&#x636E;&#x3002; AOF&#x542F;&#x7528;AOF&#x9ED8;&#x8BA4;&#x662F;&#x5173;&#x95ED;&#x7684;&#x3002;&#x6253;&#x5F00;redis.conf&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x627E;&#x5230;appendonly no&#x6539;&#x6210;appendonly yes&#x3002; AOF&#x548C;RDB&#x662F;&#x53EF;&#x4EE5;&#x5171;&#x5B58;&#x7684;&#xFF0C;&#x53EA;&#x8981;&#x4FDD;&#x5B58;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x4E0D;&#x51B2;&#x7A81;&#x3002; AOF fsync&#x540C;&#x6B65;&#x89C4;&#x5219;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5F80;&#x4E0B;&#x62C9;&#xFF0C;&#x770B;&#x5230;fsync&#x7684;&#x914D;&#x7F6E;&#x3002; Redis &#x6BCF;&#x6B21;&#x66F4;&#x6539;&#x6570;&#x636E;&#x7684;&#x65F6;&#x5019;&#xFF0C; aof &#x673A;&#x5236;&#x90FD;&#x4F1A;&#x5C06;&#x547D;&#x4EE4;&#x8BB0;&#x5F55;&#x5230; aof &#x6587;&#x4EF6;&#xFF0C;&#x4F46;&#x662F;&#x5B9E;&#x9645;&#x4E0A;&#x7531;&#x4E8E;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x7F13;&#x5B58;&#x673A;&#x5236;&#xFF0C;&#x6570;&#x636E;&#x5E76;&#x6CA1;&#x6709;&#x5B9E;&#x65F6;&#x5199;&#x5165;&#x5230;&#x786C;&#x76D8;&#xFF0C;&#x800C;&#x662F;&#x8FDB;&#x5165;&#x786C;&#x76D8;&#x7F13;&#x5B58;&#x3002;&#x518D;&#x901A;&#x8FC7;&#x786C;&#x76D8;&#x7F13;&#x5B58;&#x673A;&#x5236;&#x53BB;&#x5237;&#x65B0;&#x5230;&#x4FDD;&#x5B58;&#x5230;&#x6587;&#x4EF6;&#x3002; fsync()&#x662F;&#x4E00;&#x4E2A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x51FD;&#x6570;&#xFF0C;&#x544A;&#x8BC9;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x628A;&#x6570;&#x636E;&#x5199;&#x5230;&#x786C;&#x76D8;&#x4E0A;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x7F13;&#x5B58;&#x66F4;&#x591A;&#x6570;&#x636E;&#x624D;&#x5199;&#x5230;&#x786C;&#x76D8;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8C03;&#x7528;&#x53EF;&#x4EE5;&#x53CA;&#x65F6;&#x4FDD;&#x5B58;&#x6570;&#x636E;&#x5230;&#x786C;&#x76D8;&#x4E0A;&#x3002; Redis&#x63D0;&#x4F9B;&#x4E86;&#x4E09;&#x79CD;fsync&#x7684;&#x8C03;&#x7528;&#x65B9;&#x5F0F; appendfsync always&#xFF0C;&#x6BCF;&#x6B21;&#x64CD;&#x4F5C;&#x8BB0;&#x5F55;&#x90FD;&#x540C;&#x6B65;&#x5230;&#x786C;&#x76D8;&#x4E0A;&#xFF0C;&#x6700;&#x4F4E;&#x6548;&#xFF0C;&#x6700;&#x5B89;&#x5168;&#x3002; appendfsync everysec&#xFF0C;&#x6BCF;&#x79D2;&#x6267;&#x884C;&#x4E00;&#x6B21;&#x628A;&#x64CD;&#x4F5C;&#x8BB0;&#x5F55;&#x540C;&#x6B65;&#x5230;&#x786C;&#x76D8;&#x4E0A;&#x3002;&#x9ED8;&#x8BA4;&#x9009;&#x9879;&#x3002; appendfsync no&#xFF0C;&#x4E0D;&#x6267;&#x884C;fysnc&#x8C03;&#x7528;&#xFF0C;&#x8BA9;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x81EA;&#x52A8;&#x64CD;&#x4F5C;&#x628A;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x5199;&#x5230;&#x786C;&#x76D8;&#x4E0A;&#xFF0C;&#x4E0D;&#x53EF;&#x9760;&#xFF0C;&#x4F46;&#x6700;&#x5FEB;&#x3002; AOF&#x6587;&#x4EF6;&#x683C;&#x5F0F;&#x89E3;&#x6790;&#x5F00;&#x542F;AOF&#x540E;&#xFF0C;&#x4F1A;&#x518D;&#x5DE5;&#x4F5C;&#x76EE;&#x5F55;&#x770B;&#x5230;appendonly.aof&#x6587;&#x4EF6;&#x3002; &#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x4E0A;&#x6267;&#x884C;&#x4E00;&#x4E9B;&#x547D;&#x4EE4;&#x540E;&#xFF0C;&#x6253;&#x5F00;AOF&#x6587;&#x4EF6;&#xFF0C;&#x53EF;&#x4EE5;&#x89C2;&#x5BDF;&#x5230;&#x6709;&#x5BF9;&#x5E94;&#x7684;&#x64CD;&#x4F5C;&#x7684;&#x8BB0;&#x5F55;&#x65E5;&#x5FD7;&#x3002; 12345127.0.0.1:6379&gt; set x 1OK127.0.0.1:6379&gt; set y 2OK127.0.0.1:6379&gt; set z 3 &#x6587;&#x4EF6;&#x89E3;&#x6790;&#x8BF4;&#x660E;&#xFF1A; *&#xFF0C;&#x8868;&#x793A;&#x547D;&#x4EE4;&#x7684;&#x53C2;&#x6570;&#x4E2A;&#x6570;&#xFF0C;&#x4F8B;&#x5982;set a 1&#x662F;&#x4E09;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x6240;&#x4EE5;&#x662F;*3 $&#xFF0C;&#x8868;&#x793A;&#x53C2;&#x6570;&#x7684;&#x5B57;&#x8282;&#x6570;&#xFF0C;&#x4F8B;&#x5982;set&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x4E09;&#x5B57;&#x8282;&#xFF0C;&#x6240;&#x4EE5;&#x662F;$3&#xFF0C;key&#x503C;a&#x662F;&#x4E00;&#x4E2A;&#x5B57;&#x8282;&#xFF0C;&#x6240;&#x4EE5;&#x662F;$1 &#x65E0;&#x7B26;&#x53F7;&#xFF0C;&#x8868;&#x793A;&#x662F;&#x53C2;&#x6570;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4F8B;&#x5982;set,a,1&#x5C31;&#x662F;&#x5177;&#x4F53;&#x7684;&#x6570;&#x636E; AOF&#x91CD;&#x5199;AOF&#x867D;&#x7136;&#x6BD4;RDB&#x66F4;&#x53EF;&#x9760;&#xFF0C;&#x4F46;&#x7F3A;&#x70B9;&#x4E5F;&#x662F;&#x6BD4;&#x8F83;&#x660E;&#x663E;&#x7684;&#xFF0C;&#x5C31;&#x662F;&#x6BCF;&#x6B21;&#x5199;&#x64CD;&#x4F5C;&#x90FD;&#x8981;&#x628A;&#x64CD;&#x4F5C;&#x65E5;&#x5FD7;&#x5199;&#x5230;&#x6587;&#x4EF6;&#x4E0A;&#xFF0C;&#x8FD9;&#x6837;&#x4F1A;&#x5BFC;&#x81F4;&#x6587;&#x4EF6;&#x975E;&#x5E38;&#x5197;&#x4F59;&#x3002; &#x5047;&#x82E5;&#x4F60;&#x8981;&#x81EA;&#x589E;&#x4E00;&#x4E2A;&#x8BA1;&#x6570;&#x5668;100&#x6B21;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x91CD;&#x5199;&#xFF0C;AOF&#x6587;&#x4EF6;&#x5C31;&#x5C31;&#x4F1A;&#x6709;&#x8FD9;100&#x6B21;&#x7684;&#x81EA;&#x589E;&#x8BB0;&#x5F55;&#xFF0C;&#x5982;INCR a&#x3002;&#x5982;&#x679C;&#x6267;&#x884C;&#x4E86;&#x65E5;&#x5FD7;&#x91CD;&#x5199;&#xFF0C;&#x90A3;&#x4E48;&#x6587;&#x4EF6;&#x53EA;&#x4F1A;&#x4FDD;&#x7559;set a 100&#x800C;&#x4E0D;&#x662F;100&#x6761;INCR a&#x3002;&#x8FD9;&#x6837;&#x62E5;&#x6709;&#x76F8;&#x540C;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x4F46;&#x53EF;&#x4EE5;&#x5927;&#x5927;&#x51CF;&#x5C11;AOF&#x7684;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x8BA9;AOF&#x8F7D;&#x5165;&#x7684;&#x65F6;&#x5019;&#x63D0;&#x5347;&#x8F7D;&#x5165;&#x7684;&#x6548;&#x7387;&#x3002; &#x770B;&#x56DE;redis.conf&#x914D;&#x7F6E;&#xFF0C;&#x6709;&#x4E24;&#x9879;&#x63A7;&#x5236;rewrite&#x7684;&#x9009;&#x9879;&#x3002; auto-aof-rewrite-percentage 100&#xFF0C;&#x5F53;&#x6587;&#x4EF6;&#x589E;&#x957F;100%&#xFF08;&#x4E00;&#x500D;&#xFF09;&#x65F6;&#x5019;&#xFF0C;&#x81EA;&#x52A8;&#x91CD;&#x5199;&#x3002; auto-aof-rewrite-min-size 64mb&#xFF0C;&#x65E5;&#x5FD7;&#x91CD;&#x5199;&#x6700;&#x5C0F;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#xFF0C;&#x5982;&#x679C;&#x5C0F;&#x4E8E;&#x8BE5;&#x5927;&#x5C0F;&#xFF0C;&#x4E0D;&#x4F1A;&#x81EA;&#x52A8;&#x91CD;&#x5199;&#x3002; &#x6765;&#x5B9E;&#x9A8C;&#x4E00;&#x4E0B;&#x91CD;&#x5199;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x8BBE;&#x5B9A;&#x4E00;&#x4E2A;x&#x503C;&#xFF0C;&#x7136;&#x540E;&#x81EA;&#x589E;&#x591A;&#x6B21;&#xFF0C;&#x67E5;&#x770B;AOF&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x3002;&#x91CC;&#x9762;&#x6709;&#x5F88;&#x591A;INCR&#x7684;&#x8BED;&#x53E5;&#x8BB0;&#x5F55; &#x7136;&#x540E;&#x6211;&#x4EEC;&#x624B;&#x52A8;&#x6267;&#x884C;&#x4E0B;BGREWRITEOF&#xFF0C;&#x6267;&#x884C;&#x65E5;&#x5FD7;&#x91CD;&#x5199;&#x3002; AOF &#x6587;&#x4EF6;&#x635F;&#x574F;&#x4EE5;&#x540E;&#x5982;&#x4F55;&#x4FEE;&#x590D;&#x670D;&#x52A1;&#x5668;&#x53EF;&#x80FD;&#x5728;&#x7A0B;&#x5E8F;&#x6B63;&#x5728;&#x5BF9; AOF &#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x5199;&#x5165;&#x65F6;&#x505C;&#x673A;&#xFF0C; &#x5982;&#x679C;&#x505C;&#x673A;&#x9020;&#x6210;&#x4E86; AOF &#x6587;&#x4EF6;&#x51FA;&#x9519;&#xFF08;corrupt&#xFF09;&#xFF0C; &#x90A3;&#x4E48; Redis &#x5728;&#x91CD;&#x542F;&#x65F6;&#x4F1A;&#x62D2;&#x7EDD;&#x8F7D;&#x5165;&#x8FD9;&#x4E2A; AOF &#x6587;&#x4EF6;&#xFF0C; &#x4ECE;&#x800C;&#x786E;&#x4FDD;&#x6570;&#x636E;&#x7684;&#x4E00;&#x81F4;&#x6027;&#x4E0D;&#x4F1A;&#x88AB;&#x7834;&#x574F;&#x3002; &#x5F53;&#x53D1;&#x751F;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x65F6;&#xFF0C; &#x53EF;&#x4EE5;&#x7528;&#x4EE5;&#x4E0B;&#x65B9;&#x6CD5;&#x6765;&#x4FEE;&#x590D;&#x51FA;&#x9519;&#x7684; AOF &#x6587;&#x4EF6;&#xFF1A; &#x4E3A;&#x73B0;&#x6709;&#x7684; AOF &#x6587;&#x4EF6;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5907;&#x4EFD;&#x3002; &#x4F7F;&#x7528; Redis &#x9644;&#x5E26;&#x7684; redis-check-aof &#x7A0B;&#x5E8F;&#xFF0C;&#x5BF9;&#x539F;&#x6765;&#x7684; AOF &#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x4FEE;&#x590D;&#x3002; 1redis-check-aof --fix &#x91CD;&#x542F; Redis &#x670D;&#x52A1;&#x5668;&#xFF0C;&#x7B49;&#x5F85;&#x670D;&#x52A1;&#x5668;&#x8F7D;&#x5165;&#x4FEE;&#x590D;&#x540E;&#x7684; AOF &#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x6062;&#x590D;&#x3002; AOF&#x4F18;&#x7F3A;&#x70B9;&#x4F18;&#x70B9;&#xFF1A; AOF&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E; &#x5B8C;&#x5168;&#x4E0D;&#x540C;&#x6B65;&#x3001;&#x6BCF;&#x79D2;&#x540C;&#x6B65;&#x3001;&#x6BCF;&#x6B21;&#x64CD;&#x4F5C;&#x540C;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;&#x6BCF;&#x79D2;&#x540C;&#x6B65;&#x3002;&#x56E0;&#x4E3A;AOF&#x662F;&#x64CD;&#x4F5C;&#x6307;&#x4EE4;&#x7684;&#x8FFD;&#x52A0;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x9891;&#x7E41;&#x7684;&#x5927;&#x91CF;&#x7684;&#x540C;&#x6B65;&#x3002; AOF&#x6587;&#x4EF6;&#x662F;&#x4E00;&#x4E2A;&#x503C;&#x8FFD;&#x52A0;&#x65E5;&#x5FD7;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x5373;&#x4F7F;&#x670D;&#x52A1;&#x5B95;&#x673A;&#x4E3A;&#x5199;&#x5165;&#x5B8C;&#x6574;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;redis-check-aof&#x5DE5;&#x5177;&#x4FEE;&#x590D;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x3002; &#x5982;&#x679C;AOF&#x6587;&#x4EF6;&#x8FC7;&#x5927;&#xFF0C;Redis&#x4F1A;&#x5728;&#x540E;&#x53F0;&#x81EA;&#x52A8;&#x5730;&#x91CD;&#x5199;AOF&#x6587;&#x4EF6;&#x3002;&#x91CD;&#x5199;&#x540E;&#x4F1A;&#x4F7F;AOF&#x6587;&#x4EF6;&#x538B;&#x7F29;&#x5230;&#x6700;&#x5C0F;&#x6240;&#x9700;&#x7684;&#x6307;&#x4EE4;&#x96C6;&#x3002; AOF&#x6587;&#x4EF6;&#x662F;&#x6709;&#x5E8F;&#x4FDD;&#x5B58;&#x6570;&#x636E;&#x5E93;&#x7684;&#x6240;&#x6709;&#x5199;&#x5165;&#x64CD;&#x4F5C;&#xFF0C;&#x6613;&#x8BFB;&#xFF0C;&#x6613;&#x5206;&#x6790;&#x3002;&#x5373;&#x4F7F;&#x5982;&#x679C;&#x4E0D;&#x5C0F;&#x5FC3;&#x8BEF;&#x64CD;&#x4F5C;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x4E5F;&#x5F88;&#x5BB9;&#x6613;&#x627E;&#x51FA;&#x9519;&#x8BEF;&#x6307;&#x4EE4;&#xFF0C;&#x6062;&#x590D;&#x5230;&#x67D0;&#x4E2A;&#x6570;&#x636E;&#x8282;&#x70B9;&#x3002;&#x4F8B;&#x5982;&#x4E0D;&#x5C0F;&#x5FC3;FLUSHALL&#xFF0C;&#x53EF;&#x4EE5;&#x975E;&#x5E38;&#x5BB9;&#x6613;&#x6062;&#x590D;&#x5230;&#x6267;&#x884C;&#x547D;&#x4EE4;&#x4E4B;&#x524D;&#x3002; &#x7F3A;&#x70B9; &#x76F8;&#x540C;&#x6570;&#x636E;&#x91CF;&#x4E0B;&#xFF0C;AOF&#x7684;&#x6587;&#x4EF6;&#x901A;&#x5E38;&#x4F53;&#x79EF;&#x4F1A;&#x6BD4;RDB&#x5927;&#x3002;&#x56E0;&#x4E3A;AOF&#x662F;&#x5B58;&#x6307;&#x4EE4;&#x7684;&#xFF0C;&#x800C;RDB&#x662F;&#x6240;&#x6709;&#x6307;&#x4EE4;&#x7684;&#x7ED3;&#x679C;&#x5FEB;&#x7167;&#x3002;&#x4F46;AOF&#x5728;&#x65E5;&#x5FD7;&#x91CD;&#x5199;&#x540E;&#x4F1A;&#x538B;&#x7F29;&#x4E00;&#x4E9B;&#x7A7A;&#x95F4;&#x3002; &#x5728;&#x5927;&#x91CF;&#x5199;&#x5165;&#x548C;&#x8F7D;&#x5165;&#x7684;&#x65F6;&#x5019;&#xFF0C;AOF&#x7684;&#x6548;&#x7387;&#x4F1A;&#x6BD4;RDB&#x4F4E;&#x3002;&#x56E0;&#x4E3A;&#x5927;&#x91CF;&#x5199;&#x5165;&#xFF0C;AOF&#x4F1A;&#x6267;&#x884C;&#x66F4;&#x591A;&#x7684;&#x4FDD;&#x5B58;&#x547D;&#x4EE4;&#xFF0C;&#x8F7D;&#x5165;&#x7684;&#x65F6;&#x5019;&#x4E5F;&#x9700;&#x8981;&#x5927;&#x91CF;&#x7684;&#x91CD;&#x6267;&#x884C;&#x547D;&#x4EE4;&#x6765;&#x5F97;&#x5230;&#x6700;&#x540E;&#x7684;&#x7ED3;&#x679C;&#x3002;RDB&#x5BF9;&#x6B64;&#x66F4;&#x6709;&#x4F18;&#x52BF;&#x3002; &#x5982;&#x4F55;&#x9009;&#x62E9;&#x4EE5;&#x4E0A;&#x5DF2;&#x7ECF;&#x57FA;&#x672C;&#x4E86;&#x89E3;&#x8FC7;RDB&#x548C;AOF&#x7684;&#x4F7F;&#x7528;&#x3001;&#x57FA;&#x672C;&#x539F;&#x7406;&#x4EE5;&#x53CA;&#x5BF9;&#x5E94;&#x7684;&#x4F18;&#x7F3A;&#x70B9;&#x3002;&#x90A3;&#x4E48;&#x5728;&#x5B9E;&#x9645;&#x5F53;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5230;&#x5E95;&#x600E;&#x4E48;&#x53BB;&#x9009;&#x62E9;&#x7528;&#x54EA;&#x79CD;&#x6301;&#x4E45;&#x5316;&#x65B9;&#x5F0F;&#x5462;&#xFF1F; &#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x4E0D;&#x8003;&#x8651;&#x786C;&#x76D8;&#x5927;&#x5C0F;&#xFF0C;&#x6700;&#x5B89;&#x5168;&#x7684;&#x505A;&#x6CD5;&#x662F;RDB&#x4E0E;AOF&#x540C;&#x65F6;&#x4F7F;&#x7528;&#xFF0C;&#x5373;&#x4F7F;AOF&#x635F;&#x574F;&#x65E0;&#x6CD5;&#x4FEE;&#x590D;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x7528;RDB&#x6765;&#x6062;&#x590D;&#x6570;&#x636E;&#x3002; &#x5982;&#x679C;Redis&#x7684;&#x6570;&#x636E;&#x5728;&#x4F60;&#x7684;&#x670D;&#x52A1;&#x4E2D;&#x5E76;&#x4E0D;&#x662F;&#x5FC5;&#x8981;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4F8B;&#x5982;&#x53EA;&#x662F;&#x5F53;&#x7B80;&#x5355;&#x7684;&#x7F13;&#x5B58;&#xFF0C;&#x6CA1;&#x6709;&#x7F13;&#x5B58;&#x4E5F;&#x4E0D;&#x4F1A;&#x9020;&#x6210;&#x7F13;&#x5B58;&#x96EA;&#x5D29;&#x3002;&#x8BF4;&#x660E;&#x6570;&#x636E;&#x7684;&#x5B89;&#x5168;&#x53EF;&#x9760;&#x6027;&#x5E76;&#x4E0D;&#x662F;&#x9996;&#x8981;&#x8003;&#x8651;&#x8303;&#x56F4;&#x5185;&#xFF0C;&#x90A3;&#x4E48;&#x5355;&#x72EC;&#x53EA;&#x4F7F;&#x7528;RDB&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002; &#x82E5;&#x540C;&#x65F6;&#x542F;&#x7528;RDB&#x548C;AFO&#x4E24;&#x79CD;&#x6301;&#x4E45;&#x5316;&#x65B9;&#x5F0F;&#xFF0C;&#x5219;Redis Server&#x542F;&#x52A8;&#x65F6;&#xFF0C;&#x4F1A;&#x52A0;&#x8F7D;AOF&#x6587;&#x4EF6;&#x4EE5;&#x91CD;&#x5EFA;&#x6570;&#x636E;&#x96C6;&#xFF0C;&#x56E0;&#x4E3A;AOF&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x662F;&#x76F8;&#x5BF9;&#x6700;&#x5B8C;&#x6574;&#x7684; &#x4E0D;&#x63A8;&#x8350;&#x5355;&#x72EC;&#x4F7F;&#x7528;AOF&#xFF0C;&#x56E0;&#x4E3A;AOF&#x5BF9;&#x4E8E;&#x6570;&#x636E;&#x7684;&#x6062;&#x590D;&#x8F7D;&#x5165;&#x6765;&#x8BF4;&#xFF0C;&#x6BD4;RDB&#x6162;&#x3002;&#x5E76;&#x4E14;Redis&#x5B98;&#x65B9;&#x4E5F;&#x8BF4;&#x660E;&#x4E86;&#xFF0C;AOF&#x6709;&#x4E00;&#x4E2A;&#x7F55;&#x89C1;&#x7684;bug&#x3002;&#x51FA;&#x4E86;&#x95EE;&#x9898;&#x65E0;&#x6CD5;&#x5F88;&#x597D;&#x7684;&#x89E3;&#x51B3;&#x3002;&#x6240;&#x4EE5;&#x4F7F;&#x7528;AOF&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6700;&#x597D;&#x8FD8;&#x662F;&#x6709;RDB&#x4F5C;&#x4E3A;&#x6570;&#x636E;&#x5907;&#x4EFD;&#x3002; &#x6839;&#x636E;&#x5B98;&#x65B9;&#x7684;&#x610F;&#x613F;&#x63CF;&#x8FF0;&#xFF0C;&#x5728;&#x672A;&#x6765;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x4E00;&#x79CD;RDB&#x4E0E;AOF&#x76F8;&#x7ED3;&#x5408;&#x7684;&#x6301;&#x4E45;&#x5316;&#x6A21;&#x578B;&#x3002;&#x5230;&#x65F6;Redis&#x6301;&#x4E45;&#x5316;&#x5C31;&#x4E0D;&#x518D;&#x5982;&#x6B64;&#x9EBB;&#x70E6;&#x8D39;&#x52B2;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x62ED;&#x76EE;&#x4EE5;&#x5F85;&#x5427;&#x3002; &#x5728;&#x7EBF;&#x4FEE;&#x6539;Redis&#x914D;&#x7F6E;&#x53C2;&#x6570;&#x67E5;&#x770B;&#x5F53;&#x524D;&#x6240;&#x6709;&#x914D;&#x7F6E;123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111127.0.0.1:6379&gt; config get * 1) &quot;dbfilename&quot; 2) &quot;dump.rdb&quot; 3) &quot;requirepass&quot; 4) &quot;&quot; 5) &quot;masterauth&quot; 6) &quot;&quot; 7) &quot;unixsocket&quot; 8) &quot;&quot; 9) &quot;logfile&quot; 10) &quot;/var/log/redis/redis-server.log&quot; 11) &quot;pidfile&quot; 12) &quot;/var/run/redis/redis-server.pid&quot; 13) &quot;maxmemory&quot; 14) &quot;0&quot; 15) &quot;maxmemory-samples&quot; 16) &quot;3&quot; 17) &quot;timeout&quot; 18) &quot;0&quot; 19) &quot;tcp-keepalive&quot; 20) &quot;0&quot; 21) &quot;auto-aof-rewrite-percentage&quot; 22) &quot;100&quot; 23) &quot;auto-aof-rewrite-min-size&quot; 24) &quot;67108864&quot; 25) &quot;hash-max-ziplist-entries&quot; 26) &quot;512&quot; 27) &quot;hash-max-ziplist-value&quot; 28) &quot;64&quot; 29) &quot;list-max-ziplist-entries&quot; 30) &quot;512&quot; 31) &quot;list-max-ziplist-value&quot; 32) &quot;64&quot; 33) &quot;set-max-intset-entries&quot; 34) &quot;512&quot; 35) &quot;zset-max-ziplist-entries&quot; 36) &quot;128&quot; 37) &quot;zset-max-ziplist-value&quot; 38) &quot;64&quot; 39) &quot;lua-time-limit&quot; 40) &quot;5000&quot; 41) &quot;slowlog-log-slower-than&quot; 42) &quot;10000&quot; 43) &quot;slowlog-max-len&quot; 44) &quot;128&quot; 45) &quot;port&quot; 46) &quot;6379&quot; 47) &quot;databases&quot; 48) &quot;16&quot; 49) &quot;repl-ping-slave-period&quot; 50) &quot;10&quot; 51) &quot;repl-timeout&quot; 52) &quot;60&quot; 53) &quot;repl-backlog-size&quot; 54) &quot;1048576&quot; 55) &quot;repl-backlog-ttl&quot; 56) &quot;3600&quot; 57) &quot;maxclients&quot; 58) &quot;3984&quot; 59) &quot;watchdog-period&quot; 60) &quot;0&quot; 61) &quot;slave-priority&quot; 62) &quot;100&quot; 63) &quot;min-slaves-to-write&quot; 64) &quot;0&quot; 65) &quot;min-slaves-max-lag&quot; 66) &quot;10&quot; 67) &quot;hz&quot; 68) &quot;10&quot; 69) &quot;no-appendfsync-on-rewrite&quot; 70) &quot;no&quot; 71) &quot;slave-serve-stale-data&quot; 72) &quot;yes&quot; 73) &quot;slave-read-only&quot; 74) &quot;yes&quot; 75) &quot;stop-writes-on-bgsave-error&quot; 76) &quot;yes&quot; 77) &quot;daemonize&quot; 78) &quot;yes&quot; 79) &quot;rdbcompression&quot; 80) &quot;yes&quot; 81) &quot;rdbchecksum&quot; 82) &quot;yes&quot; 83) &quot;activerehashing&quot; 84) &quot;yes&quot; 85) &quot;repl-disable-tcp-nodelay&quot; 86) &quot;no&quot; 87) &quot;aof-rewrite-incremental-fsync&quot; 88) &quot;yes&quot; 89) &quot;appendonly&quot; 90) &quot;no&quot; 91) &quot;dir&quot; 92) &quot;/var/lib/redis&quot; 93) &quot;maxmemory-policy&quot; 94) &quot;volatile-lru&quot; 95) &quot;appendfsync&quot; 96) &quot;everysec&quot; 97) &quot;save&quot; 98) &quot;900 1 300 10 60 10000&quot; 99) &quot;loglevel&quot;100) &quot;notice&quot;101) &quot;client-output-buffer-limit&quot;102) &quot;normal 0 0 0 slave 268435456 67108864 60 pubsub 33554432 8388608 60&quot;103) &quot;unixsocketperm&quot;104) &quot;0&quot;105) &quot;slaveof&quot;106) &quot;&quot;107) &quot;notify-keyspace-events&quot;108) &quot;&quot;109) &quot;bind&quot;110) &quot;127.0.0.1&quot; &#x67E5;&#x770B;&#x5355;&#x9879;&#x914D;&#x7F6E;123127.0.0.1:6379&gt; config get appendonly1) &quot;appendonly&quot;2) &quot;no&quot; &#x914D;&#x7F6E;&#x8BF4;&#x660E;&#x670D;&#x52A1;&#x5668;&#x76F8;&#x5173;&#x914D;&#x7F6E; port :&#x670D;&#x52A1;&#x7AEF;&#x7ED1;&#x5B9A;&#x7AEF;&#x53E3;&#xFF0C;&#x9ED8;&#x8BA4;6379 bind:&#x670D;&#x52A1;&#x7AEF;&#x7ED1;&#x5B9A;&#x7684;IP&#x5730;&#x5740; timeout:&#x5F53;&#x5BA2;&#x6237;&#x7AEF;&#x95F2;&#x7F6E;&#x591A;&#x5C11;&#x79D2;&#x540E;&#x81EA;&#x52A8;&#x65AD;&#x5F00;&#x8FDE;&#x63A5; slaveof :&#x9ED8;&#x8BA4;&#x4E3A;&#x7A7A;&#xFF0C;&#x5C06;&#x672C;&#x673A;&#x4E3A;slave&#xFF0C;&#x5982;&#x679C;&#x8BBE;&#x7F6E;master&#x670D;&#x52A1;&#x7684;IP&#x5730;&#x5740;&#x53CA;&#x7AEF;&#x53E3;&#xFF0C;&#x5728;Redis&#x542F;&#x52A8;&#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x81EA;&#x52A8;&#x4ECE;master&#x8FDB;&#x884C;&#x6570;&#x636E;&#x540C;&#x6B65; masterauth &lt;master&#xAD;password&gt;&#xFF1A;&#x5F53;master&#x670D;&#x52A1;&#x8BBE;&#x7F6E;&#x4E86;&#x5BC6;&#x7801;&#x4FDD;&#x62A4;&#x65F6;&#xFF0C;slav&#x670D;&#x52A1;&#x8FDE;&#x63A5;master&#x7684;&#x5BC6;&#x7801; maxclients&#xFF1A;&#x8BBE;&#x7F6E;&#x540C;&#x4E00;&#x65F6;&#x95F4;&#x6700;&#x5927;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#x6570;&#xFF0C;&#x4E3A;0&#x4EE3;&#x8868;&#x65E0;&#x9650;&#x5236; requirepass:&#x8BBE;&#x7F6E;&#x5BC6;&#x7801;&#xFF0C;&#x9ED8;&#x8BA4;&#x6CA1;&#x6709;&#x5BC6;&#x7801;&#x3010;&#x64CD;&#x4F5C;&#x4E0D;&#x9A6C;&#x4E0A;&#x751F;&#x6548;&#x3011; databases:&#x8BBE;&#x7F6E;&#x6570;&#x636E;&#x5E93;&#x6570;&#x91CF;&#xFF0C;&#x9ED8;&#x8BA4;16&#x4E2A;&#x3010;&#x8FD9;&#x4E2A;&#x53EA;&#x80FD;&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x6765;&#x751F;&#x6548;&#x3011; dbfilename:&#x6307;&#x5B9A;&#x6570;&#x636E;&#x5E93;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x9ED8;&#x8BA4;&#x503C;&#x4E3A;dump.rdb dir:&#x6307;&#x5B9A;&#x670D;&#x52A1;&#x7AEF;&#x5B58;&#x50A8;&#x6570;&#x636E;&#x5E93;&#x7684;&#x76EE;&#x5F55; &#x65E5;&#x5FD7;&#x76F8;&#x5173;&#x914D;&#x7F6E; logfile:&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x540D;&#x79F0; loglevel:&#x6307;&#x5B9A;&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;&#x7EA7;&#x522B; debug &#x8BB0;&#x5F55;&#x5F88;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x7528;&#x4E8E;&#x5F00;&#x53D1;&#x548C;&#x6D4B;&#x8BD5; varbose &#x6709;&#x7528;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x4E0D;&#x50CF; debug &#x4F1A;&#x8BB0;&#x5F55;&#x90A3;&#x4E48;&#x591A; notice &#x666E;&#x901A;&#x7684; verbose &#xFF0C;&#x5E38;&#x7528;&#x4E8E;&#x751F;&#x4EA7;&#x73AF;&#x5883; warning &#x53EA;&#x6709;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x6216;&#x8005;&#x4E25;&#x91CD;&#x7684;&#x4FE1;&#x606F;&#x4F1A;&#x8BB0;&#x5F55;&#x5230;&#x65E5;&#x5FD7; &#x670D;&#x52A1;&#x7AEF;&#x4FDD;&#x5B58;&#x914D;&#x7F6E; save:&#x6307;&#x5B9A;&#x5728;&#x591A;&#x957F;&#x65F6;&#x95F4;&#x5185;&#xFF0C;&#x6709;&#x591A;&#x5C11;&#x6B21;&#x66F4;&#x65B0;&#x64CD;&#x4F5C;&#xFF0C;&#x5C31;&#x5C06;&#x6570;&#x636E;&#x540C;&#x6B65;&#x5230;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x7B2C;&#x4E00;&#x4E2A;jd&#x4EE3;&#x8868;1&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x4EE3;&#x8868;10&#xFF0C;&#x7B2C;&#x4E09;&#x4E2A;&#x4EE3;&#x8868;10000&#x3002; AOF&#x529F;&#x80FD;&#x5F00;&#x542F;&#xFF1A; appendonly no&#xFF1A;&#x662F;&#x5426;&#x5F00;&#x542F;aof&#x8BB0;&#x5F55;&#x529F;&#x80FD;&#xFF0C;&#x6307;&#x5B9A;&#x662F;&#x5426;&#x5728;&#x6BCF;&#x6B21;&#x66F4;&#x65B0;&#x64CD;&#x4F5C;&#x540E;&#x8FDB;&#x884C;&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;&#xFF0C;Redis&#x5728;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x662F;&#x5F02;&#x6B65;&#x7684;&#x628A;&#x6570;&#x636E;&#x5199;&#x5165;&#x78C1;&#x76D8;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x5F00;&#x542F;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x5728;&#x65AD;&#x7535;&#x65F6;&#x5BFC;&#x81F4;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x5185;&#x7684;&#x6570;&#x636E;&#x4E22;&#x5931;&#x3002;&#x56E0;&#x4E3A; redis&#x672C;&#x8EAB;&#x540C;&#x6B65;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x662F;&#x6309;&#x4E0A;&#x9762;save&#x6761;&#x4EF6;&#x6765;&#x540C;&#x6B65;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x6709;&#x7684;&#x6570;&#x636E;&#x4F1A;&#x5728;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x5185;&#x53EA;&#x5B58;&#x5728;&#x4E8E;&#x5185;&#x5B58;&#x4E2D;&#x3002;&#x9ED8;&#x8BA4;&#x4E3A;no appendfilename&#xFF1A;&#x6307;&#x5B9A;aof&#x65E5;&#x5FD7;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x79F0; appendfsync&#xFF1A;&#x6307;&#x5B9A;aof&#x65E5;&#x5FD7;&#x66F4;&#x65B0;&#x6761;&#x4EF6; no&#xFF1A;&#x8868;&#x793A;&#x7B49;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x7F13;&#x5B58;&#x540C;&#x6B65;&#x5230;&#x78C1;&#x76D8;&#xFF08;&#x5FEB;&#xFF09; always&#xFF1A;&#x8868;&#x793A;&#x6BCF;&#x6B21;&#x66F4;&#x65B0;&#x64CD;&#x4F5C;&#x540E;&#x624B;&#x52A8;&#x8C03;&#x7528;fsync()&#x5C06;&#x6570;&#x636E;&#x5199;&#x5230;&#x78C1;&#x76D8;&#xFF08;&#x6162;&#xFF0C;&#x5B89;&#x5168;&#xFF09; everysec&#xFF1A;&#x8868;&#x793A;&#x6BCF;&#x79D2;&#x540C;&#x6B65;&#x4E00;&#x6B21;&#xFF08;&#x6298;&#x8877;&#xFF0C;&#x9ED8;&#x8BA4;&#x503C;&#xFF09; &#x5728;&#x7EBF;&#x5F00;&#x542F;aof&#x529F;&#x80FD;12345678127.0.0.1:6379&gt; config get appendonly1) &quot;appendonly&quot;2) &quot;no&quot;127.0.0.1:6379&gt; config set appendonly yesOK127.0.0.1:6379&gt; config get appendonly1) &quot;appendonly&quot;2) &quot;yes&quot; &#x5F00;&#x542F;&#x540E;&#x9ED8;&#x8BA4;&#x5728;/var/lib/redis&#x76EE;&#x5F55;&#x5C31;&#x4F1A;&#x751F;&#x6210;appendonly.aof&#x6587;&#x4EF6; 1234root@ops:/var/lib/redis# pwd/var/lib/redisroot@ops:/var/lib/redis# lsappendonly.aof dump.rdb]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Nginx部署]]></title>
    <url>%2F2015%2F11%2F13%2FNginx%E9%83%A8%E7%BD%B2%2F</url>
    <content type="text"><![CDATA[&#x5355;&#x8282;&#x70B9;&#x90E8;&#x7F72;&#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x5305;1yum -y install gcc pcre-devel zlib-devel openssl-devel &#x4E0B;&#x8F7D;&#x6700;&#x65B0;&#x7A33;&#x5B9A;&#x7248;&#x672C;1wget http://nginx.org/download/nginx-1.14.2.tar.gz http://nginx.org/en/download.html &#x89E3;&#x538B;1tar zxvf nginx-1.14.2.tar.gz &#x7F16;&#x8BD1;&#x5B89;&#x88C5;123cd nginx-1.14.2./configure --prefix=/opt/nginx --with-http_stub_status_module --with-http_ssl_modulemake &amp;&amp; make install &#x505A;&#x8F6F;&#x94FE;&#xFF0C;&#x65B9;&#x4FBF;&#x540E;&#x7EED;&#x6267;&#x884C;1ln -s /opt/nginx/sbin/nginx /sbin/nginx nginx+keepalive&#xFF08;&#x9AD8;&#x53EF;&#x7528;&#x90E8;&#x7F72;&#xFF09;&#x4E24;&#x4E2A;&#x8282;&#x70B9;&#x90FD;&#x6267;&#x884C;&#xFF1A;&#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x5305;1yum -y install gcc pcre-devel zlib-devel openssl-devel &#x4E0B;&#x8F7D;&#x6700;&#x65B0;&#x7A33;&#x5B9A;&#x7248;&#x672C;1wget http://nginx.org/download/nginx-1.14.2.tar.gz &#x89E3;&#x538B;1tar zxvf nginx-1.14.2.tar.gz &#x7F16;&#x8BD1;&#x5B89;&#x88C5;123cd nginx-1.14.2./configure --prefix=/opt/nginx --with-http_stub_status_module --with-http_ssl_modulemake &amp;&amp; make install &#x505A;&#x8F6F;&#x94FE;&#xFF0C;&#x65B9;&#x4FBF;&#x540E;&#x7EED;&#x6267;&#x884C;1ln -s /opt/nginx/sbin/nginx /sbin/nginx nginx&#x72B6;&#x6001;&#x68C0;&#x6D4B;&#x811A;&#x672C;cat /opt/nginx/chk_nginx.sh 123456789101112#!/bin/bashcounter=$(ps -C nginx --no-heading|wc -l)if [ &quot;${counter}&quot; = &quot;0&quot; ]; then /sbin/nginx sleep 2 counter=$(ps -C nginx --no-heading|wc -l) if [ &quot;${counter}&quot; = &quot;0&quot; ]; then systemctl stop keepalived fifi[root@n1 ~]# chmod 755 /opt/nginx/chk_nginx.sh &#x811A;&#x672C;&#x68C0;&#x6D4B;nginx&#x8FDB;&#x7A0B;&#x6570;&#xFF0C;&#x5982;&#x679C;&#x7B49;&#x4E8E;0&#xFF0C;&#x5219;&#x542F;&#x52A8;nginx&#xFF0C;2&#x79D2;&#x540E;&#x518D;&#x68C0;&#x6D4B;&#x4E00;&#x6B21;&#xFF0C;&#x5982;&#x679C;nginx&#x8FDB;&#x7A0B;&#x8FD8;&#x662F;0&#xFF0C;&#x5219;&#x505C;&#x6B62;keealived&#xFF0C;&#x6B64;&#x65F6;&#x5907;&#x7528;&#x8282;&#x70B9;&#x4F1A;&#x63A5;&#x7BA1;&#x865A;ip&#x3002; &#x5B89;&#x88C5;keepalived1yum install keepalived &#x914D;&#x7F6E;keepalivedkeepalived&#x8282;&#x70B9;1&#x914D;&#x7F6E;cat /etc/keepalived/keepalived.conf 12345678910111213141516171819202122232425vrrp_script chk_nginx { script &quot;/opt/nginx/chk_nginx.sh&quot; interval 2 weight -5 fall 2 rise 1}vrrp_instance VI_1 { state MASTER interface em2 virtual_router_id 51 priority 101 advert_int 1 authentication { auth_type PASS auth_pass huayun888@ } virtual_ipaddress { 1.1.1.1 } track_script { chk_nginx }} keepalived&#x8282;&#x70B9;2&#x914D;&#x7F6E;123456789101112131415161718192021222324252627cat /etc/keepalived/keepalived.confvrrp_script chk_nginx { script &quot;/opt/nginx/chk_nginx.sh&quot; interval 2 weight -5 fall 2 rise 1}vrrp_instance VI_1 { state BACKUP interface em2 virtual_router_id 51 priority 99 advert_int 1 authentication { auth_type PASS auth_pass huayun888@ } virtual_ipaddress { 1.1.1.1 } track_script { chk_nginx }} &#x9700;&#x8981;&#x6839;&#x636E;&#x5B9E;&#x9645;&#x60C5;&#x51B5;&#x6539;&#x52A8;&#x7684;&#x914D;&#x7F6E; interface em2&#xFF1A;&#x6307;&#x5B9A;HA&#x76D1;&#x6D4B;&#x7F51;&#x7EDC;&#x7684;&#x63A5;&#x53E3;1.1.1.1&#xFF1A;&#x865A;ip &#x91CD;&#x542F;keepalived1systemctl restart keepalived &#x6700;&#x540E;&#x6D4B;&#x8BD5;&#x5C06;&#x8282;&#x70B9;1&#x7684;keepalived&#x505C;&#x6B62;&#x6216;&#x76F4;&#x63A5;&#x5173;&#x6389;&#x8282;&#x70B9;1&#xFF0C;&#x770B;&#x8282;&#x70B9;2&#x662F;&#x5426;&#x4F1A;&#x63A5;&#x7BA1;&#x865A;ip&#x3002;]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>nginx</tag>
        <tag>keepalived</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux中使用ShadowSocks+Privoxy代理]]></title>
    <url>%2F2015%2F03%2F21%2FLinux%E4%B8%AD%E4%BD%BF%E7%94%A8ShadowSocks%2BPrivoxy%E4%BB%A3%E7%90%86%2F</url>
    <content type="text"><![CDATA[&#x5B89;&#x88C5;shadowsocks&#x5BA2;&#x6237;&#x7AEF;12yum install python-pippip install shadowsocks -i https://pypi.tuna.tsinghua.edu.cn/simple requests &#x8FD0;&#x884C;shadowsocks&#xFF08;&#x4E00;&#x6761;&#x547D;&#x4EE4;&#xFF09;1nohup sslocal -s 39.109.8.5 -p 8008 -l 1080 -k huayun2014 -t 600 -m aes-256-cfb &gt; /root/ss.log 2&gt;&amp;1 &amp; &#x8FD0;&#x884C;shadowsocks&#xFF08;&#x8BFB;&#x53D6;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF09;12345678910111213nohup sslocal -c /etc/shadowsocks.json &gt;&gt;/root/ss.log 2&gt;&amp;1 &amp;{ &quot;server&quot;:&quot;39.109.8.5&quot;, &quot;server_port&quot;:8008, &quot;local_address&quot;: &quot;127.0.0.1&quot;, &quot;local_port&quot;:1080, &quot;password&quot;:&quot;huayun2014&quot;, &quot;timeout&quot;:300, &quot;method&quot;:&quot;aes-256-cfb&quot;, &quot;fast_open&quot;: false, &quot;workers&quot;: 1} &#x5B89;&#x88C5;privoxy1yum install privoxy -y &#x914D;&#x7F6E;grep -v &#x201C;#&#x201D; /etc/privoxy/config |grep -v &#x201C;^$&#x201D; 1234567891011121314151617181920confdir /etc/privoxylogdir /var/log/privoxyfilterfile default.filterlogfile logfilelisten-address 127.0.0.1:8118toggle 1enable-remote-toggle 0enable-remote-http-toggle 0enable-edit-actions 0enforce-blocks 0buffer-limit 4096enable-proxy-authentication-forwarding 0forward-socks5t / 127.0.0.1:1080 .forwarded-connect-retries 0accept-intercepted-requests 0allow-cgi-request-crunching 0split-large-forms 0keep-alive-timeout 5tolerate-pipelining 1socket-timeout 300 &#x542F;&#x52A8;12systemctl restart privoxy systemctl enable privoxy &#x8F6C;&#x53D1;&#x914D;&#x7F6E;1234&gt; vim /etc/profileexport http_proxy=http://127.0.0.1:8118export https_proxy=http://127.0.0.1:8118\&gt; source /etc/profile &#x4EC5;&#x5728;&#x5F53;&#x524D; session &#x751F;&#x6548;12export http_proxy=http://127.0.0.1:8118export https_proxy=http://127.0.0.1:8118 https://www.jianshu.com/p/48b3866b5e2a]]></content>
      <categories>
        <category>技巧</category>
      </categories>
      <tags>
        <tag>代理</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[xenserver虚拟机实时性能查看]]></title>
    <url>%2F2014%2F11%2F19%2Fxenserver%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%9E%E6%97%B6%E6%80%A7%E8%83%BD%E6%9F%A5%E7%9C%8B%2F</url>
    <content type="text"><![CDATA[&#x767B;&#x9646;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x6267;&#x884C;&#x811A;&#x672C;/opt/tools/real_time_status.sh&#xFF1A;&#xFF08;&#x8BE5;&#x811A;&#x672C;&#x7684;&#x76F8;&#x5173;&#x6570;&#x636E;&#x90FD;&#x662F;&#x4ECE;xentop&#x547D;&#x4EE4;&#x4E2D;&#x63D0;&#x53D6;&#x7684;&#xFF09; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051#!/bin/bash# Program:# Real-time Performance# History:# 2014/09/29 caishunzhi First release DIR=&quot;/opt/tools&quot;HOSTNAME=`/bin/hostname`SORT=${1:-4}NUM=${2:-6} function get_performance(){ #cpu &gt;/tmp/xentopcpu_ #/usr/sbin/xentop -i2 -d1 -b -f &gt;/tmp/xentopcpu_ #CPU=`awk -F&apos;[-r]&apos; &apos;{print $NF}&apos; /tmp/xentopcpu_ |grep -v VBD_WR |awk &apos;BEGIN{sum=0}{sum+=$2}END{print sum}&apos;` #traffic and io /usr/sbin/xentop -i1 -d1 -b -f |grep -v VBD_WR &gt;/tmp/xentop_1 TX1=`awk -F&apos;[-r]&apos; &apos;{print $NF}&apos; /tmp/xentop_1 |awk &apos;BEGIN{sum=0}{sum+=$9}END{print sum}&apos;` RX1=`awk -F&apos;[-r]&apos; &apos;{print $NF}&apos; /tmp/xentop_1 |awk &apos;BEGIN{sum=0}{sum+=$10}END{print sum}&apos;` VDB_RD1=`awk -F&apos;[-r]&apos; &apos;{print $NF}&apos; /tmp/xentop_1 |awk &apos;BEGIN{sum=0}{sum+=$13}END{print sum}&apos;` VDB_WR1=`awk -F&apos;[-r]&apos; &apos;{print $NF}&apos; /tmp/xentop_1 |awk &apos;BEGIN{sum=0}{sum+=$14}END{print sum}&apos;` sleep 1 /usr/sbin/xentop -i1 -d1 -b -f |grep -v VBD_WR &gt;/tmp/xentop_2 TX2=`awk -F&apos;[-r]&apos; &apos;{print $NF}&apos; /tmp/xentop_2 |awk &apos;BEGIN{sum=0}{sum+=$9}END{print sum}&apos;` RX2=`awk -F&apos;[-r]&apos; &apos;{print $NF}&apos; /tmp/xentop_2 |awk &apos;BEGIN{sum=0}{sum+=$10}END{print sum}&apos;` VDB_RD2=`awk -F&apos;[-r]&apos; &apos;{print $NF}&apos; /tmp/xentop_2 |awk &apos;BEGIN{sum=0}{sum+=$13}END{print sum}&apos;` VDB_WR2=`awk -F&apos;[-r]&apos; &apos;{print $NF}&apos; /tmp/xentop_2 |awk &apos;BEGIN{sum=0}{sum+=$14}END{print sum}&apos;` date1=`stat /tmp/xentop_1 |grep Modify |awk &apos;{print $2,$3}&apos;` date2=`stat /tmp/xentop_2 |grep Modify |awk &apos;{print $2,$3}&apos;` start=`date +%s -d &quot;$date1&quot;` end=`date +%s -d &quot;$date2&quot;` let sleep=end-start #VM Performance Output awk &apos;{print $1}&apos; /tmp/xentop_1 &gt;/tmp/vmname_ awk -F&apos;[-r]&apos; &apos;{print $NF}&apos; /tmp/xentop_1 &gt;/tmp/xentop_11 awk -F&apos;[-r]&apos; &apos;{print $NF}&apos; /tmp/xentop_2 &gt;/tmp/xentop_22 awk -F&apos;[-r]&apos; &apos;{print $NF}&apos; /tmp/xentopcpu_ |sed &apos;1,/NAME/d&apos; |awk &apos;{print $2}&apos; &gt;/tmp/xentop_33 printf &quot;\n%50s %6s %12s %12s %6s %6s\n&quot; NAME CPU &apos;NETin(KB)&apos; &apos;NETout(KB)&apos; IOr IOw paste /tmp/vmname_ /tmp/xentop_11 /tmp/xentop_22 /tmp/xentop_33 |awk -v n=$sleep &apos;{printf &quot;%50s %6s %12d %12d %6d %6d\n&quot;,$1,$NF,($27-$10)/n,($28-$11)/n,($31-$14)/n,($32-$15)/n}&apos; |sort -k&quot;$SORT&quot; -rn |head -&quot;$NUM&quot;} while true;do get_performancedone [root@xen-host01 ~]# sh /opt/tools/real_time_status.sh &#x9ED8;&#x8BA4;&#x4EE5;&#x6D41;&#x51FA;&#x6D41;&#x91CF;&#xFF08;&#x7B2C;&#x56DB;&#x5217;&#xFF09;&#x6392;&#x5E8F;&#xFF0C;&#x663E;&#x793A;&#x524D;6&#x540D;&#x3002; &#x5982;&#x679C;&#x8981;&#x4EE5;&#x5176;&#x5B83;&#x5217;&#x6392;&#x5E8F;&#xFF0C;&#x76F4;&#x63A5;&#x5728;&#x811A;&#x672C;&#x540E;&#x63A5;&#x5217;&#x53F7;&#xFF1B;&#x5982;&#x679C;&#x8981;&#x663E;&#x793A;&#x66F4;&#x591A;&#x7684;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x5728;&#x5217;&#x53F7;&#x540E;&#x63A5;&#x8981;&#x663E;&#x793A;&#x7684;&#x6570;&#x91CF;&#x3002; &#x5982;&#x4E0B;&#x547D;&#x4EE4;&#x4EE5;IO&#x8BFB;&#x8BF7;&#x6C42;&#x6570;&#x6392;&#x5E8F;&#xFF08;&#x7B2C;&#x4E94;&#x5217;&#xFF09;&#xFF0C;&#x663E;&#x793A;&#x524D;10&#x540D;&#xFF1A; [root@xen-host01 ~]# sh /opt/tools/real_time_status.sh 5 10 &#x6CE8;&#xFF1A;&#x9ED8;&#x8BA4;&#x6CA1;&#x6709;&#x663E;&#x793A;&#x865A;&#x62DF;&#x673A;&#x7684;cpu&#x4F7F;&#x7528;&#x7387;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x663E;&#x793A;&#xFF0C;&#x8BF7;&#x7F16;&#x8F91;&#x811A;&#x672C;&#xFF0C;&#x5C06;&#x5982;&#x4E0B;&#x4E24;&#x884C;&#x7684;&#x6CE8;&#x91CA;&#xFF08;#&#xFF09;&#x53BB;&#x6389;&#xFF0C;&#x4FDD;&#x5B58;&#x9000;&#x51FA;&#xFF0C;&#x518D;&#x6267;&#x884C;&#x811A;&#x672C;&#x5373;&#x53EF;&#x3002; xentop&#x5B98;&#x65B9;&#x4F7F;&#x7528;&#x8BF4;&#x660E;&#xFF1A;How to Use the XenServer Xentop Utility]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Nginx报错处理]]></title>
    <url>%2F2014%2F03%2F21%2FNginx%E6%8A%A5%E9%94%99%E5%A4%84%E7%90%86%2F</url>
    <content type="text"><![CDATA[Nginx&#x62A5;&#x9519;&#x5904;&#x7406;Request entity too large413 Request Entity Too Large&#xFF08;&#x8BF7;&#x6C42;&#x5B9E;&#x4F53;&#x592A;&#x5927;&#xFF09;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x5B9E;&#x4F53;&#x4E3B;&#x4F53;&#x90E8;&#x5206;&#x6BD4;&#x670D;&#x52A1;&#x5668;&#x80FD;&#x591F;&#x6216;&#x8005;&#x5E0C;&#x671B;&#x5904;&#x7406;&#x7684;&#x8981;&#x5927;&#x3002; &#x5728;http&#x5757;&#x6DFB;&#x52A0;&#x914D;&#x7F6E; 1client_max_body_size 100m client_max_body_size&#x6307;&#x4EE4;&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x4E3A;1 MB&#x3002; &#x5B83;&#x53EF;&#x4EE5;&#x88AB;&#x8BBE;&#x7F6E;&#x5728;http&#xFF0C;server&#x548C;location&#x8BED;&#x5883;&#x3002;&#x5728;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8BE5;&#x6307;&#x4EE4;&#x5728;&#x5D4C;&#x5957;&#x5757;&#x4F18;&#x5148;&#x4E8E;&#x7956;&#x5148;&#x5757;&#x76F8;&#x540C;&#x7684;&#x6307;&#x4EE4;&#x3002; Syntax: client_max_body_size size; Default: client_max_body_size 1m; Context: http, server, location &#x8BBE;&#x7F6E;&#x5BA2;&#x6237;&#x7AEF;&#x8BF7;&#x6C42;&#x6B63;&#x6587;&#x7684;&#x6700;&#x5927;&#x5141;&#x8BB8;&#x5927;&#x5C0F;&#xFF0C;&#x5728;&#x201C;Content-Length&#x201D;&#x8BF7;&#x6C42;&#x6807;&#x5934;&#x5B57;&#x6BB5;&#x4E2D;&#x6307;&#x5B9A;&#x3002;&#x5982;&#x679C;&#x8BF7;&#x6C42;&#x4E2D;&#x7684;&#x5927;&#x5C0F;&#x8D85;&#x8FC7;&#x914D;&#x7F6E;&#x7684;&#x503C;&#xFF0C;&#x5219;&#x4F1A;&#x5C06;413&#xFF08;&#x8BF7;&#x6C42;&#x5B9E;&#x4F53;&#x592A;&#x5927;&#xFF09;&#x9519;&#x8BEF;&#x8FD4;&#x56DE;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#x3002;&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x65E0;&#x6CD5;&#x6B63;&#x786E;&#x663E;&#x793A;&#x6B64;&#x9519;&#x8BEF;&#x3002;&#x5C06;&#x5927;&#x5C0F;&#x8BBE;&#x7F6E;&#x4E3A;0&#x5C06;&#x7981;&#x7528;&#x68C0;&#x67E5;&#x5BA2;&#x6237;&#x7AEF;&#x8BF7;&#x6C42;&#x6B63;&#x6587;&#x5927;&#x5C0F;&#x3002;]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mysql慢查询]]></title>
    <url>%2F2014%2F02%2F21%2Fmysql%E6%85%A2%E6%9F%A5%E8%AF%A2%2F</url>
    <content type="text"><![CDATA[&#x6982;&#x5FF5;MySQL&#x7684;&#x6162;&#x67E5;&#x8BE2;&#xFF0C;&#x5168;&#x540D;&#x662F;&#x6162;&#x67E5;&#x8BE2;&#x65E5;&#x5FD7;&#xFF0C;&#x662F;MySQL&#x63D0;&#x4F9B;&#x7684;&#x4E00;&#x79CD;&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;&#xFF0C;&#x7528;&#x6765;&#x8BB0;&#x5F55;&#x5728;MySQL&#x4E2D;&#x54CD;&#x5E94;&#x65F6;&#x95F4;&#x8D85;&#x8FC7;&#x9600;&#x503C;&#x7684;&#x8BED;&#x53E5;&#x3002;&#x5177;&#x4F53;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x8D85;&#x8FC7;long_query_time&#x503C;&#x7684;SQL&#x8BED;&#x53E5;&#xFF0C;&#x5219;&#x4F1A;&#x88AB;&#x8BB0;&#x5F55;&#x5230;&#x6162;&#x67E5;&#x8BE2;&#x65E5;&#x5FD7;&#x4E2D;&#x3002;long_query_time&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x4E3A;10&#xFF0C;&#x610F;&#x601D;&#x662F;&#x8BB0;&#x5F55;&#x8FD0;&#x884C;10&#x79D2;&#x4EE5;&#x4E0A;&#x7684;&#x8BED;&#x53E5;&#x3002;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;MySQL&#x6570;&#x636E;&#x5E93;&#x5E76;&#x4E0D;&#x542F;&#x52A8;&#x6162;&#x67E5;&#x8BE2;&#x65E5;&#x5FD7;&#xFF0C;&#x9700;&#x8981;&#x624B;&#x52A8;&#x6765;&#x8BBE;&#x7F6E;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x662F;&#x8C03;&#x4F18;&#x9700;&#x8981;&#x7684;&#x8BDD;&#xFF0C;&#x4E00;&#x822C;&#x4E0D;&#x5EFA;&#x8BAE;&#x542F;&#x52A8;&#x8BE5;&#x53C2;&#x6570;&#xFF0C;&#x56E0;&#x4E3A;&#x5F00;&#x542F;&#x6162;&#x67E5;&#x8BE2;&#x65E5;&#x5FD7;&#x4F1A;&#x6216;&#x591A;&#x6216;&#x5C11;&#x5E26;&#x6765;&#x4E00;&#x5B9A;&#x7684;&#x6027;&#x80FD;&#x5F71;&#x54CD;&#x3002;&#x6162;&#x67E5;&#x8BE2;&#x65E5;&#x5FD7;&#x652F;&#x6301;&#x5C06;&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;&#x5199;&#x5165;&#x6587;&#x4EF6;&#x548C;&#x6570;&#x636E;&#x5E93;&#x8868;&#x3002; &#x53C2;&#x6570;MySQL &#x6162;&#x67E5;&#x8BE2;&#x7684;&#x76F8;&#x5173;&#x53C2;&#x6570;&#x89E3;&#x91CA;&#xFF1A; slow_query_log&#xFF1A;&#x662F;&#x5426;&#x5F00;&#x542F;&#x6162;&#x67E5;&#x8BE2;&#x65E5;&#x5FD7;&#xFF0C;1&#x8868;&#x793A;&#x5F00;&#x542F;&#xFF0C;0&#x8868;&#x793A;&#x5173;&#x95ED;&#x3002; log-slow-queries &#xFF1A;&#x65E7;&#x7248;&#xFF08;5.6&#x4EE5;&#x4E0B;&#x7248;&#x672C;&#xFF09;MySQL&#x6570;&#x636E;&#x5E93;&#x6162;&#x67E5;&#x8BE2;&#x65E5;&#x5FD7;&#x5B58;&#x50A8;&#x8DEF;&#x5F84;&#x3002;&#x53EF;&#x4EE5;&#x4E0D;&#x8BBE;&#x7F6E;&#x8BE5;&#x53C2;&#x6570;&#xFF0C;&#x7CFB;&#x7EDF;&#x5219;&#x4F1A;&#x9ED8;&#x8BA4;&#x7ED9;&#x4E00;&#x4E2A;&#x7F3A;&#x7701;&#x7684;&#x6587;&#x4EF6;host_name-slow.log slow-query-log-file&#xFF1A;&#x65B0;&#x7248;&#xFF08;5.6&#x53CA;&#x4EE5;&#x4E0A;&#x7248;&#x672C;&#xFF09;MySQL&#x6570;&#x636E;&#x5E93;&#x6162;&#x67E5;&#x8BE2;&#x65E5;&#x5FD7;&#x5B58;&#x50A8;&#x8DEF;&#x5F84;&#x3002;&#x53EF;&#x4EE5;&#x4E0D;&#x8BBE;&#x7F6E;&#x8BE5;&#x53C2;&#x6570;&#xFF0C;&#x7CFB;&#x7EDF;&#x5219;&#x4F1A;&#x9ED8;&#x8BA4;&#x7ED9;&#x4E00;&#x4E2A;&#x7F3A;&#x7701;&#x7684;&#x6587;&#x4EF6;host_name-slow.log long_query_time&#xFF1A;&#x6162;&#x67E5;&#x8BE2;&#x9608;&#x503C;&#xFF0C;&#x5F53;&#x67E5;&#x8BE2;&#x65F6;&#x95F4;&#x591A;&#x4E8E;&#x8BBE;&#x5B9A;&#x7684;&#x9608;&#x503C;&#x65F6;&#xFF0C;&#x8BB0;&#x5F55;&#x65E5;&#x5FD7;&#x3002; log_queries_not_using_indexes&#xFF1A;&#x672A;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x7684;&#x67E5;&#x8BE2;&#x4E5F;&#x88AB;&#x8BB0;&#x5F55;&#x5230;&#x6162;&#x67E5;&#x8BE2;&#x65E5;&#x5FD7;&#x4E2D;&#xFF08;&#x53EF;&#x9009;&#x9879;&#xFF09;&#x3002; log_output&#xFF1A;&#x65E5;&#x5FD7;&#x5B58;&#x50A8;&#x65B9;&#x5F0F;&#x3002;log_output=&#x2019;FILE&#x2019;&#x8868;&#x793A;&#x5C06;&#x65E5;&#x5FD7;&#x5B58;&#x5165;&#x6587;&#x4EF6;&#xFF0C;&#x9ED8;&#x8BA4;&#x503C;&#x662F;&#x2019;FILE&#x2019;&#x3002;log_output=&#x2019;TABLE&#x2019;&#x8868;&#x793A;&#x5C06;&#x65E5;&#x5FD7;&#x5B58;&#x5165;&#x6570;&#x636E;&#x5E93;&#x3002; &#x914D;&#x7F6E;slow_query_log&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;slow_query_log&#x7684;&#x503C;&#x4E3A;OFF&#xFF0C;&#x8868;&#x793A;&#x6162;&#x67E5;&#x8BE2;&#x65E5;&#x5FD7;&#x662F;&#x7981;&#x7528;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;slow_query_log&#x7684;&#x503C;&#x6765;&#x5F00;&#x542F;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A; 12345678910mysql&gt; show variables like &apos;%slow_query_log%&apos;; +---------------------+-----------------------------------------------+ | Variable_name | Value | +---------------------+-----------------------------------------------+ | slow_query_log | OFF | | slow_query_log_file | /home/WDPM/MysqlData/mysql/DB-Server-slow.log | +---------------------+-----------------------------------------------+ 2 rows in set (0.00 sec)mysql&gt; set global slow_query_log=1; Query OK, 0 rows affected (0.09 sec) &#x4F7F;&#x7528;set global slow_query_log=1&#x5F00;&#x542F;&#x4E86;&#x6162;&#x67E5;&#x8BE2;&#x65E5;&#x5FD7;&#x53EA;&#x5BF9;&#x5F53;&#x524D;&#x6570;&#x636E;&#x5E93;&#x751F;&#x6548;&#xFF0C;MySQL&#x91CD;&#x542F;&#x540E;&#x5219;&#x4F1A;&#x5931;&#x6548;&#x3002;&#x5982;&#x679C;&#x8981;&#x6C38;&#x4E45;&#x751F;&#x6548;&#xFF0C;&#x5C31;&#x5FC5;&#x987B;&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6;my.cnf&#xFF08;&#x5176;&#x5B83;&#x7CFB;&#x7EDF;&#x53D8;&#x91CF;&#x4E5F;&#x662F;&#x5982;&#x6B64;&#xFF09;&#x3002;my.cnf&#x8981;&#x589E;&#x52A0;&#x6216;&#x4FEE;&#x6539;&#x53C2;&#x6570;slow_query_log &#x548C;slow_query_log_file&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A; 12slow_query_log = 1slow_query_log_file = /tmp/mysql_slow.log &#x7136;&#x540E;&#x91CD;&#x542F;MySQL&#x670D;&#x52A1;&#x5668;&#x3002; slow_query_log_file&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x7528;&#x4E8E;&#x6307;&#x5B9A;&#x6162;&#x67E5;&#x8BE2;&#x65E5;&#x5FD7;&#x7684;&#x5B58;&#x653E;&#x8DEF;&#x5F84;&#xFF0C;&#x7F3A;&#x7701;&#x60C5;&#x51B5;&#x662F;host_name-slow.log&#x6587;&#x4EF6;&#xFF0C; 1234567mysql&gt; show variables like &apos;slow_query_log_file&apos;; +---------------------+-----------------------------------------------+ | Variable_name | Value | +---------------------+-----------------------------------------------+ | slow_query_log_file | /home/WDPM/MysqlData/mysql/DB-Server-slow.log | +---------------------+-----------------------------------------------+ 1 row in set (0.00 sec) long_query_time&#x5F00;&#x542F;&#x4E86;&#x6162;&#x67E5;&#x8BE2;&#x65E5;&#x5FD7;&#x540E;&#xFF0C;&#x4EC0;&#x4E48;&#x6837;&#x7684;SQL&#x624D;&#x4F1A;&#x8BB0;&#x5F55;&#x5230;&#x6162;&#x67E5;&#x8BE2;&#x65E5;&#x5FD7;&#x91CC;&#x9762;&#x5462;&#xFF1F;&#x8FD9;&#x4E2A;&#x662F;&#x7531;&#x53C2;&#x6570;long_query_time&#x63A7;&#x5236;&#xFF0C;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;long_query_time&#x7684;&#x503C;&#x4E3A;10&#x79D2;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#x4FEE;&#x6539;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;my.cnf&#x53C2;&#x6570;&#x91CC;&#x9762;&#x4FEE;&#x6539;&#x3002;&#x5173;&#x4E8E;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x6B63;&#x597D;&#x7B49;&#x4E8E;long_query_time&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5E76;&#x4E0D;&#x4F1A;&#x88AB;&#x8BB0;&#x5F55;&#x4E0B;&#x6765;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5728;mysql&#x6E90;&#x7801;&#x91CC;&#x662F;&#x5224;&#x65AD;&#x5927;&#x4E8E;long_query_time&#xFF0C;&#x800C;&#x975E;&#x5927;&#x4E8E;&#x7B49;&#x4E8E;&#x3002;&#x4ECE;MySQL 5.1&#x5F00;&#x59CB;&#xFF0C;long_query_time&#x5F00;&#x59CB;&#x4EE5;&#x5FAE;&#x79D2;&#x8BB0;&#x5F55;SQL&#x8BED;&#x53E5;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#xFF0C;&#x4E4B;&#x524D;&#x4EC5;&#x7528;&#x79D2;&#x4E3A;&#x5355;&#x4F4D;&#x8BB0;&#x5F55;&#x3002;&#x5982;&#x679C;&#x8BB0;&#x5F55;&#x5230;&#x8868;&#x91CC;&#x9762;&#xFF0C;&#x53EA;&#x4F1A;&#x8BB0;&#x5F55;&#x6574;&#x6570;&#x90E8;&#x5206;&#xFF0C;&#x4E0D;&#x4F1A;&#x8BB0;&#x5F55;&#x5FAE;&#x79D2;&#x90E8;&#x5206;&#x3002; 123456789101112131415161718mysql&gt; show variables like &apos;long_query_time%&apos;; +-----------------+-----------+ | Variable_name | Value | +-----------------+-----------+ | long_query_time | 10.000000 | +-----------------+-----------+ 1 row in set (0.00 sec)mysql&gt; set global long_query_time=4; Query OK, 0 rows affected (0.00 sec)mysql&gt; show variables like &apos;long_query_time&apos;; +-----------------+-----------+ | Variable_name | Value | +-----------------+-----------+ | long_query_time | 10.000000 | +-----------------+-----------+ 1 row in set (0.00 sec) &#x5982;&#x4E0A;&#x6240;&#x793A;&#xFF0C;&#x6211;&#x4FEE;&#x6539;&#x4E86;&#x53D8;&#x91CF;long_query_time&#xFF0C;&#x4F46;&#x662F;&#x67E5;&#x8BE2;&#x53D8;&#x91CF;long_query_time&#x7684;&#x503C;&#x8FD8;&#x662F;10&#xFF0C;&#x96BE;&#x9053;&#x6CA1;&#x6709;&#x4FEE;&#x6539;&#x5230;&#x5462;&#xFF1F;&#x6CE8;&#x610F;&#xFF1A;&#x4F7F;&#x7528;&#x547D;&#x4EE4; set global long_query_time=4&#x4FEE;&#x6539;&#x540E;&#xFF0C;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x8FDE;&#x63A5;&#x6216;&#x65B0;&#x5F00;&#x4E00;&#x4E2A;&#x4F1A;&#x8BDD;&#x624D;&#x80FD;&#x770B;&#x5230;&#x4FEE;&#x6539;&#x503C;&#x3002;&#x7528;show variables like &#x2018;long_query_time&#x2019;&#x67E5;&#x770B;&#x662F;&#x5F53;&#x524D;&#x4F1A;&#x8BDD;&#x7684;&#x53D8;&#x91CF;&#x503C;&#x3002;&#x4E5F;&#x53EF;&#x4EE5;&#x4E0D;&#x7528;&#x91CD;&#x65B0;&#x8FDE;&#x63A5;&#x4F1A;&#x8BDD;&#xFF0C;&#x800C;&#x662F;&#x7528;show global variables like &#x2018;long_query_time&#x2019;;&#x3002; log_outputlog_output&#x53C2;&#x6570;&#x6307;&#x5B9A;&#x65E5;&#x5FD7;&#x7684;&#x5B58;&#x50A8;&#x65B9;&#x5F0F;&#x3002;log_output=&#x2019;FILE&#x2019;&#x8868;&#x793A;&#x5C06;&#x65E5;&#x5FD7;&#x5B58;&#x5165;&#x6587;&#x4EF6;&#xFF0C;&#x9ED8;&#x8BA4;&#x503C;&#x4E5F;&#x662F;&#x2019;FILE&#x2019;&#x3002;log_output=&#x2019;TABLE&#x2019;&#x8868;&#x793A;&#x5C06;&#x65E5;&#x5FD7;&#x5B58;&#x5165;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x8FD9;&#x6837;&#x65E5;&#x5FD7;&#x4FE1;&#x606F;&#x5C31;&#x4F1A;&#x88AB;&#x5199;&#x5165;&#x5230;mysql.slow_log&#x8868;&#x4E2D;&#x3002;&#x540C;&#x65F6;&#x4E5F;&#x652F;&#x6301;&#x4E24;&#x79CD;&#x65E5;&#x5FD7;&#x5B58;&#x50A8;&#x65B9;&#x5F0F;&#xFF0C;&#x914D;&#x7F6E;&#x7684;&#x65F6;&#x5019;&#x4EE5;&#x9017;&#x53F7;&#x9694;&#x5F00;&#x5373;&#x53EF;&#xFF0C;&#x5982;&#xFF1A;log_output=&#x2019;FILE,TABLE&#x2019;&#x3002;&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;&#x5230;&#x7CFB;&#x7EDF;&#x7684;&#x4E13;&#x7528;&#x65E5;&#x5FD7;&#x8868;&#x4E2D;&#xFF0C;&#x8981;&#x6BD4;&#x8BB0;&#x5F55;&#x5230;&#x6587;&#x4EF6;&#x8017;&#x8D39;&#x66F4;&#x591A;&#x7684;&#x7CFB;&#x7EDF;&#x8D44;&#x6E90;&#x3002;&#x56E0;&#x6B64;&#x5BF9;&#x4E8E;&#x9700;&#x8981;&#x542F;&#x7528;&#x6162;&#x67E5;&#x8BE2;&#x65E5;&#x5FD7;&#xFF0C;&#x53C8;&#x9700;&#x8981;&#x80FD;&#x591F;&#x83B7;&#x5F97;&#x66F4;&#x9AD8;&#x7684;&#x7CFB;&#x7EDF;&#x6027;&#x80FD;&#xFF0C;&#x90A3;&#x4E48;&#x5EFA;&#x8BAE;&#x4F18;&#x5148;&#x8BB0;&#x5F55;&#x5230;&#x6587;&#x4EF6;&#x3002; 1234567891011121314151617181920212223242526272829303132333435mysql&gt; show variables like &apos;%log_output%&apos;; +---------------+-------+ | Variable_name | Value | +---------------+-------+ | log_output | FILE | +---------------+-------+ 1 row in set (0.00 sec)mysql&gt; set global log_output=&apos;TABLE&apos;; Query OK, 0 rows affected (0.00 sec)mysql&gt; show variables like &apos;%log_output%&apos;; +---------------+-------+ | Variable_name | Value | +---------------+-------+ | log_output | TABLE | +---------------+-------+ 1 row in set (0.00 sec)mysql&gt; select sleep(5) ; +----------+ | sleep(5) | +----------+ | 0 | +----------+ 1 row in set (5.00 sec)mysql&gt; select * from mysql.slow_log; +---------------------+---------------------------+------------+-----------+-----------+---------------+----+----------------+-----------+-----------+-----------------+-----------+ | start_time | user_host | query_time | lock_time | rows_sent | rows_examined | db | last_insert_id | insert_id | server_id | sql_text | thread_id | +---------------------+---------------------------+------------+-----------+-----------+---------------+----+----------------+-----------+-----------+-----------------+-----------+ | 2016-06-16 17:37:53 | root[root] @ localhost [] | 00:00:03 | 00:00:00 | 1 | 0 | | 0 | 0 | 1 | select sleep(3) | 5 | | 2016-06-16 21:45:23 | root[root] @ localhost [] | 00:00:05 | 00:00:00 | 1 | 0 | | 0 | 0 | 1 | select sleep(5) | 2 | +---------------------+---------------------------+------------+-----------+-----------+---------------+----+----------------+-----------+-----------+-----------------+-----------+ 2 rows in set (0.00 sec) log-queries-not-using-indexes&#x8BE5;&#x7CFB;&#x7EDF;&#x53D8;&#x91CF;&#x6307;&#x5B9A;&#x672A;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x7684;&#x67E5;&#x8BE2;&#x4E5F;&#x88AB;&#x8BB0;&#x5F55;&#x5230;&#x6162;&#x67E5;&#x8BE2;&#x65E5;&#x5FD7;&#x4E2D;&#xFF08;&#x53EF;&#x9009;&#x9879;&#xFF09;&#x3002;&#x5982;&#x679C;&#x8C03;&#x4F18;&#x7684;&#x8BDD;&#xFF0C;&#x5EFA;&#x8BAE;&#x5F00;&#x542F;&#x8FD9;&#x4E2A;&#x9009;&#x9879;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x5F00;&#x542F;&#x4E86;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x5176;&#x5B9E;&#x4F7F;&#x7528;full index scan&#x7684;SQL&#x4E5F;&#x4F1A;&#x88AB;&#x8BB0;&#x5F55;&#x5230;&#x6162;&#x67E5;&#x8BE2;&#x65E5;&#x5FD7;&#x3002; 123456789101112131415161718mysql&gt; show variables like &apos;log_queries_not_using_indexes&apos;; +-------------------------------+-------+ | Variable_name | Value | +-------------------------------+-------+ | log_queries_not_using_indexes | OFF | +-------------------------------+-------+ 1 row in set (0.00 sec)mysql&gt; set global log_queries_not_using_indexes=1; Query OK, 0 rows affected (0.00 sec)mysql&gt; show variables like &apos;log_queries_not_using_indexes&apos;; +-------------------------------+-------+ | Variable_name | Value | +-------------------------------+-------+ | log_queries_not_using_indexes | ON | +-------------------------------+-------+ 1 row in set (0.00 sec) log_slow_admin_statements&#x8FD9;&#x4E2A;&#x7CFB;&#x7EDF;&#x53D8;&#x91CF;&#x8868;&#x793A;&#xFF0C;&#x662F;&#x5426;&#x5C06;&#x6162;&#x7BA1;&#x7406;&#x8BED;&#x53E5;&#x4F8B;&#x5982;ANALYZE TABLE&#x548C;ALTER TABLE&#x7B49;&#x8BB0;&#x5165;&#x6162;&#x67E5;&#x8BE2;&#x65E5;&#x5FD7;&#x3002; 1234567mysql&gt; show variables like &apos;log_slow_admin_statements&apos;; +---------------------------+-------+ | Variable_name | Value | +---------------------------+-------+ | log_slow_admin_statements | OFF | +---------------------------+-------+ 1 row in set (0.00 sec) Slow_queries&#x5982;&#x679C;&#x4F60;&#x60F3;&#x67E5;&#x8BE2;&#x6709;&#x591A;&#x5C11;&#x6761;&#x6162;&#x67E5;&#x8BE2;&#x8BB0;&#x5F55;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;Slow_queries&#x7CFB;&#x7EDF;&#x53D8;&#x91CF;&#x3002; 1234567mysql&gt; show global status like &apos;%Slow_queries%&apos;; +---------------+-------+ | Variable_name | Value | +---------------+-------+ | Slow_queries | 2104 | +---------------+-------+ 1 row in set (0.00 sec) &#x53E6;&#x5916;&#xFF0C;&#x8FD8;&#x6709;log_slow_slave_statements &#x548C; &#x2013;log-short-format &#x53C2;&#x6570;&#xFF0C;&#x53EF;&#x5230;MySQL&#x7F51;&#x7AD9;&#x4E86;&#x89E3;&#x3002; mysqldumpslow&#x5DE5;&#x5177;&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x624B;&#x5DE5;&#x5206;&#x6790;&#x65E5;&#x5FD7;&#xFF0C;&#x67E5;&#x627E;&#x3001;&#x5206;&#x6790;SQL&#xFF0C;&#x663E;&#x7136;&#x662F;&#x4E2A;&#x4F53;&#x529B;&#x6D3B;&#x3002;MySQL&#x63D0;&#x4F9B;&#x4E86;&#x65E5;&#x5FD7;&#x5206;&#x6790;&#x5DE5;&#x5177;mysqldumpslow&#x67E5;&#x770B;mysqldumpslow&#x7684;&#x5E2E;&#x52A9;&#x4FE1;&#x606F;&#xFF1A; 123456789101112131415161718192021222324252627[root@localhost ~]# mysqldumpslow --help Usage: mysqldumpslow [ OPTS... ] [ LOGS... ]Parse and summarize the MySQL slow query log. Options are --verbose verbose --debug debug --help write this text to standard output -v verbose -d debug -s ORDER what to sort by (al, at, ar, c, l, r, t), &apos;at&apos; is default&#xFF08;&#x6392;&#x5E8F;&#x65B9;&#x5F0F;&#xFF09; al: average lock time&#xFF08;&#x5E73;&#x5747;&#x9501;&#x5B9A;&#x65F6;&#x95F4;&#xFF09; ar: average rows sent&#xFF08;&#x5E73;&#x5747;&#x8FD4;&#x56DE;&#x8BB0;&#x5F55;&#x6570;&#xFF09; at: average query time&#xFF08;&#x5E73;&#x5747;&#x67E5;&#x8BE2;&#x65F6;&#x95F4;&#xFF09; c: count&#xFF08;&#x8BBF;&#x95EE;&#x8BA1;&#x6570;&#xFF09; l: lock time&#xFF08;&#x9501;&#x5B9A;&#x65F6;&#x95F4;&#xFF09; r: rows sent&#xFF08;&#x8FD4;&#x56DE;&#x8BB0;&#x5F55;&#xFF09; t: query time&#xFF08;&#x67E5;&#x8BE2;&#x65F6;&#x95F4;&#xFF09; -r reverse the sort order (largest last instead of first) -t NUM just show the top n queries&#xFF08;&#x8FD4;&#x56DE;&#x524D;&#x9762;n&#x6761;&#x6570;&#x636E;&#xFF09; -a don&apos;t abstract all numbers to N and strings to &apos;S&apos; -n NUM abstract numbers with at least n digits within names -g PATTERN grep: only consider stmts that include this string&#xFF08;&#x6B63;&#x5219;&#x5339;&#x914D;&#x6A21;&#x5F0F;&#xFF0C;&#x5927;&#x5C0F;&#x5199;&#x4E0D;&#x654F;&#x611F;&#xFF09; -h HOSTNAME hostname of db server for *-slow.log filename (can be wildcard), default is &apos;*&apos;, i.e. match all -i NAME name of server instance (if using mysql.server startup script) -l don&apos;t subtract lock time from total time &#x6BD4;&#x5982;&#xFF0C;&#x5F97;&#x5230;&#x8FD4;&#x56DE;&#x8BB0;&#x5F55;&#x96C6;&#x6700;&#x591A;&#x7684;10&#x4E2A;SQL&#x3002; 1mysqldumpslow -s r -t 10 /database/mysql/node1.log &#x5F97;&#x5230;&#x8BBF;&#x95EE;&#x6B21;&#x6570;&#x6700;&#x591A;&#x7684;10&#x4E2A;SQL 1mysqldumpslow -s c -t 10 /database/mysql/node1.log &#x5F97;&#x5230;&#x6309;&#x7167;&#x65F6;&#x95F4;&#x6392;&#x5E8F;&#x7684;&#x524D;10&#x6761;&#x91CC;&#x9762;&#x542B;&#x6709;&#x5DE6;&#x8FDE;&#x63A5;&#x7684;&#x67E5;&#x8BE2;&#x8BED;&#x53E5;&#x3002; 1mysqldumpslow -s t -t 10 -g &#x201C;left join&#x201D; /database/mysql/node1.log &#x53E6;&#x5916;&#x5EFA;&#x8BAE;&#x5728;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x547D;&#x4EE4;&#x65F6;&#x7ED3;&#x5408; | &#x548C;more &#x4F7F;&#x7528; &#xFF0C;&#x5426;&#x5219;&#x6709;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x5237;&#x5C4F;&#x7684;&#x60C5;&#x51B5;&#x3002; 1mysqldumpslow -s r -t 20 /mysqldata/mysql/node1.log | more EXPLAIN&#x5206;&#x6790;&#x67E5;&#x8BE2;&#x4F7F;&#x7528; EXPLAIN &#x5173;&#x952E;&#x5B57;&#x53EF;&#x4EE5;&#x6A21;&#x62DF;&#x4F18;&#x5316;&#x5668;&#x6267;&#x884C;SQL&#x67E5;&#x8BE2;&#x8BED;&#x53E5;&#xFF0C;&#x4ECE;&#x800C;&#x77E5;&#x9053;MySQL&#x662F;&#x5982;&#x4F55;&#x5904;&#x7406;&#x4F60;&#x7684;SQL&#x8BED;&#x53E5;&#x7684;&#x3002;&#x8FD9;&#x53EF;&#x4EE5;&#x5E2E;&#x4F60;&#x5206;&#x6790;&#x4F60;&#x7684;&#x67E5;&#x8BE2;&#x8BED;&#x53E5;&#x6216;&#x662F;&#x8868;&#x7ED3;&#x6784;&#x7684;&#x6027;&#x80FD;&#x74F6;&#x9888;&#x3002;&#x901A;&#x8FC7;explain&#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x5F97;&#x5230;: &#x8868;&#x7684;&#x8BFB;&#x53D6;&#x987A;&#x5E8F; &#x6570;&#x636E;&#x8BFB;&#x53D6;&#x64CD;&#x4F5C;&#x7684;&#x64CD;&#x4F5C;&#x7C7B;&#x578B; &#x54EA;&#x4E9B;&#x7D22;&#x5F15;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; &#x54EA;&#x4E9B;&#x7D22;&#x5F15;&#x88AB;&#x5B9E;&#x9645;&#x4F7F;&#x7528; &#x8868;&#x4E4B;&#x95F4;&#x7684;&#x5F15;&#x7528; &#x6BCF;&#x5F20;&#x8868;&#x6709;&#x591A;&#x5C11;&#x884C;&#x88AB;&#x4F18;&#x5316;&#x5668;&#x67E5;&#x8BE2; EXPLAIN&#x5B57;&#x6BB5; Table&#xFF1A;&#x663E;&#x793A;&#x8FD9;&#x4E00;&#x884C;&#x7684;&#x6570;&#x636E;&#x662F;&#x5173;&#x4E8E;&#x54EA;&#x5F20;&#x8868;&#x7684; possible_keys&#xFF1A;&#x663E;&#x793A;&#x53EF;&#x80FD;&#x5E94;&#x7528;&#x5728;&#x8FD9;&#x5F20;&#x8868;&#x4E2D;&#x7684;&#x7D22;&#x5F15;&#x3002;&#x5982;&#x679C;&#x4E3A;&#x7A7A;&#xFF0C;&#x6CA1;&#x6709;&#x53EF;&#x80FD;&#x7684;&#x7D22;&#x5F15;&#x3002;&#x53EF;&#x4EE5;&#x4E3A;&#x76F8;&#x5173;&#x7684;&#x57DF;&#x4ECE;WHERE&#x8BED;&#x53E5;&#x4E2D;&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x5408;&#x9002;&#x7684;&#x8BED;&#x53E5; key&#xFF1A;&#x5B9E;&#x9645;&#x4F7F;&#x7528;&#x7684;&#x7D22;&#x5F15;&#x3002;&#x5982;&#x679C;&#x4E3A;NULL&#xFF0C;&#x5219;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x3002;MYSQL&#x5F88;&#x5C11;&#x4F1A;&#x9009;&#x62E9;&#x4F18;&#x5316;&#x4E0D;&#x8DB3;&#x7684;&#x7D22;&#x5F15;&#xFF0C;&#x6B64;&#x65F6;&#x53EF;&#x4EE5;&#x5728;SELECT&#x8BED;&#x53E5;&#x4E2D;&#x4F7F;&#x7528;USE INDEX&#xFF08;index&#xFF09;&#x6765;&#x5F3A;&#x5236;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x7D22;&#x5F15;&#x6216;&#x8005;&#x7528;IGNORE INDEX&#xFF08;index&#xFF09;&#x6765;&#x5F3A;&#x5236;&#x5FFD;&#x7565;&#x7D22;&#x5F15; key_len&#xFF1A;&#x4F7F;&#x7528;&#x7684;&#x7D22;&#x5F15;&#x7684;&#x957F;&#x5EA6;&#x3002;&#x5728;&#x4E0D;&#x635F;&#x5931;&#x7CBE;&#x786E;&#x6027;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x957F;&#x5EA6;&#x8D8A;&#x77ED;&#x8D8A;&#x597D; ref&#xFF1A;&#x663E;&#x793A;&#x7D22;&#x5F15;&#x7684;&#x54EA;&#x4E00;&#x5217;&#x88AB;&#x4F7F;&#x7528;&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x53EF;&#x80FD;&#x7684;&#x8BDD;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x5E38;&#x6570; rows&#xFF1A;MySQL&#x8BA4;&#x4E3A;&#x5FC5;&#x987B;&#x68C0;&#x7D22;&#x7684;&#x7528;&#x6765;&#x8FD4;&#x56DE;&#x8BF7;&#x6C42;&#x6570;&#x636E;&#x7684;&#x884C;&#x6570; type&#xFF1A;&#x8FD9;&#x662F;&#x6700;&#x91CD;&#x8981;&#x7684;&#x5B57;&#x6BB5;&#x4E4B;&#x4E00;&#xFF0C;&#x663E;&#x793A;&#x67E5;&#x8BE2;&#x4F7F;&#x7528;&#x4E86;&#x4F55;&#x79CD;&#x7C7B;&#x578B;&#x3002;&#x4ECE;&#x6700;&#x597D;&#x5230;&#x6700;&#x5DEE;&#x7684;&#x8FDE;&#x63A5;&#x7C7B;&#x578B;&#x4E3A;system&#x3001;const&#x3001;eq_reg&#x3001;ref&#x3001;range&#x3001;index&#x548C;ALL system&#x3001;const&#xFF1A;&#x53EF;&#x4EE5;&#x5C06;&#x67E5;&#x8BE2;&#x7684;&#x53D8;&#x91CF;&#x8F6C;&#x4E3A;&#x5E38;&#x91CF;. &#x5982;id=1; id&#x4E3A; &#x4E3B;&#x952E;&#x6216;&#x552F;&#x4E00;&#x952E;. eq_ref&#xFF1A;&#x8BBF;&#x95EE;&#x7D22;&#x5F15;,&#x8FD4;&#x56DE;&#x67D0;&#x5355;&#x4E00;&#x884C;&#x7684;&#x6570;&#x636E;.(&#x901A;&#x5E38;&#x5728;&#x8054;&#x63A5;&#x65F6;&#x51FA;&#x73B0;&#xFF0C;&#x67E5;&#x8BE2;&#x4F7F;&#x7528;&#x7684;&#x7D22;&#x5F15;&#x4E3A;&#x4E3B;&#x952E;&#x6216;&#x60DF;&#x4E00;&#x952E;) ref&#xFF1A;&#x8BBF;&#x95EE;&#x7D22;&#x5F15;,&#x8FD4;&#x56DE;&#x67D0;&#x4E2A;&#x503C;&#x7684;&#x6570;&#x636E;.(&#x53EF;&#x4EE5;&#x8FD4;&#x56DE;&#x591A;&#x884C;) &#x901A;&#x5E38;&#x4F7F;&#x7528;=&#x65F6;&#x53D1;&#x751F; range&#xFF1A;&#x8FD9;&#x4E2A;&#x8FDE;&#x63A5;&#x7C7B;&#x578B;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x8303;&#x56F4;&#x4E2D;&#x7684;&#x884C;&#xFF0C;&#x6BD4;&#x5982;&#x4F7F;&#x7528;&gt;&#x6216;&lt;&#x67E5;&#x627E;&#x4E1C;&#x897F;&#xFF0C;&#x5E76;&#x4E14;&#x8BE5;&#x5B57;&#x6BB5;&#x4E0A;&#x5EFA;&#x6709;&#x7D22;&#x5F15;&#x65F6;&#x53D1;&#x751F;&#x7684;&#x60C5;&#x51B5;(&#x6CE8;:&#x4E0D;&#x4E00;&#x5B9A;&#x597D;&#x4E8E;index) index&#xFF1A;&#x4EE5;&#x7D22;&#x5F15;&#x7684;&#x987A;&#x5E8F;&#x8FDB;&#x884C;&#x5168;&#x8868;&#x626B;&#x63CF;&#xFF0C;&#x4F18;&#x70B9;&#x662F;&#x4E0D;&#x7528;&#x6392;&#x5E8F;,&#x7F3A;&#x70B9;&#x662F;&#x8FD8;&#x8981;&#x5168;&#x8868;&#x626B;&#x63CF; ALL&#xFF1A;&#x5168;&#x8868;&#x626B;&#x63CF;&#xFF0C;&#x5E94;&#x8BE5;&#x5C3D;&#x91CF;&#x907F;&#x514D; Extra&#xFF1A;&#x5173;&#x4E8E;MYSQL&#x5982;&#x4F55;&#x89E3;&#x6790;&#x67E5;&#x8BE2;&#x7684;&#x989D;&#x5916;&#x4FE1;&#x606F;&#xFF0C;&#x4E3B;&#x8981;&#x6709;&#x4EE5;&#x4E0B;&#x51E0;&#x79CD; using index&#xFF1A;&#x53EA;&#x7528;&#x5230;&#x7D22;&#x5F15;,&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x8BBF;&#x95EE;&#x8868;. using where&#xFF1A;&#x4F7F;&#x7528;&#x5230;where&#x6765;&#x8FC7;&#x8651;&#x6570;&#x636E;. &#x4E0D;&#x662F;&#x6240;&#x6709;&#x7684;where clause&#x90FD;&#x8981;&#x663E;&#x793A;using where. &#x5982;&#x4EE5;=&#x65B9;&#x5F0F;&#x8BBF;&#x95EE;&#x7D22;&#x5F15;. using tmporary&#xFF1A;&#x7528;&#x5230;&#x4E34;&#x65F6;&#x8868; using filesort&#xFF1A;&#x7528;&#x5230;&#x989D;&#x5916;&#x7684;&#x6392;&#x5E8F;. (&#x5F53;&#x4F7F;&#x7528;order by v1,&#x800C;&#x6CA1;&#x7528;&#x5230;&#x7D22;&#x5F15;&#x65F6;,&#x5C31;&#x4F1A;&#x4F7F;&#x7528;&#x989D;&#x5916;&#x7684;&#x6392;&#x5E8F;) range checked for eache record(index map:N)&#xFF1A;&#x6CA1;&#x6709;&#x597D;&#x7684;&#x7D22;&#x5F15;. profiling&#x5206;&#x6790;&#x67E5;&#x8BE2;&#x901A;&#x8FC7;&#x6162;&#x65E5;&#x5FD7;&#x67E5;&#x8BE2;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#x54EA;&#x4E9B;SQL&#x8BED;&#x53E5;&#x6267;&#x884C;&#x6548;&#x7387;&#x4F4E;&#x4E0B;&#xFF0C;&#x901A;&#x8FC7;explain&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F97;&#x77E5;SQL&#x8BED;&#x53E5;&#x7684;&#x5177;&#x4F53;&#x6267;&#x884C;&#x60C5;&#x51B5;&#xFF0C;&#x7D22;&#x5F15;&#x4F7F;&#x7528;&#x7B49;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x7ED3;&#x5408;show&#x547D;&#x4EE4;&#x67E5;&#x770B;&#x6267;&#x884C;&#x72B6;&#x6001;&#x3002;&#x5982;&#x679C;&#x89C9;&#x5F97;explain&#x7684;&#x4FE1;&#x606F;&#x4E0D;&#x591F;&#x8BE6;&#x7EC6;&#xFF0C;&#x53EF;&#x4EE5;&#x540C;&#x901A;&#x8FC7;profiling&#x547D;&#x4EE4;&#x5F97;&#x5230;&#x66F4;&#x51C6;&#x786E;&#x7684;SQL&#x6267;&#x884C;&#x6D88;&#x8017;&#x7CFB;&#x7EDF;&#x8D44;&#x6E90;&#x7684;&#x4FE1;&#x606F;&#x3002;profiling&#x9ED8;&#x8BA4;&#x662F;&#x5173;&#x95ED;&#x7684;&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x8BED;&#x53E5;&#x67E5;&#x770B;&#xFF1A; 1234567mysql&gt; select @@profiling;+-------------+| @@profiling |+-------------+| 0 |+-------------+1 row in set (0.01 sec) &#x6253;&#x5F00;&#x529F;&#x80FD;&#xFF1A; mysql&gt;set profiling=1; &#x6267;&#x884C;&#x9700;&#x8981;&#x6D4B;&#x8BD5;&#x7684;sql &#x8BED;&#x53E5;&#xFF1A; 12345678910mysql&gt; set profiling=1;Query OK, 0 rows affected (0.01 sec)mysql&gt; select @@profiling;+-------------+| @@profiling |+-------------+| 1 |+-------------+1 row in set (0.00 sec) &#x5F97;&#x5230;&#x88AB;&#x6267;&#x884C;&#x7684;SQL&#x8BED;&#x53E5;&#x7684;&#x65F6;&#x95F4;&#x548C;ID 123456mysql&gt; show profiles\G *************************** 1. row ***************************Query_ID: 1Duration: 35.03156400 Query: select * from kaifang3 where Mobile=158301515891 row in set (0.02 sec) &#x5F97;&#x5230;&#x5BF9;&#x5E94;SQL&#x8BED;&#x53E5;&#x6267;&#x884C;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F; 1234567891011121314151617181920212223242526272829mysql&gt; show profile for query 1 ; +--------------------------------+-----------+| Status | Duration |+--------------------------------+-----------+| starting | 0.000099 || Waiting for query cache lock | 0.000019 || checking query cache for query | 0.000137 || checking permissions | 0.000152 || Opening tables | 0.000062 || System lock | 0.011881 || Waiting for query cache lock | 0.000093 || init | 0.000212 || optimizing | 0.000036 || statistics | 0.000049 || preparing | 0.000037 || executing | 0.000011 || Sending data | 0.000189 || Waiting for query cache lock | 0.000010 || Sending data | 0.000038 || storing result in query cache | 34.995402 || end | 0.000051 || query end | 0.000123 || closing tables | 0.000047 || freeing items | 0.000921 || logging slow query | 0.000012 || logging slow query | 0.021972 || cleaning up | 0.000015 |+--------------------------------+-----------+23 rows in set (0.02 sec) &#x4EE5;&#x4E0A;&#x7684;16&#x884C;&#x662F;&#x9488;&#x5BF9;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x7684;select&#x8BED;&#x53E5;&#x7684;&#x8D44;&#x6E90;&#x4FE1;&#x606F;&#xFF0C;&#x5BF9;&#x4E8E;&#x8F83;&#x590D;&#x6742;&#x7684;SQL&#x8BED;&#x53E5;&#xFF0C;&#x4F1A;&#x6709;&#x66F4;&#x591A;&#x7684;&#x884C;&#x548C;&#x5B57;&#x6BB5;&#xFF0C;&#x6BD4;&#x5982;converting HEAP to MyISAM &#x3001;Copying to tmp table&#x7B49;&#x7B49;&#xFF0C;&#x7531;&#x4E8E;&#x4EE5;&#x4E0A;&#x7684;SQL&#x8BED;&#x53E5;&#x4E0D;&#x5B58;&#x5728;&#x590D;&#x6742;&#x7684;&#x8868;&#x64CD;&#x4F5C;&#xFF0C;&#x6240;&#x4EE5;&#x672A;&#x663E;&#x793A;&#x8FD9;&#x4E9B;&#x5B57;&#x6BB5;&#x3002;&#x901A;&#x8FC7;profiling&#x8D44;&#x6E90;&#x8017;&#x8D39;&#x4FE1;&#x606F;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x91C7;&#x53D6;&#x9488;&#x5BF9;&#x6027;&#x7684;&#x4F18;&#x5316;&#x63AA;&#x65BD;&#x3002; &#x6D4B;&#x8BD5;&#x5B8C;&#x6BD5;&#x540E; &#xFF0C;&#x5173;&#x95ED;&#xFF1A;mysql&gt; set profiling=0 &#x7D22;&#x5F15;&#x53CA;&#x67E5;&#x8BE2;&#x4F18;&#x5316;&#x7D22;&#x5F15;&#x7684;&#x7C7B;&#x578B; &#x666E;&#x901A;&#x7D22;&#x5F15;&#xFF1A;&#x8FD9;&#x662F;&#x6700;&#x57FA;&#x672C;&#x7684;&#x7D22;&#x5F15;&#x7C7B;&#x578B;&#xFF0C;&#x6CA1;&#x552F;&#x4E00;&#x6027;&#x4E4B;&#x7C7B;&#x7684;&#x9650;&#x5236;&#x3002; &#x552F;&#x4E00;&#x6027;&#x7D22;&#x5F15;&#xFF1A;&#x548C;&#x666E;&#x901A;&#x7D22;&#x5F15;&#x57FA;&#x672C;&#x76F8;&#x540C;&#xFF0C;&#x4F46;&#x6240;&#x6709;&#x7684;&#x7D22;&#x5F15;&#x5217;&#x503C;&#x4FDD;&#x6301;&#x552F;&#x4E00;&#x6027;&#x3002; &#x4E3B;&#x952E;&#xFF1A;&#x4E3B;&#x952E;&#x662F;&#x4E00;&#x79CD;&#x552F;&#x4E00;&#x7D22;&#x5F15;&#xFF0C;&#x4F46;&#x5FC5;&#x987B;&#x6307;&#x5B9A;&#x4E3A;&#x201D;PRIMARY KEY&#x201D;&#x3002; &#x5168;&#x6587;&#x7D22;&#x5F15;&#xFF1A;MYSQL&#x4ECE;3.23.23&#x5F00;&#x59CB;&#x652F;&#x6301;&#x5168;&#x6587;&#x7D22;&#x5F15;&#x548C;&#x5168;&#x6587;&#x68C0;&#x7D22;&#x3002;&#x5728;MYSQL&#x4E2D;&#xFF0C;&#x5168;&#x6587;&#x7D22;&#x5F15;&#x7684;&#x7D22;&#x5F15;&#x7C7B;&#x578B;&#x4E3A;FULLTEXT&#x3002;&#x5168;&#x6587;&#x7D22;&#x5F15;&#x53EF;&#x4EE5;&#x5728;VARCHAR&#x6216;&#x8005;TEXT&#x7C7B;&#x578B;&#x7684;&#x5217;&#x4E0A;&#x521B;&#x5EFA;&#x3002; &#x5927;&#x591A;&#x6570;MySQL&#x7D22;&#x5F15;(PRIMARY KEY&#x3001;UNIQUE&#x3001;INDEX&#x548C;FULLTEXT)&#x4F7F;&#x7528;B&#x6811;&#x4E2D;&#x5B58;&#x50A8;&#x3002;&#x7A7A;&#x95F4;&#x5217;&#x7C7B;&#x578B;&#x7684;&#x7D22;&#x5F15;&#x4F7F;&#x7528;R-&#x6811;&#xFF0C;MEMORY&#x8868;&#x652F;&#x6301;hash&#x7D22;&#x5F15;&#x3002; &#x5355;&#x5217;&#x7D22;&#x5F15;&#x548C;&#x591A;&#x5217;&#x7D22;&#x5F15;&#xFF08;&#x590D;&#x5408;&#x7D22;&#x5F15;&#xFF09;&#x7D22;&#x5F15;&#x53EF;&#x4EE5;&#x662F;&#x5355;&#x5217;&#x7D22;&#x5F15;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x591A;&#x5217;&#x7D22;&#x5F15;&#x3002;&#x5BF9;&#x76F8;&#x5173;&#x7684;&#x5217;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x662F;&#x63D0;&#x9AD8;SELECT&#x64CD;&#x4F5C;&#x6027;&#x80FD;&#x7684;&#x6700;&#x4F73;&#x9014;&#x5F84;&#x4E4B;&#x4E00;&#x3002; &#x591A;&#x5217;&#x7D22;&#x5F15;MySQL&#x53EF;&#x4EE5;&#x4E3A;&#x591A;&#x4E2A;&#x5217;&#x521B;&#x5EFA;&#x7D22;&#x5F15;&#x3002;&#x4E00;&#x4E2A;&#x7D22;&#x5F15;&#x53EF;&#x4EE5;&#x5305;&#x62EC;15&#x4E2A;&#x5217;&#x3002;&#x5BF9;&#x4E8E;&#x67D0;&#x4E9B;&#x5217;&#x7C7B;&#x578B;&#xFF0C;&#x53EF;&#x4EE5;&#x7D22;&#x5F15;&#x5217;&#x7684;&#x5DE6;&#x524D;&#x7F00;&#xFF0C;&#x5217;&#x7684;&#x987A;&#x5E8F;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x3002;&#x591A;&#x5217;&#x7D22;&#x5F15;&#x53EF;&#x4EE5;&#x89C6;&#x4E3A;&#x5305;&#x542B;&#x901A;&#x8FC7;&#x8FDE;&#x63A5;&#x7D22;&#x5F15;&#x5217;&#x7684;&#x503C;&#x800C;&#x521B;&#x5EFA;&#x7684;&#x503C;&#x7684;&#x6392;&#x5E8F;&#x7684;&#x6570;&#x7EC4;&#x3002;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x5373;&#x4F7F;&#x662F;&#x9650;&#x5236;&#x6700;&#x4E25;&#x683C;&#x7684;&#x5355;&#x5217;&#x7D22;&#x5F15;&#xFF0C;&#x5B83;&#x7684;&#x9650;&#x5236;&#x80FD;&#x529B;&#x4E5F;&#x8FDC;&#x8FDC;&#x4F4E;&#x4E8E;&#x591A;&#x5217;&#x7D22;&#x5F15;&#x3002; &#x6700;&#x5DE6;&#x524D;&#x7F00;&#x591A;&#x5217;&#x7D22;&#x5F15;&#x6709;&#x4E00;&#x4E2A;&#x7279;&#x70B9;&#xFF0C;&#x5373;&#x6700;&#x5DE6;&#x524D;&#x7F00;&#xFF08;Leftmost Prefixing&#xFF09;&#x3002;&#x5047;&#x5982;&#x6709;&#x4E00;&#x4E2A;&#x591A;&#x5217;&#x7D22;&#x5F15;&#x4E3A;key(firstname lastname age)&#xFF0C;&#x5F53;&#x641C;&#x7D22;&#x6761;&#x4EF6;&#x662F;&#x4EE5;&#x4E0B;&#x5404;&#x79CD;&#x5217;&#x7684;&#x7EC4;&#x5408;&#x548C;&#x987A;&#x5E8F;&#x65F6;&#xFF0C;MySQL&#x5C06;&#x4F7F;&#x7528;&#x8BE5;&#x591A;&#x5217;&#x7D22;&#x5F15;&#xFF1A;firstname&#xFF0C;lastname&#xFF0C;agefirstname&#xFF0C;lastnamefirstname &#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x8FD8;&#x5EFA;&#x7ACB;&#x4E86;key(firstname lastname)&#x548C;key(firstname)&#x3002; &#x7D22;&#x5F15;&#x4E3B;&#x8981;&#x7684;&#x64CD;&#x4F5C;&#x5FEB;&#x901F;&#x627E;&#x51FA;&#x5339;&#x914D;&#x4E00;&#x4E2A;WHERE&#x5B50;&#x53E5;&#x7684;&#x884C;&#x3002;&#x5220;&#x9664;&#x884C;&#x3002;&#x5F53;&#x6267;&#x884C;&#x8054;&#x63A5;&#x65F6;&#xFF0C;&#x4ECE;&#x5176;&#x5B83;&#x8868;&#x68C0;&#x7D22;&#x884C;&#x3002;&#x5BF9;&#x5177;&#x4F53;&#x6709;&#x7D22;&#x5F15;&#x7684;&#x5217;key_col&#x627E;&#x51FA;MAX()&#x6216;MIN()&#x503C;&#x3002;&#x7531;&#x9884;&#x5904;&#x7406;&#x5668;&#x8FDB;&#x884C;&#x4F18;&#x5316;&#xFF0C;&#x68C0;&#x67E5;&#x662F;&#x5426;&#x5BF9;&#x7D22;&#x5F15;&#x4E2D;&#x5728;key_col&#x4E4B;&#x524D;&#x53D1;&#x751F;&#x6240;&#x6709;&#x5173;&#x952E;&#x5B57;&#x5143;&#x7D20;&#x4F7F;&#x7528;&#x4E86;WHERE key_part_# = constant&#x3002;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;MySQL&#x4E3A;&#x6BCF;&#x4E2A;MIN()&#x6216;MAX()&#x8868;&#x8FBE;&#x5F0F;&#x6267;&#x884C;&#x4E00;&#x6B21;&#x5173;&#x952E;&#x5B57;&#x67E5;&#x627E;&#xFF0C;&#x5E76;&#x7528;&#x5E38;&#x6570;&#x66FF;&#x6362;&#x5B83;&#x3002;&#x5982;&#x679C;&#x6240;&#x6709;&#x8868;&#x8FBE;&#x5F0F;&#x66FF;&#x6362;&#x4E3A;&#x5E38;&#x91CF;&#xFF0C;&#x67E5;&#x8BE2;&#x7ACB;&#x5373;&#x8FD4;&#x56DE;&#x3002;&#x4F8B;&#x5982;&#xFF1A;SELECT MIN(key2), MAX (key2) FROM tb WHERE key1=10; &#x5982;&#x679C;&#x5BF9;&#x4E00;&#x4E2A;&#x53EF;&#x7528;&#x5173;&#x952E;&#x5B57;&#x7684;&#x6700;&#x5DE6;&#x9762;&#x7684;&#x524D;&#x7F00;&#x8FDB;&#x884C;&#x4E86;&#x6392;&#x5E8F;&#x6216;&#x5206;&#x7EC4;(&#x4F8B;&#x5982;&#xFF0C;ORDER BY key_part_1,key_part_2)&#xFF0C;&#x6392;&#x5E8F;&#x6216;&#x5206;&#x7EC4;&#x4E00;&#x4E2A;&#x8868;&#x3002;&#x5982;&#x679C;&#x6240;&#x6709;&#x5173;&#x952E;&#x5B57;&#x5143;&#x7D20;&#x540E;&#x9762;&#x6709;DESC&#xFF0C;&#x5173;&#x952E;&#x5B57;&#x4EE5;&#x5012;&#x5E8F;&#x88AB;&#x8BFB;&#x53D6;&#x3002;&#x5728;&#x4E00;&#x4E9B;&#x60C5;&#x51B5;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x5BF9;&#x4E00;&#x4E2A;&#x67E5;&#x8BE2;&#x8FDB;&#x884C;&#x4F18;&#x5316;&#x4EE5;&#x4FBF;&#x4E0D;&#x7528;&#x67E5;&#x8BE2;&#x6570;&#x636E;&#x884C;&#x5373;&#x53EF;&#x4EE5;&#x68C0;&#x7D22;&#x503C;&#x3002;&#x5982;&#x679C;&#x67E5;&#x8BE2;&#x53EA;&#x4F7F;&#x7528;&#x6765;&#x81EA;&#x67D0;&#x4E2A;&#x8868;&#x7684;&#x6570;&#x5B57;&#x578B;&#x5E76;&#x4E14;&#x6784;&#x6210;&#x67D0;&#x4E9B;&#x5173;&#x952E;&#x5B57;&#x7684;&#x6700;&#x5DE6;&#x9762;&#x524D;&#x7F00;&#x7684;&#x5217;&#xFF0C;&#x4E3A;&#x4E86;&#x66F4;&#x5FEB;&#xFF0C;&#x53EF;&#x4EE5;&#x4ECE;&#x7D22;&#x5F15;&#x6811;&#x68C0;&#x7D22;&#x51FA;&#x503C;&#x3002;SELECT key_part3 FROM tb WHERE key_part1=1 &#x6709;&#x65F6;MySQL&#x4E0D;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#xFF0C;&#x5373;&#x4F7F;&#x6709;&#x53EF;&#x7528;&#x7684;&#x7D22;&#x5F15;&#x3002;&#x4E00;&#x79CD;&#x60C5;&#x5F62;&#x662F;&#x5F53;&#x4F18;&#x5316;&#x5668;&#x4F30;&#x8BA1;&#x5230;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x5C06;&#x9700;&#x8981;MySQL&#x8BBF;&#x95EE;&#x8868;&#x4E2D;&#x7684;&#x5927;&#x90E8;&#x5206;&#x884C;&#x65F6;&#x3002;(&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8868;&#x626B;&#x63CF;&#x53EF;&#x80FD;&#x4F1A;&#x66F4;&#x5FEB;&#x4E9B;&#xFF09;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x5982;&#x679C;&#x6B64;&#x7C7B;&#x67E5;&#x8BE2;&#x4F7F;&#x7528;LIMIT&#x53EA;&#x641C;&#x7D22;&#x90E8;&#x5206;&#x884C;&#xFF0C;MySQL&#x5219;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x53EF;&#x4EE5;&#x66F4;&#x5FEB;&#x5730;&#x627E;&#x5230;&#x51E0;&#x884C;&#x5E76;&#x5728;&#x7ED3;&#x679C;&#x4E2D;&#x8FD4;&#x56DE;&#x3002; &#x5408;&#x7406;&#x7684;&#x5EFA;&#x7ACB;&#x7D22;&#x5F15;&#x7684;&#x5EFA;&#x8BAE; &#x8D8A;&#x5C0F;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x901A;&#x5E38;&#x66F4;&#x597D;&#xFF1A;&#x8D8A;&#x5C0F;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x901A;&#x5E38;&#x5728;&#x78C1;&#x76D8;&#x3001;&#x5185;&#x5B58;&#x548C;CPU&#x7F13;&#x5B58;&#x4E2D;&#x90FD;&#x9700;&#x8981;&#x66F4;&#x5C11;&#x7684;&#x7A7A;&#x95F4;&#xFF0C;&#x5904;&#x7406;&#x8D77;&#x6765;&#x66F4;&#x5FEB;&#x3002; &#x7B80;&#x5355;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x66F4;&#x597D;&#xFF1A;&#x6574;&#x578B;&#x6570;&#x636E;&#x6BD4;&#x8D77;&#x5B57;&#x7B26;&#xFF0C;&#x5904;&#x7406;&#x5F00;&#x9500;&#x66F4;&#x5C0F;&#xFF0C;&#x56E0;&#x4E3A;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x6BD4;&#x8F83;&#x66F4;&#x590D;&#x6742;&#x3002;&#x5728;MySQL&#x4E2D;&#xFF0C;&#x5E94;&#x8BE5;&#x7528;&#x5185;&#x7F6E;&#x7684;&#x65E5;&#x671F;&#x548C;&#x65F6;&#x95F4;&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x7528;&#x5B57;&#x7B26;&#x4E32;&#x6765;&#x5B58;&#x50A8;&#x65F6;&#x95F4;&#xFF1B;&#x4EE5;&#x53CA;&#x7528;&#x6574;&#x578B;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x5B58;&#x50A8;IP&#x5730;&#x5740;&#x3002; &#x5C3D;&#x91CF;&#x907F;&#x514D;NULL&#xFF1A;&#x5E94;&#x8BE5;&#x6307;&#x5B9A;&#x5217;&#x4E3A;NOT NULL&#xFF0C;&#x9664;&#x975E;&#x4F60;&#x60F3;&#x5B58;&#x50A8;NULL&#x3002;&#x5728;MySQL&#x4E2D;&#xFF0C;&#x542B;&#x6709;&#x7A7A;&#x503C;&#x7684;&#x5217;&#x5F88;&#x96BE;&#x8FDB;&#x884C;&#x67E5;&#x8BE2;&#x4F18;&#x5316;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x4F7F;&#x5F97;&#x7D22;&#x5F15;&#x3001;&#x7D22;&#x5F15;&#x7684;&#x7EDF;&#x8BA1;&#x4FE1;&#x606F;&#x4EE5;&#x53CA;&#x6BD4;&#x8F83;&#x8FD0;&#x7B97;&#x66F4;&#x52A0;&#x590D;&#x6742;&#x3002;&#x4F60;&#x5E94;&#x8BE5;&#x7528;0&#x3001;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x7684;&#x503C;&#x6216;&#x8005;&#x4E00;&#x4E2A;&#x7A7A;&#x4E32;&#x4EE3;&#x66FF;&#x7A7A;&#x503C; &#x5173;&#x4E8E;&#x7D22;&#x5F15;&#x548C;&#x5199;SQL&#x8BED;&#x53E5;&#x65F6;&#x5E94;&#x5F53;&#x6CE8;&#x610F;&#x7684;&#x4E00;&#x4E9B;&#x7410;&#x788E;&#x5EFA;&#x8BAE;&#x548C;&#x6CE8;&#x610F;&#x70B9; &#x5F53;&#x7ED3;&#x679C;&#x96C6;&#x53EA;&#x6709;&#x4E00;&#x884C;&#x6570;&#x636E;&#x65F6;&#x4F7F;&#x7528;LIMIT 1 &#x907F;&#x514D;SELECT *&#xFF0C;&#x59CB;&#x7EC8;&#x6307;&#x5B9A;&#x4F60;&#x9700;&#x8981;&#x7684;&#x5217;&#x4ECE;&#x8868;&#x4E2D;&#x8BFB;&#x53D6;&#x8D8A;&#x591A;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x67E5;&#x8BE2;&#x4F1A;&#x53D8;&#x5F97;&#x66F4;&#x6162;&#x3002;&#x4ED6;&#x589E;&#x52A0;&#x4E86;&#x78C1;&#x76D8;&#x9700;&#x8981;&#x64CD;&#x4F5C;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x8FD8;&#x662F;&#x5728;&#x6570;&#x636E;&#x5E93;&#x670D;&#x52A1;&#x5668;&#x4E0E;WEB&#x670D;&#x52A1;&#x5668;&#x662F;&#x72EC;&#x7ACB;&#x5206;&#x5F00;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x3002;&#x4F60;&#x5C06;&#x4F1A;&#x7ECF;&#x5386;&#x975E;&#x5E38;&#x6F2B;&#x957F;&#x7684;&#x7F51;&#x7EDC;&#x5EF6;&#x8FDF;&#xFF0C;&#x4EC5;&#x4EC5;&#x662F;&#x56E0;&#x4E3A;&#x6570;&#x636E;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x5728;&#x670D;&#x52A1;&#x5668;&#x4E4B;&#x95F4;&#x4F20;&#x8F93;&#x3002; &#x4F7F;&#x7528;&#x8FDE;&#x63A5;&#xFF08;JOIN&#xFF09;&#x6765;&#x4EE3;&#x66FF;&#x5B50;&#x67E5;&#x8BE2;(Sub-Queries)&#x8FDE;&#x63A5;&#xFF08;JOIN&#xFF09;.. &#x4E4B;&#x6240;&#x4EE5;&#x66F4;&#x6709;&#x6548;&#x7387;&#x4E00;&#x4E9B;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;MySQL&#x4E0D;&#x9700;&#x8981;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x521B;&#x5EFA;&#x4E34;&#x65F6;&#x8868;&#x6765;&#x5B8C;&#x6210;&#x8FD9;&#x4E2A;&#x903B;&#x8F91;&#x4E0A;&#x7684;&#x9700;&#x8981;&#x4E24;&#x4E2A;&#x6B65;&#x9AA4;&#x7684;&#x67E5;&#x8BE2;&#x5DE5;&#x4F5C;&#x3002; &#x4F7F;&#x7528;ENUM&#x3001;CHAR &#x800C;&#x4E0D;&#x662F;VARCHAR&#xFF0C;&#x4F7F;&#x7528;&#x5408;&#x7406;&#x7684;&#x5B57;&#x6BB5;&#x5C5E;&#x6027;&#x957F;&#x5EA6; &#x5C3D;&#x53EF;&#x80FD;&#x7684;&#x4F7F;&#x7528;NOT NULL &#x56FA;&#x5B9A;&#x957F;&#x5EA6;&#x7684;&#x8868;&#x4F1A;&#x66F4;&#x5FEB; &#x62C6;&#x5206;&#x5927;&#x7684;DELETE &#x6216;INSERT &#x8BED;&#x53E5; &#x67E5;&#x8BE2;&#x7684;&#x5217;&#x8D8A;&#x5C0F;&#x8D8A;&#x5FEB; Where&#x6761;&#x4EF6;&#x5728;&#x67E5;&#x8BE2;&#x4E2D;&#xFF0C;WHERE&#x6761;&#x4EF6;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x91CD;&#x8981;&#x7684;&#x56E0;&#x7D20;&#xFF0C;&#x5C3D;&#x91CF;&#x5C11;&#x5E76;&#x4E14;&#x662F;&#x5408;&#x7406;&#x7684;where&#x6761;&#x4EF6;&#x662F;&#x5F88;&#x91CD;&#x8981;&#x7684;&#xFF0C;&#x5C3D;&#x91CF;&#x5728;&#x591A;&#x4E2A;&#x6761;&#x4EF6;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x628A;&#x4F1A;&#x63D0;&#x53D6;&#x5C3D;&#x91CF;&#x5C11;&#x6570;&#x636E;&#x91CF;&#x7684;&#x6761;&#x4EF6;&#x653E;&#x5728;&#x524D;&#x9762;&#xFF0C;&#x51CF;&#x5C11;&#x540E;&#x4E00;&#x4E2A;where&#x6761;&#x4EF6;&#x7684;&#x67E5;&#x8BE2;&#x65F6;&#x95F4;&#x3002; &#x6709;&#x4E9B;where&#x6761;&#x4EF6;&#x4F1A;&#x5BFC;&#x81F4;&#x7D22;&#x5F15;&#x65E0;&#x6548;&#xFF1A;where&#x5B50;&#x53E5;&#x7684;&#x67E5;&#x8BE2;&#x6761;&#x4EF6;&#x91CC;&#x6709;&#xFF01;=&#xFF0C;MySQL&#x5C06;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x3002;where&#x5B50;&#x53E5;&#x4F7F;&#x7528;&#x4E86;Mysql&#x51FD;&#x6570;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7D22;&#x5F15;&#x5C06;&#x65E0;&#x6548;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;select * from tb where left(name, 4) = &#x2018;xxx&#x2019;&#x4F7F;&#x7528;LIKE&#x8FDB;&#x884C;&#x641C;&#x7D22;&#x5339;&#x914D;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8FD9;&#x6837;&#x7D22;&#x5F15;&#x662F;&#x6709;&#x6548;&#x7684;&#xFF1A;select * from tbl1 where name like &#x2018;xxx%&#x2019;&#xFF0C;&#x800C;like &#x2018;%xxx%&#x2019; &#x65F6;&#x7D22;&#x5F15;&#x65E0;&#x6548; &#x914D;&#x7F6E;&#x4F18;&#x5316;&#x5B89;&#x88C5;MySQL&#x540E;&#xFF0C;&#x914D;&#x7F6E;&#x6587;&#x4EF6;my.cnf&#x5728; /MySQL&#x5B89;&#x88C5;&#x76EE;&#x5F55;/share/mysql&#x76EE;&#x5F55;&#x4E2D;&#xFF0C;&#x8BE5;&#x76EE;&#x5F55;&#x4E2D;&#x8FD8;&#x5305;&#x542B;&#x591A;&#x4E2A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x53EF;&#x4F9B;&#x53C2;&#x8003;&#xFF0C;&#x6709;my-large.cnf &#xFF0C;my-huge.cnf&#xFF0C; my-medium.cnf&#xFF0C;my-small.cnf&#xFF0C;&#x5206;&#x522B;&#x5BF9;&#x5E94;&#x5927;&#x4E2D;&#x5C0F;&#x578B;&#x6570;&#x636E;&#x5E93;&#x5E94;&#x7528;&#x7684;&#x914D;&#x7F6E;&#x3002;win&#x73AF;&#x5883;&#x4E0B;&#x5373;&#x5B58;&#x5728;&#x4E8E;MySQL&#x5B89;&#x88C5;&#x76EE;&#x5F55;&#x4E2D;&#x7684;.ini&#x6587;&#x4EF6;&#x3002; &#x4E0B;&#x9762;&#x5217;&#x51FA;&#x4E86;&#x5BF9;&#x6027;&#x80FD;&#x4F18;&#x5316;&#x5F71;&#x54CD;&#x8F83;&#x5927;&#x7684;&#x4E3B;&#x8981;&#x53D8;&#x91CF;&#xFF0C;&#x4E3B;&#x8981;&#x5206;&#x4E3A;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x7684;&#x53D8;&#x91CF;&#x548C;&#x7F13;&#x51B2;&#x533A;&#x53D8;&#x91CF;&#x3002; &#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x7684;&#x53D8;&#x91CF;&#xFF1A;1) max_connectionsMySQL&#x7684;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;&#xFF0C;&#x589E;&#x52A0;&#x8BE5;&#x503C;&#x589E;&#x52A0;mysqld &#x8981;&#x6C42;&#x7684;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x7684;&#x6570;&#x91CF;&#x3002;&#x5982;&#x679C;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5E76;&#x53D1;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x91CF;&#x6BD4;&#x8F83;&#x5927;&#xFF0C;&#x5EFA;&#x8BAE;&#x8C03;&#x9AD8;&#x6B64;&#x503C;&#xFF0C;&#x4EE5;&#x589E;&#x52A0;&#x5E76;&#x884C;&#x8FDE;&#x63A5;&#x6570;&#x91CF;&#xFF0C;&#x5F53;&#x7136;&#x8FD9;&#x5EFA;&#x7ACB;&#x5728;&#x673A;&#x5668;&#x80FD;&#x652F;&#x6491;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x56E0;&#x4E3A;&#x5982;&#x679C;&#x8FDE;&#x63A5;&#x6570;&#x8D8A;&#x591A;&#xFF0C;&#x4ECB;&#x4E8E;MySQL&#x4F1A;&#x4E3A;&#x6BCF;&#x4E2A;&#x8FDE;&#x63A5;&#x63D0;&#x4F9B;&#x8FDE;&#x63A5;&#x7F13;&#x51B2;&#x533A;&#xFF0C;&#x5C31;&#x4F1A;&#x5F00;&#x9500;&#x8D8A;&#x591A;&#x7684;&#x5185;&#x5B58;&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x9002;&#x5F53;&#x8C03;&#x6574;&#x8BE5;&#x503C;&#xFF0C;&#x4E0D;&#x80FD;&#x76F2;&#x76EE;&#x63D0;&#x9AD8;&#x8BBE;&#x503C;&#x3002; &#x6570;&#x503C;&#x8FC7;&#x5C0F;&#x4F1A;&#x7ECF;&#x5E38;&#x51FA;&#x73B0;ERROR 1040: Too many connections&#x9519;&#x8BEF;&#xFF0C;&#x53EF;&#x4EE5;&#x8FC7;&#x2019;conn%&#x2019;&#x901A;&#x914D;&#x7B26;&#x67E5;&#x770B;&#x5F53;&#x524D;&#x72B6;&#x6001;&#x7684;&#x8FDE;&#x63A5;&#x6570;&#x91CF;&#xFF0C;&#x4EE5;&#x5B9A;&#x593A;&#x8BE5;&#x503C;&#x7684;&#x5927;&#x5C0F;&#x3002;show variables like &#x2018;max_connections&#x2019; &#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;show status like &#x2018;max_used_connections&#x2019; &#x54CD;&#x5E94;&#x7684;&#x8FDE;&#x63A5;&#x6570; &#x5982;&#x4E0B;&#xFF1A; 12345678910111213mysql&gt; show variables like &apos;max_connections&apos;;+&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2013;+&#x2014;&#x2014;-+| Variable_name | Value |+&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2013;+&#x2014;&#x2014;-+| max_connections | 256 |+&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2013;+&#x2014;&#x2014;-+mysql&gt; show status like &apos;max%connections&apos;;+&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2013;+&#x2014;&#x2014;-+| Variable_name | Value |+&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;-+&#x2014;&#x2014;-+| max_used_connections | 256|+&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;-+&#x2014;&#x2014;-+ max_used_connections / max_connections * 100% &#xFF08;&#x7406;&#x60F3;&#x503C;&#x2248; 85%&#xFF09;&#x5982;&#x679C;max_used_connections&#x8DDF;max_connections&#x76F8;&#x540C; &#x90A3;&#x4E48;&#x5C31;&#x662F;max_connections&#x8BBE;&#x7F6E;&#x8FC7;&#x4F4E;&#x6216;&#x8005;&#x8D85;&#x8FC7;&#x670D;&#x52A1;&#x5668;&#x8D1F;&#x8F7D;&#x4E0A;&#x9650;&#x4E86;&#xFF0C;&#x4F4E;&#x4E8E;10%&#x5219;&#x8BBE;&#x7F6E;&#x8FC7;&#x5927;&#x3002; 2) back_logMySQL&#x80FD;&#x6682;&#x5B58;&#x7684;&#x8FDE;&#x63A5;&#x6570;&#x91CF;&#x3002;&#x5F53;&#x4E3B;&#x8981;MySQL&#x7EBF;&#x7A0B;&#x5728;&#x4E00;&#x4E2A;&#x5F88;&#x77ED;&#x65F6;&#x95F4;&#x5185;&#x5F97;&#x5230;&#x975E;&#x5E38;&#x591A;&#x7684;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#xFF0C;&#x8FD9;&#x5C31;&#x8D77;&#x4F5C;&#x7528;&#x3002;&#x5982;&#x679C;MySQL&#x7684;&#x8FDE;&#x63A5;&#x6570;&#x636E;&#x8FBE;&#x5230;max_connections&#x65F6;&#xFF0C;&#x65B0;&#x6765;&#x7684;&#x8BF7;&#x6C42;&#x5C06;&#x4F1A;&#x88AB;&#x5B58;&#x5728;&#x5806;&#x6808;&#x4E2D;&#xFF0C;&#x4EE5;&#x7B49;&#x5F85;&#x67D0;&#x4E00;&#x8FDE;&#x63A5;&#x91CA;&#x653E;&#x8D44;&#x6E90;&#xFF0C;&#x8BE5;&#x5806;&#x6808;&#x7684;&#x6570;&#x91CF;&#x5373;back_log&#xFF0C;&#x5982;&#x679C;&#x7B49;&#x5F85;&#x8FDE;&#x63A5;&#x7684;&#x6570;&#x91CF;&#x8D85;&#x8FC7;back_log&#xFF0C;&#x5C06;&#x4E0D;&#x88AB;&#x6388;&#x4E88;&#x8FDE;&#x63A5;&#x8D44;&#x6E90;&#x3002;back_log&#x503C;&#x6307;&#x51FA;&#x5728;MySQL&#x6682;&#x65F6;&#x505C;&#x6B62;&#x56DE;&#x7B54;&#x65B0;&#x8BF7;&#x6C42;&#x4E4B;&#x524D;&#x7684;&#x77ED;&#x65F6;&#x95F4;&#x5185;&#x6709;&#x591A;&#x5C11;&#x4E2A;&#x8BF7;&#x6C42;&#x53EF;&#x4EE5;&#x88AB;&#x5B58;&#x5728;&#x5806;&#x6808;&#x4E2D;&#x3002;&#x53EA;&#x6709;&#x5982;&#x679C;&#x671F;&#x671B;&#x5728;&#x4E00;&#x4E2A;&#x77ED;&#x65F6;&#x95F4;&#x5185;&#x6709;&#x5F88;&#x591A;&#x8FDE;&#x63A5;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x589E;&#x52A0;&#x5B83;&#xFF0C;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x8FD9;&#x503C;&#x5BF9;&#x5230;&#x6765;&#x7684;TCP/IP&#x8FDE;&#x63A5;&#x7684;&#x4FA6;&#x542C;&#x961F;&#x5217;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x5F53;&#x89C2;&#x5BDF;&#x4F60;&#x4E3B;&#x673A;&#x8FDB;&#x7A0B;&#x5217;&#x8868;&#xFF08;mysql&gt; show full processlist&#xFF09;&#xFF0C;&#x53D1;&#x73B0;&#x5927;&#x91CF;264084 | unauthenticated user | xxx.xxx.xxx.xxx | NULL | Connect | NULL | login | NULL &#x7684;&#x5F85;&#x8FDE;&#x63A5;&#x8FDB;&#x7A0B;&#x65F6;&#xFF0C;&#x5C31;&#x8981;&#x52A0;&#x5927;back_log &#x7684;&#x503C;&#x4E86;&#x3002;&#x9ED8;&#x8BA4;&#x6570;&#x503C;&#x662F;50&#xFF0C;&#x53EF;&#x8C03;&#x4F18;&#x4E3A;128&#xFF0C;&#x5BF9;&#x4E8E;Linux&#x7CFB;&#x7EDF;&#x8BBE;&#x7F6E;&#x8303;&#x56F4;&#x4E3A;&#x5C0F;&#x4E8E;512&#x7684;&#x6574;&#x6570;&#x3002; 3) interactive_timeout&#x4E00;&#x4E2A;&#x4EA4;&#x4E92;&#x8FDE;&#x63A5;&#x5728;&#x88AB;&#x670D;&#x52A1;&#x5668;&#x5728;&#x5173;&#x95ED;&#x524D;&#x7B49;&#x5F85;&#x884C;&#x52A8;&#x7684;&#x79D2;&#x6570;&#x3002;&#x4E00;&#x4E2A;&#x4EA4;&#x4E92;&#x7684;&#x5BA2;&#x6237;&#x88AB;&#x5B9A;&#x4E49;&#x4E3A;&#x5BF9;mysql_real_connect()&#x4F7F;&#x7528;CLIENT_INTERACTIVE &#x9009;&#x9879;&#x7684;&#x5BA2;&#x6237;&#x3002;&#x9ED8;&#x8BA4;&#x6570;&#x503C;&#x662F;28800&#xFF0C;&#x53EF;&#x8C03;&#x4F18;&#x4E3A;7200&#x3002; &#x7F13;&#x51B2;&#x533A;&#x53D8;&#x91CF;&#x5168;&#x5C40;&#x7F13;&#x51B2;&#xFF1A; 4) key_buffer_sizekey_buffer_size&#x6307;&#x5B9A;&#x7D22;&#x5F15;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x5B83;&#x51B3;&#x5B9A;&#x7D22;&#x5F15;&#x5904;&#x7406;&#x7684;&#x901F;&#x5EA6;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x7D22;&#x5F15;&#x8BFB;&#x7684;&#x901F;&#x5EA6;&#x3002;&#x901A;&#x8FC7;&#x68C0;&#x67E5;&#x72B6;&#x6001;&#x503C;Key_read_requests&#x548C;Key_reads&#xFF0C;&#x53EF;&#x4EE5;&#x77E5;&#x9053;key_buffer_size&#x8BBE;&#x7F6E;&#x662F;&#x5426;&#x5408;&#x7406;&#x3002;&#x6BD4;&#x4F8B;key_reads / key_read_requests&#x5E94;&#x8BE5;&#x5C3D;&#x53EF;&#x80FD;&#x7684;&#x4F4E;&#xFF0C;&#x81F3;&#x5C11;&#x662F;1:100&#xFF0C;1:1000&#x66F4;&#x597D;&#xFF08;&#x4E0A;&#x8FF0;&#x72B6;&#x6001;&#x503C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;SHOW STATUS LIKE &#x2018;key_read%&#x2019;&#x83B7;&#x5F97;&#xFF09;&#x3002; key_buffer_size&#x53EA;&#x5BF9;MyISAM&#x8868;&#x8D77;&#x4F5C;&#x7528;&#x3002;&#x5373;&#x4F7F;&#x4F60;&#x4E0D;&#x4F7F;&#x7528;MyISAM&#x8868;&#xFF0C;&#x4F46;&#x662F;&#x5185;&#x90E8;&#x7684;&#x4E34;&#x65F6;&#x78C1;&#x76D8;&#x8868;&#x662F;MyISAM&#x8868;&#xFF0C;&#x4E5F;&#x8981;&#x4F7F;&#x7528;&#x8BE5;&#x503C;&#x3002;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x68C0;&#x67E5;&#x72B6;&#x6001;&#x503C;created_tmp_disk_tables&#x5F97;&#x77E5;&#x8BE6;&#x60C5;&#x3002; &#x4E3E;&#x4F8B;&#x5982;&#x4E0B;&#xFF1A; 123456mysql&gt; show variables like &apos;key_buffer_size&apos;;+&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;-+&#x2014;&#x2014;&#x2014;&#x2014;+| Variable_name | Value |+&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;+&#x2014;&#x2014;&#x2014;&#x2014;+| key_buffer_size | 536870912 |+&#x2014;&#x2014;&#x2014;&#x2014; &#x2014;&#x2014;&#x2014;-+&#x2014;&#x2014;&#x2014;&#x2014;+ key_buffer_size&#x4E3A;512MB&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x770B;&#x4E00;&#x4E0B;key_buffer_size&#x7684;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#xFF1A; 1234567mysql&gt; show global status like &apos;key_read%&apos;;+&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;+&#x2014;&#x2014;&#x2014;&#x2014;-+| Variable_name | Value |+&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;+&#x2014;&#x2014;&#x2014;&#x2014;-+| Key_read_requests| 27813678764 || Key_reads | 6798830 |+&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;+&#x2014;&#x2014;&#x2014;&#x2014;-+ &#x4E00;&#x5171;&#x6709;27813678764&#x4E2A;&#x7D22;&#x5F15;&#x8BFB;&#x53D6;&#x8BF7;&#x6C42;&#xFF0C;&#x6709;6798830&#x4E2A;&#x8BF7;&#x6C42;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x6CA1;&#x6709;&#x627E;&#x5230;&#x76F4;&#x63A5;&#x4ECE;&#x786C;&#x76D8;&#x8BFB;&#x53D6;&#x7D22;&#x5F15;&#xFF0C;&#x8BA1;&#x7B97;&#x7D22;&#x5F15;&#x672A;&#x547D;&#x4E2D;&#x7F13;&#x5B58;&#x7684;&#x6982;&#x7387;&#xFF1A;key_cache_miss_rate &#xFF1D;Key_reads / Key_read_requests * 100%&#xFF0C;&#x8BBE;&#x7F6E;&#x5728;1/1000&#x5DE6;&#x53F3;&#x8F83;&#x597D;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x6570;&#x503C;&#x662F;8388600(8M)&#xFF0C;&#x4E3B;&#x673A;&#x6709;4GB&#x5185;&#x5B58;&#xFF0C;&#x53EF;&#x4EE5;&#x8C03;&#x4F18;&#x503C;&#x4E3A;268435456(256MB)&#x3002; 5) query_cache_size&#x4F7F;&#x7528;&#x67E5;&#x8BE2;&#x7F13;&#x51B2;&#xFF0C;MySQL&#x5C06;&#x67E5;&#x8BE2;&#x7ED3;&#x679C;&#x5B58;&#x653E;&#x5728;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#xFF0C;&#x4ECA;&#x540E;&#x5BF9;&#x4E8E;&#x540C;&#x6837;&#x7684;SELECT&#x8BED;&#x53E5;&#xFF08;&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;&#xFF09;&#xFF0C;&#x5C06;&#x76F4;&#x63A5;&#x4ECE;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x8BFB;&#x53D6;&#x7ED3;&#x679C;&#x3002; &#x901A;&#x8FC7;&#x68C0;&#x67E5;&#x72B6;&#x6001;&#x503C;Qcache_*&#xFF0C;&#x53EF;&#x4EE5;&#x77E5;&#x9053;query_cache_size&#x8BBE;&#x7F6E;&#x662F;&#x5426;&#x5408;&#x7406;&#xFF08;&#x4E0A;&#x8FF0;&#x72B6;&#x6001;&#x503C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;SHOW STATUS LIKE &#x2018;Qcache%&#x2019;&#x83B7;&#x5F97;&#xFF09;&#x3002;&#x5982;&#x679C;Qcache_lowmem_prunes&#x7684;&#x503C;&#x975E;&#x5E38;&#x5927;&#xFF0C;&#x5219;&#x8868;&#x660E;&#x7ECF;&#x5E38;&#x51FA;&#x73B0;&#x7F13;&#x51B2;&#x4E0D;&#x591F;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5982;&#x679C;Qcache_hits&#x7684;&#x503C;&#x4E5F;&#x975E;&#x5E38;&#x5927;&#xFF0C;&#x5219;&#x8868;&#x660E;&#x67E5;&#x8BE2;&#x7F13;&#x51B2;&#x4F7F;&#x7528;&#x975E;&#x5E38;&#x9891;&#x7E41;&#xFF0C;&#x6B64;&#x65F6;&#x9700;&#x8981;&#x589E;&#x52A0;&#x7F13;&#x51B2;&#x5927;&#x5C0F;&#xFF1B;&#x5982;&#x679C;Qcache_hits&#x7684;&#x503C;&#x4E0D;&#x5927;&#xFF0C;&#x5219;&#x8868;&#x660E;&#x4F60;&#x7684;&#x67E5;&#x8BE2;&#x91CD;&#x590D;&#x7387;&#x5F88;&#x4F4E;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x4F7F;&#x7528;&#x67E5;&#x8BE2;&#x7F13;&#x51B2;&#x53CD;&#x800C;&#x4F1A;&#x5F71;&#x54CD;&#x6548;&#x7387;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x8003;&#x8651;&#x4E0D;&#x7528;&#x67E5;&#x8BE2;&#x7F13;&#x51B2;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x5728;SELECT&#x8BED;&#x53E5;&#x4E2D;&#x52A0;&#x5165;SQL_NO_CACHE&#x53EF;&#x4EE5;&#x660E;&#x786E;&#x8868;&#x793A;&#x4E0D;&#x4F7F;&#x7528;&#x67E5;&#x8BE2;&#x7F13;&#x51B2;&#x3002; &#x4E0E;&#x67E5;&#x8BE2;&#x7F13;&#x51B2;&#x6709;&#x5173;&#x7684;&#x53C2;&#x6570;&#x8FD8;&#x6709;query_cache_type&#x3001;query_cache_limit&#x3001;query_cache_min_res_unit&#x3002; query_cache_type&#x6307;&#x5B9A;&#x662F;&#x5426;&#x4F7F;&#x7528;&#x67E5;&#x8BE2;&#x7F13;&#x51B2;&#xFF0C;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x4E3A;0&#x3001;1&#x3001;2&#xFF0C;&#x8BE5;&#x53D8;&#x91CF;&#x662F;SESSION&#x7EA7;&#x7684;&#x53D8;&#x91CF;&#x3002; query_cache_limit&#x6307;&#x5B9A;&#x5355;&#x4E2A;&#x67E5;&#x8BE2;&#x80FD;&#x591F;&#x4F7F;&#x7528;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x5927;&#x5C0F;&#xFF0C;&#x7F3A;&#x7701;&#x4E3A;1M&#x3002; query_cache_min_res_unit&#x662F;&#x5728;4.1&#x7248;&#x672C;&#x4EE5;&#x540E;&#x5F15;&#x5165;&#x7684;&#xFF0C;&#x5B83;&#x6307;&#x5B9A;&#x5206;&#x914D;&#x7F13;&#x51B2;&#x533A;&#x7A7A;&#x95F4;&#x7684;&#x6700;&#x5C0F;&#x5355;&#x4F4D;&#xFF0C;&#x7F3A;&#x7701;&#x4E3A;4K&#x3002;&#x68C0;&#x67E5;&#x72B6;&#x6001;&#x503C;Qcache_free_blocks&#xFF0C;&#x5982;&#x679C;&#x8BE5;&#x503C;&#x975E;&#x5E38;&#x5927;&#xFF0C;&#x5219;&#x8868;&#x660E;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x788E;&#x7247;&#x5F88;&#x591A;&#xFF0C;&#x8FD9;&#x5C31;&#x8868;&#x660E;&#x67E5;&#x8BE2;&#x7ED3;&#x679C;&#x90FD;&#x6BD4;&#x8F83;&#x5C0F;&#xFF0C;&#x6B64;&#x65F6;&#x9700;&#x8981;&#x51CF;&#x5C0F;query_cache_min_res_unit&#x3002; &#x4E3E;&#x4F8B;&#x5982;&#x4E0B;&#xFF1A; 123456789101112131415161718192021222324mysql&gt; show global status like &apos;qcache%&apos;;+&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;-+&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2013;+| Variable_name | Value |+&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;-+&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2013;+| Qcache_free_blocks | 22756 || Qcache_free_memory | 76764704 || Qcache_hits | 213028692 || Qcache_inserts | 208894227 || Qcache_lowmem_prunes | 4010916 || Qcache_not_cached | 13385031 || Qcache_queries_in_cache | 43560 || Qcache_total_blocks | 111212 |+&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;-+&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2013;+mysql&gt; show variables like &apos;query_cache%&apos;;+&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2013;+&#x2014;&#x2014;&#x2014;&#x2014;&#x2013;+| Variable_name | Value |+&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2013;+&#x2014;&#x2014;&#x2014;&#x2013;+| query_cache_limit | 2097152 || query_cache_min_res_unit | 4096 || query_cache_size | 203423744 || query_cache_type | ON || query_cache_wlock_invalidate | OFF |+&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2013;+&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;+ &#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#x788E;&#x7247;&#x7387;= Qcache_free_blocks / Qcache_total_blocks * 100%&#x5982;&#x679C;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#x788E;&#x7247;&#x7387;&#x8D85;&#x8FC7;20%&#xFF0C;&#x53EF;&#x4EE5;&#x7528;FLUSH QUERY CACHE&#x6574;&#x7406;&#x7F13;&#x5B58;&#x788E;&#x7247;&#xFF0C;&#x6216;&#x8005;&#x8BD5;&#x8BD5;&#x51CF;&#x5C0F;query_cache_min_res_unit&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x7684;&#x67E5;&#x8BE2;&#x90FD;&#x662F;&#x5C0F;&#x6570;&#x636E;&#x91CF;&#x7684;&#x8BDD;&#x3002;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#x5229;&#x7528;&#x7387;= (query_cache_size &#x2013; Qcache_free_memory) / query_cache_size * 100%&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#x5229;&#x7528;&#x7387;&#x5728;25%&#x4EE5;&#x4E0B;&#x7684;&#x8BDD;&#x8BF4;&#x660E;query_cache_size&#x8BBE;&#x7F6E;&#x7684;&#x8FC7;&#x5927;&#xFF0C;&#x53EF;&#x9002;&#x5F53;&#x51CF;&#x5C0F;&#xFF1B;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#x5229;&#x7528;&#x7387;&#x5728;80&#xFF05;&#x4EE5;&#x4E0A;&#x800C;&#x4E14;Qcache_lowmem_prunes &gt; 50&#x7684;&#x8BDD;&#x8BF4;&#x660E;query_cache_size&#x53EF;&#x80FD;&#x6709;&#x70B9;&#x5C0F;&#xFF0C;&#x8981;&#x4E0D;&#x5C31;&#x662F;&#x788E;&#x7247;&#x592A;&#x591A;&#x3002;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#x547D;&#x4E2D;&#x7387;= (Qcache_hits &#x2013; Qcache_inserts) / Qcache_hits * 100%&#x793A;&#x4F8B;&#x670D;&#x52A1;&#x5668;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#x788E;&#x7247;&#x7387;&#xFF1D;20.46&#xFF05;&#xFF0C;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#x5229;&#x7528;&#x7387;&#xFF1D;62.26&#xFF05;&#xFF0C;&#x67E5;&#x8BE2;&#x7F13;&#x5B58;&#x547D;&#x4E2D;&#x7387;&#xFF1D;1.94&#xFF05;&#xFF0C;&#x547D;&#x4E2D;&#x7387;&#x5F88;&#x5DEE;&#xFF0C;&#x53EF;&#x80FD;&#x5199;&#x64CD;&#x4F5C;&#x6BD4;&#x8F83;&#x9891;&#x7E41;&#x5427;&#xFF0C;&#x800C;&#x4E14;&#x53EF;&#x80FD;&#x6709;&#x4E9B;&#x788E;&#x7247;&#x3002; &#x6BCF;&#x4E2A;&#x8FDE;&#x63A5;&#x7684;&#x7F13;&#x51B2; 6) record_buffer_size&#x6BCF;&#x4E2A;&#x8FDB;&#x884C;&#x4E00;&#x4E2A;&#x987A;&#x5E8F;&#x626B;&#x63CF;&#x7684;&#x7EBF;&#x7A0B;&#x4E3A;&#x5176;&#x626B;&#x63CF;&#x7684;&#x6BCF;&#x5F20;&#x8868;&#x5206;&#x914D;&#x8FD9;&#x4E2A;&#x5927;&#x5C0F;&#x7684;&#x4E00;&#x4E2A;&#x7F13;&#x51B2;&#x533A;&#x3002;&#x5982;&#x679C;&#x4F60;&#x505A;&#x5F88;&#x591A;&#x987A;&#x5E8F;&#x626B;&#x63CF;&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x60F3;&#x8981;&#x589E;&#x52A0;&#x8BE5;&#x503C;&#x3002;&#x9ED8;&#x8BA4;&#x6570;&#x503C;&#x662F;131072(128K)&#xFF0C;&#x53EF;&#x6539;&#x4E3A;16773120 (16M) 7) read_rnd_buffer_size&#x968F;&#x673A;&#x8BFB;&#x7F13;&#x51B2;&#x533A;&#x5927;&#x5C0F;&#x3002;&#x5F53;&#x6309;&#x4EFB;&#x610F;&#x987A;&#x5E8F;&#x8BFB;&#x53D6;&#x884C;&#x65F6;(&#x4F8B;&#x5982;&#xFF0C;&#x6309;&#x7167;&#x6392;&#x5E8F;&#x987A;&#x5E8F;)&#xFF0C;&#x5C06;&#x5206;&#x914D;&#x4E00;&#x4E2A;&#x968F;&#x673A;&#x8BFB;&#x7F13;&#x5B58;&#x533A;&#x3002;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#x67E5;&#x8BE2;&#x65F6;&#xFF0C;MySQL&#x4F1A;&#x9996;&#x5148;&#x626B;&#x63CF;&#x4E00;&#x904D;&#x8BE5;&#x7F13;&#x51B2;&#xFF0C;&#x4EE5;&#x907F;&#x514D;&#x78C1;&#x76D8;&#x641C;&#x7D22;&#xFF0C;&#x63D0;&#x9AD8;&#x67E5;&#x8BE2;&#x901F;&#x5EA6;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x6392;&#x5E8F;&#x5927;&#x91CF;&#x6570;&#x636E;&#xFF0C;&#x53EF;&#x9002;&#x5F53;&#x8C03;&#x9AD8;&#x8BE5;&#x503C;&#x3002;&#x4F46;MySQL&#x4F1A;&#x4E3A;&#x6BCF;&#x4E2A;&#x5BA2;&#x6237;&#x8FDE;&#x63A5;&#x53D1;&#x653E;&#x8BE5;&#x7F13;&#x51B2;&#x7A7A;&#x95F4;&#xFF0C;&#x6240;&#x4EE5;&#x5E94;&#x5C3D;&#x91CF;&#x9002;&#x5F53;&#x8BBE;&#x7F6E;&#x8BE5;&#x503C;&#xFF0C;&#x4EE5;&#x907F;&#x514D;&#x5185;&#x5B58;&#x5F00;&#x9500;&#x8FC7;&#x5927;&#x3002;&#x4E00;&#x822C;&#x53EF;&#x8BBE;&#x7F6E;&#x4E3A;16M 8) sort_buffer_size&#x6BCF;&#x4E2A;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#x7684;&#x7EBF;&#x7A0B;&#x5206;&#x914D;&#x8BE5;&#x5927;&#x5C0F;&#x7684;&#x4E00;&#x4E2A;&#x7F13;&#x51B2;&#x533A;&#x3002;&#x589E;&#x52A0;&#x8FD9;&#x503C;&#x52A0;&#x901F;ORDER BY&#x6216;GROUP BY&#x64CD;&#x4F5C;&#x3002;&#x9ED8;&#x8BA4;&#x6570;&#x503C;&#x662F;2097144(2M)&#xFF0C;&#x53EF;&#x6539;&#x4E3A;16777208 (16M)&#x3002; 9) join_buffer_size&#x8054;&#x5408;&#x67E5;&#x8BE2;&#x64CD;&#x4F5C;&#x6240;&#x80FD;&#x4F7F;&#x7528;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x5927;&#x5C0F;record_buffer_size&#xFF0C;read_rnd_buffer_size&#xFF0C;sort_buffer_size&#xFF0C;join_buffer_size&#x4E3A;&#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x72EC;&#x5360;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5982;&#x679C;&#x6709;100&#x4E2A;&#x7EBF;&#x7A0B;&#x8FDE;&#x63A5;&#xFF0C;&#x5219;&#x5360;&#x7528;&#x4E3A;16M*100 10) table_cache&#x8868;&#x9AD8;&#x901F;&#x7F13;&#x5B58;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x6BCF;&#x5F53;MySQL&#x8BBF;&#x95EE;&#x4E00;&#x4E2A;&#x8868;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x8868;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x8FD8;&#x6709;&#x7A7A;&#x95F4;&#xFF0C;&#x8BE5;&#x8868;&#x5C31;&#x88AB;&#x6253;&#x5F00;&#x5E76;&#x653E;&#x5165;&#x5176;&#x4E2D;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x66F4;&#x5FEB;&#x5730;&#x8BBF;&#x95EE;&#x8868;&#x5185;&#x5BB9;&#x3002;&#x901A;&#x8FC7;&#x68C0;&#x67E5;&#x5CF0;&#x503C;&#x65F6;&#x95F4;&#x7684;&#x72B6;&#x6001;&#x503C;Open_tables&#x548C;Opened_tables&#xFF0C;&#x53EF;&#x4EE5;&#x51B3;&#x5B9A;&#x662F;&#x5426;&#x9700;&#x8981;&#x589E;&#x52A0;table_cache&#x7684;&#x503C;&#x3002;&#x5982;&#x679C;&#x4F60;&#x53D1;&#x73B0;open_tables&#x7B49;&#x4E8E;table_cache&#xFF0C;&#x5E76;&#x4E14;opened_tables&#x5728;&#x4E0D;&#x65AD;&#x589E;&#x957F;&#xFF0C;&#x90A3;&#x4E48;&#x4F60;&#x5C31;&#x9700;&#x8981;&#x589E;&#x52A0;table_cache&#x7684;&#x503C;&#x4E86;&#xFF08;&#x4E0A;&#x8FF0;&#x72B6;&#x6001;&#x503C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;SHOW STATUS LIKE &#x2018;Open%tables&#x2019;&#x83B7;&#x5F97;&#xFF09;&#x3002;&#x6CE8;&#x610F;&#xFF0C;&#x4E0D;&#x80FD;&#x76F2;&#x76EE;&#x5730;&#x628A;table_cache&#x8BBE;&#x7F6E;&#x6210;&#x5F88;&#x5927;&#x7684;&#x503C;&#x3002;&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x5F97;&#x592A;&#x9AD8;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x9020;&#x6210;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x4E0D;&#x8DB3;&#xFF0C;&#x4ECE;&#x800C;&#x9020;&#x6210;&#x6027;&#x80FD;&#x4E0D;&#x7A33;&#x5B9A;&#x6216;&#x8005;&#x8FDE;&#x63A5;&#x5931;&#x8D25;&#x3002;1G&#x5185;&#x5B58;&#x673A;&#x5668;&#xFF0C;&#x63A8;&#x8350;&#x503C;&#x662F;128&#xFF0D;256&#x3002;&#x5185;&#x5B58;&#x5728;4GB&#x5DE6;&#x53F3;&#x7684;&#x670D;&#x52A1;&#x5668;&#x8BE5;&#x53C2;&#x6570;&#x53EF;&#x8BBE;&#x7F6E;&#x4E3A;256M&#x6216;384M&#x3002; 11) max_heap_table_size&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x7684;&#x5185;&#x5B58;&#x8868;(memory table)&#x7684;&#x5927;&#x5C0F;&#x3002;&#x8FD9;&#x4E2A;&#x503C;&#x7528;&#x6765;&#x8BA1;&#x7B97;&#x5185;&#x5B58;&#x8868;&#x7684;&#x6700;&#x5927;&#x884C;&#x6570;&#x503C;&#x3002;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x652F;&#x6301;&#x52A8;&#x6001;&#x6539;&#x53D8;&#xFF0C;&#x5373;set @max_heap_table_size=#&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x548C;tmp_table_size&#x4E00;&#x8D77;&#x9650;&#x5236;&#x4E86;&#x5185;&#x90E8;&#x5185;&#x5B58;&#x8868;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x5982;&#x679C;&#x67D0;&#x4E2A;&#x5185;&#x90E8;heap&#xFF08;&#x5806;&#x79EF;&#xFF09;&#x8868;&#x5927;&#x5C0F;&#x8D85;&#x8FC7;tmp_table_size&#xFF0C;MySQL&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x9700;&#x8981;&#x81EA;&#x52A8;&#x5C06;&#x5185;&#x5B58;&#x4E2D;&#x7684;heap&#x8868;&#x6539;&#x4E3A;&#x57FA;&#x4E8E;&#x786C;&#x76D8;&#x7684;MyISAM&#x8868;&#x3002; 12) tmp_table_size&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;tmp_table_size&#x9009;&#x9879;&#x6765;&#x589E;&#x52A0;&#x4E00;&#x5F20;&#x4E34;&#x65F6;&#x8868;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x4F8B;&#x5982;&#x505A;&#x9AD8;&#x7EA7;GROUP BY&#x64CD;&#x4F5C;&#x751F;&#x6210;&#x7684;&#x4E34;&#x65F6;&#x8868;&#x3002;&#x5982;&#x679C;&#x8C03;&#x9AD8;&#x8BE5;&#x503C;&#xFF0C;MySQL&#x540C;&#x65F6;&#x5C06;&#x589E;&#x52A0;heap&#x8868;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x53EF;&#x8FBE;&#x5230;&#x63D0;&#x9AD8;&#x8054;&#x63A5;&#x67E5;&#x8BE2;&#x901F;&#x5EA6;&#x7684;&#x6548;&#x679C;&#xFF0C;&#x5EFA;&#x8BAE;&#x5C3D;&#x91CF;&#x4F18;&#x5316;&#x67E5;&#x8BE2;&#xFF0C;&#x8981;&#x786E;&#x4FDD;&#x67E5;&#x8BE2;&#x8FC7;&#x7A0B;&#x4E2D;&#x751F;&#x6210;&#x7684;&#x4E34;&#x65F6;&#x8868;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x907F;&#x514D;&#x4E34;&#x65F6;&#x8868;&#x8FC7;&#x5927;&#x5BFC;&#x81F4;&#x751F;&#x6210;&#x57FA;&#x4E8E;&#x786C;&#x76D8;&#x7684;MyISAM&#x8868;&#x3002; 12345678mysql&gt; show global status like &apos;created_tmp%&apos;;+&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2013;+&#x2014;&#x2014;&#x2014;+| Variable_name | Value |+&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;-+&#x2014;&#x2014;&#x2014;+| Created_tmp_disk_tables | 21197 || Created_tmp_files | 58 || Created_tmp_tables | 1771587 |+&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2013;+&#x2014;&#x2014;&#x2014;&#x2013;+ &#x6BCF;&#x6B21;&#x521B;&#x5EFA;&#x4E34;&#x65F6;&#x8868;&#xFF0C;Created_tmp_tables&#x589E;&#x52A0;&#xFF0C;&#x5982;&#x679C;&#x4E34;&#x65F6;&#x8868;&#x5927;&#x5C0F;&#x8D85;&#x8FC7;tmp_table_size&#xFF0C;&#x5219;&#x662F;&#x5728;&#x78C1;&#x76D8;&#x4E0A;&#x521B;&#x5EFA;&#x4E34;&#x65F6;&#x8868;&#xFF0C;Created_tmp_disk_tables&#x4E5F;&#x589E;&#x52A0;,Created_tmp_files&#x8868;&#x793A;MySQL&#x670D;&#x52A1;&#x521B;&#x5EFA;&#x7684;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x6587;&#x4EF6;&#x6570;&#xFF0C;&#x6BD4;&#x8F83;&#x7406;&#x60F3;&#x7684;&#x914D;&#x7F6E;&#x662F;&#xFF1A;Created_tmp_disk_tables / Created_tmp_tables * 100% &lt;= 25%&#x6BD4;&#x5982;&#x4E0A;&#x9762;&#x7684;&#x670D;&#x52A1;&#x5668;Created_tmp_disk_tables / Created_tmp_tables * 100% &#xFF1D;1.20%&#xFF0C;&#x5E94;&#x8BE5;&#x76F8;&#x5F53;&#x597D;&#x4E86; &#x9ED8;&#x8BA4;&#x4E3A;16M&#xFF0C;&#x53EF;&#x8C03;&#x5230;64-256&#x6700;&#x4F73;&#xFF0C;&#x7EBF;&#x7A0B;&#x72EC;&#x5360;&#xFF0C;&#x592A;&#x5927;&#x53EF;&#x80FD;&#x5185;&#x5B58;&#x4E0D;&#x591F;I/O&#x5835;&#x585E; 13) thread_cache_size&#x53EF;&#x4EE5;&#x590D;&#x7528;&#x7684;&#x4FDD;&#x5B58;&#x5728;&#x4E2D;&#x7684;&#x7EBF;&#x7A0B;&#x7684;&#x6570;&#x91CF;&#x3002;&#x5982;&#x679C;&#x6709;&#xFF0C;&#x65B0;&#x7684;&#x7EBF;&#x7A0B;&#x4ECE;&#x7F13;&#x5B58;&#x4E2D;&#x53D6;&#x5F97;&#xFF0C;&#x5F53;&#x65AD;&#x5F00;&#x8FDE;&#x63A5;&#x7684;&#x65F6;&#x5019;&#x5982;&#x679C;&#x6709;&#x7A7A;&#x95F4;&#xFF0C;&#x5BA2;&#x6237;&#x7684;&#x7EBF;&#x7F6E;&#x5728;&#x7F13;&#x5B58;&#x4E2D;&#x3002;&#x5982;&#x679C;&#x6709;&#x5F88;&#x591A;&#x65B0;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x4E3A;&#x4E86;&#x63D0;&#x9AD8;&#x6027;&#x80FD;&#x53EF;&#x4EE5;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x503C;&#x3002; &#x901A;&#x8FC7;&#x6BD4;&#x8F83; Connections&#x548C;Threads_created&#x72B6;&#x6001;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x7684;&#x4F5C;&#x7528;&#x3002; &#x9ED8;&#x8BA4;&#x503C;&#x4E3A;110&#xFF0C;&#x53EF;&#x8C03;&#x4F18;&#x4E3A;80&#x3002; 14) thread_concurrency&#x63A8;&#x8350;&#x8BBE;&#x7F6E;&#x4E3A;&#x670D;&#x52A1;&#x5668; CPU&#x6838;&#x6570;&#x7684;2&#x500D;&#xFF0C;&#x4F8B;&#x5982;&#x53CC;&#x6838;&#x7684;CPU, &#x90A3;&#x4E48;thread_concurrency&#x7684;&#x5E94;&#x8BE5;&#x4E3A;4&#xFF1B;2&#x4E2A;&#x53CC;&#x6838;&#x7684;cpu, thread_concurrency&#x7684;&#x503C;&#x5E94;&#x4E3A;8&#x3002;&#x9ED8;&#x8BA4;&#x4E3A;8 15) wait_timeout&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x7684;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x65F6;&#x95F4;&#xFF0C;&#x5BF9;&#x4E8E;4GB&#x5DE6;&#x53F3;&#x5185;&#x5B58;&#x7684;&#x670D;&#x52A1;&#x5668;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x4E3A;5-10&#x3002; &#x914D;&#x7F6E;InnoDB&#x7684;&#x51E0;&#x4E2A;&#x53D8;&#x91CF;innodb_buffer_pool_size&#x5BF9;&#x4E8E;InnoDB&#x8868;&#x6765;&#x8BF4;&#xFF0C;innodb_buffer_pool_size&#x7684;&#x4F5C;&#x7528;&#x5C31;&#x76F8;&#x5F53;&#x4E8E;key_buffer_size&#x5BF9;&#x4E8E;MyISAM&#x8868;&#x7684;&#x4F5C;&#x7528;&#x4E00;&#x6837;&#x3002;InnoDB&#x4F7F;&#x7528;&#x8BE5;&#x53C2;&#x6570;&#x6307;&#x5B9A;&#x5927;&#x5C0F;&#x7684;&#x5185;&#x5B58;&#x6765;&#x7F13;&#x51B2;&#x6570;&#x636E;&#x548C;&#x7D22;&#x5F15;&#x3002;&#x5BF9;&#x4E8E;&#x5355;&#x72EC;&#x7684;MySQL&#x6570;&#x636E;&#x5E93;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x6700;&#x5927;&#x53EF;&#x4EE5;&#x628A;&#x8BE5;&#x503C;&#x8BBE;&#x7F6E;&#x6210;&#x7269;&#x7406;&#x5185;&#x5B58;&#x7684;80%&#x3002;&#x6839;&#x636E;MySQL&#x624B;&#x518C;&#xFF0C;&#x5BF9;&#x4E8E;2G&#x5185;&#x5B58;&#x7684;&#x673A;&#x5668;&#xFF0C;&#x63A8;&#x8350;&#x503C;&#x662F;1G&#xFF08;50%&#xFF09;&#x3002; innodb_flush_log_at_trx_commit&#x4E3B;&#x8981;&#x63A7;&#x5236;&#x4E86;innodb&#x5C06;log buffer&#x4E2D;&#x7684;&#x6570;&#x636E;&#x5199;&#x5165;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x5E76;flush&#x78C1;&#x76D8;&#x7684;&#x65F6;&#x95F4;&#x70B9;&#xFF0C;&#x53D6;&#x503C;&#x5206;&#x522B;&#x4E3A;0&#x3001;1&#x3001;2&#x4E09;&#x4E2A;&#x3002; 0&#xFF0C;&#x8868;&#x793A;&#x5F53;&#x4E8B;&#x52A1;&#x63D0;&#x4EA4;&#x65F6;&#xFF0C;&#x4E0D;&#x505A;&#x65E5;&#x5FD7;&#x5199;&#x5165;&#x64CD;&#x4F5C;&#xFF0C;&#x800C;&#x662F;&#x6BCF;&#x79D2;&#x949F;&#x5C06;log buffer&#x4E2D;&#x7684;&#x6570;&#x636E;&#x5199;&#x5165;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x5E76;flush&#x78C1;&#x76D8;&#x4E00;&#x6B21;&#xFF1B; 1&#xFF0C;&#x5219;&#x5728;&#x6BCF;&#x79D2;&#x949F;&#x6216;&#x662F;&#x6BCF;&#x6B21;&#x4E8B;&#x7269;&#x7684;&#x63D0;&#x4EA4;&#x90FD;&#x4F1A;&#x5F15;&#x8D77;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x5199;&#x5165;&#x3001;flush&#x78C1;&#x76D8;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x786E;&#x4FDD;&#x4E86;&#x4E8B;&#x52A1;&#x7684;ACID&#xFF1B; 2&#xFF0C;&#x6BCF;&#x6B21;&#x4E8B;&#x52A1;&#x63D0;&#x4EA4;&#x5F15;&#x8D77;&#x5199;&#x5165;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x7684;&#x52A8;&#x4F5C;&#xFF0C;&#x4F46;&#x6BCF;&#x79D2;&#x949F;&#x5B8C;&#x6210;&#x4E00;&#x6B21;flush&#x78C1;&#x76D8;&#x64CD;&#x4F5C;&#x3002; &#x5B9E;&#x9645;&#x6D4B;&#x8BD5;&#x53D1;&#x73B0;&#xFF0C;&#x8BE5;&#x503C;&#x5BF9;&#x63D2;&#x5165;&#x6570;&#x636E;&#x7684;&#x901F;&#x5EA6;&#x5F71;&#x54CD;&#x975E;&#x5E38;&#x5927;&#xFF0C;&#x8BBE;&#x7F6E;&#x4E3A;2&#x65F6;&#x63D2;&#x5165;10000&#x6761;&#x8BB0;&#x5F55;&#x53EA;&#x9700;&#x8981;2&#x79D2;&#xFF0C;&#x8BBE;&#x7F6E;&#x4E3A;0&#x65F6;&#x53EA;&#x9700;&#x8981;1&#x79D2;&#xFF0C;&#x800C;&#x8BBE;&#x7F6E;&#x4E3A;1&#x65F6;&#x5219;&#x9700;&#x8981;229&#x79D2;&#x3002;&#x56E0;&#x6B64;&#xFF0C;MySQL&#x624B;&#x518C;&#x4E5F;&#x5EFA;&#x8BAE;&#x5C3D;&#x91CF;&#x5C06;&#x63D2;&#x5165;&#x64CD;&#x4F5C;&#x5408;&#x5E76;&#x6210;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x5927;&#x5E45;&#x63D0;&#x9AD8;&#x901F;&#x5EA6;&#x3002;&#x6839;&#x636E;MySQL&#x624B;&#x518C;&#xFF0C;&#x5728;&#x5141;&#x8BB8;&#x4E22;&#x5931;&#x6700;&#x8FD1;&#x90E8;&#x5206;&#x4E8B;&#x52A1;&#x7684;&#x5371;&#x9669;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#xFF0C;&#x53EF;&#x4EE5;&#x628A;&#x8BE5;&#x503C;&#x8BBE;&#x4E3A;0&#x6216;2&#x3002; innodb_log_buffer_sizelog&#x7F13;&#x5B58;&#x5927;&#x5C0F;&#xFF0C;&#x4E00;&#x822C;&#x4E3A;1-8M&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;1M&#xFF0C;&#x5BF9;&#x4E8E;&#x8F83;&#x5927;&#x7684;&#x4E8B;&#x52A1;&#xFF0C;&#x53EF;&#x4EE5;&#x589E;&#x5927;&#x7F13;&#x5B58;&#x5927;&#x5C0F;&#x3002;&#x53EF;&#x8BBE;&#x7F6E;&#x4E3A;4M&#x6216;8M&#x3002; innodb_additional_mem_pool_size&#x8BE5;&#x53C2;&#x6570;&#x6307;&#x5B9A;InnoDB&#x7528;&#x6765;&#x5B58;&#x50A8;&#x6570;&#x636E;&#x5B57;&#x5178;&#x548C;&#x5176;&#x4ED6;&#x5185;&#x90E8;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x7684;&#x5185;&#x5B58;&#x6C60;&#x5927;&#x5C0F;&#x3002;&#x7F3A;&#x7701;&#x503C;&#x662F;1M&#x3002;&#x901A;&#x5E38;&#x4E0D;&#x7528;&#x592A;&#x5927;&#xFF0C;&#x53EA;&#x8981;&#x591F;&#x7528;&#x5C31;&#x884C;&#xFF0C;&#x5E94;&#x8BE5;&#x4E0E;&#x8868;&#x7ED3;&#x6784;&#x7684;&#x590D;&#x6742;&#x5EA6;&#x6709;&#x5173;&#x7CFB;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x591F;&#x7528;&#xFF0C;MySQL&#x4F1A;&#x5728;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x4E2D;&#x5199;&#x5165;&#x4E00;&#x6761;&#x8B66;&#x544A;&#x4FE1;&#x606F;&#x3002;&#x6839;&#x636E;MySQL&#x624B;&#x518C;&#xFF0C;&#x5BF9;&#x4E8E;2G&#x5185;&#x5B58;&#x7684;&#x673A;&#x5668;&#xFF0C;&#x63A8;&#x8350;&#x503C;&#x662F;20M&#xFF0C;&#x53EF;&#x9002;&#x5F53;&#x589E;&#x52A0;&#x3002; innodb_thread_concurrency=8&#x63A8;&#x8350;&#x8BBE;&#x7F6E;&#x4E3A; 2*(NumCPUs+NumDisks)&#xFF0C;&#x9ED8;&#x8BA4;&#x4E00;&#x822C;&#x4E3A;8 &#x8BBE;&#x7F6E;innodb_buffer_pool_size&#x5927;&#x5C0F;1234567mysql&gt; show global variables like &apos;innodb_buffer_pool_size&apos;;+-------------------------+-----------+| Variable_name | Value |+-------------------------+-----------+| innodb_buffer_pool_size | 134217728 |+-------------------------+-----------+1 row in set (0.00 sec) &#x90A3;&#x4E48;&#x5982;&#x4F55;&#x8BBE;&#x7F6E;&#x8BE5;&#x53C2;&#x6570;&#x5927;&#x5C0F;&#x5462;&#xFF1F;&#x9996;&#x5148;&#x67E5;&#x770B;&#x8FD0;&#x884C;&#x65F6;buffer pool&#x76F8;&#x5173;&#x6570;&#x636E;&#x6307;&#x6807;&#xFF1A; 1234567891011121314151617181920212223mysql&gt; show global status like &apos;Innodb_buffer_pool_pages_data&apos;;+-------------------------------+-------+| Variable_name | Value |+-------------------------------+-------+| Innodb_buffer_pool_pages_data | 314 |+-------------------------------+-------+1 row in set (0.00 sec)mysql&gt; show global status like &apos;Innodb_buffer_pool_pages_total&apos;;+--------------------------------+-------+| Variable_name | Value |+--------------------------------+-------+| Innodb_buffer_pool_pages_total | 8191 |+--------------------------------+-------+1 row in set (0.00 sec)mysql&gt; show global status like &apos;Innodb_page_size&apos;;+------------------+-------+| Variable_name | Value |+------------------+-------+| Innodb_page_size | 16384 |+------------------+-------+1 row in set (0.00 sec) &#x4E0A;&#x8FF0;&#x4E09;&#x9879;&#x6307;&#x6807;&#x7684;&#x542B;&#x4E49;&#x5982;&#x4E0B;&#xFF1A; 12345678910Innodb_buffer_pool_pages_dataThe number of pages in the InnoDB buffer pool containing data. The number includes both dirty andclean pages.Innodb_buffer_pool_pages_totalThe total size of the InnoDB buffer pool, in pages.Innodb_page_sizeInnoDB page size (default 16KB). Many values are counted in pages; the page size enables them to beeasily converted to bytes &#x8BA1;&#x7B97;Innodb_buffer_pool_pages_data/Innodb_buffer_pool_pages_total100%&#x5F53;&#x7ED3;&#x679C; &gt; 95% &#x5219;&#x589E;&#x52A0; innodb_buffer_pool_size&#xFF0C; &#x5EFA;&#x8BAE;&#x4F7F;&#x7528;&#x7269;&#x7406;&#x5185;&#x5B58;&#x7684; 75%&#x5F53;&#x7ED3;&#x679C; &lt; 95% &#x5219;&#x51CF;&#x5C11; innodb_buffer_pool_size&#xFF0C;&#x5EFA;&#x8BAE;&#x8BBE;&#x7F6E;&#x5927;&#x5C0F;&#x4E3A;&#xFF1A; Innodb_buffer_pool_pages_data Innodb_page_size * 1.05 / (102410241024) &#x8BBE;&#x7F6E;max_connections&#x5927;&#x5C0F;MySQL&#x670D;&#x52A1;&#x5668;&#x7684;&#x8FDE;&#x63A5;&#x6570;&#x5E76;&#x4E0D;&#x662F;&#x8981;&#x8FBE;&#x5230;&#x6700;&#x5927;&#x7684;100%&#x4E3A;&#x597D;&#xFF0C;&#x8FD8;&#x662F;&#x8981;&#x5177;&#x4F53;&#x95EE;&#x9898;&#x5177;&#x4F53;&#x5206;&#x6790;&#xFF0C;&#x4E0B;&#x9762;&#x5C31;&#x5BF9;MySQL&#x670D;&#x52A1;&#x5668;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;&#x7684;&#x5408;&#x7406;&#x8BBE;&#x7F6E;&#x8FDB;&#x884C;&#x4E86;&#x8BE6;&#x5C3D;&#x7684;&#x5206;&#x6790;&#xFF0C;&#x4F9B;&#x60A8;&#x53C2;&#x8003;&#x3002; &#x6211;&#x4EEC;&#x7ECF;&#x5E38;&#x4F1A;&#x9047;&#x89C1;&#x201C;MySQL: ERROR 1040: Too many connections&#x201D;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x4E00;&#x79CD;&#x662F;&#x8BBF;&#x95EE;&#x91CF;&#x786E;&#x5B9E;&#x5F88;&#x9AD8;&#xFF0C;MySQL&#x670D;&#x52A1;&#x5668;&#x6297;&#x4E0D;&#x4F4F;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x5C31;&#x8981;&#x8003;&#x8651;&#x589E;&#x52A0;&#x4ECE;&#x670D;&#x52A1;&#x5668;&#x5206;&#x6563;&#x8BFB;&#x538B;&#x529B;&#xFF0C;&#x53E6;&#x5916;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#x662F;MySQL&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;max_connections&#x503C;&#x8FC7;&#x5C0F;&#xFF1A; 123456mysql&gt; show variables like &apos;max_connections&apos;;+-----------------+-------+| Variable_name | Value |+-----------------+-------+| max_connections | 256 |+-----------------+-------+ &#x8FD9;&#x53F0;MySQL&#x670D;&#x52A1;&#x5668;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;&#x662F;256&#xFF0C;&#x7136;&#x540E;&#x67E5;&#x8BE2;&#x4E00;&#x4E0B;&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#x7684;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;&#xFF1A; 1mysql&gt; show global status like &apos;Max_used_connections&apos;; MySQL&#x670D;&#x52A1;&#x5668;&#x8FC7;&#x53BB;&#x7684;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;&#x662F;245&#xFF0C;&#x6CA1;&#x6709;&#x8FBE;&#x5230;&#x670D;&#x52A1;&#x5668;&#x8FDE;&#x63A5;&#x6570;&#x4E0A;&#x9650;256&#xFF0C;&#x5E94;&#x8BE5;&#x6CA1;&#x6709;&#x51FA;&#x73B0;1040&#x9519;&#x8BEF;&#xFF0C;&#x6BD4;&#x8F83;&#x7406;&#x60F3;&#x7684;&#x8BBE;&#x7F6E;&#x662F;&#xFF1A; 1Max_used_connections / max_connections * 100% &#x2248; 85% &#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;&#x5360;&#x4E0A;&#x9650;&#x8FDE;&#x63A5;&#x6570;&#x7684;85%&#x5DE6;&#x53F3;&#xFF0C;&#x5982;&#x679C;&#x53D1;&#x73B0;&#x6BD4;&#x4F8B;&#x5728;10%&#x4EE5;&#x4E0B;&#xFF0C;MySQL&#x670D;&#x52A1;&#x5668;&#x8FDE;&#x63A5;&#x4E0A;&#x7EBF;&#x5C31;&#x8BBE;&#x7F6E;&#x5F97;&#x8FC7;&#x9AD8;&#x4E86;&#x3002;]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[简单备份监控程序]]></title>
    <url>%2F2014%2F01%2F03%2F%E7%AE%80%E5%8D%95%E5%A4%87%E4%BB%BD%E7%9B%91%E6%8E%A7%E7%A8%8B%E5%BA%8F%2F</url>
    <content type="text"><![CDATA[&#x524D;&#x8A00;&#x968F;&#x7740;&#x7EF4;&#x62A4;&#x670D;&#x52A1;&#x5668;&#x7684;&#x589E;&#x591A;&#xFF0C;&#x6BCF;&#x5929;&#x4E00;&#x53F0;&#x53F0;&#x68C0;&#x67E5;&#x5907;&#x4EFD;&#x5DF2;&#x7ECF;&#x4E0D;&#x5207;&#x5B9E;&#x9645;&#xFF0C;&#x5373;&#x4F7F;&#x901A;&#x8FC7;email&#x7684;&#x65B9;&#x5F0F;&#xFF08;&#x5907;&#x4EFD;&#x811A;&#x672C;&#x6267;&#x884C;&#x5B8C;&#x540E;&#x5C06;&#x5907;&#x4EFD;&#x4FE1;&#x606F;&#x53D1;&#x9001;&#x5230;&#x6307;&#x5B9A;&#x90AE;&#x7BB1;&#xFF09;&#x68C0;&#x67E5;&#x4E5F;&#x8981;&#x8017;&#x8D39;&#x4E0D;&#x5C11;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x6BCF;&#x5929;&#x505A;&#x8FD9;&#x79CD;&#x91CD;&#x590D;&#x6027;&#x4E14;&#x7E41;&#x6742;&#x7684;&#x4E8B;&#x60C5;&#x5BF9;&#x6211;&#x4EEC;&#x8FD9;&#x7C7B;&#x61D2;&#x4EBA;&#x6765;&#x8BF4;&#x7B80;&#x76F4;&#x75DB;&#x4E0D;&#x6B32;&#x751F;&#x3002;&#x7ECF;&#x8FC7;&#x4E00;&#x6B21;&#x60E8;&#x75DB;&#x7684;&#x6559;&#x8BAD;&#x4E4B;&#x540E;&#xFF0C;&#x51B3;&#x5B9A;&#x505A;&#x4E2A;&#x5907;&#x4EFD;&#x68C0;&#x67E5;&#xFF08;&#x76D1;&#x63A7;&#xFF09;&#x7A0B;&#x5E8F;&#x3002; &#x539F;&#x7406;&#x539F;&#x7406;&#x633A;&#x7B80;&#x5355;&#xFF0C;&#x672C;&#x5730;&#x670D;&#x52A1;&#x5668;&#x901A;&#x8FC7;&#x5907;&#x4EFD;&#x68C0;&#x67E5;&#x811A;&#x672C;&#x68C0;&#x67E5;&#x5907;&#x4EFD;&#x6587;&#x4EF6;&#x662F;&#x5426;&#x5B58;&#x5728;&#xFF0C;&#x5E76;&#x5C06;&#x68C0;&#x67E5;&#x7ED3;&#x679C;&#x63D0;&#x4EA4;&#x5230;sae&#x7684;mysql&#x6570;&#x636E;&#x5E93;&#x91CC;&#xFF0C;&#x6700;&#x540E;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;web&#x9875;&#x9762;&#x5C06;&#x6570;&#x636E;&#x7EDF;&#x4E00;&#x663E;&#x793A;&#x51FA;&#x6765;&#x3002; &#x5B9E;&#x4F8B;&#x5047;&#x8BBE;&#x6709;5&#x53F0;&#x670D;&#x52A1;&#x5668;&#xFF08;web1~web5&#xFF09;&#xFF0C;&#x5907;&#x4EFD;&#x9879;&#x76EE;&#x6709;&#xFF1A;msyql&#x6570;&#x636E;&#x5E93;&#x3001;mongodb&#x6570;&#x636E;&#x5E93;&#x548C;/data/img&#x7684;rsync+inotify&#x5B9E;&#x65F6;&#x540C;&#x6B65;&#xFF0C;&#x5177;&#x4F53;&#x7684;&#x5907;&#x4EFD;&#x4FE1;&#x606F;&#x5982;&#x4E0B;&#xFF1A; &#x5907;&#x4EFD;&#x9879;&#x76EE; &#x672C;&#x5730;&#x5907;&#x4EFD;&#x4FDD;&#x5B58;&#x8DEF;&#x5F84;&#x53CA;&#x6587;&#x4EF6;&#x540D; &#x5F02;&#x5730;&#x5907;&#x4EFD;&#x4FDD;&#x5B58;&#x8DEF;&#x5F84;&#x53CA;&#x6587;&#x4EF6;&#x540D; rsync+inotify /data/img /bk/$hostname/img/* mysql /data/bk/msyql/mysql_&#x65E5;&#x671F;.tgz /bk/$hostname/mysql/mysql_&#x65E5;&#x671F;.tgz mongodb /data/bk/mongodb/mongodb_&#x65E5;&#x671F;.tgz /bk/$hostname/mongodb/mongodb_&#x65E5;&#x671F;.tgz &#x7A0B;&#x5E8F;&#x6587;&#x4EF6;&#x8BF4;&#x660E;&#xFF1A; &#x6587;&#x4EF6;&#x540D; &#x529F;&#x80FD; getdata.php &#x7528;&#x4E8E;&#x83B7;&#x53D6;&#x5BA2;&#x6237;&#x7AEF;POST&#x8FC7;&#x6765;&#x7684;&#x6570;&#x636E;&#x5E76;&#x5C06;&#x6570;&#x636E;&#x63D0;&#x4EA4;&#x5230;mysql&#x6570;&#x636E;&#x5E93; bk.sh &#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7684;&#x5907;&#x4EFD;&#x68C0;&#x67E5;&#x811A;&#x672C; bk.php web&#x9875;&#x9762; &#x9996;&#x5148;&#x5230;&#x521B;&#x5EFA;&#x6570;&#x636E;&#x5E93;&#xFF1A; 123456789CREATE TABLE `bk_monitor` (`id` smailint NOT NULL auto_increment,`hostname` varchar(20) default NULL,`rsync` tinyint default NULL,`mysql`varchar(20) default NULL,`mongodb` varchar(20) default NULL,`date` timestamp,PRIMARY KEY (`id`)) getdata.php&#x7528;&#x4E8E;&#x83B7;&#x53D6;&#x5BA2;&#x6237;&#x7AEF;POST&#x8FC7;&#x6765;&#x7684;&#x6570;&#x636E;&#x5E76;&#x5C06;&#x6570;&#x636E;&#x63D0;&#x4EA4;&#x5230;mysql&#x6570;&#x636E;&#x5E93;&#x3002;shell&#x811A;&#x672C;&#x4E2D;&#xFF0C;&#x53EA;&#x8981;&#x4F7F;&#x7528;curl -d xxx=xxx http://www.cszhi.com/getdata.php&#xFF0C; &#x5C31;&#x53EF;&#x4EE5;&#x5C06;&#x6570;&#x636E;&#x63D0;&#x4EA4;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x7684;mysql&#x6570;&#x636E;&#x5E93;&#x91CC;&#x3002; 1234567891011121314151617181920212223242526272829303132333435363738&lt; ?php $posts=$_POST; // &#x6E05;&#x9664;&#x4E00;&#x4E9B;&#x7A7A;&#x767D;&#x7B26;&#x53F7; foreach ($posts as $key =&gt; $value) { $posts[$key] = trim(addslashes($value)); } //&#x4E00;&#x4E9B;&#x53D8;&#x91CF;&#x521D;&#x59CB;&#x5316; $db=&quot;bk_monitor&quot;; $type=$posts[&apos;type&apos;]; //0&#x63D2;&#x5165; &amp; 1&#x66F4;&#x65B0; switch ($type) { case 0: $hostname=$posts[&apos;hostname&apos;]; $rsync=$posts[&apos;rsync&apos;]; $mysql=$posts[&apos;mysql&apos;]; $mongodb=$posts[&apos;mongodb&apos;]; $sql=&quot;insert into $db(hostname,rsync,mysql,mongodb) values(&apos;$hostname&apos;,&apos;$rsync&apos;,&apos;$mysql&apos;,&apos;$mongodb&apos;)&quot;; break; case 1: $hostname=$posts[&apos;hostname&apos;]; $rsync=$posts[&apos;rsync&apos;]; $mysql=$posts[&apos;mysql&apos;]; $mongo=$posts[&apos;mongo&apos;]; $sql=&quot;update $db set rsync=&apos;$rsync&apos;,mysql=&apos;$mysql&apos;,mongodb=&apos;$mongodb&apos; where hostname=&apos;$hostname&apos;&quot;; break; default: exit(&apos;error!!!&apos;); } //&#x64CD;&#x4F5C;&#x6570;&#x636E;&#x5E93; $conn = mysql_connect(&quot;localhost&quot;,&quot;root&quot;,&quot;aaabbb123&quot;,&quot;bk_monitor&quot;) or die(&quot;can&apos;t connect mysql:&quot;.mysql_error()); mysql_query($sql,$conn) or die(&quot;query error:&quot;.mysql_error().&quot;:&quot;.$sql); mysql_close($conn); ?&gt; bk.sh&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7684;&#x5907;&#x4EFD;&#x68C0;&#x67E5;&#x811A;&#x672C;&#x3002;&#x811A;&#x672C;&#x6709;&#x9A8C;&#x8BC1;&#x5F02;&#x5907;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7684;&#x6587;&#x4EF6;&#x662F;&#x5426;&#x5B58;&#x5728;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x5148;&#x5728;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x8BBE;&#x7F6E;&#x80FD;ssh&#x65E0;&#x5BC6;&#x7801;&#x767B;&#x9646;&#x5230;&#x5F02;&#x5907;&#x670D;&#x52A1;&#x5668;&#x3002; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152#!/bin/bash#Program:#check the backup file and submit to the sae database#History:#2013/12/31 caishzh #&#x53D8;&#x91CF;&#x521D;&#x59CB;&#x5316;HOSTNAME=$(hostname)TODAY=$(date +%Y%m%d)REMOTEIP=&quot;10.35.14.55&quot; #&#x8FD9;&#x91CC;&#x662F;&#x5F02;&#x5907;&#x670D;&#x52A1;&#x5668;&#x7684;ip&#x5730;&#x5740;TIMESTAMP=$(date +%s)TIMESTAMPFILE=&quot;/data/img/tmp/$TIMESTAMP&quot;[ -f &quot;/data/img/tmp&quot; ] || mkdir /data/img/tmpLOG=&quot;/var/log/bk.log&quot;URL=&quot;http://webshot.sinaapp.com/getdata.php&quot;[ &quot;$1&quot; == 1 ] &amp;amp;&amp;amp; TYPE=0 || TYPE=1 #&#x51FD;&#x6570;&#xFF1A;&#x68C0;&#x67E5;&#x672C;&#x5730;&#x5907;&#x4EFD;&#x6587;&#x4EF6;&#x548C;&#x5F02;&#x5730;&#x5907;&#x4EFD;&#x6587;&#x4EF6;&#x662F;&#x5426;&#x5B58;&#x5728;function isExistFile(){ [ -f $1/$2 ] || { echo 2;echo &quot;$1/$2 doesn&apos;t exist...&quot;&amp;gt;&amp;gt;$LOG;exit; } #&#x5224;&#x65AD;&#x8FDC;&#x7A0B;&#x6587;&#x4EF6;&#x662F;&#x5426;&#x5B58;&#x5728; if [ $(ssh -o ConnectTimeout=10 $REMOTEIP &quot;test -f $3/$2 &amp;amp;&amp;amp; echo true || echo false&quot;) == &quot;true&quot; ];then size=$(ssh -o ConnectTimeout=10 $REMOTEIP &quot;ls -lh $3/$2|cut -d&apos; &apos; -f5&quot;) echo &quot;0_$size&quot; else { echo 1;echo &quot;remote file ${REMOTEIP}:$3/$2 doesn&apos;t exist...&quot;&gt;&gt;$LOG;exit; } fi} echo &quot;=====$(date +&apos;%F %T&apos;) start=====&quot; &amp;gt;&amp;gt;$LOG #mysql&#x548C;mongodb&#x5907;&#x4EFD;&#x6587;&#x4EF6;&#x68C0;&#x67E5;MYSQBKFILE=&quot;$(isExistFile /data/bk/mysql mysql_${TODAY}.tgz /bk/${HOSTNAME}/mysql)&quot;MONGODBBKFILE=&quot;$(isExistFile /data/bk/mongodb mongodb_${TODAY}.tgz /bk/${HOSTNAME}/mysql)&quot; #rsync&#x5B9E;&#x65F6;&#x540C;&#x6B65;&#x68C0;&#x67E5;#&#x5728;&#x540C;&#x6B65;&#x76EE;&#x5F55;&#x7684;tmp&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;touch&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF08;&#x6587;&#x4EF6;&#x540D;&#x5C31;&#x662F;&#x5F53;&#x524D;&#x65F6;&#x95F4;&#x6233;&#xFF09;&#xFF0C;sleep 5&#x79D2;&#x540E;&#xFF0C;&#x518D;&#x5224;&#x65AD;&#x8FDC;&#x7A0B;&#x76EE;&#x5F55;&#x662F;&#x5426;&#x5B58;&#x5728;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x5B58;&#x5728;&#x5219;rsync&#x540C;&#x6B65;&#x6B63;&#x5E38;&#xFF0C;&#x4E0D;&#x5B58;&#x5728;&#x5219;&#x5F02;&#x5E38;#sleep&#x7684;&#x65F6;&#x95F4;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x81EA;&#x5DF1;&#x670D;&#x52A1;&#x5668;&#x7684;&#x60C5;&#x51B5;&#x8C03;&#x6574;touch $TIMESTAMPFILEsleep 5if [ $(ssh -o ConnectTimeout=10 $REMOTEIP &quot;test -f /bk/${HOSTNAME}/img/tmp/${TIMESTAMP} &amp;amp;&amp;amp; echo true || echo false&quot;) != &quot;true&quot; ];then RSYNCBAK=2 echo &quot;rsync error...&quot; &gt;&gt;$LOGfiRSYNCBAK=${RSYNCBAK:=0} #&#x5C06;&#x6570;&#x636E;&#x63D0;&#x4EA4;&#x81F3;&#x6570;&#x636E;&#x5E93;curl --connect-timeout 10 -d type=${TYPE} -d rsync=&quot;${RSYNCBAK}&quot; -d mysql=&quot;${MYSQBKFILE}&quot; -d mongodb=&quot;${MONGODBBKFILE}&quot; -d hostname=&quot;${HOSTNAME}&quot; $URL echo -e &quot;=====$(date +&apos;%F %T&apos;) finish=====\n&quot; &gt;&gt;$LOG &#x7B2C;&#x4E00;&#x6B21;&#x6267;&#x884C;&#x65F6;&#xFF0C;&#x811A;&#x672C;&#x540E;&#x9762;&#x52A0;&#x4E2A;&#x53C2;&#x6570;1&#xFF0C;&#x5F80;&#x6570;&#x636E;&#x5E93;&#x91CC;&#x65B0;&#x63D2;&#x5165;&#x4E00;&#x6761;&#x6570;&#x636E;&#xFF1A; 1sh /root/tool/bk.sh 1 &#x5C06;bk.sh&#x653E;&#x5230;crontab&#xFF0C;&#x6BCF;&#x5929;&#x65E9;&#x4E0A;8&#x70B9;&#x5B9A;&#x65F6;&#x8FD0;&#x884C;&#xFF1A; 1echo &quot;0 8 * * * root sh /root/tool/bk.sh&quot; &gt;&gt;/etc/crontab bk.php web&#x9875;&#x9762;&#xFF1A; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758&lt; !DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt; &lt;head&gt; &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=GB2312&quot;/&gt; &lt;title&gt;bk monitor&lt;/title&gt; &lt;link rel=&quot;stylesheet&quot; href=&quot;style.css&quot;&gt; &lt;/link&gt;&lt;/head&gt; &lt;body&gt; &lt;h2&gt;bk monitor&lt;/h2&gt; &lt;table border=&apos;1&apos;&gt; &lt;tr&gt; &lt;th&gt;id&lt;/th&gt; &lt;th&gt;hostname&lt;/th&gt; &lt;th&gt;rsync&lt;/th&gt; &lt;th&gt;mysql&lt;/th&gt; &lt;th&gt;mongodb&lt;/th&gt; &lt;th&gt;date&lt;/th&gt; &lt;/tr&gt; &lt; ?php function status($bkname) { $str=explode(&quot;_&quot;,$bkname); $status=(int)$str[0]; if ($status==0) { if(empty($str[1])) echo &quot;&lt;td&gt;OK&quot;; else echo &quot;&lt;td&gt;OK&amp;nbsp;&amp;nbsp;$str[1]&lt;/td&gt;&quot;; } elseif ($status==1) { echo &quot;&lt;td&gt;WARN&lt;/td&gt;&quot;; } elseif($bkname==2) { echo &quot;&lt;td&gt;ERROR&lt;/td&gt;&quot;; } else { echo &quot;&lt;td&gt;UNKNOW&lt;/td&gt;&quot;; } } //&#x76F4;&#x63A5;&#x7528;sae&#x63D0;&#x4F9B;&#x7684;SaeMysql&#x7C7B;&#x64CD;&#x4F5C;mysql&#x6570;&#x636E;&#x5E93; $mysql = new SaeMysql(); $sql = &quot;SELECT * FROM bk_monitor&quot;; $data = $mysql-&gt;getData( $sql ); //getDate&#x8FD4;&#x56DE;&#x7684;&#x662F;&#x4E8C;&#x7EF4;&#x6570;&#x7EC4;&#xFF0C;&#x7528;foreach&#x904D;&#x5386;&#x4E0B; foreach($data as $value) { echo &quot;&lt;tr&gt;&quot;; echo &quot;&lt;td&gt;&quot;.$value[&apos;id&apos;].&quot;&lt;/td&gt;&quot;; echo &quot;&lt;td&gt;&quot;.$value[&apos;hostname&apos;].&quot;&lt;/td&gt;&quot;; status($value[&apos;rsync&apos;]); status($value[&apos;mysql&apos;]); status($value[&apos;mongodb&apos;]); echo &quot;&lt;td&gt;&quot;.$value[&apos;date&apos;].&quot;&lt;/td&gt;&quot;; echo &quot;&lt;/tr&gt;&quot;; } ?&gt; &lt;/table&gt; &lt;/body&gt;&lt;/html&gt; &#x754C;&#x9762;&#x5982;&#x4E0B;&#xFF1A; &#x5982;&#x679C;&#x60F3;&#x8981;&#x663E;&#x793A;&#x7684;&#x754C;&#x9762;&#x66F4;&#x52A0;&#x76F4;&#x89C2;&#x6F02;&#x4EAE;&#x70B9;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;bootstrap&#x505A;&#x70B9;&#x6837;&#x5F0F;&#xFF0C;&#x6548;&#x679C;&#x5982;&#x4E0B;&#xFF1A;]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>dev</tag>
        <tag>monitor</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[linux多线程网页截图-python]]></title>
    <url>%2F2013%2F06%2F13%2Flinux%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BD%91%E9%A1%B5%E6%88%AA%E5%9B%BE-python%2F</url>
    <content type="text"><![CDATA[&#x4E0A;&#x4E00;&#x7BC7;&#x4E2D;&#xFF08;linux&#x591A;&#x7EBF;&#x7A0B;&#x7F51;&#x9875;&#x622A;&#x56FE;-shell&#xFF09;&#xFF0C;&#x4F7F;&#x7528;shell&#x591A;&#x8FDB;&#x7A0B;&#x5BF9;&#x5927;&#x91CF;&#x7684;&#x7F51;&#x7AD9;&#x622A;&#x56FE;&#xFF0C;&#x5927;&#x5927;&#x51CF;&#x5C11;&#x4E86;&#x622A;&#x56FE;&#x7684;&#x65F6;&#x95F4;&#x3002;&#x4F46;&#x6162;&#x6162;&#x7684;&#x4E5F;&#x53D1;&#x73B0;&#x4E86;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x7684;&#x5F0A;&#x7AEF;&#xFF1A;&#x6BCF;&#x4E2A;&#x8FDB;&#x7A0B;&#x5206;&#x914D;&#x7684;&#x7F51;&#x7AD9;&#x6570;&#x91CF;&#x662F;&#x76F8;&#x7B49;&#x7684;&#xFF0C;&#x6709;&#x4E9B;&#x8FDB;&#x7A0B;&#x622A;&#x56FE;&#x8F83;&#x5FEB;&#xFF0C;&#x6709;&#x4E9B;&#x8F83;&#x6162;&#xFF0C;&#x4E2A;&#x522B;&#x8FDB;&#x7A0B;&#x5728;&#x5176;&#x5B83;&#x8FDB;&#x7A0B;&#x5DF2;&#x7ECF;&#x622A;&#x56FE;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x8FD8;&#x8981;&#x8FD0;&#x884C;10&#x591A;&#x4E2A;&#x5C0F;&#x65F6;&#x624D;&#x80FD;&#x628A;&#x5206;&#x914D;&#x7684;&#x7F51;&#x7AD9;&#x622A;&#x56FE;&#x5B8C;&#x3002;&#x5982;&#x4F55;&#x628A;&#x73B0;&#x6709;&#x7684;&#x201C;&#x5E73;&#x5747;&#x5206;&#x914D;&#x201D;&#x622A;&#x56FE;&#x65B9;&#x5F0F;&#x6539;&#x6210;&#x201C;&#x80FD;&#x8005;&#x591A;&#x52B3;&#x201D;&#x5462;&#xFF1F; &#x521A;&#x597D;&#x6700;&#x8FD1;&#x5728;&#x5B66;&#x4E60;python&#xFF0C;&#x800C;python&#x53EF;&#x4EE5;&#x5F88;&#x65B9;&#x4FBF;&#x7684;&#x652F;&#x6301;&#x591A;&#x7EBF;&#x7A0B;&#x3002;&#x627E;&#x4E86;&#x4E9B;&#x8D44;&#x6599;&#xFF0C;&#x4F7F;&#x7528;threading+queue&#x7684;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;&#x4E86;&#x201C;&#x80FD;&#x8005;&#x591A;&#x52B3;&#x201D;&#x7684;&#x591A;&#x7EBF;&#x7A0B;&#x622A;&#x56FE;&#x65B9;&#x5F0F;&#xFF1A; 12345678910111213141516171819202122232425262728293031323334353637383940#coding:utf-8import threading,urllib2import datetime,timeimport Queueimport os class Webshot(threading.Thread): def __init__(self,queue): threading.Thread.__init__(self) self.queue=queue def run(self): while True: #&#x5982;&#x679C;&#x961F;&#x5217;&#x4E3A;&#x7A7A;&#xFF0C;&#x5219;&#x9000;&#x51FA;&#xFF0C;&#x5426;&#x5219;&#x4ECE;&#x961F;&#x5217;&#x4E2D;&#x53D6;&#x51FA;&#x4E00;&#x6761;&#x7F51;&#x5740;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x622A;&#x56FE; if self.queue.empty(): break host=self.queue.get().strip(&apos;\n&apos;) shotcmd=&quot;DISPLAY=:0 cutycapt --url=http://&quot;+host+&quot; --max-wait=90000 --out=&quot;+host+&quot;.jpg&quot; os.system(shotcmd) self.queue.task_done() time.sleep(1) def main(): queue=Queue.Queue() f=file(&apos;domain.txt&apos;,&apos;r&apos;) &#xFF03;&#x5F80;&#x961F;&#x5217;&#x4E2D;&#x586B;&#x5145;&#x6570;&#x636E; while True: line=f.readline() if len(line)==0: break queue.put(line) #&#x751F;&#x6210;&#x4E00;&#x4E2A; threads pool, &#x5E76;&#x628A;&#x961F;&#x5217;&#x4F20;&#x9012;&#x7ED9;thread&#x51FD;&#x6570;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF0C;&#x8FD9;&#x91CC;&#x5F00;&#x542F;10&#x4E2A;&#x7EBF;&#x7A0B;&#x5E76;&#x53D1; for i in range(0,10): shot=Webshot(queue) shot.start() if __name__==&quot;__main__&quot;: main() &#x7A0B;&#x5E8F;&#x63CF;&#x8FF0;&#x5982;&#x4E0B;&#xFF1A;1&#x3001;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;Queue.Queue() &#x7684;&#x5B9E;&#x4F8B;,&#x5C06;domain.txt&#x91CC;&#x7684;&#x7F51;&#x7AD9;&#x5217;&#x8868;&#x5B58;&#x5165;&#x5230;&#x8BE5;&#x961F;&#x5217;&#x4E2D;2&#x3001;for&#x5FAA;&#x73AF;&#x751F;&#x6210;10&#x4E2A;&#x7EBF;&#x7A0B;&#x5E76;&#x53D1;3&#x3001;&#x5C06;&#x961F;&#x5217;&#x5B9E;&#x4F8B;&#x4F20;&#x9012;&#x7ED9;&#x7EBF;&#x7A0B;&#x7C7B;Webshot&#xFF0C;&#x540E;&#x8005;&#x662F;&#x901A;&#x8FC7;&#x7EE7;&#x627F; threading.Thread &#x7684;&#x65B9;&#x5F0F;&#x521B;&#x5EFA;&#x7684;4&#x3001;&#x6BCF;&#x6B21;&#x4ECE;&#x961F;&#x5217;&#x4E2D;&#x53D6;&#x51FA;&#x4E00;&#x4E2A;&#x9879;&#x76EE;&#xFF0C;&#x5E76;&#x4F7F;&#x7528;&#x8BE5;&#x7EBF;&#x7A0B;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x548C; run &#x65B9;&#x6CD5;&#x4EE5;&#x6267;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x5DE5;&#x4F5C;5&#x3001;&#x5728;&#x5B8C;&#x6210;&#x8FD9;&#x9879;&#x5DE5;&#x4F5C;&#x4E4B;&#x540E;&#xFF0C;&#x4F7F;&#x7528; queue.task_done() &#x51FD;&#x6570;&#x5411;&#x4EFB;&#x52A1;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#x7684;&#x961F;&#x5217;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x4FE1;&#x53F7; &#x53C2;&#x8003;&#xFF1A;Python&#xFF1A;&#x4F7F;&#x7528;threading&#x6A21;&#x5757;&#x5B9E;&#x73B0;&#x591A;&#x7EBF;&#x7A0B;&#xFF08;&#x8F6C;&#xFF09;http://bkeep.blog.163.com/blog/static/1234142902012112210717682/http://fc-lamp.blog.163.com/blog/static/17456668720127221363513/http://www.pythonclub.org/python-network-application/observer-spiderhttp://www.phpno.com/python-threading-2.html]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[linux多线程网页截图-shell]]></title>
    <url>%2F2013%2F06%2F08%2Flinux%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BD%91%E9%A1%B5%E6%88%AA%E5%9B%BE-shell%2F</url>
    <content type="text"><![CDATA[&#x8001;&#x5927;&#x4E34;&#x65F6;&#x5B89;&#x6392;&#x4EFB;&#x52A1;&#xFF0C;&#x8981;&#x5B9A;&#x671F;&#x5BF9;&#x5927;&#x91CF;&#xFF08;&#x4E07;&#x4E3A;&#x5355;&#x4F4D;&#xFF09;&#x7684;&#x7F51;&#x7AD9;&#x622A;&#x56FE;&#x5E76;&#x5F52;&#x6863;&#x4FDD;&#x5B58;&#x3002;&#x6700;&#x65E9;&#x4F7F;&#x7528;&#x7684;&#x662F;window&#x4E0B;&#x7684;&#x4E00;&#x4E2A;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF1A;webshotcmd.exe+&#x6279;&#x5904;&#x7406;&#x3002;&#x8FD0;&#x884C;&#x4E86;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#xFF0C;&#x53D1;&#x73B0;&#x7ECF;&#x5E38;&#x5F39;&#x51FA;webshotcmd.exe&#x7A0B;&#x5E8F;&#x672A;&#x54CD;&#x5E94;&#x7684;&#x7A97;&#x53E3;&#xFF0C;&#x9700;&#x8981;&#x4EBA;&#x5DE5;&#x70B9;&#x51FB;&#x786E;&#x5B9A;&#x540E;&#x624D;&#x80FD;&#x7EE7;&#x7EED;&#x622A;&#x56FE;&#xFF0C;&#x800C;&#x4E14;webshocmd&#x672A;&#x6CE8;&#x518C;&#x7248;&#x672C;&#x622A;&#x51FA;&#x7684;&#x56FE;&#x662F;&#x7070;&#x8272;&#x7684;&#xFF0C;&#x4E0D;&#x65B9;&#x4FBF;&#x67E5;&#x770B;&#x3002; google&#x4E86;&#x4E0B;&#xFF0C;&#x53D1;&#x73B0;&#x4E86;linux&#x7684;&#x4E24;&#x4E2A;&#x622A;&#x56FE;&#x5DE5;&#x5177;cutycapt&#x548C;phantomjs&#xFF0C;&#x7ECF;&#x8FC7;&#x6D4B;&#x8BD5;&#xFF0C;cutycapt&#x622A;&#x56FE;&#x8F83;&#x6162;&#xFF0C;&#x4F46;&#x6BD4;&#x8F83;&#x7A33;&#x5B9A;&#xFF0C;phantomjs&#x622A;&#x56FE;&#x901F;&#x5EA6;&#x8F83;&#x5FEB;&#xFF0C;&#x4F46;&#x65F6;&#x6709;&#x51FA;&#x73B0;&#x8FDB;&#x7A0B;&#x5047;&#x6B7B;&#x7684;&#x72B6;&#x6001;&#x3002;&#x6743;&#x8861;&#x5229;&#x5F0A;&#xFF0C;&#x51B3;&#x5B9A;&#x4F7F;&#x7528;cutycapt+shell&#x811A;&#x672C;&#x7684;&#x65B9;&#x5F0F;&#x622A;&#x56FE;&#xFF1A; webshot.sh 1234567891011#/bin/bash#webhsot#by caishzh 2013 WEBSHOTDIR=&quot;/data/webshot&quot;mkdir -p $WEBSHOTDIR while read LINEdo DISPLAY=:0 cutycapt --url=http://$LINE --max-wait=90000 --out=$WEBSHOTDIR/$LINE.jpg &gt;/dev/null 2&gt;&amp;1done&lt;domain.txt &#x811A;&#x672C;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x4E0D;&#x6CE8;&#x91CA;&#x4E86;&#xFF0C;domain.txt&#x662F;&#x7F51;&#x5740;&#x5217;&#x8868;&#x3002;cutycapt&#x7684;&#x5B89;&#x88C5;&#x548C;&#x4F7F;&#x7528;&#x53C2;&#x7167;&#x8FD9;&#x91CC;&#x3002;&#x6267;&#x884C;&#x811A;&#x672C;&#xFF0C;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x622A;&#x56FE;&#xFF0C;&#x56FE;&#x7247;&#x8D28;&#x91CF;&#x4E5F;&#x5F88;&#x9AD8;&#x3002;&#x4F46;&#x53E6;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x51FA;&#x73B0;&#x4E86;&#xFF0C;&#x5BF9;&#x51E0;&#x4E07;&#x4E2A;&#x7F51;&#x7AD9;&#x622A;&#x56FE;&#xFF0C;&#x65F6;&#x95F4;&#x5468;&#x671F;&#x592A;&#x957F;&#xFF0C;&#x4F30;&#x7B97;&#x9700;&#x8981;&#x534A;&#x4E2A;&#x6708;&#x5DE6;&#x53F3;&#x3002;&#x65F6;&#x95F4;&#x592A;&#x957F;&#xFF0C;&#x8017;&#x4E0D;&#x8D77;&#xFF0C;&#x9700;&#x8981;&#x4F18;&#x5316;&#x4E0B;&#x811A;&#x672C;&#x3002;&#x627E;&#x4E86;&#x4E0B;&#x8D44;&#x6599;&#xFF0C;&#x51B3;&#x5B9A;&#x4F7F;&#x7528;&#x591A;&#x7EBF;&#x7A0B;&#x622A;&#x56FE;&#x3002;&#x5176;&#x5B9E;shell&#x65E0;&#x6CD5;&#x5B9E;&#x73B0;&#x591A;&#x7EBF;&#x7A0B;&#xFF0C;&#x53EA;&#x662F;&#x5C06;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x653E;&#x5165;&#x540E;&#x53F0;&#x6267;&#x884C;&#x800C;&#x5DF2;&#x3002; multiwebshot.sh 123456789101112131415161718192021#/bin/bash#Multithreading webshot#by caishzh 2013 WEBSHOTDIR=&quot;/data/webshot&quot;mkdir -p $WEBSHOTDIR #&#x5C06;domain.txt&#x5206;&#x5272;&#x6210;10&#x4E2A;&#x6587;&#x4EF6;&#xFF08;x&#x5F00;&#x5934;&#xFF09;&#xFF0C;&#x6BCF;&#x4E2A;&#x6587;&#x4EF6;5000&#x884C;split -l 5000 domain.txt for i in `ls x*`;do{ for j in `cat $i`;do DISPLAY=:0 cutycapt --url=http://$j --max-wait=90000 --out=$WEBSHOTDIR/$j.jpg &gt;/dev/null 2&gt;&amp;1 done}&amp;donewait#&#x5220;&#x9664;&#x7531;spilt&#x5206;&#x5272;&#x51FA;&#x7684;&#x4E34;&#x65F6;&#x6587;&#x4EF6;rm x* -f &#x811A;&#x672C;&#x8BF4;&#x660E;&#xFF1A;&#x5148;&#x4F7F;&#x7528;split&#x5C06;domain.txt&#x5206;&#x5272;&#x6210;&#x591A;&#x4E2A;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x6BCF;&#x4E2A;&#x6587;&#x4EF6;5000&#x884C;&#xFF0C;&#x518D;&#x4F7F;&#x7528;&#x4E24;&#x4E2A;&#x5D4C;&#x5957;&#x7684;for&#x5FAA;&#x73AF;&#x5B9E;&#x73B0;&#x591A;&#x8FDB;&#x7A0B;&#x622A;&#x56FE;&#x3002;&#x7B2C;&#x4E00;&#x4E2A;for&#x662F;&#x5217;&#x51FA;&#x7531;split&#x5206;&#x5272;&#x7684;&#x7684;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;for&#x5BF9;&#x8FD9;&#x4E9B;&#x6587;&#x4EF6;&#x91CC;&#x7684;&#x7F51;&#x7AD9;&#x622A;&#x56FE;&#xFF0C;&#x6CE8;&#x610F;&#x5927;&#x62EC;&#x53F7;&#x540E;&#x9762;&#x7684;&amp;&#xFF0C;&amp;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x5C06;&#x5927;&#x62EC;&#x53F7;&#x91CC;&#x7684;&#x811A;&#x672C;&#x4EE3;&#x7801;&#x653E;&#x5230;&#x540E;&#x53F0;&#x6267;&#x884C;&#xFF0C;&#x8FD9;&#x5C31;&#x6A21;&#x62DF;&#x5904;&#x7406;&#x201C;&#x591A;&#x7EBF;&#x7A0B;&#x201D;&#x7684;&#x6548;&#x679C;&#xFF0C;&#x5B9E;&#x9645;&#x5219;&#x662F;&#x591A;&#x8FDB;&#x7A0B;&#x3002;wait&#x662F;&#x7B49;&#x5F85;&#x524D;&#x9762;&#x7684;&#x540E;&#x53F0;&#x4EFB;&#x52A1;&#x5168;&#x90E8;&#x5B8C;&#x6210;&#x624D;&#x5F80;&#x4E0B;&#x6267;&#x884C;&#x3002; &#x4F7F;&#x7528;&#x8BE5;&#x811A;&#x672C;&#x5927;&#x5927;&#x63D0;&#x9AD8;&#x4E86;&#x622A;&#x56FE;&#x7684;&#x662F;&#x901F;&#x5EA6;&#xFF0C;&#x5728;&#x4E24;&#x5929;&#x5DE6;&#x53F3;&#x7684;&#x65F6;&#x95F4;&#x91CC;&#x5B8C;&#x6210;&#x6240;&#x6709;&#x7F51;&#x7AD9;&#x7684;&#x622A;&#x56FE;&#xFF0C;&#x6548;&#x679C;&#x663E;&#x8457;&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;cutycapt&#x622A;&#x56FE;&#x662F;&#x9700;&#x8981;&#x5360;&#x7528;&#x8F83;&#x5927;&#x7684;&#x7F51;&#x7EDC;&#x5E26;&#x5BBD;&#x548C;cpu&#x8D44;&#x6E90;&#xFF0C;&#x5728;&#x914D;&#x7F6E;&#x8F83;&#x5DEE;&#x7684;&#x673A;&#x5668;&#x4E0A;&#x4E0D;&#x8981;&#x5F00;&#x592A;&#x591A;&#x7684;cutycapt&#x201C;&#x7EBF;&#x7A0B;&#x201D;&#xFF0C;&#x4EE5;&#x514D;&#x9020;&#x6210;&#x673A;&#x5668;&#x6B7B;&#x673A;&#x3002; &#x53C2;&#x8003;SHELL&#x6A21;&#x62DF;&#x591A;&#x7EBF;&#x7A0B;&#x811A;&#x672C;&#x7684;&#x8BE6;&#x7EC6;&#x6CE8;&#x89E3;]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[开发自己的监控系统三、移动篇（android）]]></title>
    <url>%2F2013%2F05%2F22%2F%E5%BC%80%E5%8F%91%E8%87%AA%E5%B7%B1%E7%9A%84%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%E4%B8%89%E3%80%81%E7%A7%BB%E5%8A%A8%E7%AF%87%EF%BC%88android%EF%BC%89%2F</url>
    <content type="text"><![CDATA[&#x79FB;&#x52A8;&#x7BC7;&#xFF08;android&#xFF09;&#x5173;&#x952E;&#x5B57;&#xFF1A;java&#x3001;android&#x3001;json&#x3001;php &#x4E92;&#x8054;&#x7F51;&#x5DF2;&#x7ECF;&#x8FDB;&#x5165;&#x79FB;&#x52A8;&#x65F6;&#x4EE3;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x7ED9;&#x81EA;&#x5DF1;&#x7684;&#x4EA7;&#x54C1;&#x5F00;&#x53D1;&#x624B;&#x673A;&#x7AEF;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x51FA;&#x95E8;&#x90FD;&#x4E0D;&#x597D;&#x610F;&#x601D;&#x8DDF;&#x522B;&#x4EBA;&#x6253;&#x62DB;&#x547C;&#x4E86;~~&#x4E3A;&#x4E86;&#x968F;&#x65F6;&#x968F;&#x5730;&#x638C;&#x63E1;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#xFF0C;&#x5F53;&#x7136;&#xFF0C;&#x4E5F;&#x4E3A;&#x4E86;&#x88C5;ability&#xFF0C;&#x4E0B;&#x9762;&#x5C31;&#x6765;&#x4E3A;&#x6211;&#x4EEC;&#x7684;&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;&#x5F00;&#x53D1;&#x4E00;&#x4E2A;&#x624B;&#x673A;&#x7AEF;&#xFF08;android&#xFF09;&#x7684;&#x5E94;&#x7528;&#x3002; &#x539F;&#x7406;&#x9996;&#x5148;&#x7F16;&#x5199;&#x4E00;&#x4E2A;web&#x63A5;&#x53E3;&#xFF0C;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x5E93;&#x670D;&#x52A1;&#x5668;&#x6570;&#x636E;&#xFF0C;&#x8FD4;&#x56DE;json&#x5BF9;&#x8C61;&#x6570;&#x7EC4;&#x3002;android&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x89E3;&#x6790;json&#x6570;&#x636E;&#xFF0C;&#x901A;&#x8FC7;listvie&#x63A7;&#x4EF6;&#x663E;&#x793A;&#x3002; &#x4EE5;&#x4E0B;&#x662F;web&#x63A5;&#x53E3;&#xFF0C;php&#x7F16;&#x5199;&#xFF0C;pdo&#x65B9;&#x5F0F;&#x8FDE;&#x63A5;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x4F7F;&#x7528;json_encode&#x5C06;&#x5B57;&#x7B26;&#x4E32;&#x8F6C;&#x6362;&#x4E3A;json&#x5BF9;&#x8C61;&#x683C;&#x5F0F;&#xFF0C;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A; 12345678910111213141516&lt; ?php $dbms=&apos;mysql&apos;; //&#x6570;&#x636E;&#x5E93;&#x7C7B;&#x578B; oracle &#x7528;ODI,&#x5BF9;&#x4E8E;&#x5F00;&#x53D1;&#x8005;&#x6765;&#x8BF4;&#xFF0C;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x53EA;&#x8981;&#x6539;&#x8FD9;&#x4E2A;&#xFF0C;&#x4E0D;&#x7528;&#x8BB0;&#x4F4F;&#x90A3;&#x4E48;&#x591A;&#x7684;&#x51FD;&#x6570;&#x4E86; $host=&apos;localhost&apos;; //&#x6570;&#x636E;&#x5E93;&#x4E3B;&#x673A;&#x540D; $dbName=&apos;monitor&apos;; //&#x4F7F;&#x7528;&#x7684;&#x6570;&#x636E;&#x5E93; $user=&apos;user1&apos;; //&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x7528;&#x6237;&#x540D; $pass=&apos;Root123&apos;; //&#x5BF9;&#x5E94;&#x7684;&#x5BC6;&#x7801; $dsn=&quot;$dbms:host=$host;dbname=$dbName&quot;; try { $dbh=new PDO($dsn,$user,$pass);//&#x521D;&#x59CB;&#x5316;&#x4E00;&#x4E2A;PDO&#x5BF9;&#x8C61;&#xFF0C;&#x5C31;&#x662F;&#x521B;&#x5EFA;&#x4E86;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x5BF9;&#x8C61;$dbh $jsonString=json_encode($dbh-&gt;query(&apos;select * from servers&apos;)-&gt;fetchAll(PDO::FETCH_ASSOC)); print_r($jsonString); } catch (PDOException $e) { die(&quot;Error!:&quot;.$e-&gt;getMessage()); }?&gt; &#x6CE8;&#xFF1A;&#x63A5;&#x53E3;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4EFB;&#x4F55;&#x8BED;&#x8A00;&#x7F16;&#x5199;&#xFF0C;&#x53EA;&#x8981;&#x80FD;&#x8FD4;&#x56DE;json&#x5BF9;&#x8C61;&#x6570;&#x7EC4;&#x5C31;&#x884C;&#x3002; &#x4F7F;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x8BBF;&#x95EE;&#x8BE5;&#x63A5;&#x53E3;&#xFF0C;&#x8FD4;&#x56DE;json&#x5BF9;&#x8C61;&#x6570;&#x7EC4;&#xFF1A; &#x5E94;&#x7528;&#x5F00;&#x53D1;&#x5927;&#x4F53;&#x601D;&#x8DEF;&#xFF1A;&#x4F7F;&#x7528;HttpClient&#x63A5;&#x53E3;&#x5411;web&#x63A5;&#x53E3;&#x63D0;&#x4EA4;get&#x8BF7;&#x6C42;&#xFF0C;&#x53D6;&#x56DE;json&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;&#x89E3;&#x6790;json&#x6570;&#x636E;&#x5E76;&#x663E;&#x793A;&#x5728;listview&#x6784;&#x9020;&#x7684;&#x8868;&#x683C;&#x4E2D;&#x3002;eclipse&#x9879;&#x76EE;&#x7ED3;&#x6784;&#x5982;&#x4E0B;&#xFF1A; AndroidManifest.xml&#xFF1A; 123456789101112131415161718192021222324252627&lt; ?xml version= &quot;1.0&quot; encoding =&quot;utf-8&quot;?&gt;&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; package=&quot;com.cszhi.mymonitor&quot; android:versionCode= &quot;1&quot; android:versionName= &quot;1.0&quot; &gt; &lt;uses -sdk android:minSdkVersion=&quot;8&quot; android:targetSdkVersion=&quot;17&quot; /&gt; &lt;uses -permission android:name=&quot;android.permission.INTERNET&quot; /&gt;&lt;!-- &#x7F51;&#x8DEF;&#x8FDE;&#x63A5;&#x6743;&#x9650;--&gt; &lt;uses -permission android:name= &quot;android.permission.ACCESS_NETWORK_STATE&quot; /&gt;&lt;!-- &#x5141;&#x8BB8;&#x8BBF;&#x95EE;&#x7F51;&#x7EDC;&#x72B6;&#x6001;--&gt; &lt;application android:allowBackup=&quot;true&quot; android:icon=&quot;@drawable/ic_launcher&quot; android:label=&quot;@string/app_name&quot; android:theme=&quot;@style/AppTheme&quot; &gt; &lt;activity android:screenOrientation=&quot;landscape&quot; android:name=&quot;com.cszhi.mymonitor.MainActivity&quot; android:label=&quot;@string/app_name&quot; &gt; &lt;intent -filter&gt; &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt; &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt; &lt;/intent&gt; &lt;/activity&gt; &lt;/application&gt; &lt;/manifest&gt; server_list.xml&#xFF1A; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051&lt; ?xml version= &quot;1.0&quot; encoding =&quot;utf-8&quot;?&gt;&lt;linearlayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; android:layout_width= &quot;wrap_content&quot; android:layout_height= &quot;20dp&quot; android:orientation= &quot;horizontal&quot; &gt; &lt;tablelayout android:id=&quot;@+id/table&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; &gt; &lt;tablerow&gt; &lt;view android:layout_width=&quot;1dip&quot; android:background= &quot;#FF909090&quot; /&gt; &lt;textview android:id=&quot;@+id/id&quot; android:layout_width=&quot;20dp&quot; android:gravity=&quot;center&quot; android:layout_height=&quot;wrap_content&quot; /&gt; &lt;view android:layout_width=&quot;1dip&quot; android:background= &quot;#FF909090&quot; /&gt; &lt;textview android:id=&quot;@+id/hostname&quot; android:layout_width=&quot;70dp&quot; android:gravity=&quot;center&quot; android:layout_height=&quot;wrap_content&quot; /&gt; &lt;view android:layout_width=&quot;1dip&quot; android:background= &quot;#FF909090&quot; /&gt; &lt;textview android:id=&quot;@+id/ip&quot; android:layout_width=&quot;100dp&quot; android:gravity=&quot;center&quot; android:layout_height=&quot;wrap_content&quot; /&gt; &lt;view android:layout_width=&quot;1dip&quot; android:background= &quot;#FF909090&quot; /&gt; &lt;textview android:id=&quot;@+id/rootpartion&quot; android:layout_width=&quot;100dp&quot; android:gravity=&quot;center&quot; android:layout_height=&quot;wrap_content&quot; /&gt; &lt;view android:layout_width=&quot;1dip&quot; android:background= &quot;#FF909090&quot; /&gt; &lt;textview android:id=&quot;@+id/uptime&quot; android:layout_width=&quot;100dp&quot; android:gravity=&quot;center&quot; android:layout_height=&quot;wrap_content&quot; /&gt; &lt;view android:layout_width=&quot;1dip&quot; android:background= &quot;#FF909090&quot; /&gt; &lt;textview android:id=&quot;@+id/time&quot; android:layout_width=&quot;85dp&quot; android:gravity=&quot;center&quot; android:layout_height=&quot;wrap_content&quot; /&gt; &lt;view android:layout_width=&quot;1dip&quot; android:background= &quot;#FF909090&quot; /&gt; &lt;/tablerow&gt; &lt;/tablelayout&gt;&lt;/linearlayout&gt; activity_main.xml&#xFF1A; 123456789101112131415161718192021222324252627&lt;linearlayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; xmlns:tools= &quot;http://schemas.android.com/tools&quot; android:layout_width= &quot;match_parent&quot; android:layout_height= &quot;match_parent&quot; android:orientation= &quot;vertical&quot; android:paddingBottom= &quot;@dimen/activity_vertical_margin&quot; android:paddingLeft= &quot;@dimen/activity_horizontal_margin&quot; android:paddingRight= &quot;@dimen/activity_horizontal_margin&quot; android:paddingTop= &quot;@dimen/activity_vertical_margin&quot; tools:context= &quot;.MainActivity&quot; &gt; &lt;button android:id=&quot;@+id/bn&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:layout_marginLeft=&quot;20dp&quot; android:text=&quot;&#x5237;&#x65B0;&quot; /&gt; &lt;listview android:id=&quot;@+id/lvTitle&quot; android:background=&quot;#bfe1f2&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; /&gt; &lt;listview android:id=&quot;@+id/lv&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; /&gt; &lt;/linearlayout&gt; MyHttp.java&#xFF1A;&#x7528;&#x4E8E;&#x63D0;&#x4EA4;get&#x8BF7;&#x6C42;&#xFF0C;&#x83B7;&#x53D6;&#x63A5;&#x53E3;&#x8FD4;&#x56DE;&#x7684;&#x6570;&#x636E;&#x3002; 1234567891011121314151617181920212223242526272829303132package com.cszhi.mymonitor; import java.io.IOException; import org.apache.http.HttpResponse;import org.apache.http.HttpStatus;import org.apache.http.client.ClientProtocolException;import org.apache.http.client.HttpClient;import org.apache.http.client.methods.HttpGet;import org.apache.http.impl.client.DefaultHttpClient;import org.apache.http.util.EntityUtils; public class MyHttp { public String httpGet(String url){ String response= null; HttpClient httpClient= new DefaultHttpClient(); HttpGet httpGet= new HttpGet(url); HttpResponse httpResponse; try{ httpResponse=httpClient.execute(httpGet); int statusCode=httpResponse.getStatusLine().getStatusCode(); if(statusCode==HttpStatus.SC_OK){ response=EntityUtils. toString(httpResponse.getEntity()); } } catch(ClientProtocolException e){ e.printStackTrace(); } catch(IOException e){ e.printStackTrace(); } return response; }} MainActivity.java 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153package com.cszhi.mymonitor; import java.util.ArrayList;import java.util.HashMap;import java.util.List;import java.util.Map; import org.json.JSONArray;import org.json.JSONObject; import android.net.ConnectivityManager;import android.net.NetworkInfo;import android.os.Bundle;import android.os.Handler;import android.os.Message;import android.app.Activity;import android.content.Context;import android.util.Log;import android.view.View;import android.view.View.OnClickListener;import android.view.Window;import android.widget.Button;import android.widget.ListView;import android.widget.SimpleAdapter;import android.widget.Toast; public class MainActivity extends Activity { //jsonstring &#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x7528;&#x4E8E;&#x5B58;&#x653E;&#x901A;&#x8FC7;url&#x83B7;&#x53D6;&#x7684;json&#x6570;&#x636E; String jsonstring=null ; //&#x63A5;&#x53E3;&#x5730;&#x5740; String url= &quot;http://60.191.231.17/get.php&quot; ; @Override protected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); //&#x7528;&#x4E8E;&#x7B49;&#x5F85;&#x56FE;&#x6807; requestWindowFeature(Window. FEATURE_INDETERMINATE_PROGRESS); setContentView(R.layout. activity_main); Button bn=(Button) findViewById(R.id. bn); //&#x5904;&#x7406;&#x7EBF;&#x7A0B;&#x4F20;&#x9012;&#x6765;&#x7684;&#x6D88;&#x606F; final Handler myhandler =new Handler(){ public void handleMessage(Message msg){ ListView lv=(ListView) findViewById(R.id. lv); String[] from={&quot;id&quot;,&quot;hostname&quot; ,&quot;ip&quot; ,&quot;rootpartion&quot; ,&quot;uptime&quot; ,&quot;time&quot; }; int[] to={R.id.id,R.id.hostname ,R.id.ip,R.id.rootpartion,R.id. uptime,R.id.time }; List&lt;map &lt;string,?&gt;&gt; listb= new ArrayList&lt;/map&gt;&lt;map &lt;string,?&gt;&gt;(); Map&lt;string ,String&gt; b= new HashMap&lt;/string&gt;&lt;string , String&gt;(); b.put( &quot;id&quot;, &quot;id&quot; ); b.put( &quot;hostname&quot;, &quot;hostname&quot; ); b.put( &quot;ip&quot;, &quot;ip&quot; ); b.put( &quot;rootpartion&quot;,&quot;rootpartion&quot; ); b.put( &quot;uptime&quot;,&quot;uptime&quot; ); b.put( &quot;time&quot;, &quot;time&quot; ); listb.add(b); ListView lvtitle=(ListView) findViewById(R.id.lvTitle ); SimpleAdapter adapterb= new SimpleAdapter(MainActivity.this ,listb,R.layout.server_list,from,to); lvtitle.setAdapter(adapterb); List&lt;map &lt;string,?&gt;&gt; list= new ArrayList&lt;/map&gt;&lt;map &lt;string,?&gt;&gt;(); try{ JSONArray jsonArray= new JSONArray(jsonstring ); //&#x89E3;&#x6790;json&#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x653E;&#x5165;hashmap&#x4E2D; for(int i=0;i&lt;jsonarray .length();i++){ JSONObject item=jsonArray.getJSONObject(i); Map&lt;string,String&gt; m=new HashMap&lt;string , String&gt;(); m.put( &quot;id&quot;, item.getString(&quot;id&quot; )); m.put( &quot;hostname&quot;, item.getString(&quot;hostname&quot; )); m.put( &quot;ip&quot;, item.getString(&quot;ip&quot; )); m.put( &quot;rootpartion&quot;,item.getString(&quot;rootpartion&quot; )); m.put( &quot;uptime&quot;, item.getString(&quot;uptime&quot; )); m.put( &quot;time&quot;, item.getString(&quot;time&quot; )); list.add(m); } } catch(Exception e){ e.printStackTrace(); } //&#x8FD9;&#x91CC;&#x7684;this&#x662F;Handler&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x662F;&#x5728;&#x653E;&#x5728;Handler&#x91CC;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x4E0D;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;this&#xFF0C;&#x800C;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;MainActivity.this(MainActivity&#x662F;&#x7C7B;&#x540D;) SimpleAdapter adapter= new SimpleAdapter(MainActivity.this ,list,R.layout.server_list,from,to); lv.setAdapter(adapter); //&#x5173;&#x95ED;&#x7B49;&#x5F85;&#x56FE;&#x6807;&#xFF08;&#x53F3;&#x4E0A;&#x89D2;&#x7684;&#x8F6C;&#x5708;&#xFF09; setProgressBarIndeterminateVisibility( false); } }; //Runnable&#x63A5;&#x53E3; final Runnable st=new Runnable() { @Override public void run() { data( url); myhandler.sendEmptyMessage(0); } }; //&#x68C0;&#x67E5;&#x662F;&#x5426;&#x6709;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5; if(!checkNet( this)){ Toast. makeText(this, &quot;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#x5931;&#x8D25;&#xFF0C;&#x8BF7;&#x68C0;&#x67E5;&#x7F51;&#x7EDC;&quot; ,Toast.LENGTH_LONG).show(); } else{ new Thread(st).start(); setProgressBarIndeterminateVisibility( true); } //&#x5355;&#x51FB;&#x6309;&#x94AE; bn.setOnClickListener( new OnClickListener() { @Override public void onClick(View arg0) { // TODO Auto-generated method stub //&#x5982;&#x679C;&#x6709;&#x7F51;&#x8DEF;&#x8FDE;&#x63A5;&#xFF0C;&#x521B;&#x5EFA;&#x65B0;&#x7EBF;&#x7A0B;&#xFF0C;&#x4F20;&#x5165; st&#x63A5;&#x53E3;&#xFF0C;&#x5E76;&#x542F;&#x52A8;&#x8BE5;&#x7EBF;&#x7A0B; if(!checkNet(MainActivity. this)){ Toast. makeText(MainActivity.this, &quot;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#x5931;&#x8D25;&#xFF0C;&#x8BF7;&#x68C0;&#x67E5;&#x7F51;&#x7EDC;&quot; ,Toast.LENGTH_LONG).show(); return; } else{ new Thread(st).start(); //&#x663E;&#x793A;&#x7B49;&#x5F85;&#x56FE;&#x6807;&#xFF08;&#x53F3;&#x4E0A;&#x89D2;&#x7684;&#x8F6C;&#x5708;&#xFF09; setProgressBarIndeterminateVisibility( true); } } }); } //&#x83B7;&#x53D6;url&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x8D4B;&#x503C;&#x7ED9;jsonstring private void data(String url){ MyHttp myHttp= new MyHttp(); jsonstring= myHttp.httpGet(url); } //&#x68C0;&#x67E5;&#x662F;&#x5426;&#x6709;&#x7F51;&#x7EDC;&#x7684;&#x51FD;&#x6570; public static boolean checkNet(Context context) { try { NetworkInfo networkInfo = (( ConnectivityManager) context.getSystemService(Context.CONNECTIVITY_SERVICE )).getActiveNetworkInfo(); if (networkInfo != null) { Log. d(&quot;httpjson&quot;, &quot;true&quot;); return true ; } else { Log. d(&quot;httpjson&quot;, &quot;false&quot;); return false ; } } catch (Exception e) { e.printStackTrace(); return false ; } } }&lt;/string&gt;&lt;/jsonarray&gt;&lt;/map&gt;&lt;/string&gt;&lt;/map&gt; &#x7F16;&#x8BD1;&#xFF0C;&#x4F20;&#x5230;&#x624B;&#x673A;&#x4E0A;&#x5B89;&#x88C5;&#x8FD0;&#x884C;&#xFF1A; &#x53EF;&#x4EE5;&#x6839;&#x636E;&#x81EA;&#x5DF1;&#x9700;&#x6C42;&#x6DFB;&#x52A0;&#x5176;&#x5B83;&#x529F;&#x80FD;&#xFF0C;&#x5982;&#x5B9A;&#x65F6;&#x5237;&#x65B0;&#xFF0C;&#x58F0;&#x97F3;&#x62A5;&#x8B66;&#x7B49;&#x3002;&#x5982;&#x4E0B;&#x622A;&#x56FE;&#x662F;&#x6211;&#x4E3A;&#x90E8;&#x95E8;&#x8FD0;&#x7EF4;&#x670D;&#x52A1;&#x5668;&#x5F00;&#x53D1;&#x7684;&#x624B;&#x673A;&#x7AEF;&#x76D1;&#x63A7;&#x7A0B;&#x5E8F;&#xFF0C;&#x652F;&#x6301;&#x6309;&#x7BA1;&#x7406;&#x5458;&#x76D1;&#x63A7;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x652F;&#x6301;&#x6309;&#x4E0D;&#x540C;&#x76D1;&#x63A7;&#x9879;&#x76EE;&#x6392;&#x5E8F;&#xFF1A; &#x53C2;&#x8003;&#xFF1A; &#x5C1A;&#x5B66;&#x5802;&#x79D1;&#x6280;.&#x9A6C;&#x58EB;&#x5175;.JAVA&#x89C6;&#x9891;&#x6559;&#x7A0B;&#x75AF;&#x72C2;android&#x8BB2;&#x4E49;http://developer.android.com/training/index.html]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>dev</tag>
        <tag>monitor</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[开发自己的监控系统二、web篇]]></title>
    <url>%2F2013%2F05%2F21%2F%E5%BC%80%E5%8F%91%E8%87%AA%E5%B7%B1%E7%9A%84%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%E4%BA%8C%E3%80%81web%E7%AF%87%2F</url>
    <content type="text"><![CDATA[web&#x7BC7;&#x5173;&#x952E;&#x5B57;&#xFF1A;shell mysql python web.py &#x5728;&#x4E0A;&#x4E00;&#x7BC7;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4ECB;&#x7ECD;&#x4E86;&#x5982;&#x4F55;&#x4F7F;&#x7528;shell&#x811A;&#x672C;&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;&#x72B6;&#x6001;&#xFF0C;&#x5E76;&#x5728;&#x51FA;&#x73B0;&#x5F02;&#x5E38;&#x65F6;&#x901A;&#x8FC7;email&#x53D1;&#x9001;&#x8B66;&#x62A5;&#x3002;&#x4F46;email&#x62A5;&#x8B66;&#x6709;&#x4E00;&#x4E2A;&#x5F0A;&#x7AEF;&#xFF0C;&#x65E0;&#x6CD5;&#x5B9E;&#x65F6;&#x4E86;&#x89E3;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#x3002;&#x4E3A;&#x4E86;&#x6EE1;&#x8DB3;&#x8FD9;&#x4E00;&#x9700;&#x6C42;&#xFF0C;&#x5C31;&#x8981;&#x5F00;&#x53D1;&#x4E00;&#x4E2A;web&#x7A0B;&#x5E8F;&#xFF0C;&#x901A;&#x8FC7;&#x7F51;&#x9875;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x663E;&#x793A;&#x6240;&#x6709;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5B9E;&#x65F6;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#x3002; &#x539F;&#x7406;&#x5B9A;&#x65F6;&#x6267;&#x884C;&#x76D1;&#x63A7;&#x811A;&#x672C;&#x63D0;&#x53D6;&#x670D;&#x52A1;&#x5668;&#x8FD0;&#x884C;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x7CFB;&#x7EDF;&#x8D1F;&#x8F7D;&#x3001;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x7B49;&#xFF0C;&#x5C06;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x5165;&#x5230;mysql&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x3002;&#x5F00;&#x53D1;&#x4E00;&#x4E2A;web&#x7A0B;&#x5E8F;&#xFF0C;&#x5F53;&#x7528;&#x6237;&#x901A;&#x8FC7;&#x6D4F;&#x89C8;&#x5668;&#x8BBF;&#x95EE;web&#x76D1;&#x63A7;&#x9875;&#x9762;&#xFF0C;web&#x7A0B;&#x5E8F;&#x8BFB;&#x53D6;mysql&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x670D;&#x52A1;&#x5668;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4EE5;&#x7F51;&#x9875;&#x7684;&#x5F62;&#x5F0F;&#x5C55;&#x73B0;&#x7ED9;&#x7528;&#x6237;&#x3002; &#x5B9E;&#x4F8B;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x6765;&#x8BE6;&#x7EC6;&#x8BB2;&#x89E3;&#x3002;&#x5171;&#x7528;&#x5230;3&#x53F0;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x4E00;&#x53F0;&#x76D1;&#x63A7;&#x670D;&#x52A1;&#x5668;serverM&#xFF08;60.11.232.17&#xFF09;&#xFF0C;&#x7528;&#x4E8E;&#x5B58;&#x653E;&#x6211;&#x4EEC;web&#x7A0B;&#x5E8F;&#x548C;mysql&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x8FD8;&#x6709;&#x4E24;&#x53F0;&#x88AB;&#x76D1;&#x63A7;&#x670D;&#x52A1;&#x5668;&#xFF0C;server1&#xFF08;199.83.55.39&#xFF09;&#x548C;server2&#xFF08;59.66.7.124&#xFF09;. &#x9996;&#x5148;&#x5728;&#x76D1;&#x63A7;&#x670D;&#x52A1;&#x5668;serverM&#x4E0A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E93;monitor&#xFF1A; 12mysql -pcreate database monitor &#x5728;monitor&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;servers&#x8868;&#xFF0C;&#x7528;&#x4E8E;&#x5B58;&#x653E;&#x76D1;&#x63A7;&#x6570;&#x636E;&#xFF1A; 123456789use monitorcreate table servers ( id int not null primary key auto_increment, hostname varchar(20), ip varchar(64), rootpartion varchar(64), uptime varchar(64), time timestamp) &#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x7528;&#x6237;user1&#xFF0C;&#x5E76;&#x8BA9;&#x5176;&#x6709;&#x8BBF;&#x95EE;monitor&#x6570;&#x636E;&#x5E93;&#x7684;&#x6743;&#x9650;: 12grant all privileges on monitor.* to &apos;user1&apos;@&apos;%&apos; identified by &apos;Root123&apos;;flush privileges &#x5728;&#x88AB;&#x76D1;&#x63A7;&#x670D;&#x52A1;&#x5668;server1&#x548C;server2&#x4E0A;&#x6267;&#x884C;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#xFF0C;&#x770B;&#x80FD;&#x5426;&#x6B63;&#x5E38;&#x8FDE;&#x63A5;&#x7684;&#x5230;&#x76D1;&#x63A7;&#x670D;&#x52A1;&#x5668;serverM&#x7684;&#x6570;&#x636E;&#x5E93; 1mysql -h60.11.232.17 -uuser1 -pRoot123 monitor &#x63A5;&#x4E0B;&#x6765;&#x662F;&#x88AB;&#x76D1;&#x63A7;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7684;shell&#x76D1;&#x63A7;&#x811A;&#x672C;&#xFF0C;&#x548C;email&#x7BC7;&#x4E2D;&#x7684;&#x811A;&#x672C;&#x5927;&#x4F53;&#x76F8;&#x4F3C;&#xFF0C;&#x591A;&#x4E86;&#x4E00;&#x4E2A;&#x5165;&#x5E93;&#x7684;&#x64CD;&#x4F5C;&#xFF1A; 1234567891011121314151617181920212223242526272829303132333435363738394041#!/bin/bash#Server status monitor#by caishzh 2013 #&#x521D;&#x59CB;&#x5316;&#x53D8;&#x91CF;&#x53CA;&#x8BBE;&#x7F6E;&#x9600;&#x503C;MYSQL=&quot;mysql -h60.11.232.17 -uuser1 -pRoot123 monitor -e&quot; #&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x8BED;&#x53E5;DIR=&quot;/tmp&quot;NOW=$(date &quot;+%F %T&quot;)&gt;${DIR}/messages.txt ADMIN=&quot;xxx@qq.com&quot; #&#x4F60;&#x7684;&#x90AE;&#x7BB1;&#x5730;&#x5740;HOSTNAME=$(hostname) #&#x8FD9;&#x91CC;&#x4E5F;&#x53EF;&#x4EE5;&#x624B;&#x52A8;&#x6307;&#x5B9A;&#x670D;&#x52A1;&#x5668;&#x540D; &#x5982;&#xFF1A;HOSTNAME=&quot;Server1&quot;IP=$(ifconfig eth0|grep &apos;inet addr&apos;|sed &apos;s/.*addr:\(.*\) Bcast:.*/\1/&apos;) UPTIME_MAX=3 #&#x7CFB;&#x7EDF;&#x8D1F;&#x8F7D;DISK_MAX=90 #&#x78C1;&#x76D8;&#x4F7F;&#x7528;&#x7387; #&#x7CFB;&#x7EDF;&#x8D1F;&#x8F7D;UPTIME=$(uptime|sed &apos;s/^.*age: \(.*\)$/\1/&apos;)UPTIME_NOW=$(echo $UPTIME|awk -F&apos;,&apos; &apos;{print $1}&apos;)if echo &quot;$UPTIME_NOW&gt;$UPTIME_MAX&quot;|bc &gt;/dev/null;then echo &quot;UPTIME: $UPTIME&quot; &gt;&gt;${DIR}/messages.txtfi #&#x6839;&#x5206;&#x533A;DISK=$(df -h|grep /$|awk &apos;{print $5,$2,$4}&apos;)DISK_USAGE=$(echo $DISK|awk &apos;{print $1}&apos;|tr -d &apos;%&apos;)[ &quot;$DISK_USAGE&quot; -ge &quot;$DISK_MAX&quot; ] &amp;&amp; $(echo &quot;DISK: $DISK&quot; &gt;&gt; ${DIR}/messages.txt) #&#x5982;&#x679C;messages.txt&#x6587;&#x4EF6;&#x4E0D;&#x4E3A;&#x7A7A;&#x5219;&#x53D1;&#x9001;&#x8B66;&#x62A5;&#x4FE1;if [ -s ${DIR}/messages.txt ];then mail -s &quot;system monitor: $NOW $IP $HOSTNAME&quot; &quot;$ADMIN&quot; &lt; ${DIR}/messages.txtfi #&#x5C06;&#x670D;&#x52A1;&#x5668;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#x6570;&#x636E;&#x5165;&#x5230;mysql&#x6570;&#x636E;&#x5E93;&#x4E2D;#&#x7B2C;&#x4E00;&#x6B21;&#x6267;&#x884C;&#x63D2;&#x5165;&#x4E00;&#x6761;&#x65B0;&#x8BB0;&#x5F55;&#xFF0C;&#x540E;&#x7EED;&#x5219;&#x66F4;&#x65B0;&#x8BB0;&#x5F55;if [ -n &quot;$1&quot; ];then $MYSQL &quot;insert into servers(hostname,ip,rootpartion,uptime,time) values(&apos;$HOSTNAME&apos;,&apos;$IP&apos;,&apos;$DISK&apos;,&apos;$UPTIME&apos;,now())&quot;else $MYSQL &quot;update servers set rootpartion=&apos;$DISK&apos;,uptime=&apos;$UPTIME&apos;,time=now() where hostname=&apos;$HOSTNAME&apos;&quot;fi &#x5C06;&#x811A;&#x672C;&#x653E;&#x5230;&#x88AB;&#x76D1;&#x63A7;&#x670D;&#x52A1;&#x5668;/root/tool&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x7ED9;&#x4E88;&#x6267;&#x884C;&#x6743;&#x9650;&#xFF1A; 1chmod 755 /root/tool/system_monitor.sh &#x653E;&#x5165;crontab&#x4E2D;&#xFF0C;&#x6BCF;3&#x5206;&#x949F;&#x6267;&#x884C;&#x4E00;&#x6B21;&#xFF1A; 1echo &quot;*/3 * * * * root /root/tool/system_monitor.sh&quot; &gt;&gt;/etc/crontab &#x7B2C;&#x4E00;&#x6B21;&#x9700;&#x8981;&#x624B;&#x52A8;&#x6267;&#x884C;&#x5982;&#x4E0B;&#x547D;&#x4EE4;&#xFF0C;&#x547D;&#x4EE4;&#x540E;&#x52A0;&#x4EFB;&#x610F;&#x53C2;&#x6570;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x5728;&#x6570;&#x636E;&#x5E93;&#x63D2;&#x5165;&#x4E00;&#x6761;&#x65B0;&#x8BB0;&#x5F55;&#xFF1A; 1/root/tool/system_monitor.sh 1 &#x6B64;&#x65F6;&#xFF0C;&#x6570;&#x636E;&#x5E93;&#x7684;&#x76D1;&#x63A7;&#x6570;&#x636E;&#x5982;&#x4E0B;&#xFF1A; 12345678910mysql&gt; use monitor;Database changedmysql&gt; select * from servers;+----+----------+--------------+--------------+------------------+---------------------+| id | hostname | ip | rootpartion | uptime | time |+----+----------+--------------+--------------+------------------+---------------------+| 1 | Server1 | 199.83.55.39 | 40% 20G 12G | 0.45, 0.23, 0.28 | 2013-05-21 21:39:06 || 2 | Server2 | 59.66.7.124 | 34% 101G 64G | 4.84, 4.35, 3.76 | 2013-05-21 21:39:22 |+----+----------+--------------+--------------+------------------+---------------------+2 rows in set (0.00 sec) &#x5230;&#x76D1;&#x63A7;&#x670D;&#x52A1;&#x5668;serverM&#xFF0C;&#x4E0B;&#x8F7D;&#x5B89;&#x88C5;web.py&#x6846;&#x67B6;&#xFF08; web.py &#x662F;&#x4E00;&#x4E2A;&#x8F7B;&#x91CF;&#x7EA7;Python web&#x6846;&#x67B6;&#xFF0C;&#x5B83;&#x7B80;&#x5355;&#x3001;&#x65B9;&#x4FBF;&#x800C;&#x4E14;&#x529F;&#x80FD;&#x5927;&#xFF09;&#xFF1A; 1234wget http://webpy.org/static/web.py-0.37.tar.gztar zxvf web.py-0.37.tar.gzcd web.py-0.37python setup.py install &#x65B0;&#x5EFA;&#x7F16;&#x8F91;code.py&#x6587;&#x4EF6;&#xFF08;&#x4EE3;&#x7801;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x4E0D;&#x6CE8;&#x91CA;&#x4E86;&#xFF0C;&#x4E0D;&#x6E05;&#x695A;&#x7684;&#x5EFA;&#x8BAE;&#x5148;&#x770B;&#x4E0B;web.py&#x7684;&#x65B0;&#x624B;&#x6307;&#x5357;&#xFF09;&#xFF1A; 1234567891011121314151617181920212223import web urls=( &apos;/&apos;,&apos;index&apos;)render = web.template.render(&apos;templates/&apos;) db = web.database( host = &apos;127.0.0.1&apos; , dbn = &apos;mysql&apos;, user = &apos;user1&apos;, pw = &apos;Root123&apos;, db = &apos;monitor&apos;) class index: def GET(self): servers=db.select(&apos;servers&apos;) return render.index(servers) if __name__ == &quot;__main__&quot;: app = web.application(urls,globals()) app.run() &#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x6A21;&#x7248;&#x76EE;&#x5F55;templates&#xFF0C;&#x5728;&#x8BE5;&#x76EE;&#x5F55;&#x4E0B;&#x65B0;&#x5EFA;index.html 1234567891011121314151617181920212223242526272829303132333435$def with(servers)&lt; !DOCTYPE html&gt;&lt;html&gt; &lt;head&gt; &lt;meta http-equiv=&apos;Content-Type&apos; content=&apos;text/html; charset=utf-8&apos; /&gt; &lt;title&gt;my servers&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;span&gt; &lt;h2&gt;My servers&lt;/h2&gt; &lt;/span&gt; &lt;table border=&apos;1&apos;&gt; &lt;tr&gt; &lt;th&gt;id&lt;/th&gt; &lt;th&gt;hostname&lt;/th&gt; &lt;th&gt;ip&lt;/th&gt; &lt;th&gt;rootpartion&lt;/th&gt; &lt;th&gt;uptime&lt;/th&gt; &lt;th&gt;time&lt;/th&gt; &lt;/tr&gt; $for server in servers: &lt;tr&gt; &lt;td&gt;$server.id&lt;/td&gt; &lt;td&gt;$server.hostname&lt;/td&gt; &lt;td&gt;$server.ip&lt;/td&gt; &lt;td&gt;$server.rootpartion&lt;/td&gt; &lt;td&gt;$server.uptime&lt;/td&gt; &lt;td&gt;$server.time&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;/body&gt;&lt;/html&gt; &#x662F;&#x4E0D;&#x662F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x52A0;&#x8D77;&#x6765;&#x8FD8;&#x4E0D;&#x5230;100&#x884C;&#x7684;&#x4EE3;&#x7801;^_^ &#x542F;&#x52A8;web&#x670D;&#x52A1;: 1python code.py &#x9ED8;&#x8BA4;&#x542F;&#x52A8;&#x5728;8080&#x7AEF;&#x53E3;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x60F3;&#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x7AEF;&#x53E3;&#xFF0C;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#xFF1A; 1python code.py 1234 &#x5982;&#x679C;&#x63D0;&#x793A;ImportError: No module named MySQLdb&#xFF0C;&#x8868;&#x793A;&#x6CA1;&#x6709;&#x5B89;&#x88C5;MySQLdb&#x6A21;&#x5757;&#xFF0C;&#x4F7F;&#x7528;apt-get&#x5B89;&#x88C5;&#x4E0B;&#x5C31;&#x884C;&#x4E86;&#xFF1A; 1apt-get install python-mysqldb &#x6700;&#x540E;&#x4F7F;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x8BBF;&#x95EE;&#xFF0C;&#x6548;&#x679C;&#x5982;&#x4E0B;&#xFF1A; &#x914D;&#x5408;css&#x6837;&#x5F0F;&#x8868;&#xFF0C;&#x53EF;&#x4EE5;&#x505A;&#x51FA;&#x6F02;&#x4EAE;&#x7684;&#x754C;&#x9762;&#xFF0C;&#x4EE5;&#x4E0B;&#x622A;&#x56FE;&#x662F;&#x672C;&#x4EBA;&#x90E8;&#x5206;&#x670D;&#x52A1;&#x5668;&#x7684;&#x76D1;&#x63A7;&#x754C;&#x9762;&#x3002;&#x6B63;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#x7684;&#x76D1;&#x63A7;&#x6570;&#x636E;&#x662F;&#x7EFF;&#x8272;&#x80CC;&#x666F;&#xFF0C;&#x5982;&#x679C;&#x8D85;&#x8FC7;&#x4E86;&#x9600;&#x503C;&#x5219;&#x53D8;&#x6210;&#x7EA2;&#x8272;&#xFF1B;&#x70B9;&#x51FB;&#x76D1;&#x63A7;&#x9879;&#x76EE;&#x540D;&#x53EF;&#x4EE5;&#x6309;&#x5927;&#x5C0F;&#x6392;&#x5E8F;&#xFF1A; ==========================================================20130715&#xFF0C;php&#x7248;&#xFF1A; 1234567891011121314151617181920212223242526272829303132333435363738&lt;html&gt; &lt;head&gt; &lt;meta http-equiv=&apos;Content-Type&apos; content=&apos;text/html; charset=utf-8&apos; /&gt; &lt;title&gt;my servers&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;h2&gt;My servers&lt;/h2&gt; &lt;table border=&apos;1&apos;&gt; &lt;tr&gt; &lt;th&gt;id&lt;/th&gt; &lt;th&gt;hostname&lt;/th&gt; &lt;th&gt;ip&lt;/th&gt; &lt;th&gt;rootpartion&lt;/th&gt; &lt;th&gt;uptime&lt;/th&gt; &lt;th&gt;time&lt;/th&gt; &lt;/tr&gt; &lt; ?php //1&#x3001;&#x8FDE;&#x63A5;&#x5E76;&#x9009;&#x62E9;&#x6570;&#x636E;&#x5E93; $link=@mysql_connect(&quot;127.0.0.1&quot;,&quot;user1&quot;,&quot;Root123&quot;) or die(&quot;&#x8FDE;&#x63A5;&#x6570;&#x636E;&#x5E93;&#x5931;&#x8D25;&quot;); mysql_select_db(&quot;monitor&quot;,$link); //2&#x3001;&#x6784;&#x9020;sql&#x8BED;&#x53E5;&#x5E76;&#x6267;&#x884C;&#xFF0C;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x96C6; $sql=&quot;select * from servers&quot;; $res=mysql_query($sql,$link); //3&#x3001;&#x904D;&#x5386;&#x89E3;&#x6790;&#x7ED3;&#x679C;&#x96C6; while($rows=mysql_fetch_assoc($res)){ echo &quot;&lt;tr&gt;&quot;; echo &quot;&lt;td&gt;${rows[&apos;id&apos;]}&lt;/td&gt;&quot;; echo &quot;&lt;td&gt;${rows[&apos;hostname&apos;]}&lt;/td&gt;&quot;; echo &quot;&lt;td&gt;${rows[&apos;ip&apos;]}&lt;/td&gt;&quot;; echo &quot;&lt;td&gt;${rows[&apos;rootpartion&apos;]}&lt;/td&gt;&quot;; echo &quot;&lt;td&gt;${rows[&apos;uptime&apos;]}&lt;/td&gt;&quot;; echo &quot;&lt;td&gt;${rows[&apos;time&apos;]}&lt;/td&gt;&quot;; echo &quot;&quot;; } ?&gt; &lt;/table&gt; &lt;/body&gt;&lt;/html&gt; &#x53C2;&#x8003;&#x7B80;&#x660E;python&#x6559;&#x7A0B;http://webpy.org/]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>dev</tag>
        <tag>monitor</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[开发自己的监控系统一、email篇]]></title>
    <url>%2F2013%2F05%2F19%2F%E5%BC%80%E5%8F%91%E8%87%AA%E5%B7%B1%E7%9A%84%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%E4%B8%80%E3%80%81email%E7%AF%87%2F</url>
    <content type="text"><![CDATA[&#x524D;&#x8A00;&#x968F;&#x7740;&#x7EF4;&#x62A4;&#x670D;&#x52A1;&#x5668;&#x91CF;&#x7684;&#x589E;&#x591A;&#xFF0C;&#x8D8A;&#x6765;&#x8D8A;&#x89C9;&#x5F97;&#x76D1;&#x63A7;&#x7684;&#x91CD;&#x8981;&#x6027;&#x3002;&#x76D1;&#x63A7;&#xFF0C;&#x5C31;&#x662F;&#x8FD0;&#x7EF4;&#x4EBA;&#x5458;&#x7684;&#x773C;&#x775B;&#xFF0C;&#x6CA1;&#x6709;&#x4E86;&#x76D1;&#x63A7;&#xFF0C;&#x4F60;&#x4E0D;&#x77E5;&#x9053;&#x78C1;&#x76D8;&#x662F;&#x5426;&#x6EE1;&#x4E86;&#xFF0C;&#x7F51;&#x7EDC;&#x6D41;&#x91CF;&#x662F;&#x5426;&#x8D85;&#x6807;&#xFF0C;&#x751A;&#x81F3;&#x670D;&#x52A1;&#x5668;&#x662F;&#x5426;&#x5B95;&#x673A;&#x3002;&#x76D1;&#x63A7;&#x7684;&#x91CD;&#x8981;&#x6027;&#x4E0D;&#x8A00;&#x800C;&#x55BB;&#x3002;&#x5E02;&#x9762;&#x4E0A;&#x7684;&#x76D1;&#x63A7;&#x8F6F;&#x4EF6;&#x4E5F;&#x5F88;&#x591A;&#xFF0C;&#x5982;&#x5546;&#x4E1A;&#x7248;&#x7684;ipmontor&#x3001;opmanager&#xFF0C;&#x514D;&#x8D39;&#x5F00;&#x6E90;&#x7684;nagios&#x3001;cacti&#x7B49;&#x3002;&#x6BCF;&#x4E2A;&#x76D1;&#x63A7;&#x8F6F;&#x4EF6;&#x90FD;&#x6709;&#x5404;&#x81EA;&#x4F18;&#x7F3A;&#x70B9;&#x548C;&#x5E94;&#x7528;&#x573A;&#x666F;&#xFF0C;&#x8FD9;&#x91CC;&#x4E0D;&#x53BB;&#x63A2;&#x8BA8;&#x3002;&#x672C;&#x6587;&#x8981;&#x63A2;&#x8BA8;&#x7684;&#x662F;&#x4ECE;&#x4E00;&#x4E2A;&#x521D;&#x5B66;&#x8005;&#x7684;&#x89D2;&#x5EA6;&#x53BB;&#x6253;&#x9020;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;&#x3002;&#x5171;&#x5206;&#x4E3A;&#x4E09;&#x90E8;&#x5206;&#xFF1A;email&#x7BC7;&#x3001;web&#x7BC7;&#x548C;&#x79FB;&#x52A8;&#x7BC7;&#xFF08;android&#xFF09;&#x3002;&#x597D;&#x4E86;&#xFF0C;&#x4E0D;&#x5E9F;&#x8BDD;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x5F00;&#x59CB;&#x3002; email&#x7BC7;&#x5173;&#x952E;&#x5B57;&#xFF1A;shell&#x3001;email &#x539F;&#x7406;&#x5B9A;&#x65F6;&#x6267;&#x884C;&#x76D1;&#x63A7;&#x811A;&#x672C;&#xFF0C;&#x63D0;&#x53D6;&#x670D;&#x52A1;&#x5668;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#xFF0C;&#x5982;&#x7CFB;&#x7EDF;&#x8D1F;&#x8F7D;&#x3001;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x6216;&#x662F;&#x76F8;&#x5173;&#x670D;&#x52A1;&#x662F;&#x5426;&#x8FD0;&#x884C;&#x7B49;&#xFF0C;&#x53EA;&#x8981;&#x6709;&#x4E00;&#x9879;&#x5F02;&#x5E38;&#xFF0C;&#x5373;&#x9A6C;&#x4E0A;&#x53D1;&#x9001;&#x90AE;&#x4EF6;&#x8B66;&#x62A5;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x811A;&#x672C;&#x5185;&#x5BB9;&#xFF08;&#x7531;&#x4E8E;&#x53EA;&#x662F;&#x4E2A;&#x4E8B;&#x4F8B;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x8BBE;&#x5B9A;&#x4E86;&#x4E24;&#x4E2A;&#x76D1;&#x63A7;&#x9879;&#x76EE;&#xFF0C;&#x5927;&#x5BB6;&#x6839;&#x636E;&#x81EA;&#x5DF1;&#x7684;&#x9700;&#x6C42;&#x589E;&#x51CF;&#x76D1;&#x63A7;&#x9879;&#x76EE;&#xFF09;&#x3002; 1234567891011121314151617181920212223242526272829303132#!/bin/bash#Server status monitor#by caishzh 2013 #&#x521D;&#x59CB;&#x5316;&#x53D8;&#x91CF;&#x53CA;&#x8BBE;&#x7F6E;&#x9600;&#x503C;DIR=&quot;/root/tool&quot;NOW=$(date &quot;+%F %T&quot;)&amp;gt;${DIR}/messages.txt #&#x5148;&#x6E05;&#x7A7A;messages.txt&#x91CC;&#x7684;&#x5185;&#x5BB9; ADMIN=&quot;xxx@qq.com&quot; #&#x90AE;&#x7BB1;&#x5730;&#x5740;&#xFF0C;&#x7528;&#x4E8E;&#x63A5;&#x6536;&#x8B66;&#x62A5;&#x90AE;&#x4EF6;HOSTNAME=&quot;Server1&quot;IP=$(ifconfig eth0|grep &apos;inet addr&apos;|sed &apos;s/.*addr:\(.*\) Bcast:.*/\1/&apos;) UPTIME_MAX=3 #&#x7CFB;&#x7EDF;&#x8D1F;&#x8F7D;DISK_MAX=90 #&#x78C1;&#x76D8;&#x4F7F;&#x7528;&#x7387; #&#x7CFB;&#x7EDF;&#x8D1F;&#x8F7D;UPTIME=$(uptime|sed &apos;s/^.*age: \(.*\)$/\1/&apos;)UPTIME_NOW=$(echo $UPTIME|awk -F&apos;,&apos; &apos;{print $1}&apos;)if echo &quot;$UPTIME_NOW&amp;gt;$UPTIME_MAX&quot;|bc &amp;gt;/dev/null;then #UPTIME_NOW&#x5305;&#x542B;&#x5C0F;&#x6570;&#xFF0C;&#x800C;test&#x53EA;&#x652F;&#x6301;&#x6574;&#x6570;&#x95F4;&#x7684;&#x6BD4;&#x8F83;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;bc echo &quot;UPTIME: $UPTIME&quot; &amp;gt;&amp;gt;${DIR}/messages.txtfi #&#x6839;&#x5206;&#x533A;DISK=$(df -h|grep /$|awk &apos;{print $5,$2,$4}&apos;)DISK_USAGE=$(echo $DISK|awk &apos;{print $1}&apos;|tr -d &apos;%&apos;)[ &quot;$DISK_USAGE&quot; -ge &quot;$DISK_MAX&quot; ] &amp;amp;&amp;amp; $(echo &quot;DISK: $DISK&quot; &amp;gt;&amp;gt; ${DIR}/messages.txt) #&#x5982;&#x679C;messages.txt&#x6587;&#x4EF6;&#x4E0D;&#x4E3A;&#x7A7A;&#x5219;&#x53D1;&#x9001;&#x8B66;&#x62A5;&#x4FE1;if [ -s ${DIR}/messages.txt ];then mail -s &quot;system monitor: $NOW $IP $HOSTNAME&quot; &quot;$ADMIN&quot; &amp;lt;${DIR}/messages.txtfi &#x5C06;&#x811A;&#x672C;&#x653E;&#x5230;/root/tool&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x7ED9;&#x4E88;&#x6267;&#x884C;&#x6743;&#x9650;&#xFF1A; 1chmod 755 /root/tool/system_monitor.sh &#x653E;&#x5165;crontab&#x4E2D;&#xFF0C;&#x6BCF;3&#x5206;&#x949F;&#x6267;&#x884C;&#x4E00;&#x6B21;&#xFF1A; 1echo &quot;*/3 * * * * root /root/tool/system_monitor.sh&quot; &gt;&gt;/etc/crontab &#x5B9E;&#x9645;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0B;&#x6267;&#x884C;&#x8BE5;&#x811A;&#x672C;&#x540E;&#x6536;&#x5230;&#x7684;&#x8B66;&#x62A5;&#x90AE;&#x4EF6;&#xFF1A; &#x53C2;&#x8003;&#xFF1A; &#x7B80;&#x5355;&#x7684;&#x7CFB;&#x7EDF;&#x76D1;&#x63A7;&#x811A;&#x672C;&#x9E1F;&#x54E5;&#x7684;linux&#x79C1;&#x623F;&#x83DC;&#x2013;&#x5B66;&#x4E60;shell scripts]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>shell</tag>
        <tag>dev</tag>
        <tag>monitor</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[脚本实现实时显示linux网络流量]]></title>
    <url>%2F2012%2F10%2F30%2F%E8%84%9A%E6%9C%AC%E5%AE%9E%E7%8E%B0%E5%AE%9E%E6%97%B6%E6%98%BE%E7%A4%BAlinux%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%2F</url>
    <content type="text"><![CDATA[vim flow.sh 1234567891011121314151617181920212223242526272829303132#!/bin/bash#caishzh 20121030#displays the current Traffic ETH=$1ETH=${ETH:-eth0}IP=`ifconfig $ETH|awk -F &apos;[ :]+&apos; &apos;/inet addr/{print $4}&apos;` while true;do let I+=1 NOW=`date +&quot;%F %T&quot;` TX1=`grep $ETH /proc/net/dev | tr : &quot; &quot; | awk &apos;{print $10}&apos;` RX1=`grep $ETH /proc/net/dev | tr : &quot; &quot; | awk &apos;{print $2}&apos;` sleep 1 TX2=`grep $ETH /proc/net/dev | tr : &quot; &quot; | awk &apos;{print $10}&apos;` RX2=`grep $ETH /proc/net/dev | tr : &quot; &quot; | awk &apos;{print $2}&apos;` let TX=(TX2-TX1)/1024 let RX=(RX2-RX1)/1024 let TX_TOTAL+=$TX let RX_TOTAL+=$RX let TX_AVERAGE=TX_TOTAL/${I} let RX_AVERAGE=RX_TOTAL/${I} clear printf &quot;%10s\t%20s\n&quot; &quot;Device $ETH [$IP]&quot; &quot;$NOW&quot; echo &quot;=============================================================&quot; printf &quot;%10s\t%20s\t%20s\n&quot; CURRENT: in:${RX}KB/s out:${TX}KB/s printf &quot;%10s\t%20s\t%20s\n&quot; AVERAGE: in:${RX_AVERAGE}KB/s out:${TX_AVERAGE}KB/s printf &quot;%10s\t%20s\t%20s\n&quot; TOTAL: in:${RX_TOTAL}KB out:${TX_TOTAL}KBdone &#x811A;&#x672C;&#x9ED8;&#x8BA4;&#x663E;&#x793A;eth0&#x7684;&#x6D41;&#x91CF;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x663E;&#x793A;&#x5176;&#x5B83;&#x7F51;&#x5361;&#x7684;&#x6D41;&#x91CF;&#xFF0C;&#x8BF7;&#x5728;&#x811A;&#x672C;&#x540E;&#x63A5;&#x7F51;&#x5361;&#x540D;&#xFF0C;&#x5982;&#xFF1A;./flow.sh eth1 &#x53E6;&#x4E00;&#x4E2A;&#x7248;&#x672C;&#xFF0C;&#x5C31;&#x662F;&#x6539;&#x4E86;&#x4E0B;&#x663E;&#x793A;&#x7684;&#x65B9;&#x5F0F;&#xFF1A; 123456789101112131415161718192021222324252627#!/bin/bash#caishzh 20130311 version 2#displays the current Traffic LANG=CETH=$1ETH=${ETH:-eth0}IP=`ifconfig $ETH|awk -F &apos;[ :]+&apos; &apos;/inet addr/{print $4}&apos;` while true;do let I+=1 NOW=`date +&quot;%F %T&quot;` TX1=`grep $ETH /proc/net/dev | tr : &quot; &quot; | awk &apos;{print $10}&apos;` RX1=`grep $ETH /proc/net/dev | tr : &quot; &quot; | awk &apos;{print $2}&apos;` sleep 1 TX2=`grep $ETH /proc/net/dev | tr : &quot; &quot; | awk &apos;{print $10}&apos;` RX2=`grep $ETH /proc/net/dev | tr : &quot; &quot; | awk &apos;{print $2}&apos;` let TX=(TX2-TX1)/1024 let RX=(RX2-RX1)/1024 let TX_TOTAL+=$TX let RX_TOTAL+=$RX let TX_AVERAGE=TX_TOTAL/${I} let RX_AVERAGE=RX_TOTAL/${I} printf &quot;%s \t %30s \t %30s \t %30s\n&quot; &quot;$NOW&quot; &quot;CURRENT: in:${RX}KB/s out:${TX}KB/s&quot; &quot;AVERAGE: in:${RX_AVERAGE}KB/s out:${TX_AVERAGE}KB/s&quot; &quot;TOTAL: in:${RX_TOTAL}KB out:${TX_TOTAL}KB&quot;done]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CentOS（RHEL）使用光盘源]]></title>
    <url>%2F2012%2F09%2F07%2FCentOS%EF%BC%88RHEL%EF%BC%89%E4%BD%BF%E7%94%A8%E5%85%89%E7%9B%98%E6%BA%90%2F</url>
    <content type="text"><![CDATA[CentOS&#x7684;yum&#x6E90;&#x662F;&#x5728;/etc/yum.repos.d/&#x76EE;&#x5F55;&#x4E0B;&#x7684;&#x4E24;&#x4E2A;&#x6587;&#x4EF6;&#x4E2D;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x7684;&#xFF0C;CentOS-Base.repo&#x548C;CentOS-Media.repo&#x3002;&#x5176;&#x4E2D;&#xFF0C;CentOS-Base.repo&#x662F;&#x914D;&#x7F6E;&#x7F51;&#x7EDC;yum&#x6E90;&#xFF0C;CentOS-Media.repo&#x662F;&#x914D;&#x7F6E;&#x672C;&#x5730;yum&#x6E90;&#x3002; &#x5982;&#x679C;&#x8981;&#x5728;&#x6CA1;&#x6709;&#x7F51;&#x7EDC;&#x7684;&#x73AF;&#x5883;&#x4E0B;&#x5B89;&#x88C5;rpm&#x5305;&#xFF0C;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x672C;&#x5730;&#x5149;&#x76D8;&#x6E90;&#x6765;&#x89E3;&#x51B3;&#x3002; &#x521B;&#x5EFA;&#x6302;&#x8F7D;&#x76EE;&#x5F55;&#x5E76;&#x6302;&#x8F7D;&#x5149;&#x76D8;12[root@vps ~]# cd /[root@vps /]# mkdir centos_dvd &#x76F4;&#x63A5;&#x5C06;&#x5149;&#x76D8;&#x6302;&#x8F7D;&#x5230;&#x8BE5;&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x6216;&#x8005;&#x5C06;centos&#x7684;dvd&#x955C;&#x50CF;&#x89E3;&#x538B;&#x5230;&#x8BE5;&#x76EE;&#x5F55;&#x4E0B;&#x90FD;&#x53EF;&#x4EE5;&#xFF0C;&#x672C;&#x4F8B;&#x4EE5;&#x6302;&#x8F7D;&#x4E3A;&#x4F8B;&#xFF1A; 12[root@vps /]# mount /dev/cdrom /centos_dvdmount: block device /dev/cdrom is write-protected, mounting read-only &#x4FEE;&#x6539;&#x6E90;&#x914D;&#x7F6E;&#x6587;&#x4EF6;12345678910[root@vps /]# cd /etc/yum.repos.d[root@vps yum.repos.d]# lltotal 36-rw-r--r-- 1 root root 1926 Feb 25 16:20 CentOS-Base.repo-rw-r--r-- 1 root root 631 Feb 25 16:20 CentOS-Debuginfo.repo-rw-r--r-- 1 root root 626 Feb 25 16:20 CentOS-Media.repo-rw-r--r-- 1 root root 6118 Feb 25 16:20 CentOS-Vault.repo[root@vps yum.repos.d]# mkdir bak[root@vps yum.repos.d]# mv *.repo bak/[root@vps yum.repos.d]# cp bak/CentOS-Media.repo . &#x5BF9;CentOS-Media.repo&#x6587;&#x4EF6;&#x505A;&#x4FEE;&#x6539;&#xFF1A; 123456[root@vps yum.repos.d]# vi CentOS-Media.reponame=centos_dvdbaseurl=file:///centos_dvdgpgcheck=1enabled=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-5 baseurl&#x662F;&#x672C;&#x5730;yum&#x6E90;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x8FD9;&#x91CC;&#x662F;&#x5149;&#x76D8;&#x6302;&#x5728;&#x76EE;&#x5F55;&#xFF0C;&#x5177;&#x4F53;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x81EA;&#x5DF1;&#x7CFB;&#x7EDF;&#x4FEE;&#x6539;&#x3002; &#x6E05;&#x9664;&#x65E7;&#x7684;yum&#x6570;&#x636E;&#xFF1A;1[root@vps yum.repos.d]# yum clean all &#x63A5;&#x4E0B;&#x6765;&#x53EF;&#x4EE5;&#x5B89;&#x88C5;&#x9700;&#x8981;&#x7684;&#x8F6F;&#x4EF6;&#xFF1A; 1[root@vps yum.repos.d]# yum install httpd]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[shell算数运算方法总结]]></title>
    <url>%2F2012%2F08%2F20%2Fshell%E7%AE%97%E6%95%B0%E8%BF%90%E7%AE%97%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[expr &#x8868;&#x8FBE;&#x5F0F;expr&#x53EA;&#x80FD;&#x7528;&#x4E8E;&#x4E00;&#x5143;&#x64CD;&#x4F5C;&#x7B26;,&#x4E0D;&#x652F;&#x6301;&#x4E8C;&#x5143;&#x64CD;&#x4F5C;&#x7B26; 12x=1x=$(expr $x + 1) $x + 1&#x4E4B;&#x95F4;&#x5FC5;&#x987B;&#x6709;&#x7A7A;&#x683C; let &#x8868;&#x8FBE;&#x5F0F;1234x=10let x=$x+1let x+=1let x*=10 &#x4F7F;&#x7528;$((&#x8868;&#x8FBE;&#x5F0F;))1x=$((4+5)) &#x4F7F;&#x7528;$[ ]&#x5F62;&#x5F0F;1x=$[ 4 + 5 ] &#x4F7F;&#x7528;decalare123decare -i numnum=$num+1echo $num]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[使用mail命令发送邮件]]></title>
    <url>%2F2012%2F08%2F14%2F%E4%BD%BF%E7%94%A8mail%E5%91%BD%E4%BB%A4%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6%2F</url>
    <content type="text"><![CDATA[1&#x3001;&#x4F7F;&#x7528;shell&#x5F53;&#x7F16;&#x8F91;&#x5668; 123mail -s &quot;hi,this is a test by shell&quot; m@cszhi.comhellowelcome to www.cszhi.com -s&#x540E;&#x9762;&#x63A5;&#x90AE;&#x4EF6;&#x7684;&#x4E3B;&#x9898;&#xFF0C;m@cszhi.com&#x662F;&#x90AE;&#x4EF6;&#x7684;&#x63A5;&#x6536;&#x4EBA;&#xFF0C;&#x8F93;&#x5165;&#x5B8C;&#x8FD9;&#x884C;&#x547D;&#x4EE4;&#x540E;&#x56DE;&#x8F66;&#xFF0C;&#x4F1A;&#x8FDB;&#x5165;&#x90AE;&#x4EF6;&#x6B63;&#x6587;&#x7684;&#x7F16;&#x5199;&#x3002;&#x5F53;&#x90AE;&#x4EF6;&#x6B63;&#x6587;&#x8F93;&#x5165;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x6309;CTRL+D&#x7ED3;&#x675F;&#x8F93;&#x5165;&#xFF0C;&#x90AE;&#x4EF6;&#x5C31;&#x53D1;&#x9001;&#x51FA;&#x53BB;&#x4E86;&#x3002; 2&#x3001;&#x4F7F;&#x7528;&#x7BA1;&#x9053;&#x53D1;&#x9001;&#x90AE;&#x4EF6; 1echo &quot;hello,welcome to www.cszhi.com&quot; | mail -s &quot;hi,this is a test by pipe&quot; m@cszhi.com &#x4F7F;&#x7528;&#x7BA1;&#x9053;&#x76F4;&#x63A5;&#x6572;&#x5165;&#x8FD9;&#x884C;&#x547D;&#x4EE4;&#x5373;&#x53EF;&#x5B8C;&#x6210;&#x90AE;&#x4EF6;&#x7684;&#x53D1;&#x9001;&#xFF0C;echo&#x540E;&#x9762;&#x63A5;&#x7684;&#x662F;&#x90AE;&#x4EF6;&#x6B63;&#x6587; 3&#x3001;&#x4F7F;&#x7528;&#x6587;&#x4EF6;&#x4F5C;&#x4E3A;&#x90AE;&#x4EF6;&#x5185;&#x5BB9; 1mail -s &quot;hi,this is a test by file&quot; m@cszhi.com &lt;content.txt &#x4E0A;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x628A;content.txt&#x6587;&#x4EF6;&#x7684;&#x5185;&#x5BB9;&#x4F5C;&#x4E3A;&#x90AE;&#x4EF6;&#x7684;&#x5185;&#x5BB9;&#x53D1;&#x9001;&#x7ED9;m@cszhi.com&#x4E86;&#x3002; &#x56E0;&#x4E3A;mail&#x7A0B;&#x5E8F;&#x672C;&#x8EAB;&#x5C31;&#x662F;&#x8C03;&#x7528;sendmail&#x6765;&#x8FDB;&#x884C;&#x90AE;&#x4EF6;&#x53D1;&#x9001;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;mail&#x547D;&#x4EE4;&#x4E2D;&#x4F7F;&#x7528;sendmail&#x7684;&#x53C2;&#x6570;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x60F3;&#x4F7F;&#x7528;&#x7279;&#x5B9A;&#x7684;&#x53D1;&#x4EF6;&#x4EBA;&#x53D1;&#x9001;&#x90AE;&#x4EF6;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x547D;&#x4EE4;&#xFF1A; 1mail -s &quot;this is a test &quot; m@cszhi.com -- -f user@cszhi.com &lt;content.txt &#x4E0A;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E86;&#x2013; -f user@cszhi.com&#x8FD9;&#x6837;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x8FD9;&#x662F;sendmail&#x7684;&#x9009;&#x9879;&#xFF0C;&#x5176;&#x4E2D;-f&#x8868;&#x793A;&#x90AE;&#x4EF6;&#x7684;&#x53D1;&#x9001;&#x4EBA;&#x90AE;&#x4EF6;&#x5730;&#x5740;&#x3002; 4&#x3001;&#x53D1;&#x9001;&#x5305;&#x542B;&#x9644;&#x4EF6;&#x7684;&#x90AE;&#x4EF6;&#x73B0;&#x5728;&#x7684;&#x90AE;&#x7BB1;&#x52A8;&#x8F84;&#x597D;&#x51E0;&#x4E2A;G&#xFF0C;&#x53EF;&#x4EE5;&#x63A5;&#x6536;&#x7684;&#x9644;&#x4EF6;&#x4E5F;&#x8D8A;&#x6765;&#x8D8A;&#x5927;&#xFF0C;&#x7528;&#x6765;&#x5907;&#x4EFD;&#x4E00;&#x4E9B;&#x5C0F;&#x578B;&#x6570;&#x636E;&#x8FD8;&#x662F;&#x86EE;&#x4E0D;&#x9519;&#x7684;&#x3002;&#x4F7F;&#x7528;mail&#x547D;&#x4EE4;&#x53D1;&#x9001;&#x5E26;&#x9644;&#x4EF6;&#x7684;&#x90AE;&#x4EF6;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4E0D;&#x8FC7;&#x9700;&#x8981;&#x5148;&#x5B89;&#x88C5;uuencode&#x8F6F;&#x4EF6;&#x5305;&#xFF0C;&#x8FD9;&#x4E2A;&#x7A0B;&#x5E8F;&#x662F;&#x5BF9;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x7F16;&#x7801;&#x4F7F;&#x5176;&#x9002;&#x5408;&#x901A;&#x8FC7;&#x90AE;&#x4EF6;&#x8FDB;&#x884C;&#x53D1;&#x9001;&#xFF1A; 1yum install sharutils &#x5B89;&#x88C5;&#x5B8C;&#x6210;&#x540E;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x6765;&#x8FDB;&#x884C;&#x9644;&#x4EF6;&#x7684;&#x53D1;&#x9001;&#x4E86;&#xFF0C;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x547D;&#x4EE4;&#xFF1A; 1uuencode test.txt test | mail -s &quot;hello,see the attachement&quot; m@cszhi.com &lt;content.txt &#x5B8C;&#x6210;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x628A;text.txt&#x6587;&#x4EF6;&#x4F5C;&#x4E3A;&#x90AE;&#x4EF6;&#x7684;&#x9644;&#x4EF6;&#x53D1;&#x9001;&#x51FA;&#x53BB;&#x4E86;&#x3002;uuencode&#x6709;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x662F;&#x8981;&#x53D1;&#x9001;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x662F;&#x663E;&#x793A;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x79F0;&#x3002; &#x53E6;&#x5916;,&#x5728;centos 6.0&#x4E0A;&#x7684;mail&#x5DF2;&#x7ECF;&#x6709;&#x4E00;&#x4E2A;-a&#x53C2;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x6DFB;&#x52A0;&#x9644;&#x4EF6;&#xFF1A; 1echo &quot;hello,see the test.txt&quot; |mail -a test.txt -s &quot;helo&quot; m@cszhi.com]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[生产环境常见的HTTP状态码列表]]></title>
    <url>%2F2012%2F08%2F03%2F%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E5%B8%B8%E8%A7%81%E7%9A%84HTTP%E7%8A%B6%E6%80%81%E7%A0%81%E5%88%97%E8%A1%A8%2F</url>
    <content type="text"><![CDATA[200 &#x2013; OK&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x6210;&#x529F;&#x8FD4;&#x56DE;&#x7F51;&#x9875;&#x2013; Standard response for successful HTTP requests. 301 &#x2013; Moved Permanently&#xFF08;&#x6C38;&#x4E45;&#x8DF3;&#x8F6C;&#xFF09;&#xFF0C;&#x8BF7;&#x6C42;&#x7684;&#x7F51;&#x9875;&#x5DF2;&#x6C38;&#x4E45;&#x8DF3;&#x8F6C;&#x5230;&#x65B0;&#x4F4D;&#x7F6E;&#x3002;&#x2013; This and all future requests should be directed to the given. 403 &#x2013; Forbidden&#xFF08;&#x7981;&#x6B62;&#x8BBF;&#x95EE;&#xFF09;,&#x670D;&#x52A1;&#x5668;&#x62D2;&#x7EDD;&#x8BF7;&#x6C42;&#x2013; forbidden request (matches a deny filter) =&gt; HTTP 403&#x2013; The request was a legal request, but the server is refusing to respond to it. 404 &#x2013; Not Found,&#x670D;&#x52A1;&#x5668;&#x627E;&#x4E0D;&#x5230;&#x8BF7;&#x6C42;&#x7684;&#x9875;&#x9762;&#x3002;&#x2013; The requested resource could not be found but may be available again in the future. 500 &#x2013; Internal Server Error&#xFF08;&#x5185;&#x90E8;&#x670D;&#x52A1;&#x5668;&#x9519;&#x8BEF;&#xFF09;&#x2013; internal error in haproxy =&gt; HTTP 500&#x2013; A generic error message, given when no more specific message is suitable. 502 &#x2013; Bad Gateway&#xFF08;&#x574F;&#x7684;&#x7F51;&#x5173;&#xFF09;,&#x4E00;&#x822C;&#x662F;&#x7F51;&#x5173;&#x670D;&#x52A1;&#x5668;&#x8BF7;&#x6C42;&#x540E;&#x7AEF;&#x670D;&#x52A1;&#x65F6;&#xFF0C;&#x540E;&#x7AEF;&#x670D;&#x52A1;&#x6CA1;&#x6709;&#x6309;&#x7167;http&#x534F;&#x8BAE;&#x6B63;&#x786E;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x3002;&#x2013; the server returned an invalid or incomplete response =&gt; HTTP 502&#x2013; The server was acting as a gateway or proxy and received an invalid response from the upstream server. 503 &#x2013; Service Unavailable&#xFF08;&#x670D;&#x52A1;&#x5F53;&#x524D;&#x4E0D;&#x53EF;&#x7528;&#xFF09;,&#x53EF;&#x80FD;&#x56E0;&#x4E3A;&#x8D85;&#x8F7D;&#x6216;&#x505C;&#x673A;&#x7EF4;&#x62A4;&#x3002;&#x2013; no server was available to handle the request =&gt; HTTP 503&#x2013; The server is currently unavailable (because it is overloaded or down for maintenance). 504 &#x2013; Gateway Timeout&#xFF08;&#x7F51;&#x5173;&#x8D85;&#x65F6;&#xFF09;,&#x4E00;&#x822C;&#x662F;&#x7F51;&#x5173;&#x670D;&#x52A1;&#x5668;&#x8BF7;&#x6C42;&#x540E;&#x7AEF;&#x670D;&#x52A1;&#x65F6;&#xFF0C;&#x540E;&#x7AEF;&#x670D;&#x52A1;&#x6CA1;&#x6709;&#x5728;&#x7279;&#x5B9A;&#x7684;&#x65F6;&#x95F4;&#x5185;&#x5B8C;&#x6210;&#x670D;&#x52A1;&#x3002;&#x2013; the server failed to reply in time =&gt; HTTP 504&#x2013; The server was acting as a gateway or proxy and did not receive a timely response from the upstream server &#x6765;&#x81EA;&#xFF1A;http://oldboy.blog.51cto.com/2561410/716294]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>http</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[工作中常用的shell命令]]></title>
    <url>%2F2012%2F06%2F25%2F%E5%B7%A5%E4%BD%9C%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%9A%84shell%E5%91%BD%E4%BB%A4%2F</url>
    <content type="text"><![CDATA[&#x5217;&#x51FA;&#x6240;&#x6709; ESTABLISHED &#x72B6;&#x6001;&#x7684;&#x8FDE;&#x63A5;&#xFF1A; 1netstat -nta | fgrep &quot;ESTABLISHED&quot; | cut -b 49-75 | cut -d &apos;:&apos; -f1 | sort | uniq -c | sort -n -r --key=1,7 | head -25 &#x5217;&#x51FA;&#x6240;&#x6709;&#x8FDE;&#x63A5;&#x72B6;&#x6001;&#x7684;&#x7EDF;&#x8BA1;&#xFF1A; 1netstat -nta | fgrep &quot;:&quot; | cut -b 77-90 | sort | uniq -c &#x6216; 1netstat -n | awk &apos;/^tcp/ {++S[$NF]} END {for(a in S) print a, S[a]}&apos; &#x7B80;&#x5355;&#x5C06;&#x653B;&#x51FB;IP&#x5217;&#x5165;iptables &#x9650;&#x5236;&#x8303;&#x56F4;&#xFF1A; 1netstat -an | grep -v LISTEN | awk &apos;{print $5}&apos; |grep -v 127.0.0.1|grep -v &#x672C;&#x673A;ip|sed &quot;s/::ffff://g&quot;|awk &apos;BEGIN { FS=&quot;:&quot; } { Num[$1]++ } END { for(i in Num) if(Num[i]&gt;8) { print i} }&apos; |grep &apos;[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}&apos;| xargs -i[] iptables -I INPUT -s [] -j DROP Num[i]&gt;8&#x90E8;&#x5206;&#x662F;&#x8BBE;&#x7F6E;&#x9600;&#x503C;&#xFF0C;&#x8FD9;&#x6761;shell&#x53E5;&#x5B50;&#x4F1A;&#x81EA;&#x52A8;&#x5C06;netstat -an&#x4E2D;&#x67E5;&#x5230;&#x7684;&#x6765;&#x81EA;&#x540C;&#x4E00;ip&#x7684;&#x8D85;&#x8FC7;&#x9600;&#x503C;&#x7684;&#x8FDE;&#x63A5;&#x7684;&#x5217;&#x5165;iptables&#x7981;&#x6B62;&#x5C06;&#x547D;&#x4EE4;&#x4E2D;&#x7684;&#x201C;&#x672C;&#x673A;ip&#x201D;&#x6539;&#x6210;&#x4F60;&#x7684;&#x670D;&#x52A1;&#x5668;&#x7684;ip&#x5730;&#x5740; &#x4E00;&#x4E2A;ip&#x9650;&#x5236;30&#x4E2A;pop&#x8FDE;&#x63A5;&#xFF1A; 1iptables -I INPUT -p tcp --syn --dport 110 -m connlimit --connlimit-above 30 -j REJECT &#x5C06;192.168.4.139&#x4E0A;&#x7684;/data0&#x76EE;&#x5F55;&#x540C;&#x6B65;&#x5230;&#x672C;&#x673A;&#xFF1A; 1rsync -avLP -e &apos;ssh&apos; --delete 192.168.4.139:/data0 / 1&gt;&gt;/opt/out.txt 2&gt;&gt;/opt/err.txt &#x4FEE;&#x6539;&#x76EE;&#x6807;&#x5730;&#x5740;&#xFF0C;&#x7528;&#x4E8E;&#x5728;&#x9632;&#x706B;&#x5899;&#x540E;&#x7AEF;&#x7684;web&#x670D;&#x52A1;&#x5668;&#xFF08;DNAT&#xFF09;&#xFF1A; 1iptables -t nat -A PREROUTING -p tcp --dport 80 -d $INTERNET_ADDR -j DNAT --to-destination 192.168.100.2:80 &#x5F00;&#x542F;&#x8DEF;&#x7531;&#xFF08;SNAT&#xFF09;&#xFF1A; 12echo &quot;1&quot; &gt; /proc/sys/net/ipv4/ip_forward &#xFF03;&#x5F00;&#x542F;&#x8F6C;&#x53D1;iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o eth1 -j MASQUERADE &#xFF03;eth1&#x662F;&#x516C;&#x7F51;&#x7F51;&#x5361;&#xFF0C;&#x4F7F;&#x7528;&#x4F2A;&#x88C5;MASQUERADE &#x6216; 1iptables -t nat -A POSTROUTING -o eth0 -j SNAT --to-source 199.15.116.12 &#xFF03;&#x4E0D;&#x4F7F;&#x7528;&#x4F2A;&#x88C5;&#xFF0C;&#x4FEE;&#x6539;&#x6E90;&#x5730;&#x5740;&#x4E3A;&#x516C;&#x7F51;&#x5730;&#x5740;199.15.116.12 &#x5C06;&#x516C;&#x94A5;&#x4F20;&#x5230;&#x5176;&#x4ED6;&#x670D;&#x52A1;&#x5668;&#xFF1A; 1ssh-copy-id -i ~/.ssh/id_rsa.pub user@remoteServer &#x83B7;&#x53D6;&#x672C;&#x673A;&#x6240;&#x6709;ip&#x53CA;&#x5176;&#x5BF9;&#x5E94;&#x7684;mac&#x5730;&#x5740;&#xFF1A; 1ifconfig|grep HWaddr -A 1|awk -v RS=&quot;--&quot; &apos;{sub(/addr:/,&quot;&quot;,$7); print $7,$5}&apos; -v&#xFF1A;&#x8D4B;&#x503C;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x53D8;&#x91CF; RS&#xFF1A;&#x8BB0;&#x5F55;&#x5206;&#x9694;&#x7B26;(&#x9ED8;&#x8BA4;&#x662F;&#x4E00;&#x4E2A;&#x6362;&#x884C;&#x7B26;) FS&#xFF1A;&#x5B57;&#x6BB5;&#x5206;&#x9694;&#x7B26;(&#x9ED8;&#x8BA4;&#x662F;&#x4EFB;&#x4F55;&#x7A7A;&#x683C;) NF&#xFF1A; &#x5F53;&#x524D;&#x8BB0;&#x5F55;&#x4E2D;&#x7684;&#x5B57;&#x6BB5;&#x6570; NR&#xFF1A;&#x5F53;&#x524D;&#x8BB0;&#x5F55;&#x6570; sub(/addr:/,&#x201D;&#x201D;,$7)&#xFF1A;&#x5C06;&#x7B2C;7&#x6BB5;&#x4E2D;&#x7684;addr:&#x66FF;&#x6362;&#x6210;&#x7A7A; &#x67E5;&#x627E;&#x5F53;&#x524D;&#x76EE;&#x5F55;&#x4E0B;&#x7684;&#x6240;&#x6709;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x5C06;&#x6587;&#x4EF6;&#x4E2D;&#x7684;cszhi.com&#x66FF;&#x6362;&#x6210;test.cn&#xFF1A; 1find . -type f -exec sed -i &apos;s/cszhi\.com/test\.cn/g&apos; {} \; &#x4E0D;&#x8F6C;&#x4E49;&#x70B9;&#x53F7;&#x4E5F;&#x53EF;&#xFF1A; 1find . -type f -exec sed -i &apos;s/cszhi.com/test.cn/g&apos; {} \; ssh&#x4EA4;&#x4E92;&#x5F0F;&#x767B;&#x9646;&#x811A;&#x672C; 123456789#!/usr/bin/expectset timeout 30spawn ssh 192.168.0.2expect { &quot;yes/no&quot; { send &quot;yes\r&quot;;exp_continue } &quot;password:&quot; { send &quot;redhat\r&quot; }}expect &quot;]#&quot;send &quot;df -h &gt; /tmp/diskfile\r&quot; set timeout 30&#x547D;&#x4EE4;&#x628A;&#x8D85;&#x65F6;&#x65F6;&#x503C;&#x8BBE;&#x5B9A;&#x4E3A;30&#x79D2;spawn&#x547D;&#x4EE4;&#x6FC0;&#x6D3B;&#x4E00;&#x4E2A;Unix&#x7A0B;&#x5E8F;&#x6765;&#x8FDB;&#x884C;&#x4EA4;&#x4E92;&#x5F0F;&#x7684;&#x8FD0;&#x884C;send&#x547D;&#x4EE4;&#x5411;&#x8FDB;&#x7A0B;&#x53D1;&#x9001;&#x5B57;&#x7B26;&#x4E32; &#x540C;&#x6B65;&#x65F6;&#x95F4;&#xFF1A; 1ntpdate -s -b ntp.aliyun.com &#x4E0D;&#x65AD;&#x66F4;&#x65B0;&#x4E2D;&#x3002;&#x3002;&#x3002;&#x3002;&#x3002;&#x3002;]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux监控利器nagios–NSCA被动监控]]></title>
    <url>%2F2012%2F05%2F27%2FLinux%E7%9B%91%E6%8E%A7%E5%88%A9%E5%99%A8nagios%E2%80%93NSCA%E8%A2%AB%E5%8A%A8%E7%9B%91%E6%8E%A7%2F</url>
    <content type="text"><![CDATA[&#x524D;&#x8A00;PS&#xFF1A;&#x5173;&#x4E8E;nagios&#x7684;&#x88AB;&#x52A8;&#x76D1;&#x63A7;&#xFF08;nsca&#xFF09;&#x597D;&#x51E0;&#x4E2A;&#x6708;&#x524D;&#x5C31;&#x60F3;&#x6574;&#x7406;&#x4E86;&#xFF0C;&#x6574;&#x4E86;&#x8FD9;&#x4E48;&#x4E45;&#x624D;&#x6574;&#x5B8C;&#xFF0C;&#x770B;&#x6765;&#x81EA;&#x5DF1;&#x53C8;&#x61D2;&#x6563;&#x4E86;&#x3002;&#x9700;&#x8981;&#x5BFB;&#x627E;&#x4E00;&#x4E9B;&#x52A8;&#x529B;&#x4E86;&#x3002;&#x3002;&#x3002; nagios&#x7684;&#x4E3B;&#x52A8;&#x76D1;&#x63A7;&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x4E0B;&#x4EE5;&#x4E0B;&#x535A;&#x6587;&#xFF0C;&#x535A;&#x4E3B;&#x8BB2;&#x5F97;&#x5F88;&#x8BE6;&#x7EC6;&#xFF1A;nagios&#x5168;&#x653B;&#x7565; &#x4EE5;&#x4E0B;&#x4ECB;&#x7ECD;nagios&#x7684;&#x88AB;&#x52A8;&#x76D1;&#x63A7;NSCA&#xFF1A; &#x968F;&#x7740;&#x670D;&#x52A1;&#x5668;&#x7684;&#x4E0D;&#x65AD;&#x589E;&#x52A0;&#xFF0C;nagios&#x76D1;&#x63A7;&#x673A;&#x5DF2;&#x7ECF;&#x6709;&#x70B9;&#x4E0D;&#x582A;&#x8D1F;&#x91CD;&#xFF0C;&#x6545;&#x5C1D;&#x8BD5;&#x4F7F;&#x7528;&#x88AB;&#x52A8;&#x6A21;&#x5F0F;&#x4EE5;&#x627F;&#x62C5;&#x66F4;&#x5927;&#x7684;&#x76D1;&#x6D4B;&#x91CF;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x63D0;&#x9AD8;&#x4E86;&#x76D1;&#x6D4B;&#x7684;&#x7075;&#x654F;&#x6027;&#x548C;&#x76D1;&#x6D4B;&#x7684;&#x65B9;&#x4FBF;&#x6027;&#x3002; &#x88AB;&#x52A8;&#x6A21;&#x5F0F;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x76F8;&#x6BD4;&#x4E0E;&#x4E3B;&#x52A8;&#x6A21;&#x5F0F;&#x4E2D;&#x670D;&#x52A1;&#x5668;&#x4E3B;&#x52A8;&#x53BB;&#x88AB;&#x76D1;&#x63A7;&#x673A;&#x4E0A;&#x8F6E;&#x8BE2;&#x83B7;&#x53D6;&#x76D1;&#x63A7;&#x6570;&#x636E;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x88AB;&#x52A8;&#x6A21;&#x5F0F;&#x5219;&#x662F;&#x5728;&#x88AB;&#x76D1;&#x63A7;&#x673A;&#x4E0A;&#x9762;&#x901A;&#x8FC7;&#x63D2;&#x4EF6;&#x6216;&#x811A;&#x672C;&#x83B7;&#x53D6;&#x76D1;&#x63A7;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x6570;&#x636E;&#x901A;&#x8FC7;send_nsca&#x53D1;&#x5F80;&#x76D1;&#x63A7;&#x673A;&#xFF0C;&#x6700;&#x540E;&#x76D1;&#x63A7;&#x673A;&#x901A;&#x8FC7;Nsca&#x63A5;&#x6536;&#x5E76;&#x89E3;&#x6790;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x4F20;&#x9012;&#x7ED9;Nagios&#x3002;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x4E00;&#x4E2A;&#x5F88;&#x5927;&#x7684;&#x4F18;&#x52BF;&#x5C31;&#x662F;&#x5C06;&#x9664;&#x53BB;&#x5904;&#x7406;&#x6570;&#x636E;&#x7684;&#x5176;&#x4ED6;&#x5DE5;&#x4F5C;&#x90FD;&#x653E;&#x5728;&#x4E86;&#x88AB;&#x76D1;&#x63A7;&#x673A;&#x4E0A;&#x9762;&#xFF08;&#x5305;&#x62EC;&#x4E86;&#x6570;&#x636E;&#x7684;&#x4F20;&#x8F93;&#xFF09;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x907F;&#x514D;&#x4E86;&#x88AB;&#x76D1;&#x63A7;&#x673A;&#x6570;&#x91CF;&#x5927;&#x65F6;&#xFF0C;&#x4E00;&#x6B21;&#x8F6E;&#x8BE2;&#x65F6;&#x95F4;&#x8FC7;&#x957F;&#x800C;&#x5BFC;&#x81F4;&#x76D1;&#x63A7;&#x53CD;&#x5E94;&#x5EF6;&#x8FDF;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x88AB;&#x52A8;&#x6A21;&#x5F0F;&#x80FD;&#x627F;&#x62C5;&#x66F4;&#x5927;&#x76D1;&#x63A7;&#x91CF;&#x7684;&#x5173;&#x952E; NSCA&#x7531;&#x4E24;&#x4E2A;&#x90E8;&#x5206;&#x7EC4;&#x6210;Nsca &#xFF08;&#x5B89;&#x88C5;&#x5728;MonitorServer&#x4E0A;&#xFF0C;&#x7528;&#x6765;&#x63A5;&#x6536;&#x5E76;&#x89E3;&#x6790;MonitorClient&#x53D1;&#x6765;&#x7684;&#x76D1;&#x63A7;&#x6570;&#x636E;&#xFF0C;&#x4F20;&#x9012;&#x7ED9;nagios&#xFF09;Send_nsca&#xFF08;&#x5B89;&#x88C5;&#x5728;MonitorClient&#x4E0A;&#xFF0C;&#x7528;&#x6765;&#x53D1;&#x9001;&#x76D1;&#x63A7;&#x6570;&#x636E;&#x3002;&#xFF09; &#x8FC7;&#x7A0B;&#x5982;&#x4E0B;&#x5728;MonitorClient&#x4E0A;&#x9762;&#xFF0C;&#x4F7F;&#x7528;nagios-plugins&#x63D0;&#x4F9B;&#x7684;&#x63D2;&#x4EF6;&#xFF0C;&#x5F97;&#x51FA;&#x76D1;&#x63A7;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x6570;&#x636E;&#x5B58;&#x4E3A;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x5229;&#x7528;&#x8F93;&#x5165;&#x91CD;&#x5B9A;&#x5411;&#xFF0C;&#x901A;&#x8FC7;send_nsca&#x5C06;&#x6570;&#x636E;&#x53D1;&#x5F80;MonitorServer&#x3002;MonitorServer&#x4E0A;&#x9762;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;nsca&#x7684;daemon&#xFF08;&#x9ED8;&#x8BA4;&#x5F00;&#x542F;5667&#x7AEF;&#x53E3;&#xFF09;&#xFF0C;&#x7528;&#x6765;&#x63A5;&#x6536;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;&#x505A;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5904;&#x7406;&#xFF08;&#x4F1A;&#x548C;nagios&#x7684;service&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x5BF9;&#x5E94;&#xFF0C;&#x5C06;&#x591A;&#x4F59;&#x7684;&#x76D1;&#x63A7;&#x6570;&#x636E;&#x6392;&#x9664;&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x683C;&#x5F0F;&#x7684;&#x8F6C;&#x6362;&#xFF0C;&#x53D1;&#x7ED9;nagios&#x7684;&#x201C;&#x5916;&#x90E8;&#x547D;&#x4EE4;&#x6587;&#x4EF6;&#x201D;&#xFF08;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x4E3A;&#x201C;/usr/local/nagios/var/rw/nagios.cmd&#x201D;&#x5728;nagios.cfg&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#xFF09;&#x3002;&#x8BE5;&#x6587;&#x4EF6;&#x662F;&#x4E00;&#x4E2A;&#x7BA1;&#x9053;&#x6587;&#x4EF6;&#xFF0C;&#x4E5F;&#x662F;nagios&#x4E3B;&#x7A0B;&#x5E8F;&#x7684;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#xFF08;&#x7528;&#x6765;&#x63A5;&#x6536;&#x76D1;&#x63A7;&#x6570;&#x636E;&#xFF09;&#xFF0C;&#x4F7F;&#x7528;cat&#x67E5;&#x770B;&#x8BE5;&#x6587;&#x4EF6;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x51FA;&#x6765;&#x7ECF;nsca&#x5904;&#x7406;&#x540E;&#x7684;&#x6570;&#x636E;&#x683C;&#x5F0F;&#x3002;&#x7136;&#x540E;nagios&#x4E3B;&#x7A0B;&#x5E8F;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF08;&#x524D;&#x53F0;&#x5C55;&#x793A;&#xFF0C;&#x8B66;&#x62A5;&#xFF09;&#x3002; &#x5B9E;&#x73B0;&#x8FC7;&#x7A0B;&#x914D;&#x7F6E;nagios1&#xFF09;&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6;nagios.cfg 12check_external_commands = 1 &#xFF08;enable commands file&#xFF09;command_check_interval = -1 &#xFF08;check the external command file as often as possible &#xFF09; 2&#xFF09;&#x6DFB;&#x52A0;&#x6A21;&#x677F;&#xFF08;template.cfg&#xFF09; 1234567891011121314define service{ name passive_service use generic-service max_check_attempts 3 active_checks_enabled 0 passive_checks_enabled 1 normal_check_interval 5 retry_check_interval 1 notifications_enabled 1 notification_interval 5 notification_period 24x7 contact_groups admins register 0} 3&#xFF09;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;command 1234define command{ command_name check_dummy command_line /usr/local/nagios/libexec/check_dummy $ARG1$} &#x8BE5;command&#x5BF9;&#x88AB;&#x76D1;&#x63A7;&#x673A;&#x53D1;&#x8FC7;&#x6765;&#x7684;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF0C;check_dummy&#x53EA;&#x80FD;&#x5904;&#x7406;4&#x4E2A;&#x53C2;&#x6570;&#xFF08;0&#x3001;1&#x3001;2&#x3001;&#x5176;&#x4ED6;&#x6570;&#x5B57;&#xFF09; 12345678[root@vps /]# /usr/local/nagios/libexec/check_dummy 0OK[root@vps /]# /usr/local/nagios/libexec/check_dummy 1WARNING[root@vps /]# /usr/local/nagios/libexec/check_dummy 2CRITICAL[root@vps /]# /usr/local/nagios/libexec/check_dummy 55UNKNOWN: Status 55 is not a supported error state 4&#x4E2A;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x4EE3;&#x8868;4&#x79CD;&#x72B6;&#x6001;&#xFF0C;&#x800C;&#x76D1;&#x6D4B;&#x670D;&#x52A1;&#x4E00;&#x822C;&#x53EA;&#x9700;&#x8981;&#x4E24;&#x79CD;&#x72B6;&#x6001;&#xFF08;running&#xFF0C;sotp&#xFF09;&#xFF0C;&#x786C;&#x4EF6;&#x4E09;&#x79CD;&#xFF08;OK warning critical&#xFF09; 4&#xFF09;&#x518D;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x672C;&#x673A;&#x7684;&#x88AB;&#x52A8;&#x76D1;&#x63A7;service&#xFF1A; 1234567define service{ use passive_service host_name localhost #&#x672C;&#x673A;&#x88AB;&#x52A8;&#x76D1;&#x63A7; service_description NSCA check_command check_dummy!0 notifications_enabled 1} &#x4E0B;&#x8F7D;&#x5E76;&#x5B89;&#x88C5;nsca12345wget http://nchc.dl.sourceforge.net/project/nagios/nsca-2.x/nsca-2.9.1/nsca-2.9.1.tar.gztar zxf nsca-2.9.1.tar.gzcd nsca-2.9.1./configuremake all &#x4EE5;&#x4E0A;&#x6B65;&#x9AA4;&#x68C0;&#x67E5;&#x6B63;&#x786E;&#x6267;&#x884C;&#x4EE5;&#x540E;&#xFF1A;1)&#x3001;&#x4F1A;&#x5728;src&#x76EE;&#x5F55;&#x4E0B;&#x751F;&#x6210;&#x4E24;&#x4E2A;&#x7A0B;&#x5E8F; nsca send_nsca&#xFF08;&#x4E3B;&#x7A0B;&#x5E8F;&#xFF09;2)&#x3001;sample-config&#x4E2D;&#x4F1A;&#x6709;nsca.cfg&#x4E0E;send_nsca.cfg&#xFF08;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF09;3)&#x3001;&#x5F53;&#x524D;&#x76EE;&#x5F55;&#x4E0B;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;init-script&#xFF08;&#x542F;&#x52A8;&#x811A;&#x672C;&#xFF09; Nagios&#x76D1;&#x63A7;&#x673A;&#xFF08;MonitorServer&#xFF09;&#x64CD;&#x4F5C;&#xFF1A; 1234567cp src/nsca /usr/local/nagios/bin/cp sample-config/nsca.cfg /usr/local/nagios/etcchown nagios.nagios /usr/local/nagios/bin/nscachown nagios.nagios /usr/local/nagios/etc/nsca.cfgcp init-script /etc/init.d/nscachmod a+x /etc/init.d/nscachkconfig --add nsca &#x81F3;&#x6B64;nsca&#x5B89;&#x88C5;&#x5B8C;&#x6210;&#xFF0C;&#x4E0B;&#x9762;&#x9700;&#x8981;&#x66F4;&#x6539;&#x4E00;&#x4E9B;&#x914D;&#x7F6E;&#x9009;&#x9879;&#xFF1A; &#xFF08;nsca.cfg&#xFF09; 12345server_address=xxx.xxx.xxx.xxx &#xFF08;&#x8FD9;&#x91CC;&#x52A1;&#x5FC5;&#x4F7F;&#x7528;&#x5BF9;&#x5916;&#x8868;&#x73B0;&#x7684;IP&#xFF09;debug=1 &#xFF08;debug&#x9009;&#x9879;&#x5373;log&#x9009;&#x9879;&#xFF0C;&#x5199;&#x5165;message&#xFF09;aggregate_writes=1 &#xFF08;&#x80FD;&#x591F;&#x652F;&#x6301;&#x66F4;&#x5927;&#x7684;&#x76D1;&#x63A7;&#x91CF;&#xFF0C;&#x5EFA;&#x8BAE;&#x5F00;&#x542F;&#xFF09;max_packet_age=60 &#xFF08;&#x6570;&#x636E;&#x5305;&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#xFF0C;&#x9ED8;&#x8BA4;30s&#xFF0C;&#x4F46;&#x662F;&#x8003;&#x8651;&#x5230;&#x7F51;&#x7EDC;&#x56E0;&#x7D20;&#x5EFA;&#x8BAE;&#x8BBE;&#x4E3A;60s&#xFF09;password=xxxxxxx &#xFF08;&#x5BC6;&#x7801;&#xFF0C;&#x6700;&#x57FA;&#x7840;&#x7684;&#x52A0;&#x5BC6;&#x65B9;&#x5F0F;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4E0D;&#x8BBE;&#x7F6E;&#xFF09; &#x68C0;&#x67E5;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x662F;&#x5426;&#x6B63;&#x786E;&#xFF1A;1/usr/local/nagios/bin/nagios -v /usr/local/nagios/etc/nagios.cfg &#x542F;&#x52A8;nagios&#x548C;nsca&#x670D;&#x52A1;12service nagios startservice nsca start &#x6D4B;&#x8BD5;&#x53D1;&#x9001;&#x6570;&#x636E;&#x7ED9;&#x88AB;&#x52A8;&#x76D1;&#x6D4B;&#x670D;&#x52A1;&#xFF1A;1echo &quot;localhost;NSCA;0;testOK&quot;|./send_nsca -H 127.0.0.1 -d &quot;;&quot; -c /root/send_nsca.cfg &#x901A;&#x8FC7;&#x7BA1;&#x9053;&#x5C06;&#x6570;&#x636E;&#x4F20;&#x7ED9;send_nsca&#x7A0B;&#x5E8F;&#xFF0C;send nsca&#x518D;&#x5C06;&#x6570;&#x636E;&#x53D1;&#x9001;&#x5230;nsca&#x670D;&#x52A1;&#xFF0C;&#x5176;&#x4E2D;localhost&#x662F;nsca&#x76D1;&#x542C;&#x7684;&#x4E3B;&#x673A;&#x540D;&#xFF0C;NSCA&#x662F;Nagios&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x88AB;&#x52A8;&#x76D1;&#x6D4B;&#x670D;&#x52A1;&#x7684;&#x540D;&#x5B57;&#xFF0C;0&#x544A;&#x8BC9;nsca&#x6B63;&#x5E38;&#xFF0C;testOK&#x662F;&#x9644;&#x52A0;&#x4FE1;&#x606F;&#xFF0C;&#x5728;web&#x7AEF;&#x7684;&#x663E;&#x793A;&#x5982;&#x4E0B;&#xFF1A; -H 127.0.0.1&#x662F;&#x6570;&#x636E;&#x53D1;&#x5F80;&#x7684;&#x76EE;&#x7684;&#x5730;&#xFF0C;&#x5373;nagios&#x76D1;&#x63A7;&#x673A;&#xFF1B; -d &#x2018;&#xFF1B;&#x2019;&#x662F;&#x6570;&#x636E;&#x7684;&#x5206;&#x9694;&#x7B26;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;[TAB]&#xFF1B; -c /root/send_nsca.cfg&#x662F;send_nsca&#x8FD9;&#x4E2A;&#x53D1;&#x9001;&#x7A0B;&#x5E8F;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002; &#x4E5F;&#x53EF;&#x4EE5;&#x5C06;&#x8981;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#x5199;&#x5165;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x5982;/root/info.txt&#xFF0C;&#x7528;&#x4E0B;&#x9762;&#x547D;&#x4EE4;&#x53D1;&#x9001;&#x6570;&#x636E;&#xFF1A; 1./send_nsca -H 127.0.0.1 -d ; -c /root/send_nsca.cfg &lt; /root/info.txt &#x4E0B;&#x9762;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x88AB;&#x52A8;&#x76D1;&#x63A7;&#x811A;&#x672C;&#xFF1A;1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465#!/bin/bash #&#x521D;&#x59CB;&#x5316;&#x5E76;&#x8BBE;&#x7F6E;&#x9600;&#x503C;HOSTNAME=$(hostname)DIR=/tmp/nsca[ -d &quot;$DIR&quot; ] || mkdir -p $DIR&gt;${DIR}/nsca_messages.txt IP=$(ifconfig eth0|grep &apos;inet addr&apos;|sed &apos;s/.*addr:\(.*\) Bcast:.*/\1/&apos;)HOSTNAME=$(hostname) CPU_MAX=90 #&#x5355;&#x4E2A;&#x8FDB;&#x7A0B;&#x7684;cpu&#x4F7F;&#x7528;&#x7387;UPTIME_MAX=8 #&#x7CFB;&#x7EDF;&#x8D1F;&#x8F7D;DISK_MAX=95 #&#x78C1;&#x76D8;&#x4F7F;&#x7528;&#x7387; #&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;flag&#xFF0C;&#x7528;&#x4E8E;&#x811A;&#x672C;&#x7684;&#x6267;&#x884C;&#x4E0E;&#x5426;&#xFF1B;0&#x6267;&#x884C;&#xFF0C;1&#x4E0D;&#x6267;&#x884C;#FLAG=$(cat /root/tool/flag.txt)#[ $FLAG -eq 1 ] &amp;&amp; { exit 1 } #&#x8FDB;&#x7A0B;&#x5360;&#x7528;cpu&#x60C5;&#x51B5;CPU_MAX_NUM=$(top -n 1 -b|awk &apos;NR&gt;7{if ($10&gt;&quot;&apos;$CPU_MAX&apos;&quot;)print $10}&apos;|wc -l) #&#x7EDF;&#x8BA1;cpu&#x4F7F;&#x7528;&#x7387;&#x8D85;&#x8FC7;90%&#x7684;&#x8FDB;&#x7A0B;&#x6570;if [ &quot;$CPU_MAX_NUM&quot; -gt 0 ];then sleep 5 CPU_MAX_NUM=$(top -n 1|awk &apos;NR&gt;7{if ($10&gt;&quot;&apos;$CPU_MAX&apos;&quot;)print $10}&apos;|wc -l) [ $CPU_MAX_NUM -gt 0 ] &amp;&amp; $(echo &quot;CPU_${CPU_MAX}%_NUM: $CPU_MAX_NUM&quot; &gt;&gt;${DIR}/nsca_messages.txt)fi #&#x7CFB;&#x7EDF;&#x8D1F;&#x8F7D;UPTIME=$(uptime|sed &apos;s/.*age: \(.*\),.*,.*/\1/&apos;|awk -F&apos;.&apos; &apos;{print $1}&apos;)[ &quot;$UPTIME&quot; -gt &quot;$UPTIME_MAX&quot; ] &amp;&amp; $(echo &quot;UPTIME: $UPTIME&quot; &gt;&gt;${DIR}/nsca_messages.txt) #&#x76D1;&#x63A7;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;DISK=$(df -h |awk &apos;NR&gt;1{print $0}&apos;|sort -k5|tail -1|awk &apos;{print $1,$4,$5}&apos;) #&#x63D0;&#x53D6;&#x78C1;&#x76D8;&#x5360;&#x7528;&#x7387;&#x6700;&#x5927;&#x7684;&#x5206;&#x533A;DISK_USAGE=$(echo $DISK|awk &apos;{print $3}&apos;|tr -d &apos;%&apos;)[ &quot;$DISK_USAGE&quot; -ge &quot;$DISK_MAX&quot; ] &amp;&amp; $(echo &quot;DISK: $DISK&quot; &gt;&gt; ${DIR}/nsca_messages.txt) #&#x76D1;&#x63A7;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF08;filesystem&#xFF09;[ -f &quot;${DIR}/fs.txt&quot; ] || $(df -T|grep -v tmpfs|awk &apos;NR&gt;1{print $1,$2}&apos;&gt;${DIR}/fs.txt)while read FSdo PARTITION=$(echo $FS|awk &apos;{print $1}&apos;) #&#x63D0;&#x53D6;&#x5206;&#x533A;&#x540D; FILESYSTEM=$(echo $FS|awk &apos;{print $2}&apos;) #&#x63D0;&#x53D6;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7C7B;&#x578B; [ &quot;$FILESYSTEM&quot; == &quot;ext4&quot; ] &amp;&amp; CMD=&quot;/sbin/tune4fs&quot; || CMD=&quot;/sbin/tune2fs&quot; FS_STAT=$($CMD -l $PARTITION | grep &apos;Filesystem state&apos;) echo $FS_STAT|grep &apos;clean$&apos;&gt;/dev/null if [ $? -eq 1 ];then echo &quot;$PARTITION : $FS_STAT&quot; &gt;&gt;${DIR}/nsca_messages.txt fidone&lt; ${DIR}/fs.txt #&#x76D1;&#x63A7;iptables#/sbin/iptables -nL|grep &apos;INPUT&apos;|grep &apos;policy ACCEPT&apos; &amp;&amp; echo &quot;iptables: policy DROP&quot;&gt;&gt;${DIR}/messages.txt #&#x53D1;&#x9001;&#x8B66;&#x62A5;&#x90AE;&#x4EF6;#if [ -s ${DIR}/messages.txt ];then #&#x5982;&#x679C;messages.txt&#x6587;&#x4EF6;&#x4E0D;&#x4E3A;&#x7A7A;&#x5219;&#x53D1;&#x9001;&#x8B66;&#x62A5;&#x4FE1;# mail -s &quot;system monitor: $IP $HOSTNAME&quot; &quot;$ADMIN_SMS&quot; &lt; ${DIR}/messages.txt#fi if [ -s ${DIR}/nsca_messages.txt ];then MESS=$(cat ${DIR}/nsca_messages.txt) echo &quot;$HOSTNAME;NSCA;2;$MESS&quot;|/root/mailtool/nsca/send_nsca -H 199.15.116.25 -d &quot;;&quot; -c send_nsca.cfg&gt;&gt;send_stat.txtelse echo &quot;$HOSTNAME;NSCA;0;OK&quot;|/root/mailtool/nsca/send_nsca -H 199.15.116.25 -d &quot;;&quot; -c send_nsca.cfg&gt;&gt;sent_stat.txtfi &#x5C06;&#x811A;&#x672C;&#x653E;&#x5230;&#x88AB;&#x76D1;&#x63A7;&#x673A;&#x4E0A;&#xFF0C;&#x4F8B;&#x5982;&#x4FDD;&#x5B58;&#x4E3A;/root/nsca/nsca_check.sh&#xFF0C;&#x7ED9;&#x4E88;&#x6267;&#x884C;&#x6743;&#x9650;&#xFF0C;&#x5E76;&#x653E;&#x5230;crontab&#x6BCF;5&#x5206;&#x949F;&#x6267;&#x884C;&#x4E00;&#x6B21;&#x3002; &#x6700;&#x540E;&#x662F;&#x6279;&#x91CF;&#x6DFB;&#x52A0;&#x88AB;&#x76D1;&#x63A7;&#x670D;&#x52A1;&#x5668;&#x811A;&#x672C;&#xFF1A;12345678910111213141516171819202122232425262728293031323334#!/bin/bash#made by caishzh# if [ -z &quot;$1&quot; ] || [ -z &quot;$2&quot; ];then echo -e &quot;\nUsage:\n $0 groupname filename&quot; echo -e &quot;Example:\n $0 webserver /root/webserver.txt\n&quot; exit 1fi NAGIOS_DIR=&quot;/usr/local/nagios&quot; HOSTGROUP=$1SERVICES=$2while read LINEdoHOSTNAME=$(echo $LINE|awk &apos;{print $1}&apos;)IP=$(echo $LINE|awk &apos;{print $2}&apos;) cat &gt;&gt;&quot;$NAGIOS_DIR&quot;/etc/nsca/&quot;$HOSTGROUP&quot;.cfg &lt; &lt;eofdefine host{ use linux-server host_name $HOSTNAME address $IP}define service{ use passive_service host_name $HOSTNAME service_description NSCA check_command check_dummy!0 notifications_enabled 1}EOFdone&lt;$SERVICES &#x4FDD;&#x5B58;&#x4E3A;/root/nagios_add.sh&#xFF0C;&#x5E76;&#x7ED9;&#x4E88;&#x6267;&#x884C;&#x6743;&#x9650;&#x3002; &#x4F7F;&#x7528;&#xFF1A;&#x4F8B;&#x5982;&#x5C06;&#x9700;&#x8981;&#x6DFB;&#x52A0;&#x88AB;&#x52A8;&#x76D1;&#x63A7;&#x670D;&#x52A1;&#x5668;&#x4FE1;&#x606F;&#x5199;&#x9053;&#x6587;&#x4EF6;/root/servers.txt&#x4E2D;&#xFF0C;&#x7B2C;&#x4E00;&#x5217;&#x4E3A;&#x4E3B;&#x673A;&#x540D;&#xFF0C;&#x7B2C;&#x4E8C;&#x5217;&#x662F;&#x4E3B;&#x673A;&#x5BF9;&#x5E94;&#x7684;ip&#xFF1A; 12service1 192.168.1.1service2 192.168.1.2 &#x6267;&#x884C;&#xFF1A; 1/root/nagios_add.sh test /root/servers.txt &#x5176;&#x4E2D;&#xFF0C;test&#x662F;&#x670D;&#x52A1;&#x5668;&#x8981;&#x52A0;&#x5165;&#x5230;&#x7EC4;&#x3002; &#x6267;&#x884C;&#x7ED3;&#x679C;&#xFF1A; 12345678910111213141516171819202122232425[root@vps ~]# more /usr/local/nagios/etc/nsca/test.cfgdefine host{ use linux-server host_name service1 address 192.168.1.1}define service{ use passive_service host_name service1 service_description NSCA check_command check_dummy!0 notifications_enabled 1}define host{ use linux-server host_name service2 address 192.168.1.2}define service{ use passive_service host_name service2 service_description NSCA check_command check_dummy!0 notifications_enabled 1} &#x6700;&#x540E;&#x91CD;&#x542F;nagios&#x8BA9;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x751F;&#x6548;&#x3002;]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>monitor</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[硬盘分区为整数]]></title>
    <url>%2F2012%2F05%2F19%2F%E7%A1%AC%E7%9B%98%E5%88%86%E5%8C%BA%E4%B8%BA%E6%95%B4%E6%95%B0%2F</url>
    <content type="text"><![CDATA[&#x6700;&#x7CBE;&#x786E;&#x786C;&#x76D8;&#x5206;&#x533A;&#x7684;&#x7B97;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A; &#x786C;&#x76D8;&#x4E00;&#x822C;&#x6709;255&#x78C1;&#x5934;&#xFF0C;63&#x6247;&#x533A;&#xFF0C;&#x6545;&#x6BCF;&#x67F1;&#x9762;&#x5927;&#x5C0F;&#x4E3A;&#xFF1A; 1512byte x 255 x 63&#xFF1D;8225280bytes &#xFF1D;7.84423828125 MB &#x5982;&#x679C;&#x8981;&#x5206;40GB,&#x90A3;&#x4E48;&#x8981; 140x1024MB=40960MB &#x9700;&#x8981;&#x67F1;&#x9762;&#x6570;&#x4E3A; 140960&#xF7;7.84423828125=5221.66 &#x53D6;&#x6574;&#x6570;&#x65E2;&#x4E3A;5222&#x4E2A;&#x67F1;&#x9762;&#x5E94;&#x5206;M&#x6570;&#x4E3A; 15222x7.84423828125=40962.6123046875MB &#x4E0D;&#x7BA1;&#x5C0F;&#x6570;&#x70B9;&#x540E;&#x9762;&#x51E0;&#x4F4D;&#x90FD;&#x8FDB;1&#xFF0C;&#x4E5F;&#x5C31;&#x662F;40963MB&#xFF0C;windows&#x5C31;&#x8BA4;&#x4E3A;&#x662F;40GB&#x4E86;&#x3002;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;NTFS&#x548C;FAT32&#x901A;&#x7528;&#x3002; &#x4E0B;&#x9762;&#x9644;10GB&#x5230;200GB&#x6574;10GB&#x9012;&#x589E;&#x7684;&#x7CBE;&#x786E;&#x8BA1;&#x7B97;&#x7ED3;&#x679C;&#xFF1A; 1234567891011121314151617181910GB &#xFF1D; 10245MB20GB &#xFF1D; 20482MB30GB &#xFF1D; 30726MB40GB &#xFF1D; 40963MB50GB &#xFF1D; 51208MB60GB &#xFF1D; 61444MB70GB &#xFF1D; 71681MB80GB &#xFF1D; 81926MB90GB &#xFF1D; 92162MB100GB &#xFF1D; 102407MB110GB &#xFF1D; 112644MB120GB &#xFF1D; 122888MB130GB &#xFF1D; 133125MB140GB &#xFF1D; 143362MB150GB &#xFF1D; 153606MB160GB &#xFF1D; 163843MB170GB &#xFF1D; 174088MB180GB &#xFF1D; 184324MB190GB &#xFF1D; 194561MB &#x6B64;&#x7CBE;&#x786E;&#x5206;&#x533A;&#x7ED3;&#x679C;&#xFF0C;&#x5728;&#x7BA1;&#x7406;&#x5DE5;&#x5177;-&#x78C1;&#x76D8;&#x7BA1;&#x7406;&#x754C;&#x9762;&#xFF0C;&#x548C;Windows&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x5668;&#x91CC;&#x9762;&#x663E;&#x793A;&#x7684;&#x662F;&#x6574;&#x6570;&#xFF0C;10G&#x5C31;&#x662F;10.00GB&#xFF0C;20G&#x5C31;&#x662F;20.00GB&#xFF0C;40G&#x5C31;&#x662F;40.00GB&#x3002;]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[tar远程备份]]></title>
    <url>%2F2012%2F05%2F13%2Ftar%E8%BF%9C%E7%A8%8B%E5%A4%87%E4%BB%BD%2F</url>
    <content type="text"><![CDATA[&#x4F20;&#x8F93;&#x5230;&#x8FDC;&#x7A0B;&#xFF1A; 1tar czf - file| ssh server &quot;tar zxf -&quot; &#x538B;&#x7F29;&#x5230;&#x8FDC;&#x7A0B;&#xFF1A; 1tar czf - file| ssh server &quot;cat &gt; file.tar.gz&quot; &#x89E3;&#x538B;&#x5230;&#x8FDC;&#x7A0B;&#xFF1A; 1ssh server &quot;tar zxf -&quot; &lt; file.tar.gz &#x89E3;&#x538B;&#x5230;&#x672C;&#x5730;&#xFF1A; 1ssh server &quot;cat file.tar.gz&quot; | tar zxf - &#x53E6;&#x5916;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;-T file&#x5907;&#x4EFD;&#x6307;&#x5B9A;&#x6587;&#x4EF6;&#x3002; &#x6D4B;&#x8BD5;&#xFF08;&#x4EC5;&#x4F9B;&#x53C2;&#x8003;&#xFF09;&#xFF1A;&#x6D4B;&#x8BD5;&#x6570;&#x636E;&#xFF1A;y&#x76EE;&#x5F55; &#x5927;&#x5C0F;&#xFF1A;12G &#x6587;&#x4EF6;&#x6570;&#xFF1A;37895 &#x6D4B;&#x8BD5;&#x547D;&#x4EE4;&#xFF1A;1&#x3001;time scp -r y 192.168.35.224:/test #&#x76F4;&#x63A5;&#x4F7F;&#x7528;scp&#x4F20;&#x8F93;2&#x3001;time tar cf &#x2013; y |ssh 192.168.35.224 &#x201C;cd /test2;tar xf -&#x201D; #&#x4F20;&#x8F93;&#x5230;&#x8FDC;&#x7A0B;&#xFF0C;&#x4E0D;&#x538B;&#x7F29;3&#x3001;time tar zcf &#x2013; y |ssh 192.168.35.224 &#x201C;cd /test3;tar zxf -&#x201D; #&#x4F20;&#x8F93;&#x5230;&#x8FDC;&#x7A0B;&#xFF0C;&#x538B;&#x7F29; &#x7ED3;&#x679C;&#xFF1A; &#x547D;&#x4EE4; 1 2 3 &#x8017;&#x65F6; 38m4.291s 23m4.931s 33m35.911s]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Nginx限制ip连接数和流量控制]]></title>
    <url>%2F2012%2F05%2F13%2FNginx%E9%99%90%E5%88%B6ip%E8%BF%9E%E6%8E%A5%E6%95%B0%E5%92%8C%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6%2F</url>
    <content type="text"><![CDATA[&#x5728;&#x914D;&#x7F6E;&#x6587;&#x4EF6;nginx.conf&#x7684;http{}&#x6DFB;&#x52A0;&#xFF1A; 1limit_zone one $binary_remote_addr 10m; &#x5728;location url&#x91CD;&#x5199;&#x914D;&#x7F6E;&#x91CC;&#x6DFB;&#x52A0;&#xFF1A; 12limit_conn one 5;limit_rate 50k; &#x5982;&#x4E0B;&#xFF1A; 12345678910111213141516http{ ............. limit_zone one $binary_remote_addr 10m; #&#x6DFB;&#x52A0;&#x8FD9;&#x4E00;&#x884C; .............. server{ ................. location { ......... limit_conn one 5; #&#x8FDE;&#x63A5;&#x6570;&#x9650;&#x5236;&#xFF08;&#x7EBF;&#x7A0B;&#xFF09; limit_rate 50k; #&#x5E26;&#x5BBD;&#x9650;&#x5236; ........ } ................. } .............} &#x6D4B;&#x8BD5;&#xFF1A; &#x9650;&#x5236;&#x524D;&#xFF1A; &#x9650;&#x5236;&#x540E;]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Nginx的日常维护]]></title>
    <url>%2F2012%2F05%2F13%2FNginx%E7%9A%84%E6%97%A5%E5%B8%B8%E7%BB%B4%E6%8A%A4%2F</url>
    <content type="text"><![CDATA[&#x68C0;&#x9A8C;&#x914D;&#x7F6E;&#x6587;&#x4EF6; 1/opt/nginx/sbin/nginx -t &#x6216; 1/opt/nginx/sbin/nginx -t -c /opt/nginx/conf/nginx.conf &#x5982;&#x679C;&#x4E0D;&#x4F7F;&#x7528;-c&#x6307;&#x5B9A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4F4D;&#x7F6E;&#xFF0C;Nginx&#x4F1A;&#x5728;&#x5176;&#x5B89;&#x88C5;&#x76EE;&#x5F55;&#x4E0B;&#x627E;conf/nginx.conf&#x6587;&#x4EF6; &#x542F;&#x52A8;&#xFF1A; 1/opt/nginx/sbin/nginx &amp; &#x5173;&#x95ED;&#xFF1A; 1killall nginx &#x6216; 1kill -9 &apos;nginx_pid&apos; &#x5E73;&#x6ED1;&#x91CD;&#x542F;&#xFF1A; 1kill -HUP `cat /opt/nginx/logs/nginx.pid` HUP&#x662F;&#x4FE1;&#x53F7;&#xFF0C;&#x5E38;&#x7528;&#x7684;&#x4FE1;&#x53F7;&#x6709;&#xFF1A; QUIT&#xFF0C;&#x8868;&#x5904;&#x7406;&#x5B8C;&#x5F53;&#x524D;&#x8BF7;&#x6C42;&#x540E;&#xFF0C;&#x5173;&#x95ED;&#x8FDB;&#x7A0B;&#xFF1B; HUP&#xFF0C;&#x8868;&#x793A;&#x91CD;&#x65B0;&#x52A0;&#x8F7D;&#x914D;&#x7F6E;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5173;&#x95ED;&#x539F;&#x6709;&#x7684;&#x8FDB;&#x7A0B;&#xFF0C;&#x5E76;&#x5F00;&#x542F;&#x65B0;&#x7684;&#x5DE5;&#x4F5C;&#x8FDB;&#x7A0B;&#x3002;&#x6B64;&#x64CD;&#x4F5C;&#x4E0D;&#x4F1A;&#x4E2D;&#x65AD;&#x7528;&#x6237;&#x7684;&#x8BBF;&#x95EE;&#x8BF7;&#x6C42;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6B64;&#x4FE1;&#x53F7;&#x5E73;&#x6ED1;&#x7684;&#x91CD;&#x542F;Nginx&#xFF1B; USR1&#xFF0C;&#x7528;&#x4E8E;Nginx&#x7684;&#x65E5;&#x5FD7;&#x5207;&#x6362;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x91CD;&#x65B0;&#x6253;&#x5F00;&#x4E00;&#x4E2A;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#xFF0C;&#x4F8B;&#x5982;&#x6BCF;&#x5929;&#x8981;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x4FE1;&#x53F7;&#x6765;&#x63A7;&#x5236;&#xFF1B; USR2&#xFF0C;&#x7528;&#x4E8E;&#x5E73;&#x6ED1;&#x5347;&#x7EA7;&#x53EF;&#x6267;&#x884C;&#x7A0B;&#x5E8F;&#xFF1B; WINCH &#xFF0C;&#x4ECE;&#x5BB9;&#x5173;&#x95ED;&#x5DE5;&#x4F5C;&#x8FDB;&#x7A0B;&#x3002; &#x65E5;&#x5FD7;&#x5206;&#x5272;&#xFF1A;Nginx&#x6CA1;&#x6709;&#x7C7B;&#x4F3C;Apache&#x7684;cronolog&#x65E5;&#x5FD7;&#x5206;&#x5272;&#x5904;&#x7406;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Nginx&#x7684;&#x4FE1;&#x53F7;&#x63A7;&#x5236;&#x529F;&#x80FD;&#xFF08;USR1&#xFF09;&#x5229;&#x7528;&#x811A;&#x672C;&#x6765;&#x5B9E;&#x73B0;&#x65E5;&#x5FD7;&#x7684;&#x81EA;&#x52A8;&#x5207;&#x5272;&#x3002; 12345678#!/bin/bashLOGS_PATH=&quot;/var/log/nginx&quot;DATE=$(date +%F) mv $LOGS_PATH/access.log $LOGS_PATH/access.log.$DATEmv $LOGS_PATH/error.log $LOGS_PATH/error.log.$DATE kill -USR1 `cat /opt/nginx/logs/nginx.pid` &#x5148;&#x5C06;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x6309;&#x65E5;&#x671F;&#x91CD;&#x547D;&#x540D;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;Nginx&#x7684;&#x4FE1;&#x53F7;&#x201C;USR1&#x201D;&#x751F;&#x6210;&#x65B0;&#x7684;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x3002;&#x7ED9;&#x4E88;&#x811A;&#x672C;&#x6267;&#x884C;&#x6743;&#x9650;&#xFF0C;&#x5E76;&#x5C06;&#x811A;&#x672C;&#x653E;&#x5230;crontab&#xFF0C;&#x6BCF;&#x5929;&#x51CC;&#x6668;&#x81EA;&#x52A8;&#x5206;&#x5272;&#x65E5;&#x5FD7;&#xFF1A; 12chmod +x nginx_logs.shecho &quot;0 0 * * * root /root/nginx_logs.sh&quot;&gt;&gt;/etc/crontab]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iptables模块介绍：recent]]></title>
    <url>%2F2012%2F05%2F10%2Fiptables%E6%A8%A1%E5%9D%97%E4%BB%8B%E7%BB%8D%EF%BC%9Arecent%2F</url>
    <content type="text"><![CDATA[recent&#x6A21;&#x5757;&#x53EF;&#x4EE5;&#x770B;&#x4F5C;iptables&#x91CC;&#x9762;&#x7EF4;&#x62A4;&#x4E86;&#x4E00;&#x4E2A;&#x5730;&#x5740;&#x5217;&#x8868;&#xFF0C;&#x8FD9;&#x4E2A;&#x5730;&#x5740;&#x5217;&#x8868;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x201D;&#x2013;set&#x201D;&#x3001;&#x201D;&#x2013;update&#x201D;&#x3001;&#x201D;&#x2013;rcheck&#x201D;&#x3001;&#x201D;&#x2013;remove&#x201D;&#x56DB;&#x79CD;&#x65B9;&#x6CD5;&#x6765;&#x4FEE;&#x6539;&#x5217;&#x8868;&#xFF0C;&#x6BCF;&#x6B21;&#x4F7F;&#x7528;&#x65F6;&#x53EA;&#x80FD;&#x9009;&#x7528;&#x4E00;&#x79CD;&#x3002;&#x8FD8;&#x53EF;&#x9644;&#x5E26;&#x201D;&#x2013;name&#x201D;&#x53C2;&#x6570;&#x6765;&#x6307; &#x5B9A;&#x5217;&#x8868;&#x7684;&#x540D;&#x5B57;&#xFF08;&#x9ED8;&#x8BA4;&#x4E3A;DEFAULT&#xFF09;&#xFF0C;&#x201C;&#x2013;rsource&#x201D;&#x3001;&#x201C;&#x2013;rdest&#x201D;&#x6307;&#x793A;&#x5F53;&#x524D;&#x65B9;&#x6CD5;&#x5E94;&#x7528;&#x5230;&#x6570;&#x636E;&#x5305;&#x7684;&#x6E90;&#x5730;&#x5740;&#x8FD8;&#x662F;&#x76EE;&#x7684;&#x5730;&#x5740;&#xFF08;&#x9ED8;&#x8BA4;&#x662F;&#x524D;&#x8005;&#xFF09;&#x3002; recent&#x8BED;&#x53E5;&#x90FD;&#x5E26;&#x6709;&#x5E03;&#x5C14;&#x578B;&#x8FD4;&#x56DE;&#x503C;&#xFF0C;&#x6BCF;&#x6B21;&#x6267;&#x884C;&#x82E5;&#x7ED3;&#x679C;&#x4E3A;&#x771F;&#xFF0C;&#x5219;&#x4F1A;&#x6267;&#x884C;&#x540E;&#x7EED;&#x7684;&#x8BED;&#x53E5;&#xFF0C;&#x6BD4;&#x5982;&#x201C;-j ACCEPT&#x201D;&#x4E4B;&#x7C7B;&#x7684;&#x3002; &#x5BF9;&#x4E8E;&#x5B9E;&#x73B0;&#x524D;&#x9762;&#x63D0;&#x5230;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x989D;&#x5916;&#x7684;&#x53C2;&#x6570;&#x3002;&#x201C;&#x2013;second&#x201D;&#x9650;&#x5236;&#x5305;&#x5730;&#x5740;&#x88AB;&#x8BB0;&#x5F55;&#x8FDB;&#x5217;&#x8868;&#x7684;&#x65F6;&#x95F4;&#x8981;&#x5C0F;&#x4E8E;&#x7B49;&#x4E8E;&#x540E;&#x9762;&#x7684;&#x65F6;&#x95F4;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x8FD8;&#x6709;&#x201D;&#x2013;hitcount&#x201D;&#x3001;&#x201D;&#x2013;rttl&#x201D;&#xFF0C;&#x663E;&#x7136;&#x662F;&#x53EF;&#x4EE5;&#x6709;&#x5176;&#x4ED6;&#x9AD8;&#x7EA7;&#x7684;play&#x3002; &#x57FA;&#x4E8E;&#x4E0A;&#x9762;&#x7684;&#x8BF4;&#x660E;&#xFF0C;&#x73B0;&#x5728;&#x6765;&#x770B;&#x56DB;&#x4E2A;&#x57FA;&#x672C;&#x65B9;&#x6CD5;&#x7684;&#x4F5C;&#x7528;&#xFF1A;&#x2013;set&#x5C06;&#x5730;&#x5740;&#x6DFB;&#x52A0;&#x8FDB;&#x5217;&#x8868;&#xFF0C;&#x5E76;&#x66F4;&#x65B0;&#x4FE1;&#x606F;&#xFF0C;&#x5305;&#x542B;&#x5730;&#x5740;&#x52A0;&#x5165;&#x7684;&#x65F6;&#x95F4;&#x6233;&#x3002;&#x2013;rcheck&#x68C0;&#x67E5;&#x5730;&#x5740;&#x662F;&#x5426;&#x5728;&#x5217;&#x8868;&#x3002;&#x2013;update&#x8DDF;rcheck&#x4E00;&#x6837;&#xFF0C;&#x4F46;&#x4F1A;&#x5237;&#x65B0;&#x65F6;&#x95F4;&#x6233;&#x3002;&#x2013;remove&#x5C31;&#x662F;&#x5728;&#x5217;&#x8868;&#x91CC;&#x5220;&#x9664;&#x5730;&#x5740;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x5220;&#x9664;&#x7684;&#x5730;&#x5740;&#x4E0D;&#x5B58;&#x5728;&#x5C31;&#x4F1A;&#x8FD4;&#x56DE;&#x5047;&#x3002; &#x4F8B;&#xFF1A;#&#x9650;&#x5236;&#x65E0;&#x6CD5;ssh&#x76F4;&#x63A5;&#x8FDE;&#x63A5;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x9700;&#x5148;&#x7528;&#x8F83;&#x5927;&#x5305;ping&#x4E00;&#x4E0B;&#xFF0C;&#x6B64;&#x65F6;&#x5728;15&#x79D2;&#x5185;&#x624D;&#x53EF;&#x4EE5;&#x8FDE;&#x63A5;&#x4E0A;&#xFF1A; 123456iptables -P INPUT DROPiptables -A INPUT -s 127.0.0.1/32 -j ACCEPTiptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPTiptables -A INPUT -p icmp --icmp-type 8 -m length --length 128 -m recent --set --name SSHOPEN --rsource -j ACCEPTiptables -A INPUT -p icmp --icmp-type 8 -j ACCEPTiptables -A INPUT -p tcp --dport 22 -m state --state NEW -m recent --rcheck --seconds 15 --name SSHOPEN --rsource -j ACCEPT &#x8BF4;&#x660E;&#xFF1A;\1. &#x5C06;INPUT&#x94FE;&#x9ED8;&#x8BA4;&#x7B56;&#x7565;&#x7F6E;&#x4E3A;DROP&#xFF0C;&#x5F53;&#x5305;&#x8D70;&#x5B8C;INPUT&#x94FE;&#x800C;&#x6CA1;&#x88AB;&#x62FF;&#x8D70;&#x65F6;&#x5C31;&#x4F1A;&#x4E22;&#x5F03;&#x6389;&#xFF1B;\2. &#x672C;&#x5730;localhost&#x7684;&#x5305;&#x5168;&#x90E8;&#x63A5;&#x53D7;&#xFF1B;\3. &#x5BF9;&#x4E8E;&#x5DF2;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x6216;&#x662F;&#x4E0E;&#x5DF2;&#x8FDE;&#x63A5;&#x76F8;&#x5173;&#x7684;&#x5305;&#x90FD;&#x63A5;&#x53D7;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x5BF9;&#x5916;&#x8FDE;&#x63A5;&#x56DE;&#x6765;&#x7684;&#x5305;&#x4E00;&#x822C;&#x90FD;&#x8D70;&#x8FD9;&#x6761;&#xFF1B;&#x57FA;&#x672C;&#x73AF;&#x5883;&#x5DF2;&#x7ECF;&#x914D;&#x597D;&#x4E86;&#xFF0C;&#x73B0;&#x5728;&#x5F00;&#x59CB;&#x8981;&#x4E3A;&#x8FDE;&#x63A5;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7684;ssh&#x6253;&#x5F00;&#x901A;&#x8DEF;&#x3002;\4. icmp&#x7C7B;&#x578B;8&#x662F;ping&#x5305;&#xFF1B;&#x6307;&#x5B9A;&#x5305;&#x5927;&#x5C0F;&#x4E3A;128&#x5B57;&#x8282;&#xFF1B;recent&#x7528;&#x7684;&#x5217;&#x8868;&#x540D;&#x79F0;&#x4E3A;SSHOPEN&#xFF0C;&#x5217;&#x8868;&#x8BB0;&#x5F55;&#x6E90;&#x5730;&#x5740;&#x3002;&#x7B26;&#x5408;&#x4E0A;&#x8FF0;&#x6761;&#x4EF6;&#x7684;&#x6570;&#x636E;&#x5305;&#x90FD;&#x63A5;&#x6536;&#x3002;&#x5982;&#x679C;ping&#x5305;&#x5185;&#x5BB9;&#x4E3A;100&#x5B57;&#x8282;&#xFF0C;&#x5219;&#x52A0;&#x4E0A;IP&#x5934;&#x3001;ICMP&#x5934;&#x7684;28&#x5B57;&#x8282;&#xFF0C;&#x603B;&#x5171;128&#x5B57;&#x8282;&#x3002;\5. &#x63A5;&#x53D7;&#x4E00;&#x822C;&#x7684;ping&#x5305;&#xFF1B;\6. &#x5BF9;&#x8FDE;&#x63A5;ssh 22&#x7AEF;&#x53E3;&#x7684;&#x8FDE;&#x63A5;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF0C;&#x6765;&#x6E90;&#x4E8E;SSHOPEN&#x6E90;&#x5730;&#x5740;&#x5217;&#x8868;&#x5E76;&#x4E14;&#x5728;&#x5217;&#x8868;&#x65F6;&#x95F4;&#x5C0F;&#x4E8E;&#x7B49;&#x4E8E;15&#x79D2;&#x7684;&#x624D;&#x653E;&#x884C;&#x3002; &#x6D4B;&#x8BD5;&#xFF1A;&#x65E0;&#x6CD5;ssh&#x76F4;&#x63A5;&#x8FDE;&#x63A5;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x4F7F;&#x7528;&#x201C;ping -l 100 &#x670D;&#x52A1;&#x5668;ip &#x201D;&#x540E;&#xFF0C;15&#x79D2;&#x5185;&#x5C31;&#x53EF;&#x4EE5;ssh&#x8FDE;&#x63A5;&#x670D;&#x52A1;&#x5668;&#x4E86;&#x3002; #&#x9650;&#x5236;&#x6BCF;ip&#x5728;&#x4E00;&#x5206;&#x949F;&#x5185;&#x6700;&#x591A;&#x5BF9;&#x670D;&#x52A1;&#x5668;&#x53EA;&#x80FD;&#x6709;8&#x4E2A;http&#x8FDE;&#x63A5; 123iptables -I INPUT -p tcp --dport 80 -d 199.15.25.116 -m state --state NEW -m recent --name httpuser --setiptables -A INPUT -m recent --update --name httpuser --seconds 60 --hitcount 9 -j LOG --log-prefix &apos;HTTP attack: &apos;iptables -A INPUT -m recent --update --name httpuser --seconds 60 --hitcount 9 -j DROP &#x8BF4;&#x660E;&#xFF1A;199.15.25.116&#x662F;&#x670D;&#x52A1;&#x5668;ip \1. -I&#xFF0C;&#x5C06;&#x672C;&#x89C4;&#x5219;&#x63D2;&#x5165;&#x5230; INPUT &#x94FE;&#x91CC;&#x5934;&#x7684;&#x6700;&#x4E0A;&#x5934;&#x3002;&#x53EA;&#x8981;&#x662F; TCP&#x8FDE;&#x63A5;&#xFF0C;&#x76EE;&#x6807;&#x7AEF;&#x53E3;&#x662F;80&#xFF0C;&#x76EE;&#x6807; IP&#x662F;&#x6211;&#x4EEC;&#x670D;&#x52A1;&#x5668;&#x7684;IP&#xFF0C;&#x521A;&#x521A;&#x65B0;&#x88AB;&#x5EFA;&#x7ACB;&#x8D77;&#x6765;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x5C06;&#x8FD9;&#x4E2A;&#x8054;&#x673A;&#x5217;&#x5165; httpuser &#x8FD9;&#x5206;&#x6E05;&#x5355;&#x4E2D;&#xFF1B;\2. -A&#xFF0C;&#x5C06;&#x672C;&#x89C4;&#x5219;&#x9644;&#x5728; INPUT &#x94FE;&#x7684;&#x6700;&#x5C3E;&#x7AEF;&#x3002;&#x53EA;&#x8981;&#x662F;60&#x79D2;&#x5185;&#xFF0C;&#x540C;&#x4E00;&#x4E2A;&#x6765;&#x6E90;&#x8FDE;&#x7EED;&#x4EA7;&#x751F;&#x591A;&#x4E2A;&#x8054;&#x673A;&#xFF0C;&#x5230;&#x8FBE;&#x7B2C;9&#x4E2A;&#x8054;&#x673A;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5BF9;&#x6B64;&#x8054;&#x673A;&#x7559;&#x4E0B;Log&#x8BB0;&#x5F55;&#x3002;&#x8BB0;&#x5F55;&#x884C;&#x4F1A;&#x4EE5; HTTP attack &#x5F00;&#x5934;&#x3002;&#x6BCF;&#x4E00;&#x6B21;&#x7684;&#x672C;&#x89C4;&#x5219;&#x6BD4;&#x5BF9;&#xFF0C; &#x2013;update &#x5747;&#x4F1A;&#x66F4;&#x65B0;httpuser&#x6E05;&#x5355;&#x4E2D;&#x7684;&#x5217;&#x8868;&#xFF1B;\3. -A&#xFF0C;&#x5C06;&#x672C;&#x89C4;&#x5219;&#x9644;&#x5728; INPUT &#x94FE;&#x7684;&#x6700;&#x5C3E;&#x7AEF;&#x3002;&#x540C;&#x6837;&#x7684;&#x6BD4;&#x5BF9;&#x6761;&#x4EF6;&#xFF0C;&#x4F46;&#x662F;&#x672C;&#x6B21;&#x7684;&#x52A8;&#x4F5C;&#x5219;&#x662F;&#x5C06;&#x6B64;&#x8FDE;&#x63A5;&#x4E22;&#x6389;&#xFF1B;\4. &#x6240;&#x4EE5;&#xFF0C;&#x8FD9;&#x4E09;&#x884C;&#x89C4;&#x5219;&#x8868;&#x793A;&#xFF0C;&#x6211;&#x4EEC;&#x5141;&#x8BB8;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x6BCF;&#x4E00;&#x5206;&#x949F;&#x5185;&#x53EF;&#x4EE5;&#x63A5;&#x4E0A;&#x670D;&#x52A1;&#x5668;8&#x4E2A;&#x3002;&#x5177;&#x4F53;&#x6570;&#x503C;&#x53EF;&#x4EE5;&#x770B;&#x7BA1;&#x7406;&#x8005;&#x51B3;&#x5B9A;&#x3002;&#x8FD9;&#x4E9B;&#x89C4;&#x5219;&#x53E6;&#x5916;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x5728;&#x5176;&#x5B83;&#x5BF9;&#x5916;&#x5F00;&#x653E;&#x7684;&#x7F51;&#x7EDC;&#x670D;&#x52A1;&#x4E0A;&#xFF0C;&#x4F8B;&#x5982; port 22 (SSH), port 25 (smtp email)&#x3002; #&#x5BF9;&#x8FDE;&#x63A5;&#x5230;&#x672C;&#x673A;&#x7684;SSH&#x8FDE;&#x63A5;&#x8FDB;&#x884C;&#x9650;&#x5236;&#xFF0C;&#x6BCF;&#x4E2A;IP&#x6BCF;&#x5C0F;&#x65F6;&#x53EA;&#x9650;&#x8FDE;&#x63A5;5&#x6B21; 12-A INPUT -p tcp --dport 22 -m state --state NEW -m recent --name SSHPOOL --rcheck --seconds 3600 --hitcount 5 -j DROP-A INPUT -p tcp --dport 22 -m state --state NEW -m recent --name SSHPOOL --set -j ACCEPT &#x53C2;&#x8003;&#xFF1A;http://linux.ccidnet.com/art/737/20060705/596661_1.htmlhttp://www.sudu.cn/info/html/edu/20070102/296328.htmlhttp://shiverfalcon.blog.51cto.com/245825/406236http://blog.nelson10.info/2012/03/17/module_recent_in_iptables.htmlhttp://www.cnblogs.com/hiloves/archive/2011/07/19/2109899.htmlhttp://www.libertyvps.com/thread-44-1-1.html]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>iptables</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL备份方法总结]]></title>
    <url>%2F2012%2F05%2F10%2FMySQL%E5%A4%87%E4%BB%BD%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[&#x603B;&#x7ED3;&#x4E0B;&#x51E0;&#x79CD;&#x5E38;&#x7528;&#x7684;mysql&#x5907;&#x4EFD;&#x65B9;&#x6CD5;&#xFF1A; &#x76F4;&#x63A5;&#x62F7;&#x8D1D;&#x6570;&#x636E;&#x5E93;&#x6587;&#x4EF6; &#x9996;&#x5148;&#x628A;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x90FD;&#x5237;&#x65B0;&#x5230;&#x78C1;&#x76D8;&#x4E2D;&#xFF0C;&#x540C;&#x65F6;&#x9501;&#x5B9A;&#x6570;&#x636E;&#x8868;&#xFF0C;&#x4EE5;&#x4FDD;&#x8BC1;&#x62F7;&#x8D1D;&#x8FC7;&#x7A0B;&#x4E2D;&#x4E0D;&#x4F1A;&#x6709;&#x65B0;&#x7684;&#x6570;&#x636E;&#x5199;&#x5165;&#xFF1A; 1mysql&gt;FLUSH TABLES WITH READ LOCK; &#x4F7F;&#x7528;tar&#x6216;cp&#x7B49;&#x547D;&#x4EE4;&#x5907;&#x4EFD;&#x6570;&#x636E;&#x5E93;&#x6587;&#x4EF6;&#xFF0C;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;tar&#xFF1A; 1tar zcvf /backup/mysql_$(date &quot;+%Y%m%d&quot;).tar.gz /var/lib/mysql c&#x3001;&#x5907;&#x4EFD;&#x5B8C;&#x540E;&#x89E3;&#x9501;&#x6570;&#x636E;&#x8868; 1mysql&gt; unlock tables; &#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x5907;&#x4EFD;&#x51FA;&#x6765;&#x7684;&#x6570;&#x636E;&#x6062;&#x590D;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x76F4;&#x63A5;&#x62F7;&#x8D1D;&#x56DE;&#x539F;&#x6765;&#x7684;&#x6570;&#x636E;&#x5E93;&#x76EE;&#x5F55;&#x4E0B;&#x5373;&#x53EF;&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x5BF9;&#x4E8E; Innodb &#x7C7B;&#x578B;&#x8868;&#x6765;&#x8BF4;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x5907;&#x4EFD;&#x5176;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#xFF0C;&#x5373; ib_logfile* &#x6587;&#x4EF6;&#x3002;&#x56E0;&#x4E3A;&#x5F53; Innodb &#x8868;&#x635F;&#x574F;&#x65F6;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x4F9D;&#x9760;&#x8FD9;&#x4E9B;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x6765;&#x6062;&#x590D;&#x3002; &#x4F7F;&#x7528;mysqlhotcopy&#x5907;&#x4EFD;mysqlhotcopy &#x662F;&#x4E00;&#x4E2A; PERL &#x7A0B;&#x5E8F;&#xFF0C;&#x4F7F;&#x7528; LOCK TABLES&#x3001;FLUSH TABLES &#x548C; cp &#x6216; scp &#x6765;&#x5FEB;&#x901F;&#x5907;&#x4EFD;&#x6570;&#x636E;&#x5E93;&#x3002;&#x5B83;&#x662F;&#x5907;&#x4EFD;&#x6570;&#x636E;&#x5E93;&#x6216;&#x5355;&#x4E2A;&#x8868;&#x7684;&#x6700;&#x5FEB;&#x7684;&#x9014;&#x5F84;&#xFF0C;&#x4F46;&#x5B83;&#x53EA;&#x80FD;&#x8FD0;&#x884C;&#x5728;&#x6570;&#x636E;&#x5E93;&#x6587;&#x4EF6;&#xFF08;&#x5305;&#x62EC;&#x6570;&#x636E;&#x8868;&#x5B9A;&#x4E49;&#x6587;&#x4EF6;&#x3001;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x3001;&#x7D22;&#x5F15;&#x6587;&#x4EF6;&#xFF09;&#x6240;&#x5728;&#x7684;&#x673A;&#x5668;&#x4E0A;&#x3002;mysqlhotcopy &#x53EA;&#x80FD;&#x7528;&#x4E8E;&#x5907;&#x4EFD; MyISAM&#x3002; &#x4F8B;&#xFF1A;&#x628A;&#x6570;&#x636E;&#x5E93;test&#x5907;&#x4EFD;&#x5230;/backup&#x76EE;&#x5F55;&#x4E0B;&#xFF1A; 1/usr/local/mysql/bin/mysqlhotcopy -uroot -pxxx test /backup mysqlhotcopy&#x5728;&#x6267;&#x884C;&#x524D;&#x5C06;&#x4F1A;&#x9501;&#x5B9A;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x540E;&#x5C06;&#x81EA;&#x52A8;&#x91CA;&#x653E;&#x9501;&#x5B9A; &#x8FD8;&#x539F;&#xFF1A;mysqlhotcopy &#x5907;&#x4EFD;&#x51FA;&#x6765;&#x7684;&#x662F;&#x6574;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x76EE;&#x5F55;&#xFF0C;&#x8FD8;&#x539F;&#x65F6;&#x76F4;&#x63A5;&#x62F7;&#x8D1D;&#x8986;&#x76D6;&#x5C31;&#x884C;&#x4E86;&#xFF0C;&#x6CE8;&#x610F;&#x6743;&#x9650;&#x95EE;&#x9898; 1cp -rf /backup/test /var/lib/mysql/ &#x6CE8;&#x610F;&#xFF0C;&#x60F3;&#x8981;&#x4F7F;&#x7528; mysqlhotcopy&#xFF0C;&#x5FC5;&#x987B;&#x8981;&#x6709; SELECT&#x3001;RELOAD(&#x8981;&#x6267;&#x884C; FLUSH TABLES) &#x6743;&#x9650;&#xFF0C;&#x5E76;&#x4E14;&#x8FD8;&#x5FC5;&#x987B;&#x8981;&#x80FD;&#x591F;&#x6709;&#x8BFB;&#x53D6; datadir/db_name &#x76EE;&#x5F55;&#x7684;&#x6743;&#x9650;&#x3002; mysqldumpmysqldump &#x662F;SQL&#x7EA7;&#x522B;&#x7684;&#x5907;&#x4EFD;&#x673A;&#x5236;&#xFF0C;&#x5B83;&#x5C06;&#x6570;&#x636E;&#x8868;&#x5BFC;&#x6210; SQL &#x811A;&#x672C;&#x6587;&#x4EF6;&#xFF0C;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x7684;&#x5728;&#x4E0D;&#x540C;&#x7684;mysql&#x7248;&#x672C;&#x95F4;&#x8FDB;&#x884C;&#x6062;&#x590D;&#x6216;&#x5347;&#x7EA7;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x6700;&#x5E38;&#x7528;&#x7684;&#x5907;&#x4EFD;&#x65B9;&#x6CD5;&#x3002; &#x4E0B;&#x9762;&#x4ECB;&#x7ECD;&#x4E0B;mysqldump&#x7684;&#x53C2;&#x6570;&#xFF1A;&#x2013;compatible=name&#x5B83;&#x544A;&#x8BC9; mysqldump&#xFF0C;&#x5BFC;&#x51FA;&#x7684;&#x6570;&#x636E;&#x5C06;&#x548C;&#x54EA;&#x79CD;&#x6570;&#x636E;&#x5E93;&#x6216;&#x54EA;&#x4E2A;&#x65E7;&#x7248;&#x672C;&#x7684; MySQL &#x670D;&#x52A1;&#x5668;&#x76F8;&#x517C;&#x5BB9;&#x3002;&#x503C;&#x53EF;&#x4EE5;&#x4E3A; ansi&#x3001;mysql323&#x3001;mysql40&#x3001;postgresql&#x3001;oracle&#x3001;mssql&#x3001;db2&#x3001;maxdb&#x3001;no_key_options&#x3001;no_tables_options&#x3001;no_field_options &#x7B49;&#xFF0C;&#x8981;&#x4F7F;&#x7528;&#x51E0;&#x4E2A;&#x503C;&#xFF0C;&#x7528;&#x9017;&#x53F7;&#x5C06;&#x5B83;&#x4EEC;&#x9694;&#x5F00;&#x3002;&#x5F53;&#x7136;&#x4E86;&#xFF0C;&#x5B83;&#x5E76;&#x4E0D;&#x4FDD;&#x8BC1;&#x80FD;&#x5B8C;&#x5168;&#x517C;&#x5BB9;&#xFF0C;&#x800C;&#x662F;&#x5C3D;&#x91CF;&#x517C;&#x5BB9;&#x3002; &#x2013;complete-insert&#xFF0C;-c&#x5BFC;&#x51FA;&#x7684;&#x6570;&#x636E;&#x91C7;&#x7528;&#x5305;&#x542B;&#x5B57;&#x6BB5;&#x540D;&#x7684;&#x5B8C;&#x6574; INSERT &#x65B9;&#x5F0F;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x628A;&#x6240;&#x6709;&#x7684;&#x503C;&#x90FD;&#x5199;&#x5728;&#x4E00;&#x884C;&#x3002;&#x8FD9;&#x4E48;&#x505A;&#x80FD;&#x63D0;&#x9AD8;&#x63D2;&#x5165;&#x6548;&#x7387;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x80FD;&#x4F1A;&#x53D7;&#x5230; max_allowed_packet &#x53C2;&#x6570;&#x7684;&#x5F71;&#x54CD;&#x800C;&#x5BFC;&#x81F4;&#x63D2;&#x5165;&#x5931;&#x8D25;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x9700;&#x8981;&#x8C28;&#x614E;&#x4F7F;&#x7528;&#x8BE5;&#x53C2;&#x6570;&#xFF0C;&#x81F3;&#x5C11;&#x6211;&#x4E0D;&#x63A8;&#x8350;&#x3002; &#x2013;default-character-set=charset&#x6307;&#x5B9A;&#x5BFC;&#x51FA;&#x6570;&#x636E;&#x65F6;&#x91C7;&#x7528;&#x4F55;&#x79CD;&#x5B57;&#x7B26;&#x96C6;&#xFF0C;&#x5982;&#x679C;&#x6570;&#x636E;&#x8868;&#x4E0D;&#x662F;&#x91C7;&#x7528;&#x9ED8;&#x8BA4;&#x7684; latin1 &#x5B57;&#x7B26;&#x96C6;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E48;&#x5BFC;&#x51FA;&#x65F6;&#x5FC5;&#x987B;&#x6307;&#x5B9A;&#x8BE5;&#x9009;&#x9879;&#xFF0C;&#x5426;&#x5219;&#x518D;&#x6B21;&#x5BFC;&#x5165;&#x6570;&#x636E;&#x540E;&#x5C06;&#x4EA7;&#x751F;&#x4E71;&#x7801;&#x95EE;&#x9898;&#x3002; &#x2013;disable-keys&#x544A;&#x8BC9; mysqldump &#x5728; INSERT &#x8BED;&#x53E5;&#x7684;&#x5F00;&#x5934;&#x548C;&#x7ED3;&#x5C3E;&#x589E;&#x52A0; /!40000 ALTER TABLE table DISABLE KEYS */; &#x548C; /!40000 ALTER TABLE table ENABLE KEYS */; &#x8BED;&#x53E5;&#xFF0C;&#x8FD9;&#x80FD;&#x5927;&#x5927;&#x63D0;&#x9AD8;&#x63D2;&#x5165;&#x8BED;&#x53E5;&#x7684;&#x901F;&#x5EA6;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x662F;&#x5728;&#x63D2;&#x5165;&#x5B8C;&#x6240;&#x6709;&#x6570;&#x636E;&#x540E;&#x624D;&#x91CD;&#x5EFA;&#x7D22;&#x5F15;&#x7684;&#x3002;&#x8BE5;&#x9009;&#x9879;&#x53EA;&#x9002;&#x5408; MyISAM &#x8868;&#x3002; &#x2013;extended-insert = true|false&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;mysqldump &#x5F00;&#x542F; &#x2013;complete-insert &#x6A21;&#x5F0F;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x60F3;&#x7528;&#x5B83;&#x7684;&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x4F7F;&#x7528;&#x672C;&#x9009;&#x9879;&#xFF0C;&#x8BBE;&#x5B9A;&#x5B83;&#x7684;&#x503C;&#x4E3A; false &#x5373;&#x53EF;&#x3002; &#x2013;hex-blob&#x4F7F;&#x7528;&#x5341;&#x516D;&#x8FDB;&#x5236;&#x683C;&#x5F0F;&#x5BFC;&#x51FA;&#x4E8C;&#x8FDB;&#x5236;&#x5B57;&#x7B26;&#x4E32;&#x5B57;&#x6BB5;&#x3002;&#x5982;&#x679C;&#x6709;&#x4E8C;&#x8FDB;&#x5236;&#x6570;&#x636E;&#x5C31;&#x5FC5;&#x987B;&#x4F7F;&#x7528;&#x672C;&#x9009;&#x9879;&#x3002;&#x5F71;&#x54CD;&#x5230;&#x7684;&#x5B57;&#x6BB5;&#x7C7B;&#x578B;&#x6709; BINARY&#x3001;VARBINARY&#x3001;BLOB&#x3002; &#x2013;lock-all-tables&#xFF0C;-x&#x5728;&#x5F00;&#x59CB;&#x5BFC;&#x51FA;&#x4E4B;&#x524D;&#xFF0C;&#x63D0;&#x4EA4;&#x8BF7;&#x6C42;&#x9501;&#x5B9A;&#x6240;&#x6709;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x8868;&#xFF0C;&#x4EE5;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x7684;&#x4E00;&#x81F4;&#x6027;&#x3002;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5168;&#x5C40;&#x8BFB;&#x9501;&#xFF0C;&#x5E76;&#x4E14;&#x81EA;&#x52A8;&#x5173;&#x95ED; &#x2013;single-transaction &#x548C; &#x2013;lock-tables &#x9009;&#x9879;&#x3002; &#x2013;lock-tables&#x5B83;&#x548C; &#x2013;lock-all-tables &#x7C7B;&#x4F3C;&#xFF0C;&#x4E0D;&#x8FC7;&#x662F;&#x9501;&#x5B9A;&#x5F53;&#x524D;&#x5BFC;&#x51FA;&#x7684;&#x6570;&#x636E;&#x8868;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4E00;&#x4E0B;&#x5B50;&#x9501;&#x5B9A;&#x5168;&#x90E8;&#x5E93;&#x4E0B;&#x7684;&#x8868;&#x3002;&#x672C;&#x9009;&#x9879;&#x53EA;&#x9002;&#x7528;&#x4E8E; MyISAM &#x8868;&#xFF0C;&#x5982;&#x679C;&#x662F; Innodb &#x8868;&#x53EF;&#x4EE5;&#x7528; &#x2013;single-transaction &#x9009;&#x9879;&#x3002; &#x2013;no-create-info&#xFF0C;-t&#x53EA;&#x5BFC;&#x51FA;&#x6570;&#x636E;&#xFF0C;&#x800C;&#x4E0D;&#x6DFB;&#x52A0; CREATE TABLE &#x8BED;&#x53E5;&#x3002; &#x2013;no-data&#xFF0C;-d&#x4E0D;&#x5BFC;&#x51FA;&#x4EFB;&#x4F55;&#x6570;&#x636E;&#xFF0C;&#x53EA;&#x5BFC;&#x51FA;&#x6570;&#x636E;&#x5E93;&#x8868;&#x7ED3;&#x6784;&#x3002; &#x2013;opt&#x8FD9;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x5FEB;&#x6377;&#x9009;&#x9879;&#xFF0C;&#x7B49;&#x540C;&#x4E8E;&#x540C;&#x65F6;&#x6DFB;&#x52A0; &#x2013;add-drop-tables &#x2013;add-locking &#x2013;create-option &#x2013;disable-keys &#x2013;extended-insert &#x2013;lock-tables &#x2013;quick &#x2013;set-charset &#x9009;&#x9879;&#x3002;&#x672C;&#x9009;&#x9879;&#x80FD;&#x8BA9; mysqldump &#x5F88;&#x5FEB;&#x7684;&#x5BFC;&#x51FA;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x4E14;&#x5BFC;&#x51FA;&#x7684;&#x6570;&#x636E;&#x80FD;&#x5F88;&#x5FEB;&#x5BFC;&#x56DE;&#x3002;&#x8BE5;&#x9009;&#x9879;&#x9ED8;&#x8BA4;&#x5F00;&#x542F;&#xFF0C;&#x4F46;&#x53EF;&#x4EE5;&#x7528; &#x2013;skip-opt &#x7981;&#x7528;&#x3002;&#x6CE8;&#x610F;&#xFF0C;&#x5982;&#x679C;&#x8FD0;&#x884C; mysqldump &#x6CA1;&#x6709;&#x6307;&#x5B9A; &#x2013;quick &#x6216; &#x2013;opt &#x9009;&#x9879;&#xFF0C;&#x5219;&#x4F1A;&#x5C06;&#x6574;&#x4E2A;&#x7ED3;&#x679C;&#x96C6;&#x653E;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x3002;&#x5982;&#x679C;&#x5BFC;&#x51FA;&#x5927;&#x6570;&#x636E;&#x5E93;&#x7684;&#x8BDD;&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#x3002; &#x2013;quick&#xFF0C;-q&#x8BE5;&#x9009;&#x9879;&#x5728;&#x5BFC;&#x51FA;&#x5927;&#x8868;&#x65F6;&#x5F88;&#x6709;&#x7528;&#xFF0C;&#x5B83;&#x5F3A;&#x5236; mysqldump &#x4ECE;&#x670D;&#x52A1;&#x5668;&#x67E5;&#x8BE2;&#x53D6;&#x5F97;&#x8BB0;&#x5F55;&#x76F4;&#x63A5;&#x8F93;&#x51FA;&#x800C;&#x4E0D;&#x662F;&#x53D6;&#x5F97;&#x6240;&#x6709;&#x8BB0;&#x5F55;&#x540E;&#x5C06;&#x5B83;&#x4EEC;&#x7F13;&#x5B58;&#x5230;&#x5185;&#x5B58;&#x4E2D;&#x3002; &#x2013;routines&#xFF0C;-R&#x5BFC;&#x51FA;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x4EE5;&#x53CA;&#x81EA;&#x5B9A;&#x4E49;&#x51FD;&#x6570;&#x3002; &#x2013;single-transaction&#x8BE5;&#x9009;&#x9879;&#x5728;&#x5BFC;&#x51FA;&#x6570;&#x636E;&#x4E4B;&#x524D;&#x63D0;&#x4EA4;&#x4E00;&#x4E2A; BEGIN SQL&#x8BED;&#x53E5;&#xFF0C;BEGIN &#x4E0D;&#x4F1A;&#x963B;&#x585E;&#x4EFB;&#x4F55;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E14;&#x80FD;&#x4FDD;&#x8BC1;&#x5BFC;&#x51FA;&#x65F6;&#x6570;&#x636E;&#x5E93;&#x7684;&#x4E00;&#x81F4;&#x6027;&#x72B6;&#x6001;&#x3002;&#x5B83;&#x53EA;&#x9002;&#x7528;&#x4E8E;&#x4E8B;&#x52A1;&#x8868;&#xFF0C;&#x4F8B;&#x5982; InnoDB &#x548C; BDB&#x3002;&#x672C;&#x9009;&#x9879;&#x548C; &#x2013;lock-tables &#x9009;&#x9879;&#x662F;&#x4E92;&#x65A5;&#x7684;&#xFF0C;&#x56E0;&#x4E3A; LOCK TABLES &#x4F1A;&#x4F7F;&#x4EFB;&#x4F55;&#x6302;&#x8D77;&#x7684;&#x4E8B;&#x52A1;&#x9690;&#x542B;&#x63D0;&#x4EA4;&#x3002;&#x8981;&#x60F3;&#x5BFC;&#x51FA;&#x5927;&#x8868;&#x7684;&#x8BDD;&#xFF0C;&#x5E94;&#x7ED3;&#x5408;&#x4F7F;&#x7528; &#x2013;quick &#x9009;&#x9879;&#x3002; &#x2013;triggers&#x540C;&#x65F6;&#x5BFC;&#x51FA;&#x89E6;&#x53D1;&#x5668;&#x3002;&#x8BE5;&#x9009;&#x9879;&#x9ED8;&#x8BA4;&#x542F;&#x7528;&#xFF0C;&#x7528; &#x2013;skip-triggers &#x7981;&#x7528;&#x5B83;&#x3002; &#x4F8B;&#xFF1A;&#x4F7F;&#x7528;mysqldump&#x5907;&#x4EFD;&#xFF1A; 1/usr/local/mysql/bin/mysqldump -uroot -pxxx --opt test &gt;/backup/test.sql &#x8FD8;&#x539F;&#xFF1A;/usr/local/mysql/bin/mysqldump -uroot -pxxx test &#x56DB;&#x3001;&#x4F7F;&#x7528;&#x4E3B;&#x4ECE;&#x590D;&#x5236;&#x673A;&#x5236;(replication)&#xFF08;&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x5E93;&#x5B9E;&#x65F6;&#x5907;&#x4EFD;&#xFF09;&#x63A8;&#x8350;&#x89C1;&#xFF1A;MySQL&#x4E3B;&#x4ECE;&#x590D;&#x5236; &#x6700;&#x540E;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;mysql&#x81EA;&#x52A8;&#x5907;&#x4EFD;&#x811A;&#x672C;&#xFF0C;&#x4F7F;&#x7528;mysqldump&#x5DE5;&#x5177;123456789101112131415161718192021#!/bin/bash#caishzh 20120509 BAKDIR=&quot;/backup/mysql&quot; #mysql&#x5907;&#x4EFD;&#x76EE;&#x5F55;MAIL=&quot;xxx@xxx.com&quot; #&#x90AE;&#x7BB1;&#x5730;&#x5740;USER=&quot;root&quot; #mysql&#x7528;&#x6237;&#x540D;PASSWD=&quot;jjj&quot; #mysql&#x5BC6;&#x7801;DB=&quot;test&quot; #&#x6570;&#x636E;&#x5E93;&#x540D;DATE=$(date &quot;+%Y%m%d&quot;) #&#x65E5;&#x671F; [ -d &quot;$BAKDIR&quot; ] || mkdir -p &quot;$BAKDIR&quot; #&#x5982;&#x679C;&#x5907;&#x4EFD;&#x76EE;&#x5F55;&#x4E0D;&#x5B58;&#x5728;&#x5219;&#x521B;&#x5EFA; mysqldump -opt -u$USER -p$PASSWD $DB |gzip &gt; $BKDIR/$DB_$DATA.gz #&#x5907;&#x4EFD;&#x5E76;&#x4F7F;&#x7528;gzip&#x6253;&#x5305; if [ $? -eq 0 ];then #echo &quot;$DB mysql backup&quot; |mutt $MAIL -a $BKDIR/$DB_$DATA.sql -s &quot;$DB mysql backup&quot; ls -lh $BAKDIR/*.gz&gt;$BAKDIR/messages.txt mutt $MAIL -a $BKDIR/$DB_$DATA.gz -s &quot;$DATE&#xFF1A;$DB mysql backup&quot; &lt; $BAKDIR/messages.txtelse echo &quot;$DATE mysql backup failed&quot;|mail -s &quot;$DATE msyql bacup failed&quot; $MAILfi &#x53C2;&#x8003;&#xFF1A;http://imysql.cn/mysql_backup_and_recoverhttp://bbs.chinaunix.net/thread-1017116-1-1.htmlhttp://blog.csdn.net/fafa211/article/details/2344567http://blog.sina.com.cn/s/blog_4e424e2101000c1x.htmlhttp://www.opsers.org/linux-home/server/regular-backup-of-mysql-database-and-send-to-your-mailbox.html]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iptables模块介绍：connlimit]]></title>
    <url>%2F2012%2F05%2F10%2Fiptables%E6%A8%A1%E5%9D%97%E4%BB%8B%E7%BB%8D%EF%BC%9Aconnlimit%2F</url>
    <content type="text"><![CDATA[connlimit&#x6A21;&#x5757;&#x5141;&#x8BB8;&#x4F60;&#x9650;&#x5236;&#x6BCF;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;ip&#x7684;&#x5E76;&#x53D1;&#x8FDE;&#x63A5;&#x6570;&#xFF0C;&#x5373;&#x6BCF;&#x4E2A;ip&#x540C;&#x65F6;&#x8FDE;&#x63A5;&#x5230;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x4E2A;&#x6570;&#x3002;connlimit&#x6A21;&#x5757;&#x4E3B;&#x8981;&#x53EF;&#x4EE5;&#x9650;&#x5236;&#x5185;&#x7F51;&#x7528;&#x6237;&#x7684;&#x7F51;&#x7EDC;&#x4F7F;&#x7528;&#xFF0C;&#x5BF9;&#x670D;&#x52A1;&#x5668;&#x800C;&#x8A00;&#x5219;&#x53EF;&#x4EE5;&#x9650;&#x5236;&#x6BCF;&#x4E2A;ip&#x53D1;&#x8D77;&#x7684;&#x8FDE;&#x63A5;&#x6570;&#x3002; &#x53C2;&#x6570;&#xFF1A; 12--connlimit-above n &#x9650;&#x5236;&#x4E3A;&#x591A;&#x5C11;&#x4E2A;--connlimit-mask n &#x8FD9;&#x7EC4;&#x4E3B;&#x673A;&#x7684;&#x63A9;&#x7801;,&#x9ED8;&#x8BA4;&#x662F;connlimit-mask 32 ,&#x5373;&#x6BCF;ip. &#x4F8B;&#xFF1A;&#xFF03;&#x5141;&#x8BB8;&#x6BCF;&#x4E2A;&#x5BA2;&#x6237;&#x673A;&#x540C;&#x65F6;&#x4E24;&#x4E2A;telnet&#x8FDE;&#x63A5; 123iptables -A INPUT -p tcp --syn --dport 23 -m connlimit --connlimit-above 2 -j REJECT&#x6216;iptables -A INPUT -p tcp --syn --dport 23 -m connlimit ! --connlimit-above 2 -j ACCEPT #&#x53EA;&#x5141;&#x8BB8;&#x6BCF;&#x7EC4;C&#x7C7B;ip&#x540C;&#x65F6;16&#x4E2A;http&#x8FDE;&#x63A5; 1iptables -p tcp --syn --dport 80 -m connlimit --connlimit-above 16 --connlimit-mask 24 -j REJECT #&#x53EA;&#x5141;&#x8BB8;&#x6BCF;&#x4E2A;ip&#x540C;&#x65F6;5&#x4E2A;80&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;,&#x8D85;&#x8FC7;&#x7684;&#x4E22;&#x5F03;: 1iptables -I FORWARD -p tcp --syn --dport 80 -m connlimit --connlimit-above 5 -j DROP #&#x53EA;&#x5141;&#x8BB8;&#x6BCF;&#x7EC4;C&#x7C7B;ip&#x540C;&#x65F6;10&#x4E2A;80&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;: 1iptables -I FORWARD -p tcp --syn --dport 80 -m connlimit --connlimit-above 10 --connlimit-mask 24 -j DROP #&#x4E3A;&#x4E86;&#x9632;&#x6B62;DOS&#x592A;&#x591A;&#x8FDE;&#x63A5;&#x8FDB;&#x6765;,&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x5141;&#x8BB8;&#x6700;&#x591A;15&#x4E2A;&#x521D;&#x59CB;&#x8FDE;&#x63A5;,&#x8D85;&#x8FC7;&#x7684;&#x4E22;&#x5F03;. 12iptables -A INPUT -s 192.186.1.0/24 -p tcp --syn -m connlimit --connlimit-above 15 -j DROPiptables -A INPUT -s 192.186.1.0/24 -p tcp -m state --state ESTABLISHED,RELATED -j ACCEPT]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>shell</tag>
        <tag>iptables</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iptables模块介绍：limit]]></title>
    <url>%2F2012%2F05%2F10%2Fiptables%E6%A8%A1%E5%9D%97%E4%BB%8B%E7%BB%8D%EF%BC%9Alimit%2F</url>
    <content type="text"><![CDATA[limit&#x6A21;&#x5757;&#x7528;&#x4E8E;&#x9650;&#x5236;&#x5339;&#x914D;&#x6570;&#x636E;&#x5305;&#x7684;&#x9891;&#x7387;&#x6216;&#x901F;&#x7387; limit&#x7684;&#x5DE5;&#x4F5C;&#x65B9;&#x5F0F;&#x5C31;&#x50CF;&#x4E00;&#x4E2A;&#x5355;&#x4F4D;&#x5927;&#x95E8;&#x53E3;&#x7684;&#x4FDD;&#x5B89;&#xFF0C;&#x5F53;&#x6709;&#x4EBA;&#x8981;&#x8FDB;&#x5165;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x627E;&#x4ED6;&#x529E;&#x7406;&#x901A;&#x884C;&#x8BC1;&#x3002;&#x65E9;&#x4E0A;&#x4E0A;&#x73ED;&#x65F6;&#xFF0C;&#x4FDD;&#x5B89;&#x624B;&#x91CC;&#x6709;&#x4E00;&#x5B9A;&#x6570;&#x91CF;&#x7684;&#x901A;&#x884C;&#x8BC1;&#xFF0C;&#x6765;&#x4E00;&#x4E2A;&#x4EBA;&#xFF0C;&#x5C31;&#x7B7E;&#x53D1;&#x4E00;&#x4E2A;&#xFF0C;&#x5F53;&#x901A;&#x884C;&#x8BC1;&#x7528;&#x5B8C;&#x540E;&#xFF0C;&#x518D;&#x6765;&#x4EBA;&#x5C31;&#x8FDB;&#x4E0D;&#x53BB;&#x4E86;&#xFF0C;&#x4F46;&#x4ED6;&#x4EEC;&#x4E0D;&#x4F1A;&#x7B49;&#xFF0C;&#x800C;&#x662F;&#x5230;&#x522B;&#x7684;&#x5730;&#x65B9;&#x53BB;&#xFF08;&#x5728;iptables&#x91CC;&#xFF0C;&#x8FD9;&#x76F8;&#x5F53;&#x4E8E;&#x4E00;&#x4E2A;&#x5305;&#x4E0D;&#x7B26;&#x5408;&#x67D0;&#x6761;&#x89C4;&#x5219;&#xFF0C;&#x5C31;&#x4F1A;&#x7531;&#x540E;&#x9762;&#x7684;&#x89C4;&#x5219;&#x6765;&#x5904;&#x7406;&#xFF0C;&#x5982;&#x679C;&#x90FD;&#x4E0D;&#x7B26;&#x5408;&#xFF0C;&#x5C31;&#x7531;&#x7F3A;&#x7701;&#x7684;&#x7B56;&#x7565;&#x5904;&#x7406;&#xFF09;&#x3002;&#x4F46;&#x6709;&#x4E2A;&#x89C4;&#x5B9A;&#xFF0C;&#x6BCF;&#x9694;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x4FDD;&#x5B89;&#x5C31;&#x8981;&#x7B7E;&#x53D1;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x901A;&#x884C;&#x8BC1;&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x540E;&#x9762;&#x6765;&#x7684;&#x4EBA;&#x5982;&#x679C;&#x6070;&#x5DE7;&#x8D76;&#x4E0A;&#xFF0C;&#x4E5F;&#x5C31;&#x53EF;&#x4EE5;&#x8FDB;&#x53BB;&#x4E86;&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x4EBA;&#x6765;&#xFF0C;&#x90A3;&#x901A;&#x884C;&#x8BC1;&#x5C31;&#x4FDD;&#x7559;&#x4E0B;&#x6765;&#xFF0C;&#x4EE5;&#x5907;&#x6765;&#x7684;&#x4EBA;&#x7528;&#x3002;&#x5982;&#x679C;&#x4E00;&#x76F4;&#x6CA1;&#x4EBA;&#x6765;&#xFF0C;&#x53EF;&#x7528;&#x7684;&#x901A;&#x884C;&#x8BC1;&#x7684;&#x6570;&#x91CF;&#x5C31;&#x589E;&#x52A0;&#x4E86;&#xFF0C;&#x4F46;&#x4E0D;&#x662F;&#x65E0;&#x9650;&#x589E;&#x5927;&#x7684;&#xFF0C;&#x6700;&#x591A;&#x4E5F;&#x5C31;&#x662F;&#x521A;&#x5F00;&#x59CB;&#x65F6;&#x4FDD;&#x5B89;&#x624B;&#x91CC;&#x6709;&#x7684;&#x90A3;&#x4E2A;&#x6570;&#x91CF;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x521A;&#x5F00;&#x59CB;&#x65F6;&#xFF0C;&#x901A;&#x884C;&#x8BC1;&#x7684;&#x6570;&#x91CF;&#x662F;&#x6709;&#x9650;&#x7684;&#xFF0C;&#x4F46;&#x6BCF;&#x9694;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x5C31;&#x6709;&#x65B0;&#x7684;&#x901A;&#x884C;&#x8BC1;&#x53EF;&#x7528;&#x3002;limit match&#x6709;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x5C31;&#x5BF9;&#x5E94;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x2013;limit-burst&#x6307;&#x5B9A;&#x521A;&#x5F00;&#x59CB;&#x65F6;&#x6709;&#x591A;&#x5C11;&#x901A;&#x884C;&#x8BC1;&#x53EF;&#x7528;&#xFF0C;&#x2013;limit&#x6307;&#x5B9A;&#x8981;&#x9694;&#x591A;&#x957F;&#x65F6;&#x95F4;&#x624D;&#x80FD;&#x7B7E;&#x53D1;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x901A;&#x884C;&#x8BC1;&#x3002;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x5F3A;&#x8C03;&#x7684;&#x662F;&#x201C;&#x7B7E;&#x53D1;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x901A;&#x884C;&#x8BC1;&#x201D;&#xFF0C;&#x8FD9;&#x662F;&#x4EE5;iptables&#x7684;&#x89D2;&#x5EA6;&#x8003;&#x8651;&#x7684;&#x3002;&#x5728;&#x4F60;&#x81EA;&#x5DF1;&#x5199;&#x89C4;&#x5219;&#x65F6;&#xFF0C;&#x5C31;&#x8981;&#x4ECE;&#x8FD9;&#x4E2A;&#x89D2;&#x5EA6;&#x8003;&#x8651;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x4F60;&#x6307;&#x5B9A;&#x4E86;&#x2013;limit 3/minute &#x2013;limit-burst 5 &#xFF0C;&#x610F;&#x601D;&#x662F;&#x5F00;&#x59CB;&#x65F6;&#x6709;5&#x4E2A;&#x901A;&#x884C;&#x8BC1;&#xFF0C;&#x7528;&#x5B8C;&#x4E4B;&#x540E;&#x6BCF;20&#x79D2;&#x589E;&#x52A0;&#x4E00;&#x4E2A;&#xFF08;&#x8FD9;&#x5C31;&#x662F;&#x4ECE;iptables&#x7684;&#x89D2;&#x5EA6;&#x770B;&#x7684;&#xFF0C;&#x8981;&#x662F;&#x4EE5;&#x7528;&#x6237;&#x7684;&#x89D2;&#x5EA6;&#x770B;&#xFF0C;&#x8BF4;&#x6CD5;&#x5C31;&#x662F;&#x6BCF;&#x4E00;&#x5206;&#x949F;&#x589E;&#x52A0;&#x4E09;&#x4E2A;&#x6216;&#x8005;&#x6BCF;&#x5206;&#x949F;&#x53EA;&#x80FD;&#x8FC7;&#x4E09;&#x4E2A;&#xFF09;&#x3002;&#x4F60;&#x8981;&#x662F;&#x60F3;&#x6BCF;20&#x5206;&#x949F;&#x8FC7;&#x4E00;&#x4E2A;&#xFF0C;&#x53EA;&#x80FD;&#x5199;&#x6210;&#x2013;limit 3/hour &#x2013;limit-burst 5&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x4F60;&#x8981;&#x628A;&#x65F6;&#x95F4;&#x5355;&#x4F4D;&#x51D1;&#x6210;&#x6574;&#x7684;&#x3002; &#x4F8B;&#x5982;&#x8BBE;&#x7F6E;&#x4EE5;&#x4E0B;&#x89C4;&#x5219;&#xFF1A; 12iptables -A INPUT -p icmp -m limit --limit 6/m --limit-burst 5 -j ACCEPTiptables -A INPUT -p icmp -j DROP &#x7136;&#x540E;&#x4ECE;&#x53E6;&#x4E00;&#x90E8;&#x4E3B;&#x673A;&#x4E0A;ping&#x8FD9;&#x90E8;&#x4E3B;&#x673A;&#xFF0C;&#x5C31;&#x4F1A;&#x53D1;&#x751F;&#x5982;&#x4E0B;&#x7684;&#x73B0;&#x8C61;&#xFF1A;&#x9996;&#x5148;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x524D;&#x56DB;&#x4E2A;&#x5305;&#x7684;&#x56DE;&#x5E94;&#x90FD;&#x5F88;&#x6B63;&#x5E38;&#xFF0C;&#x7136;&#x540E;&#x4ECE;&#x7B2C;&#x4E94;&#x4E2A;&#x5305;&#x5F00;&#x59CB;&#xFF0C;&#x6211;&#x4EEC;&#x6BCF;10&#x79D2;&#x53EF;&#x4EE5;&#x6536;&#x5230;&#x4E00;&#x4E2A;&#x6B63;&#x5E38;&#x7684;&#x56DE;&#x5E94;&#x3002;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x8BBE;&#x5B9A;&#x4E86;&#x5355;&#x4F4D;&#x65F6;&#x95F4;(&#x5728;&#x8FD9;&#x91CC;&#x662F;&#x6BCF;&#x5206;&#x949F;)&#x5185;&#x5141;&#x8BB8;&#x901A;&#x8FC7;&#x7684;&#x6570;&#x636E;&#x5305;&#x7684;&#x4E2A;&#x6570;&#x662F;&#x6BCF;&#x5206;&#x949F;6&#x4E2A;&#xFF0C;&#x4E5F;&#x5373;&#x6BCF;10&#x79D2;&#x949F;&#x4E00;&#x4E2A;&#xFF1B;&#x5176;&#x6B21;&#x6211;&#x4EEC;&#x53C8;&#x8BBE;&#x5B9A;&#x4E86;&#x4E8B;&#x4EF6;&#x89E6;&#x53D1;&#x9600;&#x503C;&#x4E3A;5&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x7684;&#x524D;&#x56DB;&#x4E2A;&#x5305;&#x90FD;&#x662F;&#x6B63;&#x5E38;&#x7684;&#xFF0C;&#x53EA;&#x662F;&#x4ECE;&#x7B2C;&#x4E94;&#x4E2A;&#x5305;&#x5F00;&#x59CB;&#xFF0C;&#x9650;&#x5236;&#x89C4;&#x5219;&#x5F00;&#x59CB;&#x751F;&#x6548;&#xFF0C;&#x6545;&#x53EA;&#x80FD;&#x6BCF;10&#x79D2;&#x6536;&#x5230;&#x4E00;&#x4E2A;&#x6B63;&#x5E38;&#x56DE;&#x5E94;&#x3002;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x505C;&#x6B62;ping&#xFF0C;30&#x79D2;&#x540E;&#x53C8;&#x5F00;&#x59CB;ping&#xFF0C;&#x8FD9;&#x65F6;&#x7684;&#x73B0;&#x8C61;&#x662F;&#xFF1A;&#x524D;&#x4E24;&#x4E2A;&#x5305;&#x662F;&#x6B63;&#x5E38;&#x7684;&#xFF0C;&#x4ECE;&#x7B2C;&#x4E09;&#x4E2A;&#x5305;&#x5F00;&#x59CB;&#x4E22;&#x5305;&#xFF0C;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x7684;&#x5141;&#x8BB8;&#x4E00;&#x4E2A;&#x5305;&#x901A;&#x8FC7;&#x7684;&#x5468;&#x671F;&#x662F;10&#x79D2;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x4E00;&#x4E2A;&#x5468;&#x671F;&#x5185;&#x7CFB;&#x7EDF;&#x6CA1;&#x6709;&#x6536;&#x5230;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;&#x5305;&#xFF0C;&#x7CFB;&#x7EDF;&#x7684;&#x89E6;&#x53D1;&#x503C;&#x5C31;&#x4F1A;&#x6062;&#x590D;1&#xFF0C;&#x6240;&#x4EE5;&#x5047;&#x5982;&#x6211;&#x4EEC;30&#x79D2;&#x5185;&#x6CA1;&#x6709;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;&#x5305;&#x901A;&#x8FC7;&#xFF0C;&#x7CFB;&#x7EDF;&#x7684;&#x89E6;&#x53D1;&#x503C;&#x5C31;&#x4F1A;&#x6062;&#x590D;&#x5230;3&#xFF0C;&#x5047;&#x5982;5&#x4E2A;&#x5468;&#x671F;&#x5185;&#x90FD;&#x6CA1;&#x6709;&#x7B26;&#x5408;&#x6761;&#x4EF6;&#x7684;&#x5305;&#x901A;&#x8FC7;&#xFF0C;&#x7CFB;&#x7EDF;&#x90FD;&#x89E6;&#x53D1;&#x503C;&#x5C31;&#x4F1A;&#x5B8C;&#x5168;&#x6062;&#x590D;&#x3002; &#x4F8B;&#xFF1A;&#x9632;&#x6B62;SYN-Flood &#x788E;&#x7247;&#x653B;&#x51FB; 1234iptables -N syn-floodiptables -A syn-flood -m limit &#x2013;limit 100/s &#x2013;limit-burst 150 -j RETURNiptables -A syn-flood -j DROPiptables -I INPUT -j syn-flood]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>iptables</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL忘记root密码后强制修改密码的方法]]></title>
    <url>%2F2012%2F05%2F08%2FMySQL%E5%BF%98%E8%AE%B0root%E5%AF%86%E7%A0%81%E5%90%8E%E5%BC%BA%E5%88%B6%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81%E7%9A%84%E6%96%B9%E6%B3%95%2F</url>
    <content type="text"><![CDATA[&#x9996;&#x5148;&#x628A;mysqld&#x505C;&#x6B62; 1service mysqld stop &#x542F;&#x52A8;mysql&#xFF0C;&#x4F46;&#x662F;&#x8981;&#x8DF3;&#x8FC7;&#x6743;&#x9650;&#x8868; 1/usr/local/mysql/bin/mysqld_safe --skip-grant-tables &amp; &#x8FDB;&#x53BB;mysql&#xFF0C;&#x5E76;&#x4FEE;&#x6539;&#x5BC6;&#x7801; 12345mysql -u rootmysql&gt;use mysql;mysql&gt;update user set password=password(&quot;newpass&quot;) where user=&quot;root&quot;;mysql&gt;flush privileges;mysql&gt;\q &#x91CD;&#x65B0;&#x542F;&#x52A8;mysql&#xFF0C;&#x6B63;&#x5E38;&#x8FDB;&#x5165;]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iptables范例]]></title>
    <url>%2F2012%2F05%2F08%2Fiptables%E8%8C%83%E4%BE%8B%2F</url>
    <content type="text"><![CDATA[&#x53EA;&#x80FD;&#x6536;&#x53D1;&#x90AE;&#x4EF6;&#xFF0C;&#x522B;&#x7684;&#x90FD;&#x5173;&#x95ED; 1234iptables -I Filter -m mac &#x2013;mac-source 00:0F:EA:25:51:37 -j DROPiptables -I Filter -m mac &#x2013;mac-source 00:0F:EA:25:51:37 -p udp --dport 53 -j ACCEPTiptables -I Filter -m mac &#x2013;mac-source 00:0F:EA:25:51:37 -p tcp --dport 25 -j ACCEPTiptables -I Filter -m mac &#x2013;mac-source 00:0F:EA:25:51:37 -p tcp --dport 110 -j ACCEPT DMZ 1iptables -t nat -A PREROUTING -p tcp --dport 80 -d $INTERNET_ADDR -j DNAT --to-destination 192.168.100.2:80 &#xFF03;&#x4FEE;&#x6539;&#x76EE;&#x6807;&#x5730;&#x5740;&#xFF0C;&#x7528;&#x4E8E;&#x5728;&#x9632;&#x706B;&#x5899;&#x540E;&#x7AEF;&#x7684;web&#x670D;&#x52A1;&#x5668; &#x8DEF;&#x7531;&#x529F;&#x80FD; 123echo &quot;1&quot; &gt; /proc/sys/net/ipv4/ip_forward &#xFF03;&#x5F00;&#x542F;&#x8F6C;&#x53D1;iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o eth1 -j MASQUERADE &#xFF03;eth1&#x662F;&#x516C;&#x7F51;&#x7F51;&#x5361;&#xFF0C;&#x4F7F;&#x7528;&#x4F2A;&#x88C5;MASQUERADEiptables -t nat -A POSTROUTING -o eth0 -j SNAT --to-source 118.145.2.239 &#xFF03;&#x4E0D;&#x4F7F;&#x7528;&#x4F2A;&#x88C5;&#xFF0C;&#x4FEE;&#x6539;&#x6E90;&#x5730;&#x5740;&#x4E3A;&#x516C;&#x7F51;&#x5730;&#x5740;118.145.2.239 FTP&#x670D;&#x52A1;&#x5668;&#x7684;NAT 12iptables -I PFWanPriv -p tcp --dport 21 -d 192.168.100.200 -j ACCEPTiptables -t nat -A PREROUTING -p tcp --dport 21 -d $INTERNET_ADDR -j DNAT --to-destination 192.168.100.200:21 &#x53EA;&#x5141;&#x8BB8;&#x8BBF;&#x95EE;&#x6307;&#x5B9A;&#x7F51;&#x5740; 12345iptables -A Filter -p udp --dport 53 -j ACCEPTiptables -A Filter -p tcp --dport 53 -j ACCEPTiptables -A Filter -d www.3322.org -j ACCEPTiptables -A Filter -d img.cn99.com -j ACCEPTiptables -A Filter -j DROP &#x5F00;&#x653E;&#x4E00;&#x4E2A;IP&#x7684;&#x4E00;&#x4E9B;&#x7AEF;&#x53E3;&#xFF0C;&#x5176;&#x5B83;&#x90FD;&#x5C01;&#x95ED; 1234567iptables -A Filter -p tcp --dport 80 -s 192.168.100.200 -d www.pconline.com.cn -j ACCEPTiptables -A Filter -p tcp --dport 25 -s 192.168.100.200 -j ACCEPTiptables -A Filter -p tcp --dport 109 -s 192.168.100.200 -j ACCEPTiptables -A Filter -p tcp --dport 110 -s 192.168.100.200 -j ACCEPTiptables -A Filter -p tcp --dport 53 -j ACCEPTiptables -A Filter -p udp --dport 53 -j ACCEPTiptables -A Filter -j DROP &#x591A;&#x4E2A;&#x7AEF;&#x53E3; 1iptables -A Filter -p tcp -m multiport &#x2013;destination-port 22,53,80,110 -s 192.168.20.3 -j REJECT &#x8FDE;&#x7EED;&#x7AEF;&#x53E3; 1iptables -A Filter -p tcp -m multiport &#x2013;source-port 22,53,80,110 -s 192.168.20.3 -j REJECT &#x6307;&#x5B9A;&#x65F6;&#x95F4;&#x4E0A;&#x7F51; 123iptables -A Filter -s 10.10.10.253 -m time &#x2013;timestart 6:00 &#x2013;timestop 11:00 &#x2013;days Mon,Tue,Wed,Thu,Fri,Sat,Sun -j DROPiptables -A Filter -m time &#x2013;timestart 12:00 &#x2013;timestop 13:00 &#x2013;days Mon,Tue,Wed,Thu,Fri,Sat,Sun -j ACCEPTiptables -A Filter -m time &#x2013;timestart 17:30 &#x2013;timestop 8:30 &#x2013;days Mon,Tue,Wed,Thu,Fri,Sat,Sun -j ACCEPT &#x7981;&#x6B62;&#x591A;&#x4E2A;&#x7AEF;&#x53E3;&#x670D;&#x52A1; 1iptables -A Filter -m multiport -p tcp --dport 21,23,80 -j ACCEPT &#x5C06;WAN &#x53E3;NAT&#x5230;PC 1iptables -t nat -A PREROUTING -i $INTERNET_IF -d $INTERNET_ADDR -j DNAT &#x2013;to-destination 192.168.0.1 &#x5C06;WAN&#x53E3;8000&#x7AEF;&#x53E3;NAT&#x5230;192.168.100.200&#x7684;80&#x7AEF;&#x53E3; 1iptables -t nat -A PREROUTING -p tcp --dport 8000 -d $INTERNET_ADDR -j DNAT &#x2013;to-destination 192.168.100.200:80 MAIL&#x670D;&#x52A1;&#x5668;&#x8981;&#x8F6C;&#x7684;&#x7AEF;&#x53E3; 12iptables -t nat -A PREROUTING -p tcp --dport 110 -d $INTERNET_ADDR -j DNAT &#x2013;to-destination 192.168.100.200:110iptables -t nat -A PREROUTING -p tcp --dport 25 -d $INTERNET_ADDR -j DNAT &#x2013;to-destination 192.168.100.200:25 &#x53EA;&#x5141;&#x8BB8;PING 202&#x3002;96&#x3002;134&#x3002;133,&#x522B;&#x7684;&#x670D;&#x52A1;&#x90FD;&#x7981;&#x6B62; 12iptables -A Filter -p icmp -s 192.168.100.200 -d 202.96.134.133 -j ACCEPTiptables -A Filter -j DROP &#x7981;&#x7528;QQ&#x9632;&#x706B;&#x5899;&#x914D;&#x7F6E; 1234iptables -A Filter -p udp --dport ! 53 -j DROPiptables -A Filter -d 218.17.209.0/24 -j DROPiptables -A Filter -d 218.18.95.0/24 -j DROPiptables -A Filter -d 219.133.40.177 -j DROP &#x57FA;&#x4E8E;MAC&#xFF0C;&#x53EA;&#x80FD;&#x6536;&#x53D1;&#x90AE;&#x4EF6;&#xFF0C;&#x5176;&#x5B83;&#x90FD;&#x62D2;&#x7EDD; 123iptables -I Filter -m mac &#x2013;mac-source 00:0A:EB:97:79:A1 -j DROPiptables -I Filter -m mac &#x2013;mac-source 00:0A:EB:97:79:A1 -p tcp --dport 25 -j ACCEPTiptables -I Filter -m mac &#x2013;mac-source 00:0A:EB:97:79:A1 -p tcp --dport 110 -j ACCEPT &#x7981;&#x7528;MSN&#x914D;&#x7F6E; 1234iptables -A Filter -p udp --dport 9 -j DROPiptables -A Filter -p tcp --dport 1863 -j DROPiptables -A Filter -p tcp --dport 80 -d 207.68.178.238 -j DROPiptables -A Filter -p tcp --dport 80 -d 207.46.110.0/24 -j DROP &#x53EA;&#x5141;&#x8BB8;PING 202.96.134.133 &#x5176;&#x5B83;&#x516C;&#x7F51;IP&#x90FD;&#x4E0D;&#x8BB8;PING 12iptables -A Filter -p icmp -s 192.168.100.200 -d 202.96.134.133 -j ACCEPTiptables -A Filter -p icmp -j DROP &#x7981;&#x6B62;&#x67D0;&#x4E2A;MAC&#x5730;&#x5740;&#x4E0A;&#x7F51;: 1iptables -I Filter -m mac &#x2013;mac-source 00:20:18:8F:72:F8 -j DROP &#x7981;&#x6B62;&#x67D0;&#x4E2A;IP&#x5730;&#x5740;&#x7684;PING: 1iptables &#x2013;A Filter &#x2013;p icmp &#x2013;s 192.168.0.1 &#x2013;j DROP &#x7981;&#x6B62;&#x67D0;&#x4E2A;IP&#x5730;&#x5740;&#x670D;&#x52A1;&#xFF1A; 12iptables &#x2013;A Filter -p tcp -s 192.168.0.1 --dport 80 -j DROPiptables &#x2013;A Filter -p udp -s 192.168.0.1 --dport 53 -j DROP &#x53EA;&#x5141;&#x8BB8;&#x67D0;&#x4E9B;&#x670D;&#x52A1;&#xFF0C;&#x5176;&#x4ED6;&#x90FD;&#x62D2;&#x7EDD;(2&#x6761;&#x89C4;&#x5219;) 12iptables -A Filter -p tcp -s 192.168.0.1 --dport 1000 -j ACCEPTiptables -A Filter -j DROP &#x7981;&#x6B62;&#x67D0;&#x4E2A;IP&#x5730;&#x5740;&#x7684;&#x67D0;&#x4E2A;&#x7AEF;&#x53E3;&#x670D;&#x52A1; 1iptables -A Filter -p tcp -s 10.10.10.253 --dport 80 -j DROP]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>iptables</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[nginx设置expires和access_log提升网站访问速度]]></title>
    <url>%2F2012%2F05%2F03%2Fnginx%E8%AE%BE%E7%BD%AEexpires%E5%92%8Caccess_log%E6%8F%90%E5%8D%87%E7%BD%91%E7%AB%99%E8%AE%BF%E9%97%AE%E9%80%9F%E5%BA%A6%2F</url>
    <content type="text"><![CDATA[&#x56FE;&#x7247;&#x3001;css&#x3001;js&#x7B49;&#x6587;&#x4EF6;&#x5F80;&#x5F80;&#x4F1A;&#x5360;&#x7528;&#x6389;&#x4E00;&#x4E2A;&#x7F51;&#x7AD9;&#x5927;&#x91CF;&#x7684;&#x670D;&#x52A1;&#x5668;&#x5E26;&#x5BBD;&#x548C;&#x9875;&#x9762;&#x8F7D;&#x5165;&#x65F6;&#x95F4;&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528;nginx&#x505A;&#x524D;&#x7AEF;&#x670D;&#x52A1;&#x5668;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x7C7B;&#x4F3C;&#x7684;&#x9759;&#x6001;&#x6587;&#x4EF6;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x7F13;&#x5B58;&#x65F6;&#x95F4;&#x3002;&#x4F8B;&#x5982;: 1234location ~ \.(gif|jpg|jpeg|png|bmp|ico|swf|css|js)$ {expires 15d;access_log off;} &#x5C06;&#x7C7B;&#x4F3C;&#x9759;&#x6001;&#x6587;&#x4EF6;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x7F13;&#x5B58;&#x65F6;&#x95F4;&#x8BBE;&#x7F6E;&#x4E3A;15&#x5929;&#xFF0C;&#x8FD9;&#x6837;&#x5BA2;&#x6237;&#x5728;30&#x5929;&#x5185;&#x91CD;&#x65B0;&#x8BBF;&#x95EE;&#x8FD9;&#x4E9B;&#x6587;&#x4EF6;&#x65F6;&#x53EA;&#x9700;&#x8981;&#x5728;&#x672C;&#x5730;&#x7F13;&#x5B58;&#x4E2D;&#x8BFB;&#x53D6;&#xFF0C;&#x800C;&#x4E0D;&#x7528;&#x91CD;&#x65B0;&#x4ECE;&#x670D;&#x52A1;&#x5668;&#x83B7;&#x53D6;&#xFF0C;&#x5927;&#x5927;&#x63D0;&#x9AD8;&#x4E86;&#x7F51;&#x7AD9;&#x8BBF;&#x95EE;&#x901F;&#x5EA6;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x5BF9;&#x4E8E;&#x8FD9;&#x4E9B;&#x9759;&#x6001;&#x6587;&#x4EF6;&#x7684;&#x8BBF;&#x95EE;&#x8BB0;&#x5F55;&#x8BA1;&#x5165;&#x65E5;&#x5FD7;&#xFF0C;&#x5728;&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#x4E5F;&#x662F;&#x6CA1;&#x6709;&#x610F;&#x4E49;&#x7684;&#xFF0C;&#x5C06;accss_log&#x8BBE;&#x4E3A;off&#xFF0C;&#x4E5F;&#x80FD;&#x5728;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x4E0A;&#x964D;&#x4F4E;&#x670D;&#x52A1;&#x5668;&#x538B;&#x529B;&#x3002;]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[TCP连接状态详解及TIME_WAIT过多的解决方法]]></title>
    <url>%2F2012%2F04%2F25%2FTCP%E8%BF%9E%E6%8E%A5%E7%8A%B6%E6%80%81%E8%AF%A6%E8%A7%A3%E5%8F%8ATIME_WAIT%E8%BF%87%E5%A4%9A%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%2F</url>
    <content type="text"><![CDATA[&#x4E0A;&#x56FE;&#x5BF9;&#x6392;&#x9664;&#x548C;&#x5B9A;&#x4F4D;&#x7F51;&#x7EDC;&#x6216;&#x7CFB;&#x7EDF;&#x6545;&#x969C;&#x65F6;&#x5927;&#x6709;&#x5E2E;&#x52A9;&#xFF0C;&#x4F46;&#x662F;&#x600E;&#x6837;&#x7262;&#x7262;&#x5730;&#x5C06;&#x8FD9;&#x5F20;&#x56FE;&#x523B;&#x5728;&#x8111;&#x4E2D;&#x5462;&#xFF1F;&#x90A3;&#x4E48;&#x4F60;&#x5C31;&#x4E00;&#x5B9A;&#x8981;&#x5BF9;&#x8FD9;&#x5F20;&#x56FE;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x72B6;&#x6001;&#xFF0C;&#x53CA;&#x8F6C;&#x6362;&#x7684;&#x8FC7;&#x7A0B;&#x6709;&#x6DF1;&#x523B;&#x5730;&#x8BA4;&#x8BC6;&#xFF0C;&#x4E0D;&#x80FD;&#x53EA;&#x505C;&#x7559;&#x5728;&#x4E00;&#x77E5;&#x534A;&#x89E3;&#x4E4B;&#x4E2D;&#x3002;&#x4E0B;&#x9762;&#x5BF9;&#x8FD9;&#x5F20;&#x56FE;&#x7684;11&#x79CD;&#x72B6;&#x6001;&#x8BE6;&#x7EC6;&#x89E3;&#x91CA;&#x4E00;&#x4E0B;&#xFF0C;&#x4EE5;&#x4FBF;&#x52A0;&#x5F3A;&#x8BB0;&#x5FC6;&#xFF01;&#x4E0D;&#x8FC7;&#x5728;&#x8FD9;&#x4E4B;&#x524D;&#xFF0C;&#x5148;&#x56DE;&#x987E;&#x4E00;&#x4E0B;TCP&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x7684;&#x4E09;&#x6B21;&#x63E1;&#x624B;&#x8FC7;&#x7A0B;&#xFF0C;&#x4EE5;&#x53CA;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#x7684;&#x56DB;&#x6B21;&#x63E1;&#x624B;&#x8FC7;&#x7A0B;&#x3002; 1&#x3001;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x534F;&#x8BAE;&#xFF08;&#x4E09;&#x6B21;&#x63E1;&#x624B;&#xFF09;&#xFF08;1&#xFF09;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x5E26;SYN&#x6807;&#x5FD7;&#x7684;TCP&#x62A5;&#x6587;&#x5230;&#x670D;&#x52A1;&#x5668;&#x3002;&#x8FD9;&#x662F;&#x4E09;&#x6B21;&#x63E1;&#x624B;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x62A5;&#x6587;1&#x3002; &#xFF08;2&#xFF09; &#x670D;&#x52A1;&#x5668;&#x7AEF;&#x56DE;&#x5E94;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#xFF0C;&#x8FD9;&#x662F;&#x4E09;&#x6B21;&#x63E1;&#x624B;&#x4E2D;&#x7684;&#x7B2C;2&#x4E2A;&#x62A5;&#x6587;&#xFF0C;&#x8FD9;&#x4E2A;&#x62A5;&#x6587;&#x540C;&#x65F6;&#x5E26;ACK&#x6807;&#x5FD7;&#x548C;SYN&#x6807;&#x5FD7;&#x3002;&#x56E0;&#x6B64;&#x5B83;&#x8868;&#x793A;&#x5BF9;&#x521A;&#x624D;&#x5BA2;&#x6237;&#x7AEF;SYN&#x62A5;&#x6587;&#x7684;&#x56DE;&#x5E94;&#xFF1B;&#x540C;&#x65F6;&#x53C8;&#x6807;&#x5FD7;SYN&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x8BE2;&#x95EE;&#x5BA2;&#x6237;&#x7AEF;&#x662F;&#x5426;&#x51C6;&#x5907;&#x597D;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x901A;&#x8BAF;&#x3002; &#xFF08;3&#xFF09; &#x5BA2;&#x6237;&#x5FC5;&#x987B;&#x518D;&#x6B21;&#x56DE;&#x5E94;&#x670D;&#x52A1;&#x6BB5;&#x4E00;&#x4E2A;ACK&#x62A5;&#x6587;&#xFF0C;&#x8FD9;&#x662F;&#x62A5;&#x6587;&#x6BB5;3&#x3002; 2&#x3001;&#x8FDE;&#x63A5;&#x7EC8;&#x6B62;&#x534F;&#x8BAE;&#xFF08;&#x56DB;&#x6B21;&#x63E1;&#x624B;&#xFF09;&#x7531;&#x4E8E;TCP&#x8FDE;&#x63A5;&#x662F;&#x5168;&#x53CC;&#x5DE5;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x6BCF;&#x4E2A;&#x65B9;&#x5411;&#x90FD;&#x5FC5;&#x987B;&#x5355;&#x72EC;&#x8FDB;&#x884C;&#x5173;&#x95ED;&#x3002;&#x8FD9;&#x539F;&#x5219;&#x662F;&#x5F53;&#x4E00;&#x65B9;&#x5B8C;&#x6210;&#x5B83;&#x7684;&#x6570;&#x636E;&#x53D1;&#x9001;&#x4EFB;&#x52A1;&#x540E;&#x5C31;&#x80FD;&#x53D1;&#x9001;&#x4E00;&#x4E2A;FIN&#x6765;&#x7EC8;&#x6B62;&#x8FD9;&#x4E2A;&#x65B9;&#x5411;&#x7684;&#x8FDE;&#x63A5;&#x3002;&#x6536;&#x5230;&#x4E00;&#x4E2A; FIN&#x53EA;&#x610F;&#x5473;&#x7740;&#x8FD9;&#x4E00;&#x65B9;&#x5411;&#x4E0A;&#x6CA1;&#x6709;&#x6570;&#x636E;&#x6D41;&#x52A8;&#xFF0C;&#x4E00;&#x4E2A;TCP&#x8FDE;&#x63A5;&#x5728;&#x6536;&#x5230;&#x4E00;&#x4E2A;FIN&#x540E;&#x4ECD;&#x80FD;&#x53D1;&#x9001;&#x6570;&#x636E;&#x3002;&#x9996;&#x5148;&#x8FDB;&#x884C;&#x5173;&#x95ED;&#x7684;&#x4E00;&#x65B9;&#x5C06;&#x6267;&#x884C;&#x4E3B;&#x52A8;&#x5173;&#x95ED;&#xFF0C;&#x800C;&#x53E6;&#x4E00;&#x65B9;&#x6267;&#x884C;&#x88AB;&#x52A8;&#x5173;&#x95ED;&#x3002; &#xFF08;1&#xFF09; TCP&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x4E00;&#x4E2A;FIN&#xFF0C;&#x7528;&#x6765;&#x5173;&#x95ED;&#x5BA2;&#x6237;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7684;&#x6570;&#x636E;&#x4F20;&#x9001;&#xFF08;&#x62A5;&#x6587;&#x6BB5;4&#xFF09;&#x3002;&#xFF08;2&#xFF09; &#x670D;&#x52A1;&#x5668;&#x6536;&#x5230;&#x8FD9;&#x4E2A;FIN&#xFF0C;&#x5B83;&#x53D1;&#x56DE;&#x4E00;&#x4E2A;ACK&#xFF0C;&#x786E;&#x8BA4;&#x5E8F;&#x53F7;&#x4E3A;&#x6536;&#x5230;&#x7684;&#x5E8F;&#x53F7;&#x52A0;1&#xFF08;&#x62A5;&#x6587;&#x6BB5;5&#xFF09;&#x3002;&#x548C;SYN&#x4E00;&#x6837;&#xFF0C;&#x4E00;&#x4E2A;FIN&#x5C06;&#x5360;&#x7528;&#x4E00;&#x4E2A;&#x5E8F;&#x53F7;&#x3002;&#xFF08;3&#xFF09; &#x670D;&#x52A1;&#x5668;&#x5173;&#x95ED;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8FDE;&#x63A5;&#xFF0C;&#x53D1;&#x9001;&#x4E00;&#x4E2A;FIN&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#xFF08;&#x62A5;&#x6587;&#x6BB5;6&#xFF09;&#x3002;&#xFF08;4&#xFF09; &#x5BA2;&#x6237;&#x6BB5;&#x53D1;&#x56DE;ACK&#x62A5;&#x6587;&#x786E;&#x8BA4;&#xFF0C;&#x5E76;&#x5C06;&#x786E;&#x8BA4;&#x5E8F;&#x53F7;&#x8BBE;&#x7F6E;&#x4E3A;&#x6536;&#x5230;&#x5E8F;&#x53F7;&#x52A0;1&#xFF08;&#x62A5;&#x6587;&#x6BB5;7&#xFF09;&#x3002; CLOSED: &#x8FD9;&#x4E2A;&#x6CA1;&#x4EC0;&#x4E48;&#x597D;&#x8BF4;&#x7684;&#x4E86;&#xFF0C;&#x8868;&#x793A;&#x521D;&#x59CB;&#x72B6;&#x6001;&#x3002; LISTEN: &#x8FD9;&#x4E2A;&#x4E5F;&#x662F;&#x975E;&#x5E38;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x7684;&#x4E00;&#x4E2A;&#x72B6;&#x6001;&#xFF0C;&#x8868;&#x793A;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x7684;&#x67D0;&#x4E2A;SOCKET&#x5904;&#x4E8E;&#x76D1;&#x542C;&#x72B6;&#x6001;&#xFF0C;&#x53EF;&#x4EE5;&#x63A5;&#x53D7;&#x8FDE;&#x63A5;&#x4E86;&#x3002; SYN_RCVD: &#x8FD9;&#x4E2A;&#x72B6;&#x6001;&#x8868;&#x793A;&#x63A5;&#x53D7;&#x5230;&#x4E86;SYN&#x62A5;&#x6587;&#xFF0C;&#x5728;&#x6B63;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x4E2A;&#x72B6;&#x6001;&#x662F;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x7684;SOCKET&#x5728;&#x5EFA;&#x7ACB;TCP&#x8FDE;&#x63A5;&#x65F6;&#x7684;&#x4E09;&#x6B21;&#x63E1;&#x624B;&#x4F1A;&#x8BDD;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x4E2D;&#x95F4;&#x72B6;&#x6001;&#xFF0C;&#x5F88;&#x77ED;&#x6682;&#xFF0C;&#x57FA;&#x672C;&#x4E0A;&#x7528;netstat&#x4F60;&#x662F;&#x5F88;&#x96BE;&#x770B;&#x5230;&#x8FD9;&#x79CD;&#x72B6;&#x6001;&#x7684;&#xFF0C;&#x9664;&#x975E;&#x4F60;&#x7279;&#x610F;&#x5199;&#x4E86;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;&#xFF0C;&#x6545;&#x610F;&#x5C06;&#x4E09;&#x6B21;TCP&#x63E1;&#x624B;&#x8FC7;&#x7A0B;&#x4E2D;&#x6700;&#x540E;&#x4E00;&#x4E2A;ACK&#x62A5;&#x6587;&#x4E0D;&#x4E88;&#x53D1;&#x9001;&#x3002;&#x56E0;&#x6B64;&#x8FD9;&#x79CD;&#x72B6;&#x6001;&#x65F6;&#xFF0C;&#x5F53;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x7684;ACK&#x62A5;&#x6587;&#x540E;&#xFF0C;&#x5B83;&#x4F1A;&#x8FDB;&#x5165;&#x5230;ESTABLISHED&#x72B6;&#x6001;&#x3002; SYN_SENT: &#x8FD9;&#x4E2A;&#x72B6;&#x6001;&#x4E0E;SYN_RCVD&#x9065;&#x60F3;&#x547C;&#x5E94;&#xFF0C;&#x5F53;&#x5BA2;&#x6237;&#x7AEF;SOCKET&#x6267;&#x884C;CONNECT&#x8FDE;&#x63A5;&#x65F6;&#xFF0C;&#x5B83;&#x9996;&#x5148;&#x53D1;&#x9001;SYN&#x62A5;&#x6587;&#xFF0C;&#x56E0;&#x6B64;&#x4E5F;&#x968F;&#x5373;&#x5B83;&#x4F1A;&#x8FDB;&#x5165;&#x5230;&#x4E86;SYN_SENT&#x72B6;&#x6001;&#xFF0C;&#x5E76;&#x7B49;&#x5F85;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x53D1;&#x9001;&#x4E09;&#x6B21;&#x63E1;&#x624B;&#x4E2D;&#x7684;&#x7B2C;2&#x4E2A;&#x62A5;&#x6587;&#x3002;SYN_SENT&#x72B6;&#x6001;&#x8868;&#x793A;&#x5BA2;&#x6237;&#x7AEF;&#x5DF2;&#x53D1;&#x9001;SYN&#x62A5;&#x6587;&#x3002; ESTABLISHED&#xFF1A;&#x8FD9;&#x4E2A;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x4E86;&#xFF0C;&#x8868;&#x793A;&#x8FDE;&#x63A5;&#x5DF2;&#x7ECF;&#x5EFA;&#x7ACB;&#x4E86;&#x3002; FIN_WAIT_1: &#x8FD9;&#x4E2A;&#x72B6;&#x6001;&#x8981;&#x597D;&#x597D;&#x89E3;&#x91CA;&#x4E00;&#x4E0B;&#xFF0C;&#x5176;&#x5B9E;FIN_WAIT_1&#x548C;FIN_WAIT_2&#x72B6;&#x6001;&#x7684;&#x771F;&#x6B63;&#x542B;&#x4E49;&#x90FD;&#x662F;&#x8868;&#x793A;&#x7B49;&#x5F85;&#x5BF9;&#x65B9;&#x7684;FIN&#x62A5;&#x6587;&#x3002;&#x800C;&#x8FD9;&#x4E24;&#x79CD;&#x72B6;&#x6001;&#x7684;&#x533A;&#x522B;&#x662F;&#xFF1A;FIN_WAIT_1&#x72B6;&#x6001;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x5F53;SOCKET&#x5728;ESTABLISHED&#x72B6;&#x6001;&#x65F6;&#xFF0C;&#x5B83;&#x60F3;&#x4E3B;&#x52A8;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#xFF0C;&#x5411;&#x5BF9;&#x65B9;&#x53D1;&#x9001;&#x4E86;FIN&#x62A5;&#x6587;&#xFF0C;&#x6B64;&#x65F6;&#x8BE5;SOCKET&#x5373;&#x8FDB;&#x5165;&#x5230;FIN_WAIT_1&#x72B6;&#x6001;&#x3002;&#x800C;&#x5F53;&#x5BF9;&#x65B9;&#x56DE;&#x5E94;ACK&#x62A5;&#x6587;&#x540E;&#xFF0C;&#x5219;&#x8FDB;&#x5165;&#x5230;FIN_WAIT_2&#x72B6;&#x6001;&#xFF0C;&#x5F53;&#x7136;&#x5728;&#x5B9E;&#x9645;&#x7684;&#x6B63;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x65E0;&#x8BBA;&#x5BF9;&#x65B9;&#x4F55;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x90FD;&#x5E94;&#x8BE5;&#x9A6C;&#x4E0A;&#x56DE;&#x5E94;ACK&#x62A5;&#x6587;&#xFF0C;&#x6240;&#x4EE5;FIN_WAIT_1&#x72B6;&#x6001;&#x4E00;&#x822C;&#x662F;&#x6BD4;&#x8F83;&#x96BE;&#x89C1;&#x5230;&#x7684;&#xFF0C;&#x800C;FIN_WAIT_2&#x72B6;&#x6001;&#x8FD8;&#x6709;&#x65F6;&#x5E38;&#x5E38;&#x53EF;&#x4EE5;&#x7528;netstat&#x770B;&#x5230;&#x3002; FIN_WAIT_2&#xFF1A;&#x4E0A;&#x9762;&#x5DF2;&#x7ECF;&#x8BE6;&#x7EC6;&#x89E3;&#x91CA;&#x4E86;&#x8FD9;&#x79CD;&#x72B6;&#x6001;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;FIN_WAIT_2&#x72B6;&#x6001;&#x4E0B;&#x7684;SOCKET&#xFF0C;&#x8868;&#x793A;&#x534A;&#x8FDE;&#x63A5;&#xFF0C;&#x4E5F;&#x5373;&#x6709;&#x4E00;&#x65B9;&#x8981;&#x6C42;close&#x8FDE;&#x63A5;&#xFF0C;&#x4F46;&#x53E6;&#x5916;&#x8FD8;&#x544A;&#x8BC9;&#x5BF9;&#x65B9;&#xFF0C;&#x6211;&#x6682;&#x65F6;&#x8FD8;&#x6709;&#x70B9;&#x6570;&#x636E;&#x9700;&#x8981;&#x4F20;&#x9001;&#x7ED9;&#x4F60;&#xFF0C;&#x7A0D;&#x540E;&#x518D;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#x3002; TIME_WAIT: &#x8868;&#x793A;&#x6536;&#x5230;&#x4E86;&#x5BF9;&#x65B9;&#x7684;FIN&#x62A5;&#x6587;&#xFF0C;&#x5E76;&#x53D1;&#x9001;&#x51FA;&#x4E86;ACK&#x62A5;&#x6587;&#xFF0C;&#x5C31;&#x7B49;2MSL&#x540E;&#x5373;&#x53EF;&#x56DE;&#x5230;CLOSED&#x53EF;&#x7528;&#x72B6;&#x6001;&#x4E86;&#x3002;&#x5982;&#x679C;FIN_WAIT_1&#x72B6;&#x6001;&#x4E0B;&#xFF0C;&#x6536;&#x5230;&#x4E86;&#x5BF9;&#x65B9;&#x540C;&#x65F6;&#x5E26;FIN&#x6807;&#x5FD7;&#x548C;ACK&#x6807;&#x5FD7;&#x7684;&#x62A5;&#x6587;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8FDB;&#x5165;&#x5230;TIME_WAIT&#x72B6;&#x6001;&#xFF0C;&#x800C;&#x65E0;&#x987B;&#x7ECF;&#x8FC7;FIN_WAIT_2&#x72B6;&#x6001;&#x3002; &#x6CE8;:MSL(&#x6700;&#x5927;&#x5206;&#x6BB5;&#x751F;&#x5B58;&#x671F;)&#x6307;&#x660E;TCP&#x62A5;&#x6587;&#x5728;Internet&#x4E0A;&#x6700;&#x957F;&#x751F;&#x5B58;&#x65F6;&#x95F4;,&#x6BCF;&#x4E2A;&#x5177;&#x4F53;&#x7684;TCP&#x5B9E;&#x73B0;&#x90FD;&#x5FC5;&#x987B;&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x786E;&#x5B9A;&#x7684;MSL&#x503C;.RFC 1122&#x5EFA;&#x8BAE;&#x662F;2&#x5206;&#x949F;,&#x4F46;BSD&#x4F20;&#x7EDF;&#x5B9E;&#x73B0;&#x91C7;&#x7528;&#x4E86;30&#x79D2;.TIME_WAIT &#x72B6;&#x6001;&#x6700;&#x5927;&#x4FDD;&#x6301;&#x65F6;&#x95F4;&#x662F;2 * MSL,&#x4E5F;&#x5C31;&#x662F;1-4&#x5206;&#x949F;. CLOSING: &#x8FD9;&#x79CD;&#x72B6;&#x6001;&#x6BD4;&#x8F83;&#x7279;&#x6B8A;&#xFF0C;&#x5B9E;&#x9645;&#x60C5;&#x51B5;&#x4E2D;&#x5E94;&#x8BE5;&#x662F;&#x5F88;&#x5C11;&#x89C1;&#xFF0C;&#x5C5E;&#x4E8E;&#x4E00;&#x79CD;&#x6BD4;&#x8F83;&#x7F55;&#x89C1;&#x7684;&#x4F8B;&#x5916;&#x72B6;&#x6001;&#x3002;&#x6B63;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5F53;&#x4F60;&#x53D1;&#x9001;FIN&#x62A5;&#x6587;&#x540E;&#xFF0C;&#x6309;&#x7406;&#x6765;&#x8BF4;&#x662F;&#x5E94;&#x8BE5;&#x5148;&#x6536;&#x5230;&#xFF08;&#x6216;&#x540C;&#x65F6;&#x6536;&#x5230;&#xFF09;&#x5BF9;&#x65B9;&#x7684;ACK&#x62A5;&#x6587;&#xFF0C;&#x518D;&#x6536;&#x5230;&#x5BF9;&#x65B9;&#x7684;FIN&#x62A5;&#x6587;&#x3002;&#x4F46;&#x662F;CLOSING&#x72B6;&#x6001;&#x8868;&#x793A;&#x4F60;&#x53D1;&#x9001;FIN&#x62A5;&#x6587;&#x540E;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x6536;&#x5230;&#x5BF9;&#x65B9;&#x7684;ACK&#x62A5;&#x6587;&#xFF0C;&#x53CD;&#x800C;&#x5374;&#x4E5F;&#x6536;&#x5230;&#x4E86;&#x5BF9;&#x65B9;&#x7684;FIN&#x62A5;&#x6587;&#x3002;&#x4EC0;&#x4E48;&#x60C5;&#x51B5;&#x4E0B;&#x4F1A;&#x51FA;&#x73B0;&#x6B64;&#x79CD;&#x60C5;&#x51B5;&#x5462;&#xFF1F;&#x5176;&#x5B9E;&#x7EC6;&#x60F3;&#x4E00;&#x4E0B;&#xFF0C;&#x4E5F;&#x4E0D;&#x96BE;&#x5F97;&#x51FA;&#x7ED3;&#x8BBA;&#xFF1A;&#x90A3;&#x5C31;&#x662F;&#x5982;&#x679C;&#x53CC;&#x65B9;&#x51E0;&#x4E4E;&#x5728;&#x540C;&#x65F6;close&#x4E00;&#x4E2A;SOCKET&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x51FA;&#x73B0;&#x4E86;&#x53CC;&#x65B9;&#x540C;&#x65F6;&#x53D1;&#x9001;FIN&#x62A5;&#x6587;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x4E5F;&#x5373;&#x4F1A;&#x51FA;&#x73B0;CLOSING&#x72B6;&#x6001;&#xFF0C;&#x8868;&#x793A;&#x53CC;&#x65B9;&#x90FD;&#x6B63;&#x5728;&#x5173;&#x95ED;SOCKET&#x8FDE;&#x63A5;&#x3002; CLOSE_WAIT: &#x8FD9;&#x79CD;&#x72B6;&#x6001;&#x7684;&#x542B;&#x4E49;&#x5176;&#x5B9E;&#x662F;&#x8868;&#x793A;&#x5728;&#x7B49;&#x5F85;&#x5173;&#x95ED;&#x3002;&#x600E;&#x4E48;&#x7406;&#x89E3;&#x5462;&#xFF1F;&#x5F53;&#x5BF9;&#x65B9;close&#x4E00;&#x4E2A;SOCKET&#x540E;&#x53D1;&#x9001;FIN&#x62A5;&#x6587;&#x7ED9;&#x81EA;&#x5DF1;&#xFF0C;&#x4F60;&#x7CFB;&#x7EDF;&#x6BEB;&#x65E0;&#x7591;&#x95EE;&#x5730;&#x4F1A;&#x56DE;&#x5E94;&#x4E00;&#x4E2A;ACK&#x62A5;&#x6587;&#x7ED9;&#x5BF9;&#x65B9;&#xFF0C;&#x6B64;&#x65F6;&#x5219;&#x8FDB;&#x5165;&#x5230;CLOSE_WAIT&#x72B6;&#x6001;&#x3002;&#x63A5;&#x4E0B;&#x6765;&#x5462;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x4F60;&#x771F;&#x6B63;&#x9700;&#x8981;&#x8003;&#x8651;&#x7684;&#x4E8B;&#x60C5;&#x662F;&#x5BDF;&#x770B;&#x4F60;&#x662F;&#x5426;&#x8FD8;&#x6709;&#x6570;&#x636E;&#x53D1;&#x9001;&#x7ED9;&#x5BF9;&#x65B9;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E48;&#x4F60;&#x4E5F;&#x5C31;&#x53EF;&#x4EE5;close&#x8FD9;&#x4E2A;SOCKET&#xFF0C;&#x53D1;&#x9001;FIN&#x62A5;&#x6587;&#x7ED9;&#x5BF9;&#x65B9;&#xFF0C;&#x4E5F;&#x5373;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#x3002;&#x6240;&#x4EE5;&#x4F60;&#x5728;CLOSE_WAIT&#x72B6;&#x6001;&#x4E0B;&#xFF0C;&#x9700;&#x8981;&#x5B8C;&#x6210;&#x7684;&#x4E8B;&#x60C5;&#x662F;&#x7B49;&#x5F85;&#x4F60;&#x53BB;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#x3002; LAST_ACK: &#x8FD9;&#x4E2A;&#x72B6;&#x6001;&#x8FD8;&#x662F;&#x6BD4;&#x8F83;&#x5BB9;&#x6613;&#x597D;&#x7406;&#x89E3;&#x7684;&#xFF0C;&#x5B83;&#x662F;&#x88AB;&#x52A8;&#x5173;&#x95ED;&#x4E00;&#x65B9;&#x5728;&#x53D1;&#x9001;FIN&#x62A5;&#x6587;&#x540E;&#xFF0C;&#x6700;&#x540E;&#x7B49;&#x5F85;&#x5BF9;&#x65B9;&#x7684;ACK&#x62A5;&#x6587;&#x3002;&#x5F53;&#x6536;&#x5230;ACK&#x62A5;&#x6587;&#x540E;&#xFF0C;&#x4E5F;&#x5373;&#x53EF;&#x4EE5;&#x8FDB;&#x5165;&#x5230;CLOSED&#x53EF;&#x7528;&#x72B6;&#x6001;&#x4E86;&#x3002; &#x6700;&#x540E;&#x6709;2&#x4E2A;&#x95EE;&#x9898;&#x7684;&#x56DE;&#x7B54;&#xFF0C;&#x6211;&#x81EA;&#x5DF1;&#x5206;&#x6790;&#x540E;&#x7684;&#x7ED3;&#x8BBA;&#xFF08;&#x4E0D;&#x4E00;&#x5B9A;&#x4FDD;&#x8BC1;100%&#x6B63;&#x786E;&#xFF09; 1&#x3001; &#x4E3A;&#x4EC0;&#x4E48;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x534F;&#x8BAE;&#x662F;&#x4E09;&#x6B21;&#x63E1;&#x624B;&#xFF0C;&#x800C;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#x5374;&#x662F;&#x56DB;&#x6B21;&#x63E1;&#x624B;&#x5462;&#xFF1F; &#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x670D;&#x52A1;&#x7AEF;&#x7684;LISTEN&#x72B6;&#x6001;&#x4E0B;&#x7684;SOCKET&#x5F53;&#x6536;&#x5230;SYN&#x62A5;&#x6587;&#x7684;&#x5EFA;&#x8FDE;&#x8BF7;&#x6C42;&#x540E;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x628A;ACK&#x548C;SYN&#xFF08;ACK&#x8D77;&#x5E94;&#x7B54;&#x4F5C;&#x7528;&#xFF0C;&#x800C;SYN&#x8D77;&#x540C;&#x6B65;&#x4F5C;&#x7528;&#xFF09;&#x653E;&#x5728;&#x4E00;&#x4E2A;&#x62A5;&#x6587;&#x91CC;&#x6765;&#x53D1;&#x9001;&#x3002;&#x4F46;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#x65F6;&#xFF0C;&#x5F53;&#x6536;&#x5230;&#x5BF9;&#x65B9;&#x7684;FIN&#x62A5;&#x6587;&#x901A;&#x77E5;&#x65F6;&#xFF0C;&#x5B83;&#x4EC5;&#x4EC5;&#x8868;&#x793A;&#x5BF9;&#x65B9;&#x6CA1;&#x6709;&#x6570;&#x636E;&#x53D1;&#x9001;&#x7ED9;&#x4F60;&#x4E86;&#xFF1B;&#x4F46;&#x672A;&#x5FC5;&#x4F60;&#x6240;&#x6709;&#x7684;&#x6570;&#x636E;&#x90FD;&#x5168;&#x90E8;&#x53D1;&#x9001;&#x7ED9;&#x5BF9;&#x65B9;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x4F60;&#x53EF;&#x4EE5;&#x672A;&#x5FC5;&#x4F1A;&#x9A6C;&#x4E0A;&#x4F1A;&#x5173;&#x95ED;SOCKET,&#x4E5F;&#x5373;&#x4F60;&#x53EF;&#x80FD;&#x8FD8;&#x9700;&#x8981;&#x53D1;&#x9001;&#x4E00;&#x4E9B;&#x6570;&#x636E;&#x7ED9;&#x5BF9;&#x65B9;&#x4E4B;&#x540E;&#xFF0C;&#x518D;&#x53D1;&#x9001;FIN&#x62A5;&#x6587;&#x7ED9;&#x5BF9;&#x65B9;&#x6765;&#x8868;&#x793A;&#x4F60;&#x540C;&#x610F;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x8FD9;&#x91CC;&#x7684;ACK&#x62A5;&#x6587;&#x548C;FIN&#x62A5;&#x6587;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#x90FD;&#x662F;&#x5206;&#x5F00;&#x53D1;&#x9001;&#x7684;&#x3002; 2&#x3001; &#x4E3A;&#x4EC0;&#x4E48;TIME_WAIT&#x72B6;&#x6001;&#x8FD8;&#x9700;&#x8981;&#x7B49;2MSL&#x540E;&#x624D;&#x80FD;&#x8FD4;&#x56DE;&#x5230;CLOSED&#x72B6;&#x6001;&#xFF1F; &#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#xFF1A;&#x867D;&#x7136;&#x53CC;&#x65B9;&#x90FD;&#x540C;&#x610F;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#x4E86;&#xFF0C;&#x800C;&#x4E14;&#x63E1;&#x624B;&#x7684;4&#x4E2A;&#x62A5;&#x6587;&#x4E5F;&#x90FD;&#x534F;&#x8C03;&#x548C;&#x53D1;&#x9001;&#x5B8C;&#x6BD5;&#xFF0C;&#x6309;&#x7406;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x56DE;&#x5230;CLOSED&#x72B6;&#x6001;&#xFF08;&#x5C31;&#x597D;&#x6BD4;&#x4ECE;SYN_SEND&#x72B6;&#x6001;&#x5230;ESTABLISH&#x72B6;&#x6001;&#x90A3;&#x6837;&#xFF09;&#xFF1B;&#x4F46;&#x662F;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x8981;&#x5047;&#x60F3;&#x7F51;&#x7EDC;&#x662F;&#x4E0D;&#x53EF;&#x9760;&#x7684;&#xFF0C;&#x4F60;&#x65E0;&#x6CD5;&#x4FDD;&#x8BC1;&#x4F60;&#x6700;&#x540E;&#x53D1;&#x9001;&#x7684;ACK&#x62A5;&#x6587;&#x4F1A;&#x4E00;&#x5B9A;&#x88AB;&#x5BF9;&#x65B9;&#x6536;&#x5230;&#xFF0C;&#x56E0;&#x6B64;&#x5BF9;&#x65B9;&#x5904;&#x4E8E;LAST_ACK&#x72B6;&#x6001;&#x4E0B;&#x7684;SOCKET&#x53EF;&#x80FD;&#x4F1A;&#x56E0;&#x4E3A;&#x8D85;&#x65F6;&#x672A;&#x6536;&#x5230;ACK&#x62A5;&#x6587;&#xFF0C;&#x800C;&#x91CD;&#x53D1;FIN&#x62A5;&#x6587;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;TIME_WAIT&#x72B6;&#x6001;&#x7684;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x7528;&#x6765;&#x91CD;&#x53D1;&#x53EF;&#x80FD;&#x4E22;&#x5931;&#x7684;ACK&#x62A5;&#x6587;&#xFF0C;&#x5E76;&#x4FDD;&#x8BC1;&#x4E8E;&#x6B64;&#x3002; &#x67E5;&#x770B;&#x5F53;&#x524D;&#x7CFB;&#x7EDF;&#x4E0B;&#x6240;&#x6709;&#x8FDE;&#x63A5;&#x72B6;&#x6001;&#x7684;&#x6570;&#xFF1A; 1234567[root@vps ~]#netstat -n|awk &apos;/^tcp/{++S[$NF]}END{for (key in S) print key,S[key]}&apos;TIME_WAIT 286FIN_WAIT1 5FIN_WAIT2 6ESTABLISHED 269SYN_RECV 5CLOSING 1 &#x5982;&#x53D1;&#x73B0;&#x7CFB;&#x7EDF;&#x5B58;&#x5728;&#x5927;&#x91CF;TIME_WAIT&#x72B6;&#x6001;&#x7684;&#x8FDE;&#x63A5;&#xFF0C;&#x901A;&#x8FC7;&#x8C03;&#x6574;&#x5185;&#x6838;&#x53C2;&#x6570;&#x89E3;&#x51B3;&#xFF1A;&#x7F16;&#x8F91;&#x6587;&#x4EF6;/etc/sysctl.conf&#xFF0C;&#x52A0;&#x5165;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#xFF1A; 1234net.ipv4.tcp_syncookies = 1net.ipv4.tcp_tw_reuse = 1net.ipv4.tcp_tw_recycle = 1net.ipv4.tcp_fin_timeout = 30 &#x7136;&#x540E;&#x6267;&#x884C; /sbin/sysctl -p &#x8BA9;&#x53C2;&#x6570;&#x751F;&#x6548;&#x3002; net.ipv4.tcp_syncookies = 1 &#x8868;&#x793A;&#x5F00;&#x542F;SYN Cookies&#x3002;&#x5F53;&#x51FA;&#x73B0;SYN&#x7B49;&#x5F85;&#x961F;&#x5217;&#x6EA2;&#x51FA;&#x65F6;&#xFF0C;&#x542F;&#x7528;cookies&#x6765;&#x5904;&#x7406;&#xFF0C;&#x53EF;&#x9632;&#x8303;&#x5C11;&#x91CF;SYN&#x653B;&#x51FB;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;0&#xFF0C;&#x8868;&#x793A;&#x5173;&#x95ED;&#xFF1B;net.ipv4.tcp_tw_reuse = 1 &#x8868;&#x793A;&#x5F00;&#x542F;&#x91CD;&#x7528;&#x3002;&#x5141;&#x8BB8;&#x5C06;TIME-WAIT sockets&#x91CD;&#x65B0;&#x7528;&#x4E8E;&#x65B0;&#x7684;TCP&#x8FDE;&#x63A5;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;0&#xFF0C;&#x8868;&#x793A;&#x5173;&#x95ED;&#xFF1B;net.ipv4.tcp_tw_recycle = 1 &#x8868;&#x793A;&#x5F00;&#x542F;TCP&#x8FDE;&#x63A5;&#x4E2D;TIME-WAIT sockets&#x7684;&#x5FEB;&#x901F;&#x56DE;&#x6536;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;0&#xFF0C;&#x8868;&#x793A;&#x5173;&#x95ED;&#x3002;net.ipv4.tcp_fin_timeout &#x4FEE;&#x6539;&#x7CFB;&#x9ED8;&#x8BA4;&#x7684; TIMEOUT &#x65F6;&#x95F4; &#x5176;&#x5B83;&#x53C2;&#x6570;&#x8BF4;&#x660E;&#xFF1A;net.ipv4.tcp_syncookies = 1 &#x8868;&#x793A;&#x5F00;&#x542F;SYN Cookies&#x3002;&#x5F53;&#x51FA;&#x73B0;SYN&#x7B49;&#x5F85;&#x961F;&#x5217;&#x6EA2;&#x51FA;&#x65F6;&#xFF0C;&#x542F;&#x7528;cookies&#x6765;&#x5904;&#x7406;&#xFF0C;&#x53EF;&#x9632;&#x8303;&#x5C11;&#x91CF;SYN&#x653B;&#x51FB;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;0&#xFF0C;&#x8868;&#x793A;&#x5173;&#x95ED;&#xFF1B;net.ipv4.tcp_tw_reuse = 1 &#x8868;&#x793A;&#x5F00;&#x542F;&#x91CD;&#x7528;&#x3002;&#x5141;&#x8BB8;&#x5C06;TIME-WAIT sockets&#x91CD;&#x65B0;&#x7528;&#x4E8E;&#x65B0;&#x7684;TCP&#x8FDE;&#x63A5;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;0&#xFF0C;&#x8868;&#x793A;&#x5173;&#x95ED;&#xFF1B;net.ipv4.tcp_tw_recycle = 1 &#x8868;&#x793A;&#x5F00;&#x542F;TCP&#x8FDE;&#x63A5;&#x4E2D;TIME-WAIT sockets&#x7684;&#x5FEB;&#x901F;&#x56DE;&#x6536;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;0&#xFF0C;&#x8868;&#x793A;&#x5173;&#x95ED;&#x3002;net.ipv4.tcp_fin_timeout = 30 &#x8868;&#x793A;&#x5982;&#x679C;&#x5957;&#x63A5;&#x5B57;&#x7531;&#x672C;&#x7AEF;&#x8981;&#x6C42;&#x5173;&#x95ED;&#xFF0C;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x51B3;&#x5B9A;&#x4E86;&#x5B83;&#x4FDD;&#x6301;&#x5728;FIN-WAIT-2&#x72B6;&#x6001;&#x7684;&#x65F6;&#x95F4;&#x3002;net.ipv4.tcp_keepalive_time = 1200 &#x8868;&#x793A;&#x5F53;keepalive&#x8D77;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;TCP&#x53D1;&#x9001;keepalive&#x6D88;&#x606F;&#x7684;&#x9891;&#x5EA6;&#x3002;&#x7F3A;&#x7701;&#x662F;2&#x5C0F;&#x65F6;&#xFF0C;&#x6539;&#x4E3A;20&#x5206;&#x949F;&#x3002;net.ipv4.ip_local_port_range = 1024 65000 &#x8868;&#x793A;&#x7528;&#x4E8E;&#x5411;&#x5916;&#x8FDE;&#x63A5;&#x7684;&#x7AEF;&#x53E3;&#x8303;&#x56F4;&#x3002;&#x7F3A;&#x7701;&#x60C5;&#x51B5;&#x4E0B;&#x5F88;&#x5C0F;&#xFF1A;32768&#x5230;61000&#xFF0C;&#x6539;&#x4E3A;1024&#x5230;65000&#x3002;net.ipv4.tcp_max_syn_backlog = 8192 &#x8868;&#x793A;SYN&#x961F;&#x5217;&#x7684;&#x957F;&#x5EA6;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;1024&#xFF0C;&#x52A0;&#x5927;&#x961F;&#x5217;&#x957F;&#x5EA6;&#x4E3A;8192&#xFF0C;&#x53EF;&#x4EE5;&#x5BB9;&#x7EB3;&#x66F4;&#x591A;&#x7B49;&#x5F85;&#x8FDE;&#x63A5;&#x7684;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#x6570;&#x3002;net.ipv4.tcp_max_tw_buckets = 5000 &#x8868;&#x793A;&#x7CFB;&#x7EDF;&#x540C;&#x65F6;&#x4FDD;&#x6301;TIME_WAIT&#x5957;&#x63A5;&#x5B57;&#x7684;&#x6700;&#x5927;&#x6570;&#x91CF;&#xFF0C;&#x5982;&#x679C;&#x8D85;&#x8FC7;&#x8FD9;&#x4E2A;&#x6570;&#x5B57;&#xFF0C;TIME_WAIT&#x5957;&#x63A5;&#x5B57;&#x5C06;&#x7ACB;&#x523B;&#x88AB;&#x6E05;&#x9664;&#x5E76;&#x6253;&#x5370;&#x8B66;&#x544A;&#x4FE1;&#x606F;&#x3002;&#x9ED8; &#x8BA4;&#x4E3A;180000&#xFF0C;&#x6539;&#x4E3A;5000&#x3002;&#x5BF9;&#x4E8E;Apache&#x3001;Nginx&#x7B49;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x4E0A;&#x51E0;&#x884C;&#x7684;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x5F88;&#x597D;&#x5730;&#x51CF;&#x5C11;TIME_WAIT&#x5957;&#x63A5;&#x5B57;&#x6570;&#x91CF;&#xFF0C;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;Squid&#xFF0C;&#x6548;&#x679C;&#x5374;&#x4E0D;&#x5927;&#x3002;&#x6B64;&#x9879;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x63A7;&#x5236;TIME_WAIT&#x5957;&#x63A5;&#x5B57;&#x7684;&#x6700;&#x5927;&#x6570;&#x91CF;&#xFF0C;&#x907F;&#x514D;Squid&#x670D;&#x52A1;&#x5668;&#x88AB;&#x5927;&#x91CF;&#x7684;TIME_WAIT&#x5957;&#x63A5;&#x5B57;&#x62D6;&#x6B7B;&#x3002; &#x6CE8;:net.ipv4.tcp_tw_reuse = 1net.ipv4.tcp_tw_recycle = 1 &#x8BBE;&#x7F6E;&#x8FD9;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#xFF1A; reuse&#x662F;&#x8868;&#x793A;&#x662F;&#x5426;&#x5141;&#x8BB8;&#x91CD;&#x65B0;&#x5E94;&#x7528;&#x5904;&#x4E8E;TIME-WAIT&#x72B6;&#x6001;&#x7684;socket&#x7528;&#x4E8E;&#x65B0;&#x7684;TCP&#x8FDE;&#x63A5;&#xFF1B; recyse&#x662F;&#x52A0;&#x901F;TIME-WAIT sockets&#x56DE;&#x6536; &#x6765;&#x6E90;&#x53CA;&#x53C2;&#x8003; http://bbs.linuxtone.org/thread-853-1-1.htmlhttp://hi.baidu.com/tim_bi/blog/item/35b005d784ca91d5a044df1d.htmlhttp://apps.hi.baidu.com/share/detail/34009128]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>ops</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[简单的系统监控脚本]]></title>
    <url>%2F2012%2F04%2F22%2F%E7%AE%80%E5%8D%95%E7%9A%84%E7%B3%BB%E7%BB%9F%E7%9B%91%E6%8E%A7%E8%84%9A%E6%9C%AC%2F</url>
    <content type="text"><![CDATA[&#x5468;&#x672B;&#x62BD;&#x7A7A;&#x5199;&#x4E86;&#x4E2A;&#x7CFB;&#x7EDF;&#x76D1;&#x63A7;&#x811A;&#x672C;&#xFF0C;&#x6CA1;&#x4EC0;&#x4E48;&#x6280;&#x672F;&#x542B;&#x91CF;&#xFF0C;&#x5C31;&#x5F53;&#x7EC3;&#x7EC3;&#x624B;&#x3002;&#x82B1;&#x4E86;&#x4E0D;&#x5C11;&#x65F6;&#x95F4;&#xFF0C;&#x4E3B;&#x8981;&#x5728;&#x4E00;&#x4E9B;&#x7EC6;&#x8282;&#x4E0A;&#x5904;&#x7406;&#x5F97;&#x4E0D;&#x591F;&#x4E25;&#x8C28;&#xFF0C;&#x6BD4;&#x5982;awk&#x8C03;&#x7528;&#x7CFB;&#x7EDF;&#x53D8;&#x91CF;&#x65F6;&#x9700;&#x8981;&#x540C;&#x65F6;&#x4F7F;&#x7528;&#x5355;&#x53CC;&#x5F15;&#x53F7;&#xFF0C;&#x5982;&#x201D;&#x2018;$&#x53D8;&#x91CF;&#x540D;&#x2019;&#x201D;&#x770B;&#x6765;&#x81EA;&#x5DF1;&#x7684;&#x811A;&#x672C;&#x64B0;&#x5199;&#x80FD;&#x529B;&#x8FD8;&#x6709;&#x5F85;&#x63D0;&#x9AD8;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x811A;&#x672C;&#x5185;&#x5BB9;&#xFF1A; system_monitor.sh 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061#!/bin/bash #system monitor#caishzh 20120418 create #&#x521D;&#x59CB;&#x5316;&#x53D8;&#x91CF;&#x5E76;&#x8BBE;&#x7F6E;&#x9600;&#x503C;DIR=/root/toolADMIN=***@qq.com#ADMIN_SMS=***@139.com #&#x53EF;&#x4EE5;&#x914D;&#x5408;139&#x90AE;&#x7BB1;&#x5B9E;&#x73B0;&#x77ED;&#x4FE1;&#x8B66;&#x62A5;&gt;${DIR}/messages.txt IP=$(ifconfig eth0|grep &apos;inet addr&apos;|sed &apos;s/.*addr:\(.*\) Bcast:.*/\1/&apos;)HOSTNAME=$(hostname) CPU_MAX=90 #&#x5355;&#x4E2A;&#x8FDB;&#x7A0B;&#x7684;cpu&#x4F7F;&#x7528;&#x7387;UPTIME_MAX=3 #&#x7CFB;&#x7EDF;&#x8D1F;&#x8F7D;DISK_MAX=90 #&#x78C1;&#x76D8;&#x4F7F;&#x7528;&#x7387; #&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;flag&#xFF0C;&#x7528;&#x4E8E;&#x811A;&#x672C;&#x7684;&#x6267;&#x884C;&#x4E0E;&#x5426;&#xFF1B;0&#x6267;&#x884C;&#xFF0C;1&#x4E0D;&#x6267;&#x884C;#FLAG=$(cat /root/tool/flag.txt)#[ $FLAG -eq 1 ] &amp;&amp; { exit 1 } #&#x8FDB;&#x7A0B;&#x5360;&#x7528;cpu&#x60C5;&#x51B5;CPU_MAX_NUM=$(top -n 1 -b|awk &apos;NR&gt;7{if ($10&gt;&quot;&apos;$CPU_MAX&apos;&quot;)print $10}&apos;|wc -l) #&#x7EDF;&#x8BA1;cpu&#x4F7F;&#x7528;&#x7387;&#x8D85;&#x8FC7;90%&#x7684;&#x8FDB;&#x7A0B;&#x6570;if [ &quot;$CPU_MAX_NUM&quot; -gt 0 ];then sleep 5 CPU_MAX_NUM=$(top -n 1|awk &apos;NR&gt;7{if ($10&gt;&quot;&apos;$CPU_MAX&apos;&quot;)print $10}&apos;|wc -l) [ $CPU_MAX_NUM -gt 0 ] &amp;&amp; $(echo &quot;CPU_${CPU_MAX}%_NUM: $CPU_MAX_NUM&quot; &gt;&gt;${DIR}/messages.txt)fi #&#x7CFB;&#x7EDF;&#x8D1F;&#x8F7D;UPTIME=$(uptime|awk &apos;{print $10}&apos;|sed &apos;s/\..*//&apos;)[ &quot;$UPTIME&quot; -gt &quot;$UPTIME_MAX&quot; ] &amp;&amp; $(echo &quot;UPTIME: $UPTIME&quot; &gt;&gt;${DIR}/messages.txt) #&#x76D1;&#x63A7;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;DISK=$(df -h |awk &apos;NR&gt;1{print $0}&apos;|sort -k5|tail -1|awk &apos;{print $1,$4,$5}&apos;) #&#x63D0;&#x53D6;&#x78C1;&#x76D8;&#x5360;&#x7528;&#x7387;&#x6700;&#x5927;&#x7684;&#x5206;&#x533A;DISK_USAGE=$(echo $DISK|awk &apos;{print $3}&apos;|tr -d &apos;%&apos;)[ &quot;$DISK_USAGE&quot; -ge &quot;$DISK_MAX&quot; ] &amp;&amp; $(echo &quot;DISK: $DISK&quot; &gt;&gt; ${DIR}/messages.txt) #&#x76D1;&#x63A7;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF08;filesystem&#xFF09;[ -f &quot;${DIR}/fs.txt&quot; ] || $(df -T|grep -v tmpfs|awk &apos;NR&gt;1{print $1,$2}&apos;&gt;${DIR}/fs.txt) #&#x5C06;&#x6240;&#x6709;&#x5206;&#x533A;&#x53CA;&#x5176;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7C7B;&#x578B;&#x8F93;&#x51FA;&#x5230;fs.txt&#x6587;&#x4EF6;&#x4E2D;while read FSdo PARTITION=$(echo $FS|awk &apos;{print $1}&apos;) #&#x63D0;&#x53D6;&#x5206;&#x533A;&#x540D; FILESYSTEM=$(echo $FS|awk &apos;{print $2}&apos;) #&#x63D0;&#x53D6;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7C7B;&#x578B; [ &quot;$FILESYSTEM&quot; == &quot;ext4&quot; ] &amp;&amp; CMD=&quot;/sbin/tune4fs&quot; || CMD=&quot;/sbin/tune2fs&quot; FS_STAT=$($CMD -l $PARTITION | grep &apos;Filesystem state&apos;) echo $FS_STAT|grep &apos;clean$&apos;&gt;/dev/null if [ $? -eq 1 ];then echo &quot;$PARTITION : $FS_STAT&quot; &gt;&gt;${DIR}/messages.txt fidone&lt;${DIR}/fs.txt #&#x76D1;&#x63A7;iptables/sbin/iptables -nL|grep &apos;INPUT&apos;|grep &apos;policy ACCEPT&apos; &gt;/dev/null &amp;&amp; echo &quot;iptables: policy ACCEPT&quot;&gt;&gt;${DIR}/messages.txt #&#x53D1;&#x9001;&#x8B66;&#x62A5;&#x90AE;&#x4EF6;if [ -s ${DIR}/messages.txt ];then #&#x5982;&#x679C;messages.txt&#x6587;&#x4EF6;&#x4E0D;&#x4E3A;&#x7A7A;&#x5219;&#x53D1;&#x9001;&#x8B66;&#x62A5;&#x4FE1; mail -s &quot;system monitor: $IP $HOSTNAME&quot; &quot;$ADMIN&quot; &lt;${DIR}/messages.txtfi &#x5C06;&#x811A;&#x672C;&#x653E;&#x5165;/root/tool&#x76EE;&#x5F55;&#xFF0C;&#x7ED9;&#x4E88;&#x811A;&#x672C;&#x6267;&#x884C;&#x6743;&#x9650;&#xFF1A; 1chmod 755 /root/tool/system_monitor.sh &#x5C06;&#x811A;&#x672C;&#x5199;&#x5165;crontab&#xFF0C;&#x6BCF;5&#x5206;&#x949F;&#x6267;&#x884C;&#x4E00;&#x6B21;&#xFF1A; 1echo &quot;*/5 * * * * root /root/tool/system_monitor.sh&quot; &gt;&gt;/etc/crontab &#x5728;vps&#x4E0A;&#x6D4B;&#x8BD5;&#xFF0C;&#x7CFB;&#x7EDF;&#x51FA;&#x73B0;&#x5F02;&#x5E38;&#x65F6;&#x53D1;&#x9001;&#x7684;&#x90AE;&#x4EF6;&#x5185;&#x5BB9;&#xFF08;&#x4E3A;&#x4E86;&#x6D4B;&#x8BD5;&#x811A;&#x672C;&#xFF0C;&#x6709;&#x5C06;&#x90E8;&#x5206;&#x9600;&#x503C;&#x8C03;&#x4F4E;&#xFF09;&#xFF1A;]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>shell</tag>
        <tag>ops</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[test的用法与变量的测试替换]]></title>
    <url>%2F2012%2F04%2F18%2Ftest%E7%9A%84%E7%94%A8%E6%B3%95%E4%B8%8E%E5%8F%98%E9%87%8F%E7%9A%84%E6%B5%8B%E8%AF%95%E6%9B%BF%E6%8D%A2%2F</url>
    <content type="text"><![CDATA[test&#x7684;&#x7528;&#x6CD5; &#x6D4B;&#x8BD5;&#x7684;&#x6807;&#x5FD7; &#x4EE3;&#x8868;&#x610F;&#x4E49; 1. &#x5173;&#x4E8E;&#x67D0;&#x4E2A;&#x6587;&#x4EF6;&#x540D;&#x7684;&#x2018;&#x6587;&#x4EF6;&#x7C7B;&#x578B;&#x2019;&#x5224;&#x65AD;&#xFF0C;&#x5982; test -e filename &#x8868;&#x793A;&#x5B58;&#x5728;&#x5426; -e &#x8BE5;&#x2018;&#x6587;&#x4EF6;&#x540D;&#x2019;&#x662F;&#x5426;&#x5B58;&#x5728;&#xFF1F;(&#x5E38;&#x7528;) -f &#x8BE5;&#x2018;&#x6587;&#x4EF6;&#x540D;&#x2019;&#x662F;&#x5426;&#x5B58;&#x5728;&#x4E14;&#x4E3A;&#x6587;&#x4EF6;(file)&#xFF1F;(&#x5E38;&#x7528;) -d &#x8BE5;&#x2018;&#x6587;&#x4EF6;&#x540D;&#x2019;&#x662F;&#x5426;&#x5B58;&#x5728;&#x4E14;&#x4E3A;&#x76EE;&#x5F55;(directory)&#xFF1F;(&#x5E38;&#x7528;) -b &#x8BE5;&#x2018;&#x6587;&#x4EF6;&#x540D;&#x2019;&#x662F;&#x5426;&#x5B58;&#x5728;&#x4E14;&#x4E3A;&#x4E00;&#x4E2A; block device &#x88C5;&#x7F6E;&#xFF1F; -c &#x8BE5;&#x2018;&#x6587;&#x4EF6;&#x540D;&#x2019;&#x662F;&#x5426;&#x5B58;&#x5728;&#x4E14;&#x4E3A;&#x4E00;&#x4E2A; character device &#x88C5;&#x7F6E;&#xFF1F; -S &#x8BE5;&#x2018;&#x6587;&#x4EF6;&#x540D;&#x2019;&#x662F;&#x5426;&#x5B58;&#x5728;&#x4E14;&#x4E3A;&#x4E00;&#x4E2A; Socket &#x6587;&#x4EF6;&#xFF1F; -p &#x8BE5;&#x2018;&#x6587;&#x4EF6;&#x540D;&#x2019;&#x662F;&#x5426;&#x5B58;&#x5728;&#x4E14;&#x4E3A;&#x4E00;&#x4E2A; FIFO (pipe) &#x6587;&#x4EF6;&#xFF1F; -L &#x8BE5;&#x2018;&#x6587;&#x4EF6;&#x540D;&#x2019;&#x662F;&#x5426;&#x5B58;&#x5728;&#x4E14;&#x4E3A;&#x4E00;&#x4E2A;&#x8FDE;&#x7ED3;&#x6863;&#xFF1F; 2. &#x5173;&#x4E8E;&#x6587;&#x4EF6;&#x7684;&#x6743;&#x9650;&#x4FA6;&#x6D4B;&#xFF0C;&#x5982; test -r filename &#x8868;&#x793A;&#x53EF;&#x8BFB;&#x5426; (&#x4F46; root &#x6743;&#x9650;&#x5E38;&#x6709;&#x4F8B;&#x5916;) -r &#x4FA6;&#x6D4B;&#x8BE5;&#x6587;&#x4EF6;&#x540D;&#x662F;&#x5426;&#x5B58;&#x5728;&#x4E14;&#x5177;&#x6709;&#x2018;&#x53EF;&#x8BFB;&#x2019;&#x7684;&#x6743;&#x9650;&#xFF1F; -w &#x4FA6;&#x6D4B;&#x8BE5;&#x6587;&#x4EF6;&#x540D;&#x662F;&#x5426;&#x5B58;&#x5728;&#x4E14;&#x5177;&#x6709;&#x2018;&#x53EF;&#x5199;&#x2019;&#x7684;&#x6743;&#x9650;&#xFF1F; -x &#x4FA6;&#x6D4B;&#x8BE5;&#x6587;&#x4EF6;&#x540D;&#x662F;&#x5426;&#x5B58;&#x5728;&#x4E14;&#x5177;&#x6709;&#x2018;&#x53EF;&#x6267;&#x884C;&#x2019;&#x7684;&#x6743;&#x9650;&#xFF1F; -u &#x4FA6;&#x6D4B;&#x8BE5;&#x6587;&#x4EF6;&#x540D;&#x662F;&#x5426;&#x5B58;&#x5728;&#x4E14;&#x5177;&#x6709;&#x2018;SUID&#x2019;&#x7684;&#x5C5E;&#x6027;&#xFF1F; -g &#x4FA6;&#x6D4B;&#x8BE5;&#x6587;&#x4EF6;&#x540D;&#x662F;&#x5426;&#x5B58;&#x5728;&#x4E14;&#x5177;&#x6709;&#x2018;SGID&#x2019;&#x7684;&#x5C5E;&#x6027;&#xFF1F; -k &#x4FA6;&#x6D4B;&#x8BE5;&#x6587;&#x4EF6;&#x540D;&#x662F;&#x5426;&#x5B58;&#x5728;&#x4E14;&#x5177;&#x6709;&#x2018;Sticky bit&#x2019;&#x7684;&#x5C5E;&#x6027;&#xFF1F; -s &#x4FA6;&#x6D4B;&#x8BE5;&#x6587;&#x4EF6;&#x540D;&#x662F;&#x5426;&#x5B58;&#x5728;&#x4E14;&#x4E3A;&#x2018;&#x975E;&#x7A7A;&#x767D;&#x6587;&#x4EF6;&#x2019;&#xFF1F; 3. &#x4E24;&#x4E2A;&#x6587;&#x4EF6;&#x4E4B;&#x95F4;&#x7684;&#x6BD4;&#x8F83;&#xFF0C;&#x5982;&#xFF1A; test file1 -nt file2 -nt (newer than)&#x5224;&#x65AD; file1 &#x662F;&#x5426;&#x6BD4; file2 &#x65B0; -ot (older than)&#x5224;&#x65AD; file1 &#x662F;&#x5426;&#x6BD4; file2 &#x65E7; -ef &#x5224;&#x65AD; file1 &#x4E0E; file2 &#x662F;&#x5426;&#x4E3A;&#x540C;&#x4E00;&#x6587;&#x4EF6;&#xFF0C;&#x53EF;&#x7528;&#x5728;&#x5224;&#x65AD; hard link &#x7684;&#x5224;&#x5B9A;&#x4E0A;&#x3002; &#x4E3B;&#x8981;&#x610F;&#x4E49;&#x5728;&#x5224;&#x5B9A;&#xFF0C;&#x4E24;&#x4E2A;&#x6587;&#x4EF6;&#x662F;&#x5426;&#x5747;&#x6307;&#x5411;&#x540C;&#x4E00;&#x4E2A; inode &#x54E9;&#xFF01; 4. &#x5173;&#x4E8E;&#x4E24;&#x4E2A;&#x6574;&#x6570;&#x4E4B;&#x95F4;&#x7684;&#x5224;&#x5B9A;&#xFF0C;&#x4F8B;&#x5982; test n1 -eq n2 -eq &#x4E24;&#x6570;&#x503C;&#x76F8;&#x7B49; (equal) -ne &#x4E24;&#x6570;&#x503C;&#x4E0D;&#x7B49; (not equal) -gt n1 &#x5927;&#x4E8E; n2 (greater than) -lt n1 &#x5C0F;&#x4E8E; n2 (less than) -ge n1 &#x5927;&#x4E8E;&#x7B49;&#x4E8E; n2 (greater than or equal) -le n1 &#x5C0F;&#x4E8E;&#x7B49;&#x4E8E; n2 (less than or equal) 5. &#x5224;&#x5B9A;&#x5B57;&#x4E32;&#x7684;&#x6570;&#x636E; test -z string &#x5224;&#x5B9A;&#x5B57;&#x4E32;&#x662F;&#x5426;&#x4E3A; 0 &#xFF1F;&#x82E5; string &#x4E3A;&#x7A7A;&#x5B57;&#x4E32;&#xFF0C;&#x5219;&#x4E3A; true test -n string &#x5224;&#x5B9A;&#x5B57;&#x4E32;&#x662F;&#x5426;&#x975E;&#x4E3A; 0 &#xFF1F;&#x82E5; string &#x4E3A;&#x7A7A;&#x5B57;&#x4E32;&#xFF0C;&#x5219;&#x4E3A; false&#x3002;&#x6CE8;&#xFF1A; -n &#x4EA6;&#x53EF;&#x7701;&#x7565; test str1 = str2 &#x5224;&#x5B9A; str1 &#x662F;&#x5426;&#x7B49;&#x4E8E; str2 &#xFF0C;&#x82E5;&#x76F8;&#x7B49;&#xFF0C;&#x5219;&#x56DE;&#x4F20; true test str1 != str2 &#x5224;&#x5B9A; str1 &#x662F;&#x5426;&#x4E0D;&#x7B49;&#x4E8E; str2 &#xFF0C;&#x82E5;&#x76F8;&#x7B49;&#xFF0C;&#x5219;&#x56DE;&#x4F20; false 6. &#x591A;&#x91CD;&#x6761;&#x4EF6;&#x5224;&#x5B9A;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A; test -r filename -a -x filename -a (and)&#x4E24;&#x72B6;&#x51B5;&#x540C;&#x65F6;&#x6210;&#x7ACB;&#xFF01;&#x4F8B;&#x5982; test -r file -a -x file&#xFF0C;&#x5219; file &#x540C;&#x65F6;&#x5177;&#x6709; r &#x4E0E; x &#x6743;&#x9650;&#x65F6;&#xFF0C;&#x624D;&#x56DE;&#x4F20; true&#x3002; -o (or)&#x4E24;&#x72B6;&#x51B5;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x6210;&#x7ACB;&#xFF01;&#x4F8B;&#x5982; test -r file -o -x file&#xFF0C;&#x5219; file &#x5177;&#x6709; r &#x6216; x &#x6743;&#x9650;&#x65F6;&#xFF0C;&#x5C31;&#x53EF;&#x56DE;&#x4F20; true&#x3002; ! &#x53CD;&#x76F8;&#x72B6;&#x6001;&#xFF0C;&#x5982; test ! -x file &#xFF0C;&#x5F53; file &#x4E0D;&#x5177;&#x6709; x &#x65F6;&#xFF0C;&#x56DE;&#x4F20; true &#x53D8;&#x91CF;&#x7684;&#x6D4B;&#x8BD5;&#x66FF;&#x6362; &#x53D8;&#x91CF;&#x914D;&#x7F6E;&#x65B9;&#x5F0F; str &#x6CA1;&#x6709;&#x914D;&#x7F6E; str &#x4E3A;&#x7A7A;&#x5B57;&#x7B26;&#x4E32; str &#x5DF2;&#x914D;&#x7F6E;&#x975E;&#x4E3A;&#x7A7A;&#x5B57;&#x7B26;&#x4E32; var=${str-expr} var=expr var= var=$str var=${str:-expr} var=expr var=expr var=$str var=${str+expr} var= var=expr var=expr var=${str:+expr} var= var= var=expr var=${str=expr} str=expr var=expr str &#x4E0D;&#x53D8; var= str &#x4E0D;&#x53D8; var=$str var=${str:=expr} str=expr var=expr str=expr var=expr str &#x4E0D;&#x53D8; var=$str var=${str?expr} expr &#x8F93;&#x51FA;&#x81F3; stderr var= var=$str var=${str:?expr} expr &#x8F93;&#x51FA;&#x81F3; stderr expr &#x8F93;&#x51FA;&#x81F3; stderr var=$str]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>shell</tag>
        <tag>ops</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[使用脚本防止ssh暴力破解]]></title>
    <url>%2F2012%2F04%2F13%2F%E4%BD%BF%E7%94%A8%E8%84%9A%E6%9C%AC%E9%98%B2%E6%AD%A2ssh%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[&#x524D;&#x6BB5;&#x65F6;&#x95F4;&#x4E70;&#x4E86;&#x4E2A;&#x7F8E;&#x56FD;&#x7684;vps&#xFF0C;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x5B66;&#x4E60;&#xFF0C;&#x4E5F;&#x6CA1;&#x592A;&#x6CE8;&#x610F;&#x5B89;&#x5168;&#x65B9;&#x9762;&#x3002;&#x4ECA;&#x5929;&#x968F;&#x4FBF;&#x770B;&#x4E86;&#x4E0B;/var/log/secure&#x65E5;&#x5FD7;&#xFF1A; 12345678910Apr 11 11:10:05 kof sshd[18518]: Failed password for root from 1.226.82.197 port 36824 ssh2Apr 11 11:10:10 kof sshd[18520]: Failed password for root from 1.226.82.197 port 36966 ssh2Apr 11 11:10:15 kof sshd[18522]: Failed password for root from 1.226.82.197 port 37132 ssh2Apr 11 11:10:19 kof sshd[18524]: Failed password for root from 1.226.82.197 port 37326 ssh2Apr 11 11:10:24 kof sshd[18528]: Failed password for root from 1.226.82.197 port 37476 ssh2Apr 11 11:10:29 kof sshd[18535]: Failed password for root from 1.226.82.197 port 37642 ssh2Apr 11 11:10:34 kof sshd[18537]: Failed password for root from 1.226.82.197 port 37819 ssh2Apr 11 11:10:39 kof sshd[18539]: Failed password for root from 1.226.82.197 port 38023 ssh2Apr 11 11:10:44 kof sshd[18541]: Failed password for root from 1.226.82.197 port 38200 ssh2...... &#x5927;&#x91CF;&#x7684;ssh&#x8BA4;&#x8BC1;&#x5931;&#x8D25;&#x65E5;&#x5FD7; &#xFF01;&#x5E73;&#x5747;5&#x79D2;&#x949F;&#x5C31;&#x6709;&#x4E00;&#x6B21;&#xFF01; &#x81EA;&#x5DF1;&#x52A8;&#x624B;&#xFF0C;&#x4E30;&#x8863;&#x8DB3;&#x98DF;&#xFF0C;&#x9A6C;&#x4E0A;&#x52A8;&#x624B;&#x5199;&#x4E2A;&#x811A;&#x672C;&#xFF1A; 123456789101112131415#!/bin/bashLIMIT=30 #&#x8FD9;&#x8FB9;&#x53EF;&#x4EE5;&#x81EA;&#x5B9A;&#x4E49;&#x9650;&#x5236;&#x6B21;&#x6570;LOGFILE=&quot;/var/log/block_ssh.log&quot; #&#x65E5;&#x5FD7;&#x8DEF;&#x5F84;TIME=$(date &apos;+%b %e %H&apos;) #example: Apr 11 11BLOCK_IP=$(grep &quot;$TIME&quot; /var/log/secure|grep Failed|awk &apos;{print $(NF-3)}&apos;|sort|uniq -c|awk &apos;$1&gt;&quot;$LIMIT&quot;{print $1&quot;:&quot;$2}&apos;) #&#x5C06;1&#x5C0F;&#x65F6;&#x5185;ssh&#x8BA4;&#x8BC1;&#x5931;&#x8D25;&#x8D85;&#x8FC7;30&#x6B21;&#x7684;ip&#x6293;&#x51FA;&#x6765;for i in $BLOCK_IPdo IP=$(echo $i|awk -F: &apos;{print $2}&apos;) iptables-save|grep INPUT|grep DROP|grep $IP&gt;/dev/null #&#x5148;&#x5224;&#x65AD;&#x4E0B;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x88AB;&#x5C4F;&#x853D; if [ $? -gt 0 ];then iptables -A INPUT -s $IP -p tcp --dport 22 -j DROP #&#x5C4F;&#x853D;ip NOW=$(date &apos;+%Y-%m-%d %H:%M&apos;) echo -e &quot;$NOW : $IP&quot;&gt;&gt;${LOGFILE} fidone &#x57FA;&#x672C;&#x601D;&#x8DEF;&#x662F;&#x7EDF;&#x8BA1;&#x51FA;1&#x5C0F;&#x65F6;ssh&#x8BA4;&#x8BC1;&#x5931;&#x8D25;&#x8D85;&#x8FC7;30&#x6B21;&#x7684;IP&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x5C4F;&#x853D;&#x8FC7;&#x7684;&#x5C31;&#x5C06;&#x5176;&#x52A0;&#x5165;iptables&#x5C4F;&#x853D;&#x3002;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x8BBE;&#x7F6E;&#x767D;&#x540D;&#x5355;&#x4E86;&#xFF0C;&#x6B63;&#x5E38;ip&#x5728;&#x4E00;&#x4E2A;&#x5C0F;&#x65F6;&#x5185;&#x4E0D;&#x4F1A;&#x6709;&#x90A3;&#x4E48;&#x591A;&#x7684;Failed&#x8BA4;&#x8BC1;&#x3002; &#x7ED9;&#x4E88;&#x811A;&#x672C;&#x6267;&#x884C;&#x6743;&#x9650;&#xFF1A; 1chmod 755 /root/block_ssh.sh &#x6700;&#x540E;&#x52A0;&#x5165;&#x5230;crontab&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;&#xFF0C;10&#x5206;&#x949F;&#x8FD0;&#x884C;&#x4E00;&#x6B21;&#xFF1A; 1echo &quot;*/10 * * * * root /root/block_ssh.sh&quot; &gt;&gt;/etc/crontab &#x811A;&#x672C;&#x8FD0;&#x884C;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x540E;&#x7684;&#x65E5;&#x5FD7;&#xFF1A; 1234567891011[root@vps ~]# more /var/log/block_ssh_ip.log2012-04-13 02:10 : 210.75.241.202012-04-13 02:10 : 59.60.7.1022012-04-13 11:30 : 189.47.32.192012-04-13 13:30 : 184.107.119.2132012-04-13 18:30 : 222.122.20.1452012-04-14 05:10 : 188.127.226.662012-04-14 09:00 : 69.163.33.982012-04-14 10:10 : 184.106.165.1642012-04-14 22:10 : 65.117.150.992012-04-15 06:00 : 124.205.252.158 &#x6700;&#x540E;&#x9644;&#x4E0A;&#x63D0;&#x9AD8;ssh&#x5B89;&#x5168;&#x6027;&#x7684;&#x65B9;&#x6CD5;&#xFF1A; &#x4E0B;&#x9762;&#x5185;&#x5BB9;&#x8F6C;&#x81EA;&#xFF1A;http://www.opsers.org/linux-home/base/ssh-security-methods-to-improve.html &#x4FEE;&#x6539;sshd&#x670D;&#x52A1;&#x5668;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;/etc/ssh/sshd_config&#xFF0C;&#x5C06;&#x90E8;&#x5206;&#x53C2;&#x6570;&#x53C2;&#x7167;&#x5982;&#x4E0B;&#x4FEE;&#x6539;&#xFF0C;&#x589E;&#x5F3A;&#x5B89;&#x5168;&#x6027;&#x3002; &#x7CFB;&#x7EDF;&#x7F3A;&#x7701;&#x4F7F;&#x7528;22&#x53F7;&#x7AEF;&#x53E3;&#xFF0C;&#x5C06;&#x76D1;&#x542C;&#x7AEF;&#x53E3;&#x66F4;&#x6539;&#x4E3A;&#x5176;&#x4ED6;&#x6570;&#x503C;&#xFF08;&#x6700;&#x597D;&#x662F;1024&#x4EE5;&#x4E0A;&#x7684;&#x9AD8;&#x7AEF;&#x53E3;&#xFF0C;&#x4EE5;&#x514D;&#x548C;&#x5176;&#x4ED6;&#x5E38;&#x89C4;&#x670D;&#x52A1;&#x7AEF;&#x53E3;&#x51B2;&#x7A81;&#xFF09;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x589E;&#x52A0;&#x5165;&#x4FB5;&#x8005;&#x63A2;&#x6D4B;&#x7CFB;&#x7EDF;&#x662F;&#x5426;&#x8FD0;&#x884C;&#x4E86; sshd&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x96BE;&#x5EA6;&#x3002; 1Port 5555 &#x5BF9;&#x4E8E;&#x5728;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x5B89;&#x88C5;&#x4E86;&#x591A;&#x4E2A;&#x7F51;&#x5361;&#x6216;&#x914D;&#x7F6E;&#x591A;&#x4E2A;IP&#x5730;&#x5740;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x8BBE;&#x5B9A;sshd&#x53EA;&#x5728;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x6307;&#x5B9A;&#x7684;&#x63A5;&#x53E3;&#x5730;&#x5740;&#x76D1;&#x542C;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x51CF;&#x5C11;sshd&#x7684;&#x5165;&#x53E3;&#xFF0C;&#x964D;&#x4F4E;&#x5165;&#x4FB5;&#x7684;&#x53EF;&#x80FD;&#x6027;&#x3002; 1ListenAddress 192.168.0.1 &#x5982;&#x679C;&#x5141;&#x8BB8;&#x7528;&#x6237;&#x4F7F;&#x7528;root&#x7528;&#x6237;&#x767B;&#x5F55;&#xFF0C;&#x90A3;&#x4E48;&#x9ED1;&#x5BA2;&#x4EEC;&#x53EF;&#x4EE5;&#x9488;&#x5BF9;root&#x7528;&#x6237;&#x5C1D;&#x8BD5;&#x66B4;&#x529B;&#x7834;&#x89E3;&#x5BC6;&#x7801;&#xFF0C;&#x7ED9;&#x7CFB;&#x7EDF;&#x5B89;&#x5168;&#x5E26;&#x6765;&#x98CE;&#x9669;&#x3002; 1PermitRootLogin no &#x5141;&#x8BB8;&#x4F7F;&#x7528;&#x7A7A;&#x5BC6;&#x7801;&#x7CFB;&#x7EDF;&#x5C31;&#x50CF;&#x4E0D;&#x8BBE;&#x9632;&#x7684;&#x5821;&#x5792;&#xFF0C;&#x4EFB;&#x4F55;&#x5B89;&#x5168;&#x63AA;&#x65BD;&#x90FD;&#x662F;&#x4E00;&#x53E5;&#x7A7A;&#x8BDD;&#x3002; 1PermitEmptyPasswords no &#x53EA;&#x5141;&#x8BB8;&#x6307;&#x5B9A;&#x7684;&#x67D0;&#x4E9B;&#x7528;&#x6237;&#x901A;&#x8FC7;ssh&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5C06;ssh&#x4F7F;&#x7528;&#x6743;&#x9650;&#x9650;&#x5B9A;&#x5728;&#x6700;&#x5C0F;&#x7684;&#x8303;&#x56F4;&#x5185;&#x3002; 1AllowUsers sshuser1 sshuser2 &#x540C;&#x4E0A;&#x9762;&#x7684;AllowUsers&#x7C7B;&#x4F3C;&#xFF0C;&#x9650;&#x5B9A;&#x6307;&#x5B9A;&#x7684;&#x7528;&#x6237;&#x7EC4;&#x901A;&#x8FC7;ssh&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x4E8C;&#x8005;&#x5BF9;&#x4E8E;&#x9650;&#x5B9A;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x5668;&#x6709;&#x76F8;&#x540C;&#x7684;&#x6548;&#x679C;&#x3002; 1AllowGroups sshgroup &#x7981;&#x6B62;&#x4F7F;&#x7528;&#x7248;&#x672C;1&#x534F;&#x8BAE;&#xFF0C;&#x56E0;&#x4E3A;&#x5176;&#x5B58;&#x5728;&#x8BBE;&#x8BA1;&#x7F3A;&#x9677;&#xFF0C;&#x5F88;&#x5BB9;&#x6613;&#x4F7F;&#x5BC6;&#x7801;&#x88AB;&#x9ED1;&#x6389;&#x3002; 1Protocol 2 &#x5173;&#x95ED;X11Forwarding&#xFF0C;&#x9632;&#x6B62;&#x4F1A;&#x8BDD;&#x88AB;&#x52AB;&#x6301;&#x3002; 1X11Forwarding no sshd&#x670D;&#x52A1;&#x8FD0;&#x884C;&#x65F6;&#x6BCF;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x90FD;&#x8981;&#x4F7F;&#x7528;&#x4E00;&#x5927;&#x5757;&#x53EF;&#x89C2;&#x7684;&#x5185;&#x5B58;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;ssh&#x5B58;&#x5728;&#x62D2;&#x7EDD;&#x670D;&#x52A1;&#x653B;&#x51FB;&#x7684;&#x539F;&#x56E0;&#x3002;&#x4E00;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x9664;&#x975E;&#x5B58;&#x5728;&#x8BB8;&#x591A;&#x7BA1;&#x7406;&#x5458;&#x540C;&#x65F6;&#x7BA1;&#x7406;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5426;&#x5219;&#x4E0A;&#x9762;&#x8FD9; &#x4E2A;&#x8FDE;&#x63A5;&#x6570;&#x8BBE;&#x7F6E;&#x662F;&#x591F;&#x7528;&#x4E86;&#x3002; 1MaxStartups 5 &#x6CE8;&#x610F;&#xFF1A;&#x4EE5;&#x4E0A;&#x53C2;&#x6570;&#x8BBE;&#x7F6E;&#x4EC5;&#x4EC5;&#x662F;&#x4E00;&#x4E2A;&#x793A;&#x4F8B;&#xFF0C;&#x7528;&#x6237;&#x5177;&#x4F53;&#x4F7F;&#x7528;&#x65F6;&#x5E94;&#x6839;&#x636E;&#x5404;&#x81EA;&#x7684;&#x73AF;&#x5883;&#x505A;&#x76F8;&#x5E94;&#x7684;&#x66F4;&#x6539;&#x3002; &#x4FEE;&#x6539;sshd&#x670D;&#x52A1;&#x5668;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;/etc/ssh/sshd_config&#x7684;&#x8BFB;&#x5199;&#x6743;&#x9650;&#xFF0C;&#x5BF9;&#x6240;&#x6709;&#x975E;root&#x7528;&#x6237;&#x8BBE;&#x7F6E;&#x53EA;&#x8BFB;&#x6743;&#x9650;&#xFF0C;&#x9632;&#x6B62;&#x975E;&#x6388;&#x6743;&#x7528;&#x6237;&#x4FEE;&#x6539;sshd &#x670D;&#x52A1;&#x7684;&#x5B89;&#x5168;&#x8BBE;&#x7F6E;&#x3002; 1chmod 644 /etc/ssh/sshd_config &#x8BBE;&#x7F6E;TCP Wrappers&#x3002;&#x670D;&#x52A1;&#x5668;&#x9ED8;&#x8BA4;&#x63A5;&#x53D7;&#x6240;&#x6709;&#x7684;&#x8BF7;&#x6C42;&#x8FDE;&#x63A5;&#xFF0C;&#x8FD9;&#x662F;&#x975E;&#x5E38;&#x5371;&#x9669;&#x7684;&#x3002;&#x4F7F;&#x7528;TCP Wrappers&#x53EF;&#x4EE5;&#x963B;&#x6B62;&#x6216;&#x5141;&#x8BB8;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x4EC5;&#x5BF9;&#x67D0;&#x4E9B;&#x4E3B;&#x673A;&#x5F00;&#x653E;&#xFF0C;&#x7ED9;&#x7CFB;&#x7EDF;&#x5728;&#x589E;&#x52A0;&#x4E00;&#x9053;&#x5B89;&#x5168;&#x5C4F;&#x969C;&#x3002;&#x8FD9;&#x90E8;&#x5206;&#x8BBE;&#x7F6E;&#x5171;&#x6D89;&#x8BA1;&#x5230;&#x4E24;&#x4E2A;&#x6587;&#x4EF6;&#xFF1A;hosts.allow&#x548C; hosts.deny&#x3002; &#x5C06;&#x90A3;&#x4E9B;&#x660E;&#x786E;&#x5141;&#x8BB8;&#x7684;&#x8BF7;&#x6C42;&#x6DFB;&#x52A0;&#x5230;/etc/hosts.allow&#x4E2D;&#x3002;&#x5982;&#x7CFB;&#x7EDF;&#x4EC5;&#x5141;&#x8BB8;IP&#x5730;&#x5740;&#x4E3A;192.168.0.15&#x548C;10.0.0.11&#x7684;&#x4E3B;&#x673A;&#x4F7F;&#x7528; sshd&#x670D;&#x52A1;&#xFF0C;&#x5219;&#x6DFB;&#x52A0;&#x5982;&#x4E0B;&#x5185;&#x5BB9;&#xFF1A; 1sshd:192.168.0.15 10.0.0.11 &#x5C06;&#x9700;&#x8981;&#x7981;&#x6B62;&#x4F7F;&#x7528;&#x7684;&#x4FE1;&#x606F;&#x6DFB;&#x52A0;&#x5230;/etc/hosts.deny&#x4E2D;&#x3002;&#x5982;&#x5BF9;&#x9664;&#x4E86;&#x5728;hosts.allow&#x5217;&#x8868;&#x4E2D;&#x660E;&#x786E;&#x5141;&#x8BB8;&#x4F7F;&#x7528;sshd&#x7684;&#x7528;&#x6237;&#x5916;&#xFF0C;&#x6240;&#x6709;&#x5176;&#x4ED6;&#x7528;&#x6237;&#x90FD;&#x7981;&#x6B62;&#x4F7F;&#x7528;sshd&#x670D;&#x52A1;&#xFF0C;&#x5219;&#x6DFB;&#x52A0;&#x5982;&#x4E0B;&#x5185;&#x5BB9;&#x5230;hosts.deny&#x6587;&#x4EF6;&#x4E2D;&#xFF1A; 1sshd:All &#x6CE8;&#x610F;&#xFF1A;&#x7CFB;&#x7EDF;&#x5BF9;&#x4E0A;&#x8FF0;&#x4E24;&#x4E2A;&#x6587;&#x4EF6;&#x7684;&#x5224;&#x65AD;&#x987A;&#x5E8F;&#x662F;&#x5148;&#x68C0;&#x67E5;hosts.allow&#x6587;&#x4EF6;&#x518D;&#x67E5;&#x770B;hosts.deny&#x6587;&#x4EF6;&#xFF0C;&#x56E0;&#x6B64;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x5728;hosts.allow&#x5141;&#x8BB8;&#x4F7F;&#x7528;&#x7F51;&#x7EDC;&#x8D44;&#x6E90;&#xFF0C;&#x800C;&#x540C;&#x65F6;&#x5728;hosts.deny&#x4E2D;&#x7981;&#x6B62;&#x4F7F;&#x7528;&#x8BE5;&#x7F51;&#x7EDC;&#x8D44;&#x6E90;&#xFF0C;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x7CFB;&#x7EDF;&#x4F18;&#x5148;&#x9009;&#x62E9;&#x4F7F;&#x7528;hosts.allow&#x914D;&#x7F6E;&#xFF0C;&#x5141;&#x8BB8;&#x7528;&#x6237;&#x4F7F;&#x7528;&#x8BE5;&#x7F51;&#x7EDC;&#x8D44;&#x6E90;&#x3002; &#x5C3D;&#x91CF;&#x5173;&#x95ED;&#x4E00;&#x4E9B;&#x7CFB;&#x7EDF;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x542F;&#x52A8;&#x670D;&#x52A1;&#x3002;&#x7CFB;&#x7EDF;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x542F;&#x52A8;&#x4E86;&#x8BB8;&#x591A;&#x4E0E;&#x7F51;&#x7EDC;&#x76F8;&#x5173;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x56E0;&#x6B64;&#x76F8;&#x5BF9;&#x5E94;&#x7684;&#x5F00;&#x653E;&#x4E86;&#x8BB8;&#x591A;&#x7AEF;&#x53E3;&#x8FDB;&#x884C;LISTENING&#xFF08;&#x76D1;&#x542C;&#xFF09;&#x3002;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#xFF0C;&#x5F00;&#x653E;&#x7684;&#x7AEF;&#x53E3;&#x8D8A;&#x591A;&#xFF0C;&#x7CFB;&#x7EDF;&#x4ECE;&#x5916;&#x90E8;&#x88AB;&#x5165;&#x4FB5;&#x7684;&#x53EF;&#x80FD;&#x4E5F;&#x5C31;&#x8D8A;&#x5927;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x8981;&#x5C3D;&#x91CF;&#x5173;&#x95ED;&#x4E00;&#x4E9B;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x542F;&#x52A8;&#x670D;&#x52A1;&#xFF0C;&#x4ECE;&#x800C;&#x5C3D;&#x53EF;&#x80FD;&#x7684;&#x5173;&#x95ED;&#x7AEF;&#x53E3;&#xFF0C;&#x63D0;&#x4F9B;&#x7CFB;&#x7EDF;&#x7684;&#x5B89;&#x5168;&#x6027;&#x3002; &#x901A;&#x8FC7;&#x4EE5;&#x4E0A;&#x6B65;&#x9AA4;&#x57FA;&#x672C;&#x4E0A;&#x5C06;sshd&#x670D;&#x52A1;&#x8BBE;&#x7F6E;&#x4E0A;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x7684;&#x6F0F;&#x6D1E;&#x5835;&#x4E0A;&#x4E86;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x6295;&#x8D44;&#xFF0C;&#x53EA;&#x8981;&#x6211;&#x4EEC;&#x7A0D;&#x5FAE;&#x82B1;&#x70B9;&#x65F6;&#x95F4;&#x8C03;&#x6574;&#x4E00;&#x4E0B;&#x914D;&#x7F6E;&#xFF0C;&#x5C31;&#x53EF;&#x6781;&#x5927;&#x63D0;&#x9AD8;&#x7CFB;&#x7EDF;&#x7684;&#x5B89;&#x5168;&#x73AF;&#x5883;&#xFF0C;&#x4F55;&#x4E50;&#x800C;&#x4E0D;&#x4E3A;&#x5462;&#xFF1F;]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>ops</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[rsync简明教程]]></title>
    <url>%2F2012%2F03%2F12%2Frsync%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[&#x7B80;&#x4ECB;&#x4E00;&#x4E2A;&#x8DE8;&#x5E73;&#x53F0;&#x7684;&#x8D44;&#x6599;&#x5907;&#x4EFD;&#x4E0E;&#x540C;&#x6B65;&#x5DE5;&#x5177; &#x539F;&#x7406;&#x5728;&#x8FDB;&#x884C;&#x540C;&#x6B65;&#x4E4B;&#x524D;&#xFF0C;&#x4F1A;&#x5148;&#x6BD4;&#x8F83;&#x5206;&#x6790;&#x4E24;&#x7AEF;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x627E;&#x51FA;&#x6570;&#x636E;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x8FC7;&#x591A;&#x6587;&#x4EF6;&#xFF0C;&#x518D;&#x5C06;&#x8FD9;&#x4E9B;&#x6587;&#x4EF6;&#x4F20;&#x8F93;&#x5230;&#x76EE;&#x7684;&#x7AEF;&#xFF0C;&#x5B8C;&#x6210;&#x5907;&#x4EFD;&#x5DE5;&#x4F5C; &#x4F18;&#x70B9;1&#x3001;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x589E;&#x91CF;&#x5907;&#x4EFD;&#xFF0C;&#x5373;&#x4F7F;&#x5907;&#x4EFD;&#x4E2D;&#x65AD;&#xFF0C;&#x4E0B;&#x6B21;&#x5907;&#x4EFD;&#x4F1A;&#x4ECE;&#x4ECE;&#x4E0A;&#x6B21;&#x4E2D;&#x65AD;&#x7684;&#x4F4D;&#x7F6E;&#x7EE7;&#x7EED;2&#x3001;&#x53EF;&#x4EE5;&#x5229;&#x7528;ssh&#x8FDB;&#x884C;&#x6570;&#x636E;&#x52A0;&#x5BC6;&#x4F20;&#x8F93;3&#x3001;&#x5F00;&#x6E90;&#x3001;&#x8DE8;&#x5E73;&#x53F0; &#x7F3A;&#x70B9;1&#x3001;&#x9047;&#x5230;&#x6587;&#x4EF6;&#x6570;&#x6216;&#x76EE;&#x5F55;&#x5C42;&#x6570;&#x591A;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6548;&#x7387;&#x8F83;&#x5DEE;&#x3002;&#x6587;&#x4EF6;&#x6570;&#x5230;&#x8FBE;&#x4E00;&#x5B9A;&#x6570;&#x91CF;&#x65F6;&#xFF0C;rsync&#x53EF;&#x80FD;&#x65E0;&#x6CD5;&#x6267;&#x884C;2&#x3001;&#x64CD;&#x4F5C;&#x65F6;&#x52A1;&#x5FC5;&#x5C0F;&#x5FC3;&#xFF0C;&#x5426;&#x5219;&#x5BB9;&#x6613;&#x8986;&#x76D6;&#x6216;&#x8BEF;&#x5220;&#x9664;&#x6570;&#x636E; &#x8FD0;&#x884C;&#x6A21;&#x5F0F;1&#x3001;&#x5728;&#x672C;&#x673A;&#x4E0A;&#x8FD0;&#x884C;&#xFF0C;&#x7528;&#x6CD5;&#x4E0E;cp&#x51E0;&#x4E4E;&#x4E00;&#x6A21;&#x4E00;&#x6837;&#xFF1A;1rsync -av /etc /tmp&#xFF08;&#x5C06;/etc&#x76EE;&#x5F55;&#x5907;&#x4EFD;&#x5230;/tmp/etc&#x76EE;&#x5F55;&#x91CC;&#xFF09; 2&#x3001;&#x901A;&#x8FC7;ssh&#x901A;&#x9053;&#x5728;&#x4F20;&#x8F93;&#x6570;&#x636E;&#xFF1A;12rsync -av -e ssh user@192.168.1.1:/etc /tmp&#xFF08;&#x5C06;192.168.1.1&#x4E0A;&#x7684;/etc&#x76EE;&#x5F55;&#x5907;&#x4EFD;&#x5230;&#x672C;&#x673A;&#x7684;/tmp&#x76EE;&#x5F55;&#xFF09;rsync -av -e ssh user@192.168.1.1:/etc/ /tmp&#xFF08;&#x5C06;192.168.1.1&#x4E0A;&#x7684;/etc&#x76EE;&#x5F55;&#x4E0B;&#x7684;&#x6587;&#x4EF6;&#x5907;&#x4EFD;&#x5230;&#x672C;&#x673A;&#x7684;/tmp&#x76EE;&#x5F55;&#xFF09; 3&#x3001;&#x4F7F;&#x7528;daemon&#x7684;&#x65B9;&#x5F0F;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x5907;&#x4EFD;&#x4F20;&#x8F93; &#x6B64;&#x65F6;rsync&#x670D;&#x52A1;&#x7AEF;&#x9700;&#x542F;&#x7528;873&#x7AEF;&#x53E3; &#x73AF;&#x5883;&#xFF1A; 12server: 192.168.1.101client: 192.168.1.104 &#x8BF4;&#x660E;&#xFF1A; &#x5C06;server&#x4E0A;&#x7684;/var/log&#x91CC;&#x7684;&#x6587;&#x4EF6;&#x540C;&#x6B65;&#x5230;client&#x7684;/tmp/log&#x76EE;&#x5F55; &#x670D;&#x52A1;&#x7AEF;&#x914D;&#x7F6E;&#xFF1A; &#x9996;&#x5148;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;/etc/rsyncd.conf 12345678910111213141516[root@kof ~]# vim /etc/rsyncd.confuid = root #&#x8BBE;&#x7F6E;&#x6267;&#x884C;rsync&#x7684;&#x672C;&#x5730;&#x7528;&#x6237;gid = root #&#x8BBE;&#x7F6E;&#x6267;&#x884C;rsync&#x7684;&#x672C;&#x5730;&#x7EC4;#use chroot = yes #&#x662F;&#x5426;chrootmax connections = 4 #&#x6700;&#x5927;&#x540C;&#x65F6;&#x8FDE;&#x63A5;&#x6570;pid file = /var/run/rsyncd.pid #&#x6307;&#x5B9A;rsync&#x670D;&#x52A1;&#x8FDB;&#x7A0B;&#x7684;pid filelock file = /var/run/rsync.lock #&#x6307;&#x5B9A;rsync&#x670D;&#x52A1;&#x7AEF;&#x9501;&#x5B9A;&#x6587;&#x4EF6;log file = /var/log/rsyncd.log #&#x6307;&#x5B9A;rsync&#x7684;log&#x8F93;&#x51FA;&#x8DEF;&#x5F84;[downloads] #&#x6A21;&#x5757;&#x8BBE;&#x5B9A;&#xFF0C;&#x53EF;&#x8BBE;&#x7F6E;&#x591A;&#x4E2A;&#x6A21;&#x5757;path = /var/log #&#x540C;&#x6B65;&#x6587;&#x4EF6;&#x7684;&#x771F;&#x5B9E;&#x8DEF;&#x5F84;ignore errorsread only = true #&#x662F;&#x5426;&#x53EA;&#x8BFB;list = truehosts allow = 192.168.1.0/24 #&#x5141;&#x8BB8;&#x540C;&#x6B65;&#x5230;ip/&#x7F51;&#x6BB5;hosts deny = 0.0.0.0/32auth users = backup #&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7528;&#x6237;&#x3002;&#x8FD9;&#x4E0D;&#x662F;&#x7CFB;&#x7EDF;&#x7528;&#x6237;&#xFF0C;&#x800C;&#x662F;rsync&#x670D;&#x52A1;&#x81EA;&#x5B9A;&#x7684;secrets file = /etc/rsyncd.pwd #downloads&#x6A21;&#x5757;&#x7684;&#x5BC6;&#x7801;&#x6587;&#x4EF6; &#x521B;&#x5EFA;&#x5BC6;&#x7801;&#x6587;&#x4EF6;/etc/rsyncd.pwd 12345[root@kof ~]# vim /etc/rsyncd.pwdbackup:jjj #&#x7528;&#x6237;backup&#xFF0C;&#x5BC6;&#x7801;jjj[root@kof ~]# chmod 600 /etc/rsyncd.pwd #&#x51FA;&#x4E8E;&#x5B89;&#x5168;&#x8003;&#x8651;&#xFF0C;&#x6587;&#x4EF6;&#x53EA;&#x6709;&#x5C5E;&#x7EC4;&#x53EF;&#x8BFB;&#x5199;[root@kof ~]# rsync --daemon #&#x4EE5;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x6A21;&#x5F0F;&#x542F;&#x52A8;rsync&#x670D;&#x52A1;&#xFF0C;&#x201C;--config=&#x201D;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;/etc/rsyncd.pwd[root@kof ~]# netstat -tunlp |grep 873 #&#x68C0;&#x67E5;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x542F;&#x52A8; &#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#xFF1A; 123[root@client ~]# vim /etc/rsync.pwd #&#x521B;&#x5EFA;&#x5BC6;&#x7801;&#x6587;&#x4EF6;jjj[root@client ~]# chmod 600 /etc/rsync.pwd #&#x4FEE;&#x6539;&#x5BC6;&#x7801;&#x6587;&#x4EF6;&#x6743;&#x9650; &#x5F00;&#x59CB;&#x540C;&#x6B65;&#xFF1A; 12345[root@client ~]# rsync -avzP --password-file=/etc/rsync.pwd backup@192.168.1.101::downloads/* /tmp/logavzP #z&#x662F;&#x538B;&#x7F29; P&#x662F;&#x663E;&#x793A;&#x4F20;&#x8F93;&#x8FDB;&#x5EA6;--password-file #&#x6307;&#x5B9A;&#x5BC6;&#x7801;&#x6587;&#x4EF6;&#xFF0C;&#x5982;&#x4E0D;&#x6307;&#x5B9A;&#xFF0C;&#x4F1A;&#x5728;shell&#x4E2D;&#x63D0;&#x793A;&#x624B;&#x5DE5;&#x8F93;&#x5165;backup@192.168.1.101::downloads/* #&#x6E90;&#x6587;&#x4EF6;&#xFF0C;downloads&#x662F;&#x6A21;&#x5757;&#x540D;/tmp/log #&#x76EE;&#x6807;&#x6587;&#x4EF6; &#x4E5F;&#x53EF;&#x4ECE;&#x5BA2;&#x6237;&#x7AEF;&#x540C;&#x6B65;&#x5230;&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;read only&#x5FC5;&#x987B;&#x6539;&#x4E3A;false&#x3002; &#x4E0B;&#x9762;&#x662F;rsync&#x7684;&#x90E8;&#x5206;&#x8BED;&#x6CD5;&#x8BF4;&#x660E;&#xFF1A; 12345678910111213141516[root@linux ~]# rsync [-avrlptgoD] [-e ssh] [user@host:/dir] [/local/path]&#x53C2;&#x6570;&#xFF1A;-v &#xFF1A;&#x89C2;&#x5BDF;&#x6A21;&#x5F0F;&#xFF0C;&#x53EF;&#x4EE5;&#x5217;&#x51FA;&#x66F4;&#x591A;&#x7684;&#x4FE1;&#x606F;&#xFF1B;-q &#xFF1A;&#x4E0E; -v &#x76F8;&#x53CD;&#xFF0C;&#x5B89;&#x9759;&#x6A21;&#x5F0F;&#xFF0C;&#x8F93;&#x51FA;&#x7684;&#x4FE1;&#x606F;&#x6BD4;&#x8F83;&#x5C11;&#xFF1B;-r &#xFF1A;&#x9012;&#x5F52;&#x590D;&#x5236;&#xFF01;&#x53EF;&#x4EE5;&#x9488;&#x5BF9;&#x300E;&#x76EE;&#x5F55;&#x300F;&#x6765;&#x5904;&#x7406;&#xFF01;&#x5F88;&#x91CD;&#x8981;&#xFF01;-u &#xFF1A;&#x4EC5;&#x66F4;&#x65B0; (update)&#xFF0C;&#x4E0D;&#x4F1A;&#x8986;&#x76D6;&#x76EE;&#x6807;&#x7684;&#x65B0;&#x6863;&#x6848;&#xFF1B;-l &#xFF1A;&#x590D;&#x5236;&#x8FDE;&#x7ED3;&#x6587;&#x4EF6;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x800C;&#x975E;&#x8FDE;&#x7ED3;&#x7684;&#x76EE;&#x6807;&#x6E90;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#xFF1B;-p &#xFF1A;&#x590D;&#x5236;&#x65F6;&#xFF0C;&#x8FDE;&#x540C;&#x5C5E;&#x6027; (permission) &#x4E5F;&#x4FDD;&#x5B58;&#x4E0D;&#x53D8;&#xFF01;-g &#xFF1A;&#x4FDD;&#x5B58;&#x6E90;&#x6587;&#x4EF6;&#x7684;&#x62E5;&#x6709;&#x7FA4;&#x7EC4;&#xFF1B;-o &#xFF1A;&#x4FDD;&#x5B58;&#x6E90;&#x6587;&#x4EF6;&#x7684;&#x62E5;&#x6709;&#x4EBA;&#xFF1B;-D &#xFF1A;&#x4FDD;&#x5B58;&#x6E90;&#x6587;&#x4EF6;&#x7684;&#x88C5;&#x7F6E;&#x5C5E;&#x6027; (device)-t &#xFF1A;&#x4FDD;&#x5B58;&#x6E90;&#x6587;&#x4EF6;&#x7684;&#x65F6;&#x95F4;&#x53C2;&#x6570;&#xFF1B;-I &#xFF1A;&#x5FFD;&#x7565;&#x66F4;&#x65B0;&#x65F6;&#x95F4; (mtime) &#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x6863;&#x6848;&#x6BD4;&#x5BF9;&#x4E0A;&#x4F1A;&#x6BD4;&#x8F83;&#x5FEB;&#x901F;&#xFF1B;-z &#xFF1A;&#x52A0;&#x4E0A;&#x538B;&#x7F29;&#x7684;&#x53C2;&#x6570;&#xFF01;-e &#xFF1A;&#x4F7F;&#x7528;&#x7684;&#x4FE1;&#x9053;&#x534F;&#x8BAE;&#xFF0C;&#x4F8B;&#x5982;&#x4F7F;&#x7528; ssh &#x901A;&#x9053;&#xFF0C;&#x5219; -e ssh-a &#xFF1A;&#x76F8;&#x5F53;&#x4E8E; -rlptgoD &#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A; -a &#x662F;&#x6700;&#x5E38;&#x7528;&#x7684;&#x53C2;&#x6570;&#x4E86;&#xFF01;]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>ops</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux下大文件跨网传输的方法]]></title>
    <url>%2F2012%2F03%2F11%2FLinux%E4%B8%8B%E5%A4%A7%E6%96%87%E4%BB%B6%E8%B7%A8%E7%BD%91%E4%BC%A0%E8%BE%93%E7%9A%84%E6%96%B9%E6%B3%95%2F</url>
    <content type="text"><![CDATA[&#x5F88;&#x591A;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x90FD;&#x8981;&#x8FDB;&#x884C;&#x4E00;&#x4E9B;&#x5927;&#x6587;&#x4EF6;&#x7684;&#x4F20;&#x8F93;&#xFF0C;&#x6BD4;&#x5982;&#x6570;&#x636E;&#x7684;&#x5907;&#x4EFD;&#xFF0C;&#x8FC1;&#x79FB;&#x7B49;&#x7B49;&#x3002; &#x4E0B;&#x9762;&#x4ECB;&#x7ECD;&#x51E0;&#x79CD;&#x7B80;&#x5355;&#x7684;&#x5FEB;&#x901F;&#x4F20;&#x8F93;&#x6587;&#x4EF6;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5E0C;&#x671B;&#x5BF9;&#x5927;&#x5BB6;&#x6709;&#x5E2E;&#x52A9;&#x3002; &#x73AF;&#x5883;12host1:192.168.1.101host2:192.168.1.104 &#x4F7F;&#x7528;scp&#x5C06;host1&#x4E2D;&#x7684;file.tar.gz&#x62F7;&#x8D1D;&#x5230;host2&#x7684;/tmp&#x76EE;&#x5F55; 1scp file.tar.gz root@192.168.1.104:/tmp &#x5C06;host1&#x4E2D;&#x7684;/root&#x76EE;&#x5F55;&#x6574;&#x4E2A;&#x62F7;&#x8D1D;&#x5230;host2&#x7684;/tmp&#x76EE;&#x5F55;&#x4E0B;(&#x53C2;&#x6570;&#xFF1A;-r &#x9012;&#x5F52;&#x7684;&#x590D;&#x5236;&#x6574;&#x4E2A;&#x6587;&#x4EF6;&#x5939;) 123scp -r /root root@192.168.1.104:/tmp&#x6216;scp -r /root/ root@192.168.1.104:/tmp &#x62F7;&#x8D1D;&#x6587;&#x4EF6;&#x5939;&#x5185;&#x5BB9;&#x91CC;&#x7684;&#x6240;&#x6709;&#x5185;&#x5BB9; 1scp -r /root/* root@192.168.1.104:/tmp &#x4F7F;&#x7528;rsync&#x901A;&#x8FC7;ssh&#x901A;&#x9053;&#x5C06;host1&#x4E0A;&#x7684;&#x76EE;&#x5F55;/etc&#x5907;&#x4EFD;&#x5230;host2&#x7684;/tmp&#x76EE;&#x5F55; &#x5728;host2&#x6267;&#x884C;&#x4EE5;&#x4E0B;&#x6307;&#x4EE4;&#xFF1A; 1rsync -av -e ssh file.tar.gz 192.168.1.101:/etc /tmp &#x52A0;&#x4E0A;- -progress&#x53EF;&#x4EE5;&#x89C2;&#x5BDF;&#x4F20;&#x8F93;&#x8FDB;&#x5EA6; &#x4F7F;&#x7528;nc&#x5C06;file.tar.gz&#x4ECE;host2&#x62F7;&#x8D1D;&#x5230;host1: 12host1:nc -l 444 &gt;file.tar.gz #&#x5148;&#x542F;&#x7528;&#x76D1;&#x542C;host2:nc 192.168.1.101 444 &#x300A;file.tar.gz &#x5C06;&#x76EE;&#x5F55;/etc&#x4ECE;host2&#x62F7;&#x8D1D;&#x5230;host1&#xFF1A; 12host1:nc -l 123 |tar zxvf - #&#x5148;&#x542F;&#x7528;&#x76D1;&#x542C;host2:tar zcvf - . |nc 192.168.1.101 123]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>ops</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LINUX踢人]]></title>
    <url>%2F2012%2F03%2F11%2FLINUX%E8%B8%A2%E4%BA%BA%2F</url>
    <content type="text"><![CDATA[Linux&#x7684;root&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x5F3A;&#x5236;&#x8E22;&#x51FA;&#x5176;&#x4ED6;&#x767B;&#x9646;&#x5230;&#x7528;&#x6237;. &#x9996;&#x5148;&#x4F7F;&#x7528;w&#x547D;&#x4EE4;&#x67E5;&#x770B;&#x6240;&#x6709;&#x5728;&#x7EBF;&#x7528;&#x6237;: 123456[root@kof ~]# w 19:35:55 up 20 min, 3 users, load average: 0.36, 0.45, 0.29USER TTY FROM LOGIN@ IDLE JCPU PCPU WHATroot tty1 - 19:26 8:36 0.17s 0.17s -bashroot pts/0 192.168.1.100 19:27 0.00s 0.01s 0.00s wroot pts/1 192.168.1.100 19:29 5:49 0.01s 0.01s -bash &#x8E22;&#x4EBA;&#x547D;&#x4EE4;&#xFF1A; 1pkill -kill -t TTY &#x6BD4;&#x5982;&#x8E22;&#x51FA;pts/0&#x7684;&#x7528;&#x6237;&#x7684;&#x547D;&#x4EE4;&#x662F;&#xFF1A; 1pkill -kill -t pts/0 &#x7528;&#x6237;&#x5DF2;&#x7ECF;&#x88AB;&#x5F3A;&#x5236;&#x8E22;&#x6389;&#xFF1A; 1234 19:38:49 up 23 min, 2 users, load average: 0.02, 0.24, 0.23USER TTY FROM LOGIN@ IDLE JCPU PCPU WHATroot tty1 - 19:26 11:30 0.17s 0.17s -bashroot pts/1 192.168.1.100 19:29 0.00s 0.01s 0.00s w]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>ops</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[使用mod_limitipconn模块限制IP并发连接数]]></title>
    <url>%2F2012%2F03%2F04%2F%E4%BD%BF%E7%94%A8mod_limitipconn%E6%A8%A1%E5%9D%97%E9%99%90%E5%88%B6IP%E5%B9%B6%E5%8F%91%E8%BF%9E%E6%8E%A5%E6%95%B0%2F</url>
    <content type="text"><![CDATA[&#x4F7F;&#x7528;mod_limitipconn&#x6A21;&#x5757;&#x9650;&#x5236;IP&#x5E76;&#x53D1;&#x8FDE;&#x63A5;&#x6570;&#x5B89;&#x88C5;&#xFF1A; 1234wget http://dominia.org/djao/limit/mod_limitipconn-0.24.tar.bz2tar jxvf mod_limitipconn-0.24.tar.bz2cd mod_limitipconn-0.24/usr/local/apache2/bin/apxs -c -i mod_limitipconn.c &#x7F16;&#x8F91;httpd.conf 123456789101112ExtendedStatus OnLoadModule limitipconn_module modules/mod_limitipconn.so &lt;ifModule mod_limitipconn.c&gt;&lt;location /&gt; #&#x5BF9;&#x5E94;&#x6839;&#x76EE;&#x5F55; MaxConnPerIP 5 &#xFF03;&#x6700;&#x5927;&#x5E76;&#x53D1;&#x6570;&#x4E3A;5 NoIPLimit image/* &#xFF03;&#x5BF9;&#x56FE;&#x7247;&#x4E0D;&#x505A;&#x9650;&#x5236;&lt;/location&gt;&lt;location /test&gt; &#xFF03;&#x5BF9;&#x6839;&#x76EE;&#x5F55;&#x4E0B;&#x7684;test&#x76EE;&#x5F55;&#x505A;&#x9650;&#x5236; MaxConnPerIP 2 &#xFF03;&#x6700;&#x5927;&#x5E76;&#x53D1;&#x6570;&#x4E3A;2&lt;/location&gt;&lt;/ifModule&gt; &#x5982;&#x679C;&#x60F3;&#x9650;&#x5236;&#x865A;&#x62DF;&#x4E3B;&#x673A;&#x7684;ip&#x5E76;&#x53D1;&#x8FDE;&#x63A5;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;extra/httpd-vhost.conf&#x628A; IfModule mod_limitipconn.c &#x8FD9;&#x4E00;&#x6BB5;&#x590D;&#x5236;&#x5230;Virtualhost&#x4E2D;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002; &#x6D4B;&#x8BD5;&#xFF1A;&#x6D4B;&#x8BD5;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x628A;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;&#x8C03;&#x5C0F;&#x4E00;&#x70B9;&#xFF0C;&#x968F;&#x4FBF;&#x4E00;&#x4E2A;&#x6D4F;&#x89C8;&#x5668;&#x8BBF;&#x95EE;&#x9875;&#x9762;&#xFF0C;&#x7136;&#x540E;&#x6309;&#x7740;F5&#xFF0C;&#x8BA9;&#x9875;&#x9762;&#x4E0D;&#x65AD;&#x5237;&#x65B0;&#xFF0C;&#x4E00;&#x4E0B;&#x5C31;&#x53EF;&#x4EE5;&#x5F39;&#x51FA;503&#x9519;&#x8BEF; &#x4F7F;&#x7528;mod_bandwidth&#x6A21;&#x5757;&#x9650;&#x5236;&#x5E26;&#x5BBD;mod_bandwidth&#x53EF;&#x4EE5;&#x5BF9;IP&#x7684;&#x5E76;&#x53D1;&#x6570;&#x8FDB;&#x884C;&#x63A7;&#x5236;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5BF9;&#x4E0B;&#x8F7D;&#x6D41;&#x91CF;&#x8FDB;&#x884C;&#x63A7;&#x5236;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5BF9;&#x67D0;&#x4E2A;&#x76EE;&#x5F55;&#x7684;&#x6D41;&#x91CF;&#x8FDB;&#x884C;&#x63A7;&#x5236;&#x3002;&#x5B89;&#x88C5;&#xFF1A; 1234wget http://bwmod.sourceforge.net/files/mod_bw-0.7.tgztar zxvf mod_bw-0.7.tgzcd mod_bw/usr/local/apache2/bin/apxs -c -i mod_bw.c &#x7F16;&#x8F91;httpd.conf&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF1A; 123456789101112LoadModule bw_module modules/mod_bw.so &lt;virtualHost *:80&gt; ServerName vhost1.cszhi.com DocumentRoot /var/www/vhost1 BandwidthModule On ForceBandWidthModule On Bandwidth all 1024000 MinBandwidth all 50000 &#xFF03;&#x6BCF;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x6700;&#x9AD8;&#x901F;&#x5EA6;&#x53EF;&#x8FBE;50KB LargeFileLimit * 500 50000 MaxConnection all 6&lt;/virtualHost&gt; &#x5176;&#x5B83;&#x53C2;&#x6570;&#x4E8B;&#x4F8B;&#x8BF4;&#x660E;&#xFF0C;&#x8BE6;&#x7EC6;&#x7684;&#x89C1;&#x6E90;&#x7801;&#x5305;&#x91CC;&#x7684;mod_bw.txt&#xFF1A; 1234567891011BandWidth localhost 0 #&#x5BF9;localhost&#x4E0D;&#x9650;&#x901F;BandWidth 192.168.1.5 102400 #&#x5BF9;192.168.1.5&#x9650;&#x901F;&#x4E3A;100KBBandWidth &#x201C;u:^Mozilla(.*)&#x201D; 10240 #&#x7528;mozilla&#x65F6;&#x9650;&#x901F;10KBBandWidth &#x201C;u:wget&#x201D; 102400 &#xFF03;&#x5982;&#x679C;&#x7528;wget&#x4E0B;&#x8F7D;&#x65F6;&#x9650;&#x901F;10KBMinBandWidth all -1 &#xFF03;&#x4FDD;&#x8BC1;&#x6BCF;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x6700;&#x9AD8;&#x901F;&#x5EA6;&#x53EF;&#x8FBE;10KBLargeFileLimit .jpg 100 10240 &#xFF03;jpg&#x6587;&#x4EF6;&#x8D85;&#x8FC7;100KB&#xFF0C;&#x9650;&#x901F;10KB&#xFF03;&#x4E0B;&#x9762;&#x7684;510&#x633A;&#x597D;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x8BBE;&#x7F6E;&#xFF0C;apache&#x81EA;&#x5DF1;&#x4F1A;&#x62A5;&#x9519;&#xFF0C;&#x5C31;&#x6839;&#x62A5;404&#x5DEE;&#x4E0D;&#x591A;&#xFF0C;&#x9875;&#x9762;&#x975E;&#x5E38;&#x7684;&#x4E11;ErrorDocument 510 /exceed_speed.htmlBandWidthError 510MaxConnection all 10 #&#x6240;&#x6709;ip&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;&#x4E3A;10MaxConnection 192.168.1.5 5 &#xFF03;192.168.1.5&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;&#x4E3A;5 &#x6D4B;&#x8BD5;&#xFF1A;&#x4F7F;&#x7528;mod_bw.so&#x6A21;&#x5757;&#x524D;&#xFF1A;&#x4F7F;&#x7528;mod_bw.so&#x6A21;&#x5757;&#x540E;&#xFF1A; &#x5B89;&#x88C5;&#x8FC7;&#x7A0B;&#x4E2D;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x7684;&#x95EE;&#x9898;&#xFF1A; 1&#x3001;&#x6DFB;&#x52A0;&#x5B8C;mod_bw.so&#x6A21;&#x5757;&#xFF0C;&#x91CD;&#x542F;apache&#x65F6;&#x51FA;&#x73B0;&#x9519;&#x8BEF;&#xFF1A; 1234[root@vps httpd]# /etc/init.d/httpd restartStopping httpd: [FAILED]Starting httpd: httpd: Syntax error on line 203 of /etc/httpd/conf/httpd.conf: Cannot load /etc/httpd/modules/mod_bw.so into server: /etc/httpd/modules/mod_bw.so: undefined symbol: apr_atomic_cas [FAILED] &#x4FEE;&#x6539;&#x4E00;&#x4E0B;mod_bw.c &#x5C31;&#x53EF;&#x4EE5;&#xFF1A; 123456789#ifdef APR_MAJOR_VERSION //&#x6DFB;&#x52A0;&#x8FD9;&#x884C;#if (APR_MAJOR_VERSION &lt; 1) #define apr_atomic_inc32 apr_atomic_inc #define apr_atomic_dec32 apr_atomic_dec #define apr_atomic_add32 apr_atomic_add #define apr_atomic_cas32 apr_atomic_cas #define apr_atomic_set32 apr_atomic_set#endif#endif //&#x6DFB;&#x52A0;&#x8FD9;&#x884C; &#x91CD;&#x65B0;&#x7F16;&#x8BD1;&#xFF1A; 1/usr/local/apache2/bin/apxs -c -i mod_bw.c 2&#x3001;&#x5982;&#x679C;&#x670D;&#x52A1;&#x5668;&#x6CA1;&#x6709;&#x5B89;&#x88C5;apxs&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x7167;&#x4EE5;&#x4E0B;&#x65B9;&#x6CD5;&#x5B89;&#x88C5;&#xFF1A;apxs&#x662F;&#x4E00;&#x4E2A;&#x4E3A;Apache HTTP&#x670D;&#x52A1;&#x5668;&#x7F16;&#x8BD1;&#x548C;&#x5B89;&#x88C5;&#x6269;&#x5C55;&#x6A21;&#x5757;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x7528;&#x4E8E;&#x7F16;&#x8BD1;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x6E90;&#x7A0B;&#x5E8F;&#x6216;&#x76EE;&#x6807;&#x4EE3;&#x7801;&#x6587;&#x4EF6;&#x4E3A;&#x52A8;&#x6001;&#x5171;&#x4EAB;&#x5BF9;&#x8C61;&#xFF0C;&#x4F7F;&#x4E4B;&#x53EF;&#x4EE5;&#x7528;&#x7531;mod_so&#x63D0;&#x4F9B;&#x7684;LoadModule&#x6307;&#x4EE4;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x52A0;&#x8F7D;&#x5230;Apache&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x3002; &#x8F93;&#x5165;&#x547D;&#x4EE4;&#x67E5;&#x770B;&#x662F;&#x5426;&#x6709;httpd-devel&#x8FD9;&#x4E2A;&#x5305;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x9700;&#x8981;&#x5B89;&#x88C5; 12rpm -qa|grep httpdyum -y install httpd-devel]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>apache</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[awk列求和]]></title>
    <url>%2F2012%2F01%2F30%2Fawk%E5%88%97%E6%B1%82%E5%92%8C%2F</url>
    <content type="text"><![CDATA[&#x7528;awk&#x547D;&#x4EE4;&#x8BA1;&#x7B97;&#x6587;&#x4EF6;&#x4E2D;&#x67D0;&#x4E00;&#x5217;&#x7684;&#x603B;&#x548C;&#xFF1A; awk &#x2018;BEGIN{sum=0}{sum+=$1}END{print sum}&#x2019; data.txt &#x4F8B;&#xFF1A;&#x6709;a&#x3001;b&#x3001;c&#x4E09;&#x884C;&#x4E09;&#x5217;&#xFF0C;&#x8BA1;&#x7B97;&#x51FA;&#x7B2C;&#x4E8C;&#x5217;&#x548C;&#x7B2C;&#x4E09;&#x5217;&#x7684;&#x603B;&#x548C;&#xFF0C;&#x5E76;&#x5728;&#x7B2C;&#x56DB;&#x884C;&#x8F93;&#x51FA; 1234[root@test ~]# cat data.txt a 1 10 b 26 379 c 2 1605 &#x8BA1;&#x7B97;&#xFF1A; 12345[root@test ~]# awk &apos;{printf &quot;%10s%5s%8s\n&quot;,$1,$2,$3;x+=$2;y+=$3}END{printf &quot;%10s%5s%8s\n&quot;,&quot;Total:&quot;,x,y}&apos; data.txt a 1 10 b 26 379 c 2 1605 Total: 29 1994]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>shell</tag>
        <tag>awk</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[dd指令的使用]]></title>
    <url>%2F2012%2F01%2F29%2Fdd%E6%8C%87%E4%BB%A4%E7%9A%84%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[dd &#x662F; Linux/UNIX &#x4E0B;&#x7684;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x6709;&#x7528;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x4F5C;&#x7528;&#x662F;&#x7528;&#x6307;&#x5B9A;&#x5927;&#x5C0F;&#x7684;&#x5757;&#x62F7;&#x8D1D;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x5728;&#x62F7;&#x8D1D;&#x7684;&#x540C;&#x65F6;&#x8FDB;&#x884C;&#x6307;&#x5B9A;&#x7684;&#x8F6C;&#x6362;&#x3002; &#x6570;&#x636E;&#x5907;&#x4EFD;&#x4E0E;&#x6062;&#x590D;&#x6574;&#x76D8;&#x6570;&#x636E;&#x5907;&#x4EFD;&#x4E0E;&#x6062;&#x590D;&#xFF08;1&#xFF09;&#x5907;&#x4EFD; ##&#x5C06;&#x672C;&#x5730;&#x7684;/dev/hdx&#x6574;&#x76D8;&#x5907;&#x4EFD;&#x5230;/dev/hdy 1dd if=/dev/hdx of=/dev/hdy ##&#x5C06;/dev/hdx&#x5168;&#x76D8;&#x6570;&#x636E;&#x5907;&#x4EFD;&#x5230;&#x6307;&#x5B9A;&#x8DEF;&#x5F84;&#x7684;image&#x6587;&#x4EF6; 1dd if=/dev/hdx of=/path/to/image ##&#x5907;&#x4EFD;/dev/hdx&#x5168;&#x76D8;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x5229;&#x7528;gzip&#x5DE5;&#x5177;&#x8FDB;&#x884C;&#x538B;&#x7F29;&#xFF0C;&#x4FDD;&#x5B58;&#x5230;&#x6307;&#x5B9A;&#x8DEF;&#x5F84;&#xFF08;bzip2&#x5DE5;&#x5177;&#x4E5F;&#x4E00;&#x6837;&#x53EF;&#x4F7F;&#x7528;&#xFF09; 1dd if=/dev/hdx | gzip &gt; /path/to/image.gz &#xFF08;2&#xFF09;&#x6062;&#x590D; ##&#x5C06;&#x5907;&#x4EFD;&#x6587;&#x4EF6;&#x6062;&#x590D;&#x5230;&#x6307;&#x5B9A;&#x76D8; 1dd if=/path/to/image of=/dev/hdx ##&#x5C06;&#x538B;&#x7F29;&#x7684;&#x5907;&#x4EFD;&#x6587;&#x4EF6;&#x6062;&#x590D;&#x5230;&#x6307;&#x5B9A;&#x76D8; 1gzip -dc /path/to/image.gz | dd of=/dev/hdx &#x5229;&#x7528;netcat&#x4E0E;dd&#x6307;&#x4EE4;&#x8FDB;&#x884C;&#x8FDC;&#x7A0B;&#x5907;&#x4EFD;&#xFF08;1&#xFF09;&#x5907;&#x4EFD; &#x5047;&#x8BBE;&#xFF1A;&#x63A5;&#x6536;&#x7AEF;&#x7684;IP&#x5730;&#x5740;&#x4E3A;&#xFF1A;192.168.1.200&#xFF1B;&#x53D1;&#x9001;&#x7AEF;&#x7684;IP&#x5730;&#x5740;&#x4E3A;&#xFF1A;192.168.1.100 &#x7B2C;&#x4E00;&#x6B65;&#xFF1A;&#x5728;&#x63A5;&#x6536;&#x7AEF;&#x4E0A;&#x6267;&#x884C;&#x547D;&#x4EE4;&#xFF1A; 1nc -l 1234 | dd of=/dev/sdb1 &#x6216;&#x8005; nc -l 1234 | gzip -dc | dd of=/dev/sdb1 &#xFF0C;&#x5373;&#xFF1A;nc&#x6307;&#x4EE4;&#x7684;&#x8F93;&#x51FA;&#x4E3A;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#xFF0C;&#x901A;&#x8FC7;&#x7BA1;&#x9053;&#x5C06;nc&#x6307;&#x4EE4;&#x7684;&#x8F93;&#x51FA;&#x4F5C;&#x4E3A;dd&#x6307;&#x4EE4;&#x7684;&#x8F93;&#x5165;&#xFF0C;&#x6700;&#x540E;&#x5C06;&#x6570;&#x636E;&#x5199;&#x5165;/dev/sdb1&#x4E2D; &#xFF08;2&#xFF09;&#x6062;&#x590D; &#x7B2C;&#x4E8C;&#x6B65;&#xFF1A;&#x5728;&#x53D1;&#x9001;&#x7AEF;&#x4E0A;&#x6267;&#x884C;&#x547D;&#x4EE4;&#xFF1A; 1dd if=/dev/hda1 | nc 192.168.1.200 1234 &#x6216;&#x8005; dd if=/dev/hda1 | gzip | nc 192.168.1.200 1234 &#x5373;&#xFF1A;&#x5C06;/dev/hda1&#x8BBE;&#x5907;&#x4E0A;&#x7684;&#x6570;&#x636E;&#x4F5C;&#x4E3A;dd&#x7684;&#x8F93;&#x5165;&#xFF0C;&#x800C;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x4F5C;&#x4E3A;dd&#x6307;&#x4EE4;&#x7684;&#x8F93;&#x51FA;&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x7BA1;&#x9053;&#xFF0C;&#x6240;&#x4EE5;&#x5C06;dd&#x7684;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x5C06;&#x4F5C;&#x4E3A;nc&#x6307;&#x4EE4;&#x7684;&#x8F93;&#x51FA; &#x5907;&#x4EFD;MBR&#xFF08;1&#xFF09;&#x5907;&#x4EFD; ##&#x5907;&#x4EFD;&#x78C1;&#x76D8;&#x5F00;&#x59CB;&#x7684;512Byte&#x5927;&#x5C0F;&#x7684;MBR&#x4FE1;&#x606F;&#x5230;&#x6307;&#x5B9A;&#x6587;&#x4EF6; 1dd if=/dev/hdx of=/path/to/image count=1 bs=512 &#xFF08;2&#xFF09;&#x6062;&#x590D; ##&#x5C06;&#x5907;&#x4EFD;&#x7684;MBR&#x4FE1;&#x606F;&#x5199;&#x5230;&#x78C1;&#x76D8;&#x5F00;&#x59CB;&#x90E8;&#x5206; 1dd if=/path/to/image of=/dev/hdx &#x5907;&#x4EFD;&#x8F6F;&#x76D8;##&#x5C06;&#x8F6F;&#x9A71;&#x6570;&#x636E;&#x5907;&#x4EFD;&#x5230;&#x5F53;&#x524D;&#x76EE;&#x5F55;&#x7684;disk.img&#x6587;&#x4EF6; 1dd if=/dev/fd0 of=disk.img count=1 bs=1440k &#x62F7;&#x8D1D;&#x5185;&#x5B58;&#x6570;&#x636E;&#x5230;&#x786C;&#x76D8;##&#x5C06;&#x5185;&#x5B58;&#x91CC;&#x7684;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#x5230;backup&#x76EE;&#x5F55;&#x4E0B;&#x7684;mem.bin&#x6587;&#x4EF6; 1dd if=/dev/mem of=/backup/mem.bin bs=1024 &#x5C06;&#x5149;&#x76D8;&#x5236;&#x4F5C;&#x6210;ISO&#x955C;&#x50CF;&#x6587;&#x4EF6;##&#x62F7;&#x8D1D;&#x5149;&#x76D8;&#x6570;&#x636E;&#x5230;backup&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#xFF0C;&#x5E76;&#x4FDD;&#x5B58;&#x4E3A;cd.iso&#x6587;&#x4EF6;&#xFF0C;&#x518D;&#x8FDB;&#x884C;&#x523B;&#x5F55; 12dd if=/dev/cdrom of=/backup/cd.isocdrecord -v cd.iso &#x589E;&#x52A0;swap&#x5206;&#x533A;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x7B2C;&#x4E00;&#x6B65;&#xFF1A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x8DB3;&#x591F;&#x5927;&#x7684;&#x6587;&#x4EF6;&#xFF08;250M&#xFF09; 1dd if=/dev/zero of=/swapfile bs=1024 count=262144 &#x7B2C;&#x4E8C;&#x6B65;&#xFF1A;&#x628A;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x53D8;&#x6210;swap&#x6587;&#x4EF6; 1mkswap /swapfile &#x7B2C;&#x4E09;&#x6B65;&#xFF1A;&#x542F;&#x7528;&#x8FD9;&#x4E2A;swap&#x6587;&#x4EF6; 1swapon /swapfile &#x7B2C;&#x56DB;&#x6B65;&#xFF1A;&#x5728;&#x6BCF;&#x6B21;&#x5F00;&#x673A;&#x7684;&#x65F6;&#x5019;&#x81EA;&#x52A8;&#x52A0;&#x8F7D;swap&#x6587;&#x4EF6;, &#x9700;&#x8981;&#x5728; /etc/fstab &#x6587;&#x4EF6;&#x4E2D;&#x589E;&#x52A0;&#x4E00;&#x884C; 1/swapfile swap swap defaults 0 0 &#x6CE8;&#x610F;&#xFF1A;&#x67E5;&#x770B;&#x5F53;&#x524D;swap&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#xFF0C;&#x8BF7;&#x67E5;&#x770B;&#x6587;&#x4EF6;/proc/swaps&#xFF1B;&#x521B;&#x5EFA;&#x4EA4;&#x6362;&#x5206;&#x533A;&#x5176;&#x5B9E;&#x8FD8;&#x6709;&#x53E6;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#xFF1A;fdisk&#x6307;&#x4EE4;&#x6CD5; &#x9500;&#x6BC1;&#x78C1;&#x76D8;&#x6570;&#x636E;##&#x5229;&#x7528;&#x968F;&#x673A;&#x7684;&#x6570;&#x636E;&#x586B;&#x5145;&#x786C;&#x76D8;&#xFF0C;&#x5728;&#x67D0;&#x4E9B;&#x5FC5;&#x8981;&#x7684;&#x573A;&#x5408;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x9500;&#x6BC1;&#x6570;&#x636E;&#x3002;&#x6267;&#x884C;&#x6B64;&#x64CD;&#x4F5C;&#x4EE5;&#x540E;&#xFF0C;/dev/hda1&#x5C06;&#x65E0;&#x6CD5;&#x6302;&#x8F7D;&#xFF0C;&#x521B;&#x5EFA;&#x548C;&#x62F7;&#x8D1D;&#x64CD;&#x4F5C;&#x65E0;&#x6CD5;&#x6267;&#x884C; 1dd if=/dev/urandom of=/dev/hda1]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL将显示结果输出到文件]]></title>
    <url>%2F2012%2F01%2F29%2FMySQL%E5%B0%86%E6%98%BE%E7%A4%BA%E7%BB%93%E6%9E%9C%E8%BE%93%E5%87%BA%E5%88%B0%E6%96%87%E4%BB%B6%2F</url>
    <content type="text"><![CDATA[1&#x3001;&#x5982;&#x679C;MYSQL&#x670D;&#x52A1;&#x5668;&#x5C31;&#x662F;&#x4F60;&#x8981;&#x5BFC;&#x51FA;&#x6587;&#x4EF6;&#x7684;&#x673A;&#x5668;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x7528;select &#x2026;into outfile&#x8BED;&#x53E5;&#x3002; 1select * from rank into outfile &quot;/home/a.txt&quot; 2&#x3001;&#x5982;&#x679C;MYSQL&#x670D;&#x52A1;&#x5668;&#x662F;&#x5355;&#x72EC;&#x7684;&#x673A;&#x5668;&#xFF0C;&#x6211;&#x4EEC;&#x662F;&#x5728;&#x4E00;&#x4E2A;client&#x4E0A;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x628A;&#x6570;&#x636E;&#x7ED3;&#x679C;&#x5BFC;&#x5165;&#x5230;client&#x673A;&#x5668;&#x4E0A;&#x3002;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;mysql -e&#x8BED;&#x53E5;&#x3002; 1mysql -uroot -proot -P3306 -h10.35.13.89 dbname -e &quot;select * from rank&quot; &gt; /home/a.txt 3&#x3001;&#x4F7F;&#x7528;mysql&#x7684;tee&#xFF08;T&#xFF09;&#x547D;&#x4EE4;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x628A;MYSQL&#x7684;&#x6240;&#x6709;&#x8F93;&#x51FA;&#x90FD;&#x8F93;&#x5165;&#x5230;&#x6307;&#x5B9A;&#x6587;&#x4EF6;&#x3002; 12345678mysql&gt;tee /home/a.txtmysql&gt;select * from rank;mysql&gt;exit&#x6216;mysql&gt; \T output.txtLogging to file &apos;output.txt&apos;mysql&gt; \tOutfile disabled.]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[使用Telnet测试邮箱]]></title>
    <url>%2F2012%2F01%2F20%2F%E4%BD%BF%E7%94%A8Telnet%E6%B5%8B%E8%AF%95%E9%82%AE%E7%AE%B1%2F</url>
    <content type="text"><![CDATA[&#x7ECF;&#x5E38;&#x8981;&#x6D4B;&#x8BD5;&#x90AE;&#x4EF6;&#x670D;&#x52A1;&#x5668;&#x6536;&#x53D1;&#x90AE;&#x4EF6;&#x662F;&#x5426;&#x6B63;&#x5E38;&#xFF0C;&#x867D;&#x7136;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x90AE;&#x4EF6;&#x5BA2;&#x6237;&#x7AEF;&#x6216;&#x767B;&#x9646;web&#x6D4B;&#x8BD5;&#xFF0C;&#x4F46;&#x4F7F;&#x7528;telnet&#x8FD9;&#x4E2A;&#x5C0F;&#x7A0B;&#x5E8F;&#x4E5F;&#x633A;&#x65B9;&#x4FBF;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x7EAF;&#x7EC8;&#x7AEF;&#x7684;linux&#x754C;&#x9762;&#x4E0B;&#x4E5F;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#x3002; &#x6D4B;&#x8BD5;&#x90AE;&#x7BB1;&#x53D1;&#x4EF6;&#xFF1A;telnet ip 25 1234567891011121314151617181920[root@localhost ~]# telnet mx3.qq.com 25Trying 113.108.64.241...Connected to mx3.qq.com.Escape character is &apos;^]&apos;.220 newmx70.qq.com MX QQ Mail Serverhelo test250 newmx70.qq.commail from:xxx@gmail.com #&#x53D1;&#x4EF6;&#x4EBA;&#x5730;&#x5740;250 Okrcpt to:yyy@qq.com #&#x6536;&#x4EF6;&#x4EBA;&#x5730;&#x5740;250 Okdata #&#x6570;&#x636E;&#x521D;&#x59CB;&#x5316;354 End data with .from:caishzh@gmail.com #&#x90AE;&#x4EF6;&#x5934;&#x53D1;&#x4EF6;&#x4EBA;&#x5730;&#x5740;to:caishzh@qq.com #&#x90AE;&#x4EF6;&#x5934;&#x6536;&#x4EF6;&#x4EBA;subject:test #&#x90AE;&#x4EF6;&#x4E3B;&#x9898;test #&#x90AE;&#x4EF6;&#x5185;&#x5BB9;. #&#x4EE5;&quot;.&quot;&#x4E3A;&#x7ED3;&#x675F;&#x7B26;&#xFF0C;&#x4F20;&#x8F93;&#x5B8C;&#x6BD5;250 Ok: queued asquit #&#x9000;&#x51FA; &#x6D4B;&#x8BD5;&#x90AE;&#x7BB1;&#x6536;&#x4EF6;&#xFF08;pop&#xFF09;&#xFF1A;telnet ip 110 1234567891011[root@localhost ~]# telnet pop.qq.com 110Trying 113.108.20.27...Connected to pop.qq.com.Escape character is &apos;^]&apos;.+OK QQMail POP3 Server v1.0 Service Ready(QQMail v2.0)user xxx@qq.com #&#x90AE;&#x7BB1;&#x5E10;&#x53F7;+OKpass yyy #&#x90AE;&#x7BB1;&#x5BC6;&#x7801;+OKlist #&#x5217;&#x51FA;&#x6240;&#x6709;&#x90AE;&#x4EF6;retr 1 #&#x67E5;&#x770B;&#x7F16;&#x53F7;&#x4E3A;1&#x7684;&#x90AE;&#x4EF6; &#x6D4B;&#x8BD5;&#x90AE;&#x7BB1;&#x6536;&#x4EF6;&#xFF08;imap&#xFF09;&#xFF1A;telnet ip 143 123456789101112[root@localhost ~]# telnet imap.qq.com 143Trying 183.60.55.113...Connected to imap.qq.com.Escape character is &apos;^]&apos;.A01 LOGIN xxx@qq.com yyy #&#x90AE;&#x7BB1;&#x767B;&#x9646;A02 LIST &quot;&quot; * #&#x5217;&#x51FA;&#x6240;&#x6709;&#x4FE1;&#x7BB1;&#x5217;&#x8868;A03 Select &quot;INBOX&quot; #&#x9009;&#x62E9;inbox&#x4FE1;&#x7BB1;A04 Search ALL #&#x67E5;&#x8BE2;&#x6536;&#x4EF6;&#x7BB1;&#x6240;&#x6709;&#x90AE;&#x4EF6;A05 Fetch 1 full #&#x83B7;&#x53D6;&#x7B2C;1&#x5C01;&#x90AE;&#x4EF6;&#x7684;&#x90AE;&#x4EF6;&#x5934;A06 Fetch 1 rfc822 #&#x83B7;&#x53D6;&#x7B2C;1&#x5C01;&#x90AE;&#x4EF6;&#x7684;&#x5B8C;&#x6574;&#x5185;&#x5BB9;A07 logout #&#x9000;&#x51FA;]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>ops</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[分区变为只读的处理]]></title>
    <url>%2F2012%2F01%2F09%2F%E5%88%86%E5%8C%BA%E5%8F%98%E4%B8%BA%E5%8F%AA%E8%AF%BB%E7%9A%84%E5%A4%84%E7%90%86%2F</url>
    <content type="text"><![CDATA[&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x90AE;&#x4EF6;&#x7CFB;&#x7EDF;&#x5BA2;&#x6237;&#x670D;&#x52A1;&#x5668;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x62BD;&#x70B9;&#x65F6;&#x95F4;&#x8BB0;&#x5F55;&#x4E00;&#x4E0B;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#xFF0C;&#x8981;&#x4E0D;&#x65F6;&#x95F4;&#x4E45;&#x4E86;&#x53C8;&#x8981;&#x5FD8;&#x4E86;&#x3002;&#x8BDD;&#x8BF4;&#x65F6;&#x95F4;&#x6324;&#x6324;&#x603B;&#x4F1A;&#x6709;&#x7684;^_^ &#x95EE;&#x9898;&#xFF1A;&#x767B;&#x9646;web&#x63D0;&#x793A;&#x7CFB;&#x7EDF;&#x9519;&#x8BEF;&#x3002;&#x65E0;&#x6CD5;&#x53D1;&#x9001;&#x90AE;&#x4EF6;&#xFF0C;&#x63D0;&#x793A;&#x90AE;&#x4EF6;&#x53D1;&#x9001;&#x5931;&#x8D25; &#x5206;&#x6790;&#xFF1A;&#x5411;&#x5BA2;&#x6237;&#x8981;&#x6765;&#x670D;&#x52A1;&#x5668;ip&#x53CA;root&#x5BC6;&#x7801;&#xFF0C;&#x767B;&#x9646;&#x67E5;&#x770B;&#x3002; 1&#x3001;&#x67E5;&#x770B;webmail&#x65E5;&#x5FD7;&#xFF0C;&#x9519;&#x8BEF;&#x5173;&#x952E;&#x5B57;&#xFF1A;&#x5B58;&#x50A8;&#x90AE;&#x4EF6;&#x5F02;&#x5E38;&#xFF0C;&#x53EA;&#x8BFB;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x3002;&#x5982;&#x4E0B;&#xFF1A; 2&#x3001;&#x6D4B;&#x8BD5;&#x5728;&#x5728;mail&#x5206;&#x533A;&#x4E0B;&#x521B;&#x5EFA;&#x6587;&#x4EF6;&#xFF0C;&#x65E0;&#x6CD5;&#x6210;&#x529F;&#x521B;&#x5EFA;&#xFF0C;&#x63D0;&#x793A;&#x53EA;&#x8BFB;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF1A; 12[root@localhost mail]# touch abctouch: &#x65E0;&#x6CD5;&#x89E6;&#x78B0; &#x201C;abc&#x201D;: &#x53EA;&#x8BFB;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF; 3&#x3001;&#x67E5;&#x770B;&#x7CFB;&#x7EDF;&#x65E5;&#x5FD7;&#x4FE1;&#x606F;/var/log/messages&#xFF1A; 1234567891011[root@localhost ~]# tail -100 /var/log/messages | grep kernelJan 6 11:15:35 localhost kernel: EXT3-fs error (device sda2): htree_dirblock_to_tree: bad entry in directory #40534515: rec_len is smaller than minimal - offset=0, inode=0, rec_len=0, name_len=0Jan 6 11:29:17 localhost kernel: ext3_abort called.Jan 6 11:29:17 localhost kernel: EXT3-fs error (device sda2): ext3_put_super: Couldn&apos;t clean up the journalJan 6 11:30:20 localhost kernel: kjournald starting. Commit interval 5 secondsJan 6 11:30:20 localhost kernel: EXT3 FS on sda2, internal journalJan 6 11:30:20 localhost kernel: EXT3-fs: mounted filesystem with ordered data mode.Jan 6 11:31:02 localhost kernel: clamd[27699]: segfault at 0000000000000060 rip 00002ae03828c71b rsp 00007fff8f5ca6f0 error 4Jan 6 13:29:45 localhost kernel: EXT3-fs error (device sda2): htree_dirblock_to_tree: bad entry in directory #40534515: rec_len is smaller than minimal - offset=0, inode=0, rec_len=0, name_len=0Jan 6 13:29:45 localhost kernel: Aborting journal on device sda2.Jan 6 13:29:46 localhost kernel: ext3_abort called.Jan 6 13:29:46 localhost kernel: EXT3-fs error (device sda2): ext3_journal_start_sb: Detected aborted journalJan 6 13:29:46 localhost kernel: Remounting filesystem read-only &#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x8FD9;&#x662F;&#x7531;&#x4E8E;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x9519;&#x8BEF;&#xFF0C;&#x5185;&#x6838;&#x5C06;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x91CD;&#x65B0;&#x6302;&#x8F7D;&#x4E3A;&#x53EA;&#x8BFB;&#x6A21;&#x5F0F; &#x5904;&#x7406;&#xFF1A;&#x4FEE;&#x590D;mail&#x5206;&#x533A;1&#x3001;&#x5148;&#x5378;&#x4E0B;mail&#x5206;&#x533A; 123[root@localhost tmp]# umount /mail/umount: /mail: device is busyumount: /mail: device is busy &#x65E0;&#x6CD5;&#x5378;&#x4E0B;&#xFF0C;&#x6709;&#x7A0B;&#x5E8F;&#x5728;&#x8BBF;&#x95EE;mail&#x5206;&#x533A; 2&#x3001;&#x67E5;&#x770B;&#x662F;&#x4EC0;&#x4E48;&#x7A0B;&#x5E8F;&#x5728;&#x8BBF;&#x95EE;mail&#x5206;&#x533A; 12345[root@localhost tmp]# fuser -m -v /dev/sda2 USER PID ACCESS COMMAND/dev/sda2: root 26947 ..c.. bash root 27215 ..c.. tail root 27216 ..c.. grep 3&#x3001;&#x5C06;&#x8BBF;&#x95EE;mail&#x5206;&#x533A;&#x7684;&#x7A0B;&#x5E8F;kill&#x6389; 12[root@localhost tmp]# fuser -m -k /dev/sda2/dev/sda2: 26947c 4&#x3001;&#x91CD;&#x65B0;&#x5378;&#x4E0B;mail&#x5206;&#x533A; 123456[root@localhost tmp]# umount /mail/[root@localhost ~]# df&#x6587;&#x4EF6;&#x7CFB;&#x7EDF; 1K-&#x5757; &#x5DF2;&#x7528; &#x53EF;&#x7528; &#x5DF2;&#x7528;% &#x6302;&#x8F7D;&#x70B9;/dev/sda3 29753588 8215320 20002456 30% //dev/sda1 7936256 155460 7371144 3% /boottmpfs 2017004 0 2017004 0% /dev/shm &#x8FD9;&#x6B21;&#x6CA1;&#x6709;&#x63D0;&#x793A;&#x9519;&#x8BEF;&#x4E86;&#xFF0C;&#x4F7F;&#x7528;df&#x67E5;&#x770B;mail&#x5206;&#x533A;&#x5DF2;&#x88AB;&#x5378;&#x4E0B; 5&#x3001;&#x4FEE;&#x590D;&#x5206;&#x533A; 12[root@localhost ~]# screen -S fsck &#x5728;sceen&#x4E0B;&#x4FEE;&#x590D;[root@localhost ~]# fsck -Cy /dev/sad2 &#x4FEE;&#x590D;&#x5206;&#x533A; &#x4FEE;&#x590D;&#x5B8C;&#x6210;&#x540E;&#x518D;&#x6D4B;&#x8BD5;&#x5728;mail&#x5206;&#x533A;&#x4E0B;&#x521B;&#x5EFA;&#x6587;&#x4EF6; 1[root@localhost mail]# mkdir test &#x6CA1;&#x6709;&#x63D0;&#x793A;&#x9519;&#x8BEF;&#xFF0C;&#x6210;&#x529F;&#x521B;&#x5EFA;&#x5C06;&#x4E4B;&#x524D;&#x521B;&#x5EFA;&#x7684;&#x6587;&#x4EF6;&#x5939;&#x5220;&#x9664; 1[root@localhost mail]# rmdir test/ 6&#x3001;&#x91CD;&#x542F;&#x90AE;&#x4EF6;&#x7CFB;&#x7EDF;&#x548C;webmail&#x670D;&#x52A1; &#x6700;&#x540E;&#x4E00;&#x6B65;&#x67E5;&#x770B;webmail&#x65E5;&#x5FD7;&#xFF0C;&#x65E5;&#x5FD7;&#x663E;&#x793A;&#x6B63;&#x5E38;&#x3002;&#x767B;&#x9646;web&#x7AEF;&#x6D4B;&#x8BD5;&#x53D1;&#x9001;&#x90AE;&#x4EF6;&#xFF0C;&#x63D0;&#x793A;&#x53D1;&#x9001;&#x90AE;&#x4EF6;&#x6210;&#x529F;&#xFF0C;&#x95EE;&#x9898;&#x89E3;&#x51B3;&#x3002; &#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x6D89;&#x53CA;&#x5230;&#x51E0;&#x4E2A;&#x547D;&#x4EE4;&#xFF1A;mount&#xFF0C;fuser&#xFF0C;screen&#xFF0C;fsck&#x3002;&#x6709;&#x65F6;&#x95F4;&#x518D;&#x6574;&#x4E0B;&#x8FD9;&#x51E0;&#x4E2A;&#x547D;&#x4EE4;&#x7684;&#x7528;&#x6CD5;&#x3002; ========================================================= 2013-05-29&#x4ECA;&#x5929;&#x53C8;&#x78B0;&#x5230;&#x4E00;&#x4F8B;&#x53EA;&#x8BFB;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x3002;&#x6309;&#x7167;&#x4E0A;&#x9762;&#x7684;&#x6D41;&#x7A0B;&#x64CD;&#x4F5C;&#x4FEE;&#x590D;&#xFF0C;&#x4F46;&#x6267;&#x884C;&#x4FEE;&#x590D;&#x547D;&#x4EE4;&#xFF08;fsck -Cy /dev/sad2&#xFF09;&#x540E;&#xFF0C;&#x4E00;&#x77AC;&#x95F4;&#x5C31;&#x597D;&#x4E86;&#xFF0C;&#x63D0;&#x793A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x662F;clean&#x72B6;&#x6001;&#xFF1A; 1234[root@localhost ~]# fsck -y /dev/sda1e2fsck 1.39 (29-May-2006)/: recovering journal/: clean, 2226424/229310464 files, 155758033/229291720 blocks &#x91CD;&#x65B0;&#x6302;&#x8F7D;&#xFF0C;&#x6062;&#x590D;&#x8BFB;&#x5199;&#x3002;&#x4F46;&#x4E00;&#x4F1A;&#x540E;&#x53C8;&#x53EA;&#x8BFB;&#x3002;&#x5C1D;&#x8BD5;&#x4F7F;&#x7528;-f&#x53C2;&#x6570;&#x5F3A;&#x5236;&#x68C0;&#x67E5;&#x4FEE;&#x590D;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x68C0;&#x67E5;&#x51FA;&#x4E0D;&#x5C11;&#x9519;&#x8BEF;&#xFF0C;&#x5B8C;&#x540E;&#x6302;&#x8F7D;&#xFF0C;&#x6D4B;&#x8BD5;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#xFF0C;&#x6CA1;&#x6709;&#x518D;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x4F7F;&#x7528;-f&#x53C2;&#x6570;&#x5F3A;&#x5236;&#x68C0;&#x67E5;&#x524D;&#xFF0C;&#x6700;&#x597D;&#x5148;&#x5907;&#x4EFD;&#x4E0B;&#x6570;&#x636E;&#xFF0C;&#x9632;&#x6B62;&#x6570;&#x636E;&#x4E22;&#x5931;&#x3002; 12-f Force checking of file systems, even when they are marked clean (for file systems that support this).]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[使用iptables缓解DDOS及CC攻击]]></title>
    <url>%2F2011%2F10%2F10%2F%E4%BD%BF%E7%94%A8iptables%E7%BC%93%E8%A7%A3DDOS%E5%8F%8ACC%E6%94%BB%E5%87%BB%2F</url>
    <content type="text"><![CDATA[&#x7F13;&#x89E3;DDOS&#x653B;&#x51FB;&#x9632;&#x6B62;SYN&#x653B;&#x51FB;&#xFF0C;&#x8F7B;&#x91CF;&#x7EA7;&#x9884;&#x9632; 1iptables -N syn-floodiptables -A INPUT -p tcp &#x2013;syn -j syn-floodiptables -I syn-flood -p tcp -m limit &#x2013;limit 3/s &#x2013;limit-burst 6 -j RETURNiptables -A syn-flood -j REJECT 1iptables -A INPUT -i eth0 -p tcp &#x2013;syn -m connlimit &#x2013;connlimit-above 15 -j DROPiptables -A INPUT -p tcp -m state &#x2013;state ESTABLISHED,RELATED -j ACCEPT &#x7528;Iptables&#x7F13;&#x89E3;DDOS (&#x53C2;&#x6570;&#x4E0E;&#x4E0A;&#x76F8;&#x540C;) 1iptables -A INPUT -p tcp --syn -m limit --limit 12/s --limit-burst 24 -j ACCEPTiptables -A FORWARD -p tcp --syn -m limit --limit 1/s -j ACCEPT &#x7F13;&#x89E3;CC&#x653B;&#x51FB;&#x5F53;apache&#x7AD9;&#x70B9;&#x53D7;&#x5230;&#x4E25;&#x91CD;&#x7684;cc&#x653B;&#x51FB;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;iptables&#x6765;&#x9632;&#x6B62;web&#x670D;&#x52A1;&#x5668;&#x88AB;CC&#x653B;&#x51FB;&#xFF0C;&#x81EA;&#x52A8;&#x5C4F;&#x853D;&#x653B;&#x51FB;IP&#x3002; &#x793A;&#x4F8B;&#x5982;&#x4E0B;&#xFF1A; &#x63A7;&#x5236;&#x5355;&#x4E2A;IP&#x7684;&#x6700;&#x5927;&#x5E76;&#x53D1;&#x8FDE;&#x63A5;&#x6570; 1iptables -I INPUT -p tcp --dport 80 -m connlimit --connlimit-above 25 -j REJECT #&#x5141;&#x8BB8;&#x5355;&#x4E2A;IP&#x7684;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;&#x4E3A;25&#x4E2A; &#x65E9;&#x671F;iptables&#x6A21;&#x5757;&#x4E0D;&#x5305;&#x542B;connlimit,&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x5355;&#x72EC;&#x7F16;&#x8BD1;&#x52A0;&#x8F7D;&#xFF0C;&#x8BF7;&#x53C2;&#x8003;&#x8BE5;&#x5730;&#x5740;http://sookk8.blog.51cto.com/455855/280372 &#x4E0D;&#x7F16;&#x8BD1;&#x5185;&#x6838;&#x52A0;&#x8F7D;connlimit&#x6A21;&#x5757; &#x63A7;&#x5236;&#x5355;&#x4E2A;IP&#x5728;&#x4E00;&#x5B9A;&#x7684;&#x65F6;&#x95F4;&#xFF08;&#x6BD4;&#x5982;60&#x79D2;&#xFF09;&#x5185;&#x5141;&#x8BB8;&#x65B0;&#x5EFA;&#x7ACB;&#x7684;&#x8FDE;&#x63A5;&#x6570; 1iptables -A INPUT -p tcp --dport 80 -m recent --name BAD_HTTP_ACCESS --update --seconds 60 --hitcount 30 -j REJECTiptables -A INPUT -p tcp --dport 80 -m recent --name BAD_HTTP_ACCESS --set -j ACCEPT &#x5355;&#x4E2A;IP&#x5728;60&#x79D2;&#x5185;&#x53EA;&#x5141;&#x8BB8;&#x6700;&#x591A;&#x65B0;&#x5EFA;30&#x4E2A;&#x8FDE;&#x63A5; &#x5B9E;&#x65F6;&#x67E5;&#x770B;&#x6A21;&#x62DF;&#x653B;&#x51FB;&#x5BA2;&#x6237;&#x673A;&#x5EFA;&#x7ACB;&#x8D77;&#x6765;&#x7684;&#x8FDE;&#x63A5;&#x6570; 1watch &apos;netstat -an | grep:21 | grep &lt;&#x653B;&#x51FB;IP&gt;| wc -l &#x67E5;&#x770B;&#x6A21;&#x62DF;&#x653B;&#x51FB;&#x5BA2;&#x6237;&#x673A;&#x88AB; DROP &#x7684;&#x6570;&#x636E;&#x5305;&#x6570; 1watch &apos;iptables -L -n -v | grep &lt;&#x653B;&#x51FB;IP&gt;]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>ddos</tag>
        <tag>iptables</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[DDoS攻击原理及防护方法论]]></title>
    <url>%2F2009%2F03%2F11%2FDDoS%E6%94%BB%E5%87%BB%E5%8E%9F%E7%90%86%E5%8F%8A%E9%98%B2%E6%8A%A4%E6%96%B9%E6%B3%95%E8%AE%BA%2F</url>
    <content type="text"><![CDATA[&#x6765;&#x81EA;51cto&#xFF1A;http://netsecurity.51cto.com/art/200903/114969.htm &#x539F;&#x6587;&#x7AE0;&#x5DF2;&#x627E;&#x4E0D;&#x5230;&#xFF0C;&#x65B0;&#x5730;&#x5740;&#xFF1A; https://www.cnblogs.com/zlhff/p/5459070.html]]></content>
      <categories>
        <category>运维</category>
      </categories>
      <tags>
        <tag>ddos</tag>
      </tags>
  </entry>
</search>
