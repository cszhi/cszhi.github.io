<!DOCTYPE html>





<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=7.4.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=7.4.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.0" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css?v=7.4.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.4.0',
    exturl: false,
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":"mac"},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: true,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="&amp;#x57FA;&amp;#x4E8E;CentOS Linux release 7.7.1908 (Core) &amp;#x73AF;&amp;#x5883;&amp;#x4E0B;&amp;#x547D;&amp;#x4EE4;&amp;#x884C;&amp;#x65B9;&amp;#x5F0F;&amp;#x5B89;&amp;#x88C5;&amp;#x914D;&amp;#x7F6E;KVM&amp;#x3002; &amp;#x68C0;&amp;#x6D4B;&amp;#x670D;&amp;#x52A1;&amp;#x5668">
<meta name="keywords" content="kvm">
<meta property="og:type" content="article">
<meta property="og:title" content="KVM详解">
<meta property="og:url" content="http://blogs.cszhi.com/2019/10/12/KVM详解/index.html">
<meta property="og:site_name" content="csz&#39;s blog">
<meta property="og:description" content="&amp;#x57FA;&amp;#x4E8E;CentOS Linux release 7.7.1908 (Core) &amp;#x73AF;&amp;#x5883;&amp;#x4E0B;&amp;#x547D;&amp;#x4EE4;&amp;#x884C;&amp;#x65B9;&amp;#x5F0F;&amp;#x5B89;&amp;#x88C5;&amp;#x914D;&amp;#x7F6E;KVM&amp;#x3002; &amp;#x68C0;&amp;#x6D4B;&amp;#x670D;&amp;#x52A1;&amp;#x5668">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://blogs.cszhi.com/2019/10/12/KVM详解/1576552169311.png">
<meta property="og:updated_time" content="2019-12-17T03:26:08.684Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="KVM详解">
<meta name="twitter:description" content="&amp;#x57FA;&amp;#x4E8E;CentOS Linux release 7.7.1908 (Core) &amp;#x73AF;&amp;#x5883;&amp;#x4E0B;&amp;#x547D;&amp;#x4EE4;&amp;#x884C;&amp;#x65B9;&amp;#x5F0F;&amp;#x5B89;&amp;#x88C5;&amp;#x914D;&amp;#x7F6E;KVM&amp;#x3002; &amp;#x68C0;&amp;#x6D4B;&amp;#x670D;&amp;#x52A1;&amp;#x5668">
<meta name="twitter:image" content="http://blogs.cszhi.com/2019/10/12/KVM详解/1576552169311.png">
  <link rel="canonical" href="http://blogs.cszhi.com/2019/10/12/KVM详解/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>KVM详解 | csz's blog</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <div class="container">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">csz's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger">
        
          <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
      </li>
    
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="reading-progress-bar"></div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
      <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block post">
    <link itemprop="mainEntityOfPage" href="http://blogs.cszhi.com/2019/10/12/KVM详解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="csz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="csz's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">KVM详解

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-10-12 00:00:00" itemprop="dateCreated datePublished" datetime="2019-10-12T00:00:00+08:00">2019-10-12</time>
            </span>
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span>

                
                
              
            </span>
          

          
            <span class="post-meta-item" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span>39 分钟</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>&#x57FA;&#x4E8E;CentOS Linux release 7.7.1908 (Core) &#x73AF;&#x5883;&#x4E0B;&#x547D;&#x4EE4;&#x884C;&#x65B9;&#x5F0F;&#x5B89;&#x88C5;&#x914D;&#x7F6E;KVM&#x3002;</p>
<h2 id="&#x68C0;&#x6D4B;&#x670D;&#x52A1;&#x5668;&#x662F;&#x5426;&#x652F;&#x6301;KVM"><a href="#&#x68C0;&#x6D4B;&#x670D;&#x52A1;&#x5668;&#x662F;&#x5426;&#x652F;&#x6301;KVM" class="headerlink" title="&#x68C0;&#x6D4B;&#x670D;&#x52A1;&#x5668;&#x662F;&#x5426;&#x652F;&#x6301;KVM"></a>&#x68C0;&#x6D4B;&#x670D;&#x52A1;&#x5668;&#x662F;&#x5426;&#x652F;&#x6301;KVM</h2><p>KVM &#x662F;&#x57FA;&#x4E8E; x86 &#x865A;&#x62DF;&#x5316;&#x6269;&#x5C55;(Intel VT &#x6216;&#x8005; AMD-V) &#x6280;&#x672F;&#x7684;&#x865A;&#x62DF;&#x673A;&#x8F6F;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x67E5;&#x770B; CPU &#x662F;&#x5426;&#x652F;&#x6301; VT &#x6280;&#x672F;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5224;&#x65AD;&#x662F;&#x5426;&#x652F;&#x6301;KVM&#x3002;&#x6709;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#xFF0C;&#x5982;&#x679C;&#x7ED3;&#x679C;&#x4E2D;&#x6709;vmx&#xFF08;Intel&#xFF09;&#x6216;svm(AMD)&#x5B57;&#x6837;&#xFF0C;&#x5C31;&#x8BF4;&#x660E;CPU&#x7684;&#x652F;&#x6301;&#x7684;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/cpuinfo | egrep <span class="string">&apos;vmx|svm&apos;</span></span><br><span class="line">flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 cx16 xtpr pdcm pcid dca sse4_1 sse4_2 popcnt aes lahf_lm ssbd ibrs ibpb stibp tpr_shadow vnmi flexpriority ept vpid dtherm ida arat spec_ctrl intel_stibp flush_l1d</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="&#x5B89;&#x88C5;-KVM-&#x73AF;&#x5883;"><a href="#&#x5B89;&#x88C5;-KVM-&#x73AF;&#x5883;" class="headerlink" title="&#x5B89;&#x88C5; KVM &#x73AF;&#x5883;"></a>&#x5B89;&#x88C5; KVM &#x73AF;&#x5883;</h2><p>kvm&#x76F8;&#x5173;&#x5B89;&#x88C5;&#x5305;&#x53CA;&#x5176;&#x4F5C;&#x7528;: </p>
<ul>
<li><code>qemu-kvm</code> &#x4E3B;&#x8981;&#x7684;KVM&#x7A0B;&#x5E8F;&#x5305;  </li>
<li><code>python-virtinst</code> &#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x6240;&#x9700;&#x8981;&#x7684;&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;&#x548C;&#x7A0B;&#x5E8F;&#x5E93;  </li>
<li><code>virt-manager</code> GUI&#x865A;&#x62DF;&#x673A;&#x7BA1;&#x7406;&#x5DE5;&#x5177;  </li>
<li><code>virt-top</code> &#x865A;&#x62DF;&#x673A;&#x7EDF;&#x8BA1;&#x547D;&#x4EE4;  </li>
<li><code>virt-viewer</code> GUI&#x8FDE;&#x63A5;&#x7A0B;&#x5E8F;&#xFF0C;&#x8FDE;&#x63A5;&#x5230;&#x5DF2;&#x914D;&#x7F6E;&#x597D;&#x7684;&#x865A;&#x62DF;&#x673A;  </li>
<li><code>libvirt</code> C&#x8BED;&#x8A00;&#x5DE5;&#x5177;&#x5305;&#xFF0C;&#x63D0;&#x4F9B;libvirt&#x670D;&#x52A1;  </li>
<li><code>libvirt-client</code> &#x4E3A;&#x865A;&#x62DF;&#x5BA2;&#x6237;&#x673A;&#x63D0;&#x4F9B;&#x7684;C&#x8BED;&#x8A00;&#x5DE5;&#x5177;&#x5305;  </li>
<li><code>virt-install</code> &#x57FA;&#x4E8E;libvirt&#x670D;&#x52A1;&#x7684;&#x865A;&#x62DF;&#x673A;&#x521B;&#x5EFA;&#x547D;&#x4EE4;  </li>
<li><code>bridge-utils</code> &#x521B;&#x5EFA;&#x548C;&#x7BA1;&#x7406;&#x6865;&#x63A5;&#x8BBE;&#x5907;&#x7684;&#x5DE5;&#x5177;  </li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x5B89;&#x88C5; kvm </span></span><br><span class="line"><span class="comment"># ------------------------</span></span><br><span class="line"><span class="comment"># yum -y install qemu-kvm python-virtinst libvirt libvirt-python virt-manager libguestfs-tools bridge-utils virt-install</span></span><br><span class="line"></span><br><span class="line">yum -y install qemu-kvm libvirt virt-install bridge-utils </span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x91CD;&#x542F;&#x5BBF;&#x4E3B;&#x673A;&#xFF0C;&#x4EE5;&#x4FBF;&#x52A0;&#x8F7D; kvm &#x6A21;&#x5757;</span></span><br><span class="line"><span class="comment"># ------------------------</span></span><br><span class="line">reboot</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x67E5;&#x770B;KVM&#x6A21;&#x5757;&#x662F;&#x5426;&#x88AB;&#x6B63;&#x786E;&#x52A0;&#x8F7D;</span></span><br><span class="line"><span class="comment"># ------------------------</span></span><br><span class="line">lsmod | grep kvm</span><br><span class="line">kvm_intel             188644  0 </span><br><span class="line">kvm                   621480  1 kvm_intel</span><br></pre></td></tr></table></figure>

<p>&#x5F00;&#x542F;kvm&#x670D;&#x52A1;&#xFF0C;&#x5E76;&#x4E14;&#x8BBE;&#x7F6E;&#x5176;&#x5F00;&#x673A;&#x81EA;&#x52A8;&#x542F;&#x52A8;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start libvirtd</span><br><span class="line">systemctl <span class="built_in">enable</span> libvirtd</span><br></pre></td></tr></table></figure>

<p>&#x67E5;&#x770B;&#x72B6;&#x6001;&#x64CD;&#x4F5C;&#x7ED3;&#x679C;&#xFF0C;&#x5982;<code>Active: active (running)</code>&#xFF0C;&#x8BF4;&#x660E;&#x8FD0;&#x884C;&#x6B63;&#x5E38;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">systemctl status libvirtd</span><br><span class="line">&#x25CF; libvirtd.service - Virtualization daemon</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/libvirtd.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Tue 2019-10-10 08:25:20 CST; 8s ago</span><br><span class="line">     Docs: man:libvirtd(8)</span><br><span class="line">           https://libvirt.org</span><br></pre></td></tr></table></figure>

<h2 id="&#x5B89;&#x88C5;&#x865A;&#x62DF;&#x673A;"><a href="#&#x5B89;&#x88C5;&#x865A;&#x62DF;&#x673A;" class="headerlink" title="&#x5B89;&#x88C5;&#x865A;&#x62DF;&#x673A;"></a>&#x5B89;&#x88C5;&#x865A;&#x62DF;&#x673A;</h2><p>kvm&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x7279;&#x522B;&#x6CE8;&#x610F;<code>.iso</code>&#x955C;&#x50CF;&#x6587;&#x4EF6;&#x4E00;&#x5B9A;&#x653E;&#x5230;<code>/home</code> &#x6216;&#x8005;&#x6839;&#x76EE;&#x5F55;&#x91CD;&#x65B0;&#x521B;&#x5EFA;&#x76EE;&#x5F55;&#xFF0C;&#x4E0D;&#x7136;&#x4F1A;&#x56E0;&#x4E3A;&#x6743;&#x9650;&#x62A5;&#x9519;&#xFF0C;&#x65E0;&#x6CD5;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">virt-install \</span><br><span class="line">--virt-type=kvm \</span><br><span class="line">--name=vm1 \</span><br><span class="line">--vcpus=4 \</span><br><span class="line">--memory=4096 \</span><br><span class="line">--location=/tmp/CentOS-7-x86_64-Minimal-1908.iso \</span><br><span class="line">--disk path=/opt/vms/vm1.qcow2,size=40,format=qcow2 \</span><br><span class="line">--network bridge=virbr0 \</span><br><span class="line">--graphics none \</span><br><span class="line">--extra-args=<span class="string">&apos;console=ttyS0&apos;</span> \</span><br><span class="line">--force</span><br></pre></td></tr></table></figure>

<h3 id="&#x547D;&#x4EE4;&#x884C;&#x914D;&#x7F6E;&#x7CFB;&#x7EDF;"><a href="#&#x547D;&#x4EE4;&#x884C;&#x914D;&#x7F6E;&#x7CFB;&#x7EDF;" class="headerlink" title="&#x547D;&#x4EE4;&#x884C;&#x914D;&#x7F6E;&#x7CFB;&#x7EDF;"></a>&#x547D;&#x4EE4;&#x884C;&#x914D;&#x7F6E;&#x7CFB;&#x7EDF;</h3><p>&#x4E0A;&#x9762;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x547D;&#x4EE4;&#x6700;&#x7EC8;&#x4F1A;&#x8FDB;&#x5165;<code>CentOS</code>&#x5B89;&#x88C5;&#x754C;&#x9762;&#xFF08;text&#xFF09;&#xFF0C;&#x5E26; <code>[!]</code> &#x57FA;&#x672C;&#x90FD;&#x662F;&#x8981;&#x914D;&#x7F6E;&#x7684;&#xFF0C;&#x6309;&#x5BF9;&#x5E94;&#x7684;&#x6570;&#x5B57;&#x4F9D;&#x6B21;&#x8FDB;&#x884C;&#x8BBE;&#x7F6E;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Installation</span><br><span class="line"></span><br><span class="line"> 1) [x] Language settings                 2) [!] Time settings</span><br><span class="line">        (English (United States))                (Timezone is not <span class="built_in">set</span>.)</span><br><span class="line"> 3) [!] Installation <span class="built_in">source</span>               4) [!] Software selection</span><br><span class="line">        (Processing...)                          (Processing...)</span><br><span class="line"> 5) [!] Installation Destination          6) [x] Kdump</span><br><span class="line">        (No disks selected)                      (Kdump is enabled)</span><br><span class="line"> 7) [ ] Network configuration             8) [!] Root password</span><br><span class="line">        (Not connected)                          (Password is not <span class="built_in">set</span>.)</span><br><span class="line"> 9) [!] User creation</span><br><span class="line">        (No user will be created)</span><br><span class="line">  Please make your choice from above [<span class="string">&apos;q&apos;</span> to quit | <span class="string">&apos;b&apos;</span> to begin installation |</span><br><span class="line">  <span class="string">&apos;r&apos;</span> to refresh]:</span><br></pre></td></tr></table></figure>

<h3 id="&#x8FDE;&#x63A5;&#x865A;&#x62DF;&#x673A;"><a href="#&#x8FDE;&#x63A5;&#x865A;&#x62DF;&#x673A;" class="headerlink" title="&#x8FDE;&#x63A5;&#x865A;&#x62DF;&#x673A;"></a>&#x8FDE;&#x63A5;&#x865A;&#x62DF;&#x673A;</h3><p>&#x865A;&#x673A;&#x5B89;&#x88C5;&#x5B8C;&#x6210;&#x91CD;&#x542F;&#x540E;&#xFF0C;&#x901A;&#x8FC7; <code>virsh console &lt;&#x865A;&#x62DF;&#x673A;&#x540D;&#x79F0;&gt;</code> &#x547D;&#x4EE4;&#x6765;&#x8FDE;&#x63A5;&#x865A;&#x62DF;&#x673A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x67E5;&#x770B;&#x865A;&#x62DF;&#x673A;</span></span><br><span class="line">virsh list              <span class="comment"># &#x67E5;&#x770B;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x865A;&#x62DF;&#x673A;</span></span><br><span class="line">virsh list --all         <span class="comment"># &#x67E5;&#x770B;&#x6240;&#x6709;&#x865A;&#x62DF;&#x673A;</span></span><br><span class="line"> Id    Name                           State</span><br><span class="line">----------------------------------------------------</span><br><span class="line"> 1     vm1                            running</span><br></pre></td></tr></table></figure>

<p>&#x8FDE;&#x63A5;&#x865A;&#x62DF;&#x673A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virsh console vm1</span><br></pre></td></tr></table></figure>

<p>&#x914D;&#x7F6E;&#x865A;&#x62DF;&#x673A;&#x7F51;&#x7EDC;&#xFF0C;&#x7F16;&#x8F91;<code>vi /etc/sysconfig/network-scripts/ifcfg-eth0</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=eth0</span><br><span class="line">UUID=119c527f-dea8-4669-976c-582eca49da01</span><br><span class="line">DEVICE=eth0</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=192.168.122.2</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=192.168.122.1</span><br></pre></td></tr></table></figure>

<p>&#x6DFB;&#x52A0;DNS&#x914D;&#x7F6E;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x5982;&#x679C;&#x6CA1;&#x6709;&#x5728;&#x7F51;&#x7EDC;&#x914D;&#x7F6E;&#x6DFB;&#x52A0;DNS&#x53EF;&#x4EE5;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x6DFB;&#x52A0;DNS</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;nameserver 114.114.114.114&quot;</span> &gt; /etc/resolv.conf</span><br></pre></td></tr></table></figure>

<p>&#x6FC0;&#x6D3B;&#x7F51;&#x5361;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifup eth0 <span class="comment"># &#x6FC0;&#x6D3B;&#x7F51;&#x5361;</span></span><br></pre></td></tr></table></figure>

<p>&#x6D4B;&#x8BD5;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ping qq.com</span><br><span class="line">PING qq.com (61.129.7.47) 56(84) bytes of data.</span><br><span class="line">64 bytes from 61.129.7.47 (61.129.7.47): icmp_seq=1 ttl=53 time=21.4 ms</span><br></pre></td></tr></table></figure>

<h3 id="&#x865A;&#x62DF;&#x673A;&#x5176;&#x5B83;&#x7BA1;&#x7406;"><a href="#&#x865A;&#x62DF;&#x673A;&#x5176;&#x5B83;&#x7BA1;&#x7406;" class="headerlink" title="&#x865A;&#x62DF;&#x673A;&#x5176;&#x5B83;&#x7BA1;&#x7406;"></a>&#x865A;&#x62DF;&#x673A;&#x5176;&#x5B83;&#x7BA1;&#x7406;</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">virsh start vm1     <span class="comment"># &#x865A;&#x62DF;&#x673A;&#x5F00;&#x542F;&#xFF08;&#x542F;&#x52A8;&#xFF09;&#xFF1A;</span></span><br><span class="line">virsh reboot vm1    <span class="comment"># &#x865A;&#x62DF;&#x673A;&#x91CD;&#x65B0;&#x542F;&#x52A8;</span></span><br><span class="line">virsh shutdown vm1  <span class="comment"># &#x865A;&#x62DF;&#x673A;&#x5173;&#x673A;</span></span><br><span class="line">virsh destroy vm1   <span class="comment"># &#x5F3A;&#x5236;&#x5173;&#x673A;&#xFF08;&#x5F3A;&#x5236;&#x65AD;&#x7535;&#xFF09;</span></span><br><span class="line">virsh <span class="built_in">suspend</span> vm1   <span class="comment"># &#x6682;&#x505C;&#xFF08;&#x6302;&#x8D77;&#xFF09;KVM &#x865A;&#x62DF;&#x673A;</span></span><br><span class="line">virsh resume vm1    <span class="comment"># &#x6062;&#x590D;&#x88AB;&#x6302;&#x8D77;&#x7684; KVM &#x865A;&#x62DF;&#x673A;</span></span><br><span class="line">virsh undefine vm1  <span class="comment"># &#x8BE5;&#x65B9;&#x6CD5;&#x53EA;&#x5220;&#x9664;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x78C1;&#x76D8;&#x6587;&#x4EF6;&#x672A;&#x5220;&#x9664;</span></span><br><span class="line">virsh autostart vm1 <span class="comment"># &#x968F;&#x7269;&#x7406;&#x673A;&#x542F;&#x52A8;&#x800C;&#x542F;&#x52A8;&#xFF08;&#x5F00;&#x673A;&#x542F;&#x52A8;&#xFF09;</span></span><br><span class="line">virsh autostart --<span class="built_in">disable</span> vm1 <span class="comment"># &#x53D6;&#x6D88;&#x6807;&#x8BB0;&#x4E3A;&#x81EA;&#x52A8;&#x5F00;&#x59CB;&#xFF08;&#x53D6;&#x6D88;&#x5F00;&#x673A;&#x542F;&#x52A8;&#xFF09;</span></span><br></pre></td></tr></table></figure>

<h2 id="&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;"><a href="#&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;" class="headerlink" title="&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;"></a>&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</h2><p>&#x4EE5;&#x4E0A;&#x8FF0;VM&#x4E3A;&#x4F8B;&#xFF0C;&#x76EE;&#x524D;&#x8BE5;KVM&#x5BBF;&#x4E3B;&#x673A;&#x7684;&#x7BA1;&#x7406;IP&#x4E3A;<code>10.10.16.182</code>&#xFF0C;&#x53EF;&#x8FDE;&#x63A5;&#x516C;&#x7F51;&#xFF0C;VM&#x7684;IP&#x4E3A;<code>192.168.122.2</code>&#xFF0C;&#x73B0;&#x5728;&#x8981;&#x6C42;&#x901A;&#x8FC7;&#x8BBF;&#x95EE;KVM&#x5BBF;&#x4E3B;&#x673A;&#x7684;2222&#x7AEF;&#x53E3;&#x8BBF;&#x95EE;VM&#x7684;22&#x7AEF;&#x53E3;&#x3002;</p>
<p>&#x5BBF;&#x4E3B;&#x673A;&#x4E0A;&#x6267;&#x884C;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x542F;&#x52A8;&#x7F51;&#x7EDC;&#x8F6C;&#x53D1;&#x89C4;&#x5219;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1&quot;</span> &gt;/proc/sys/net/ipv4/ip_forward </span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 2222 -j DNAT --to-destination 192.168.122.2:22</span><br><span class="line">iptables -t nat -A POSTROUTING -p tcp -d 192.168.122.2 --dport 22 -j SNAT --to-source 10.10.16.182</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x901A;&#x8FC7;&#x5916;&#x7F51;&#x8FDE;&#x63A5;&#x865A;&#x62DF;&#x673A;</span></span><br><span class="line">ssh -p 2222 root@10.10.16.182</span><br></pre></td></tr></table></figure>

<p>&#x901A;&#x8FC7;<code>iptables</code>&#x547D;&#x4EE4;&#x6765;&#x8BBE;&#x7F6E;&#x8F6C;&#x53D1;&#x89C4;&#x5219;&#xFF0C;&#x6E90;SNAT&#x89C4;&#x5219;&#xFF0C;&#x6E90;&#x7F51;&#x7EDC;&#x5730;&#x5740;&#x8F6C;&#x6362;&#xFF0C;SNAT&#x5C31;&#x662F;&#x91CD;&#x5199;&#x5305;&#x7684;&#x6E90;IP&#x5730;&#x5740;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x6570;&#x636E;&#x5305;&#x8FDB;&#x884C; &#x6E90;NAT(SNAT)&#xFF0C;&#x7CFB;&#x7EDF;&#x5148;&#x8DEF;&#x7531;&#x2014;&#x2014;&gt;&#x518D;&#x8FC7;&#x6EE4;&#xFF08;FORWARD)&#x2014;&#x2014;&gt;&#x6700;&#x540E;&#x624D;&#x8FDB;&#x884C;POSTROUTING SNAT&#x5730;&#x5740;&#x7FFB;&#x8BD1;</span></span><br><span class="line"><span class="comment"># -t&lt;&#x8868;&gt;&#xFF1A;&#x6307;&#x5B9A;&#x8981;&#x64CD;&#x7EB5;&#x7684;&#x8868;&#xFF1B;</span></span><br><span class="line"><span class="comment"># -A&#xFF1A;&#x5411;&#x89C4;&#x5219;&#x94FE;&#x4E2D;&#x6DFB;&#x52A0;&#x6761;&#x76EE;&#xFF1B;</span></span><br><span class="line"><span class="comment"># -s&#xFF1A;&#x6307;&#x5B9A;&#x8981;&#x5339;&#x914D;&#x7684;&#x6570;&#x636E;&#x5305;&#x6E90;ip&#x5730;&#x5740;&#xFF1B;</span></span><br><span class="line"><span class="comment"># -j&lt;&#x76EE;&#x6807;&gt;&#xFF1A;&#x6307;&#x5B9A;&#x8981;&#x8DF3;&#x8F6C;&#x7684;&#x76EE;&#x6807;&#xFF1B;</span></span><br><span class="line"><span class="comment"># -j SNAT&#xFF1A;&#x6E90;&#x7F51;&#x7EDC;&#x5730;&#x5740;&#x8F6C;&#x6362;&#xFF0C;SNAT&#x5C31;&#x662F;&#x91CD;&#x5199;&#x5305;&#x7684;&#x6E90;IP&#x5730;&#x5740;</span></span><br><span class="line"><span class="comment"># --to-source ipaddr[-ipaddr][:port-port] </span></span><br><span class="line"><span class="comment">#   &#x5B83;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x5355;&#x4E2A;&#x65B0;&#x7684;&#x6E90;IP&#x5730;&#x5740;&#xFF0C;IP&#x5730;&#x5740;&#x7684;&#x5305;&#x542B;&#x8303;&#x56F4;&#xFF0C;&#x4EE5;&#x53CA;&#x53EF;&#x9009;&#x7684;&#x7AEF;&#x53E3;&#x8303;&#x56F4;&#xFF08;&#x4EC5;&#x5F53;&#x89C4;&#x5219;&#x8FD8;&#x6307;&#x5B9A;-p tcp&#x6216;-p udp&#x65F6;&#x624D;&#x6709;&#x6548;&#xFF09;&#x3002; </span></span><br><span class="line"><span class="comment">#   &#x5982;&#x679C;&#x6CA1;&#x6709;&#x6307;&#x5B9A;&#x7AEF;&#x53E3;&#x8303;&#x56F4;&#xFF0C;&#x5219;&#x4F4E;&#x4E8E;512&#x7684;&#x6E90;&#x7AEF;&#x53E3;&#x5C06;&#x6620;&#x5C04;&#x5230;512&#x4EE5;&#x4E0B;&#x7684;&#x5176;&#x4ED6;&#x7AEF;&#x53E3;&#xFF1A;512&#x548C;1023&#x4E4B;&#x95F4;&#x7684;&#x7AEF;&#x53E3;&#x5C06;&#x6620;&#x5C04;&#x5230;&#x4F4E;&#x4E8E;1024&#x7684;&#x7AEF;&#x53E3;&#xFF0C;</span></span><br><span class="line"><span class="comment">#   &#x5176;&#x4ED6;&#x7AEF;&#x53E3;&#x5C06;&#x88AB;&#x6620;&#x5C04;&#x5230;1024&#x6216;&#x66F4;&#x9AD8;&#x3002; &#x5728;&#x53EF;&#x80FD;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E0D;&#x4F1A;&#x53D1;&#x751F;&#x6E2F;&#x53E3;&#x66F4;&#x6539;&#x3002;</span></span><br><span class="line"><span class="comment">#   &#x5728;&#x5185;&#x6838;&#x9AD8;&#x8FBE;2.6.10&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x51E0;&#x4E2A; - &#x6E90;&#x9009;&#x9879;&#x3002; </span></span><br><span class="line"><span class="comment">#   &#x5BF9;&#x4E8E;&#x8FD9;&#x4E9B;&#x5185;&#x6838;&#xFF0C;&#x5982;&#x679C;&#x901A;&#x8FC7;&#x5730;&#x5740;&#x8303;&#x56F4;&#x6216;&#x591A;&#x4E2A;&#x6E90;&#x9009;&#x9879;&#x6307;&#x5B9A;&#x591A;&#x4E2A;&#x6E90;&#x5730;&#x5740;&#xFF0C;&#x5219;&#x4F1A;&#x5728;&#x8FD9;&#x4E9B;&#x5730;&#x5740;&#x4E4B;&#x95F4;&#x8FDB;&#x884C;&#x7B80;&#x5355;&#x7684;&#x5FAA;&#x73AF;&#xFF08;&#x5FAA;&#x73AF;&#x4E2D;&#x5FAA;&#x73AF;&#xFF09;&#x3002; </span></span><br><span class="line"><span class="comment">#   &#x540E;&#x6765;&#x7684;&#x5185;&#x6838;&#xFF08;&gt; = 2.6.11-rc1&#xFF09;&#x4E0D;&#x518D;&#x5177;&#x6709;NAT&#x5230;&#x591A;&#x4E2A;&#x8303;&#x56F4;&#x7684;&#x80FD;&#x529B;&#x3002;</span></span><br><span class="line">iptables -t nat -A POSTROUTING -s 192.168.122.0/24 -j SNAT --to-source &lt;&#x56FA;&#x5B9A;IP&gt;</span><br><span class="line"><span class="comment"># cat /etc/sysconfig/iptables</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/10/12/KVM&#x8BE6;&#x89E3;/1576552169311.png" alt="1576552169311"></p>
<h2 id="&#x516C;&#x7F51;&#x8BBF;&#x95EE;&#x865A;&#x62DF;&#x673A;"><a href="#&#x516C;&#x7F51;&#x8BBF;&#x95EE;&#x865A;&#x62DF;&#x673A;" class="headerlink" title="&#x516C;&#x7F51;&#x8BBF;&#x95EE;&#x865A;&#x62DF;&#x673A;"></a>&#x516C;&#x7F51;&#x8BBF;&#x95EE;&#x865A;&#x62DF;&#x673A;</h2><p>&#x901A;&#x8FC7;&#x516C;&#x7F51;ip <code>10.10.16.182</code>&#x7AEF;&#x53E3;<code>8080</code>&#xFF0C;&#x8F6C;&#x53D1;&#x5230;&#x865A;&#x62DF;&#x673A;<code>192.168.122.2:80</code>&#x4E0A;&#x9762;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -A PREROUTING -d 10.10.16.182 -p tcp --dport 8080 -j DNAT --to-dest 192.168.122.2:80</span><br></pre></td></tr></table></figure>

<p>&#x91CD;&#x542F;&#x5E76;&#x4FDD;&#x5B58; <code>iptables</code> &#x914D;&#x7F6E;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x4FDD;&#x5B58; </span></span><br><span class="line">service iptables save</span><br><span class="line"><span class="comment"># &#x91CD;&#x542F;</span></span><br><span class="line">service iptables restart</span><br></pre></td></tr></table></figure>

<h2 id="&#x914D;&#x7F6E;&#x5BBF;&#x4E3B;&#x673A;&#x7F51;&#x7EDC;"><a href="#&#x914D;&#x7F6E;&#x5BBF;&#x4E3B;&#x673A;&#x7F51;&#x7EDC;" class="headerlink" title="&#x914D;&#x7F6E;&#x5BBF;&#x4E3B;&#x673A;&#x7F51;&#x7EDC;"></a>&#x914D;&#x7F6E;&#x5BBF;&#x4E3B;&#x673A;&#x7F51;&#x7EDC;</h2><ol>
<li>KVM &#x865A;&#x62DF;&#x673A;&#x662F;&#x57FA;&#x4E8E; NAT &#x7684;&#x7F51;&#x7EDC;&#x914D;&#x7F6E;&#xFF1B;</li>
<li>&#x53EA;&#x6709;&#x540C;&#x4E00;&#x5BBF;&#x4E3B;&#x673A;&#x7684;&#x865A;&#x62DF;&#x952E;&#x4E4B;&#x95F4;&#x53EF;&#x4EE5;&#x4E92;&#x76F8;&#x8BBF;&#x95EE;&#xFF0C;&#x8DE8;&#x5BBF;&#x4E3B;&#x673A;&#x662F;&#x4E0D;&#x80FD;&#x8BBF;&#x95EE;&#xFF1B;</li>
<li>&#x865A;&#x62DF;&#x673A;&#x9700;&#x8981;&#x548C;&#x5BBF;&#x4E3B;&#x673A;&#x914D;&#x7F6E;&#x6210;&#x6865;&#x63A5;&#x6A21;&#x5F0F;&#xFF0C;&#x4EE5;&#x4FBF;&#x865A;&#x62DF;&#x673A;&#x53EF;&#x4EE5;&#x5728;&#x5C40;&#x57DF;&#x7F51;&#x5185;&#x53EF;&#x89C1;&#xFF1B;</li>
</ol>
<h3 id="Bridge&#x6A21;&#x5F0F;&#x914D;&#x7F6E;"><a href="#Bridge&#x6A21;&#x5F0F;&#x914D;&#x7F6E;" class="headerlink" title="Bridge&#x6A21;&#x5F0F;&#x914D;&#x7F6E;"></a>Bridge&#x6A21;&#x5F0F;&#x914D;&#x7F6E;</h3><p>Bridge&#x65B9;&#x5F0F;&#x5373;&#x865A;&#x62DF;&#x7F51;&#x6865;&#x7684;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#x65B9;&#x5F0F;&#xFF0C;&#x662F;&#x5BA2;&#x6237;&#x673A;&#x548C;&#x5B50;&#x7F51;&#x91CC;&#x9762;&#x7684;&#x673A;&#x5668;&#x80FD;&#x591F;&#x4E92;&#x76F8;&#x901A;&#x4FE1;&#x3002;&#x53EF;&#x4EE5;&#x4F7F;&#x865A;&#x62DF;&#x673A;&#x6210;&#x4E3A;&#x7F51;&#x7EDC;&#x4E2D;&#x5177;&#x6709;&#x72EC;&#x7ACB;IP&#x7684;&#x4E3B;&#x673A;&#x3002;<strong>&#x6865;&#x63A5;&#x7F51;&#x7EDC;</strong>&#xFF08;&#x4E5F;&#x53EB; <strong>&#x7269;&#x7406;&#x8BBE;&#x5907;&#x5171;&#x4EAB;</strong>&#xFF09;&#x88AB;&#x7528;&#x4F5C;&#x628A;&#x4E00;&#x4E2A;&#x7269;&#x7406;&#x8BBE;&#x5907;&#x590D;&#x5236;&#x5230;&#x4E00;&#x53F0;&#x865A;&#x62DF;&#x673A;&#x3002;&#x7F51;&#x6865;&#x591A;&#x7528;&#x4F5C;&#x9AD8;&#x7EA7;&#x8BBE;&#x7F6E;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x4E3B;&#x673A;&#x591A;&#x4E2A;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#x7684;&#x60C5;&#x51B5;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;      &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;</span><br><span class="line">&#x2502;          HOST           &#x2502;      &#x2502;Virtual Machine 1&#x2502;</span><br><span class="line">&#x2502; &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;      &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510; &#x2502;      &#x2502;    &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;     &#x2502;</span><br><span class="line">&#x2502; &#x2502; br0  &#x2502;&#x2500;&#x2500;&#x252C;&#x2500;&#x2500;&#x2500;&#x2502; vnet0 &#x2502;&#x2500;&#x2502;&#x2500; &#x2500; &#x2500; &#x2502;    &#x2502; br0  &#x2502;     &#x2502;</span><br><span class="line">&#x2502; &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;  &#x2502;   &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518; &#x2502;      &#x2502;    &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;     &#x2502;</span><br><span class="line">&#x2502;     &#x2502;     &#x2502;             &#x2502;      &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;</span><br><span class="line">&#x2502;     &#x2502;     &#x2502;   &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510; &#x2502;      &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;</span><br><span class="line">&#x2502; &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;  &#x2514;&#x2500;&#x2500;&#x2500;&#x2502; vnet1 &#x2502;&#x2500;&#x2502;&#x2500;     &#x2502;Virtual Machine 2&#x2502;</span><br><span class="line">&#x2502; &#x2502; eno0 &#x2502;      &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518; &#x2502; &#x2502;    &#x2502;    &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;     &#x2502;</span><br><span class="line">&#x2502; &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;                &#x2502;  &#x2500; &#x2500; &#x2502;    &#x2502; br0  &#x2502;     &#x2502;</span><br><span class="line">&#x2502; &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;                &#x2502;      &#x2502;    &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;     &#x2502;</span><br><span class="line">&#x2502; &#x2502; eno1 &#x2502;                &#x2502;      &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;</span><br><span class="line">&#x2502; &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;                &#x2502;</span><br><span class="line">&#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;</span><br></pre></td></tr></table></figure>

<p>&#x901A;&#x8FC7;<code>ip</code>&#x547D;&#x4EE4;&#x67E5;&#x770B;&#x5BBF;&#x4E3B;&#x673A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x540D;&#x5B57;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ip a</span><br><span class="line">6: em1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP qlen 1000</span><br><span class="line">    link/ether 38:63:bb:44:cf:6c brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.10.16.182/24 brd 192.168.188.255 scope global dynamic eno1</span><br><span class="line">       valid_lft 2822sec preferred_lft 2822sec</span><br><span class="line">    inet6 fe80::3a63:bbff:fe44:cf6c/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4E0A;&#x9762;<code>em1</code>&#x662F;&#x6709;&#x83B7;&#x53D6;&#x5230;ip&#x5730;&#x5740;&#x7684;&#xFF0C;&#x76F8;&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x5728;<code>/etc/sysconfig/network-scripts/</code>&#x76EE;&#x5F55;&#x4E2D;&#xFF0C;<code>ifcfg-em1</code> &#x5BBF;&#x4E3B;&#x673A;&#x7684;&#x7269;&#x7406;&#x7F51;&#x5361;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat ifcfg-eno1</span></span><br><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">NAME=eno1</span><br><span class="line">DEVICE=eno1</span><br><span class="line">UUID=242b3d4d-37a5-4f46-b072-55554c185ecf</span><br><span class="line">ONBOOT=yes</span><br><span class="line"></span><br><span class="line">BRIDGE=<span class="string">&quot;br0&quot;</span> <span class="comment"># &#x6307;&#x5B9A;&#x6865;&#x63A5;&#x7F51;&#x5361;&#x7684;&#x540D;&#x79F0;</span></span><br></pre></td></tr></table></figure>

<p><code>ifcfg-br0</code> &#x6865;&#x63A5;&#x7F51;&#x5361;&#x914D;&#x7F6E;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;&#x4E2D;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat ifcfg-br0</span></span><br><span class="line">BOOTPROTO=static</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">PEERDNS=yes</span><br><span class="line">PEERROUTES=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_PEERDNS=yes</span><br><span class="line">IPV6_PEERROUTES=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">NAME=br0</span><br><span class="line">DEVICE=br0</span><br><span class="line">ONBOOT=yes</span><br><span class="line">TYPE=bridge  <span class="comment"># &#x5C06;&#x5236;&#x5B9A;&#x4E3A;&#x6865;&#x63A5;&#x7C7B;&#x578B;</span></span><br><span class="line">IPADDR=10.10.16.182  <span class="comment"># &#x8BBE;&#x7F6E;IP&#x5730;&#x5740;</span></span><br><span class="line">PREFIX=22              <span class="comment"># &#x8BBE;&#x7F6E;&#x5B50;&#x7F51;&#x63A9;&#x7801;</span></span><br><span class="line">GATEWAY=10.10.16.254   <span class="comment"># &#x8BBE;&#x7F6E;&#x7F51;&#x5173;</span></span><br></pre></td></tr></table></figure>

<p>&#x914D;&#x7F6E;&#x597D;&#x4E4B;&#x540E;&#xFF0C;&#x901A;&#x8FC7;<code>systemctl</code>&#x547D;&#x4EE4;&#x91CD;&#x542F;&#x7F51;&#x5361;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ifup eno1 <span class="comment"># &#x6FC0;&#x6D3B;&#x7F51;&#x5361;</span></span><br><span class="line">ifup br0 <span class="comment"># &#x6FC0;&#x6D3B;&#x6865;&#x63A5;&#x7F51;&#x5361;</span></span><br><span class="line"><span class="comment"># &#x4E24;&#x79CD;&#x91CD;&#x542F;&#x7F51;&#x7EDC;&#x7684;&#x65B9;&#x6CD5;</span></span><br><span class="line">systemctl restart network.service</span><br><span class="line">service network restart</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x6821;&#x9A8C;&#x6865;&#x63A5;&#x63A5;&#x53E3;</span></span><br><span class="line">brctl show</span><br><span class="line">bridge name	bridge id		STP enabled	interfaces</span><br><span class="line">br0		8000.0026b94213ce	no		em1</span><br><span class="line">virbr0		8000.5254005d08e8	yes		virbr0-nic</span><br><span class="line">							vnet0</span><br></pre></td></tr></table></figure>

<h4 id="&#x5B89;&#x88C5;Bridge&#x6A21;&#x5F0F;&#x7684;&#x865A;&#x62DF;&#x673A;"><a href="#&#x5B89;&#x88C5;Bridge&#x6A21;&#x5F0F;&#x7684;&#x865A;&#x62DF;&#x673A;" class="headerlink" title="&#x5B89;&#x88C5;Bridge&#x6A21;&#x5F0F;&#x7684;&#x865A;&#x62DF;&#x673A;"></a>&#x5B89;&#x88C5;Bridge&#x6A21;&#x5F0F;&#x7684;&#x865A;&#x62DF;&#x673A;</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">virt-install \</span><br><span class="line">--virt-type=kvm \</span><br><span class="line">--name=vm-bridge \</span><br><span class="line">--vcpus=4 \</span><br><span class="line">--memory=4096 \</span><br><span class="line">--location=/tmp/CentOS-7-x86_64-Minimal-1908.iso \</span><br><span class="line">--disk path=/opt/vms/vm-bridge.qcow2,size=100,format=qcow2 \</span><br><span class="line">--network bridge=br0 \</span><br><span class="line">--graphics vnc,listen=0.0.0.0 \</span><br><span class="line">--extra-args=<span class="string">&apos;console=ttyS0&apos;</span> \</span><br><span class="line">--force</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x7684;&#x53C2;&#x6570; &#x2013;network bridge=br0&#xFF0C;&#x7F51;&#x7EDC;&#x4F7F;&#x7528;br0&#x7F51;&#x6865;</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">brctl show</span><br><span class="line"></span><br><span class="line">bridge name	bridge id		STP enabled	interfaces</span><br><span class="line">br0		8000.0026b94213ce	no		em1</span><br><span class="line">							vnet0</span><br></pre></td></tr></table></figure>

<p>&#x5B89;&#x88C5;&#x5B8C;&#x540E;&#x8FDB;&#x5165;&#x865A;&#x673A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virsh console vm-bridge</span><br></pre></td></tr></table></figure>

<p>&#x7F16;&#x8F91;&#x7F51;&#x5361;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line"></span><br><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=eth0</span><br><span class="line">UUID=9ab4ed7f-b9a2-4dd6-900d-878d7f99289f</span><br><span class="line">DEVICE=eth0</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=10.10.16.193</span><br><span class="line">NETMASK=255.255.252.0</span><br><span class="line">GATEWAY=10.10.16.254</span><br></pre></td></tr></table></figure>

<p>&#x542F;&#x52A8;&#x7F51;&#x5361;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifup eth0</span><br></pre></td></tr></table></figure>

<h3 id="NAT&#x6A21;&#x5F0F;"><a href="#NAT&#x6A21;&#x5F0F;" class="headerlink" title="NAT&#x6A21;&#x5F0F;"></a>NAT&#x6A21;&#x5F0F;</h3><p>NAT(Network Address Translation&#x7F51;&#x7EDC;&#x5730;&#x5740;&#x7FFB;&#x8BD1;)&#xFF0C;NAT&#x65B9;&#x5F0F;&#x662F;kvm&#x5B89;&#x88C5;&#x540E;&#x7684;&#x9ED8;&#x8BA4;&#x65B9;&#x5F0F;&#x3002;&#x5B83;&#x652F;&#x6301;&#x4E3B;&#x673A;&#x4E0E;&#x865A;&#x62DF;&#x673A;&#x7684;&#x4E92;&#x8BBF;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x652F;&#x6301;&#x865A;&#x62DF;&#x673A;&#x8BBF;&#x95EE;&#x4E92;&#x8054;&#x7F51;&#xFF0C;&#x4F46;&#x4E0D;&#x652F;&#x6301;&#x5916;&#x754C;&#x8BBF;&#x95EE;&#x865A;&#x62DF;&#x673A;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">virsh net-edit default <span class="comment"># &#x5982;&#x679C;&#x8981;&#x521B;&#x5EFA;&#x6216;&#x8005;&#x4FEE;&#x6539;NAT&#x7F51;&#x7EDC;&#xFF0C;&#x8981;&#x5148;&#x7F16;&#x8F91;default.xml&#xFF1A;</span></span><br><span class="line">virsh net-list --all</span><br><span class="line"></span><br><span class="line"> Name                 State      Autostart     Persistent</span><br><span class="line">----------------------------------------------------------</span><br><span class="line"> default              active     no            no</span><br></pre></td></tr></table></figure>

<p>default&#x662F;&#x5BBF;&#x4E3B;&#x673A;&#x5B89;&#x88C5;&#x865A;&#x62DF;&#x673A;&#x652F;&#x6301;&#x6A21;&#x5757;&#x7684;&#x65F6;&#x5019;&#x81EA;&#x52A8;&#x5B89;&#x88C5;&#x7684;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">ip a l</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: em1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq master br0 state UP group default qlen 1000</span><br><span class="line">    link/ether 00:26:b9:42:13:ce brd ff:ff:ff:ff:ff:ff</span><br><span class="line">3: em2: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span><br><span class="line">    link/ether 00:26:b9:42:13:d0 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">4: em3: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span><br><span class="line">    link/ether 00:26:b9:42:13:d2 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">5: em4: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span><br><span class="line">    link/ether 00:26:b9:42:13:d4 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">6: virbr0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    link/ether 52:54:00:5d:08:e8 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">7: virbr0-nic: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc pfifo_fast master virbr0 state DOWN group default qlen 1000</span><br><span class="line">    link/ether 52:54:00:5d:08:e8 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">13: vnet0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast master virbr0 state UNKNOWN group default qlen 1000</span><br><span class="line">    link/ether fe:54:00:9b:45:fa brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet6 fe80::fc54:ff:fe9b:45fa/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">14: br0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    link/ether 00:26:b9:42:13:ce brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.10.16.182/22 brd 10.10.19.255 scope global br0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 2001:470:19:8c:226:b9ff:fe42:13ce/64 scope global mngtmpaddr dynamic </span><br><span class="line">       valid_lft 2591945sec preferred_lft 604745sec</span><br><span class="line">    inet6 fe80::226:b9ff:fe42:13ce/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<p>&#x5176;&#x4E2D;virbr0&#x662F;&#x7531;&#x5BBF;&#x4E3B;&#x673A;&#x865A;&#x62DF;&#x673A;&#x652F;&#x6301;&#x6A21;&#x5757;&#x5B89;&#x88C5;&#x65F6;&#x4EA7;&#x751F;&#x7684;&#x865A;&#x62DF;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#xFF0C;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;switch&#x548C;bridge&#xFF0C;&#x8D1F;&#x8D23;&#x628A;&#x5185;&#x5BB9;&#x5206;&#x53D1;&#x5230;&#x5404;&#x865A;&#x62DF;&#x673A;&#x3002;&#x51E0;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x7BA1;&#x7406;&#x6A21;&#x5757;&#x4EA7;&#x751F;&#x7684;&#x63A5;&#x53E3;&#x5173;&#x7CFB;&#x5982;&#x4E0B;&#x56FE;:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;                      </span><br><span class="line">&#x2502;         HOST          &#x2502;                      </span><br><span class="line">&#x2502; &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;              &#x2502;   &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;</span><br><span class="line">&#x2502; &#x2502; br0  &#x2502;&#x2500;&#x252C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;     &#x2502;   &#x2502;Virtual Machine 1&#x2502;</span><br><span class="line">&#x2502; &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518; &#x2502;      &#x2502;     &#x2502;   &#x2502;   &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;      &#x2502;</span><br><span class="line">&#x2502;     &#x2502;    &#x2502;  &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510; &#x2502; &#x2500; &#x2502;   &#x2502; br0  &#x2502;      &#x2502;</span><br><span class="line">&#x2502;     &#x2502;    &#x2502;  &#x2502; vnet0 &#x2502;&#x2500;&#x2502;&#x2518;  &#x2502;   &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;      &#x2502;</span><br><span class="line">&#x2502; &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510; &#x2502;  &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518; &#x2502;   &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;</span><br><span class="line">&#x2502; &#x2502;virbr0&#x2502; &#x2502;  &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510; &#x2502;   &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;</span><br><span class="line">&#x2502; &#x2502; -nic &#x2502; &#x2514;&#x2500;&#x2500;&#x2502; vnet1 &#x2502;&#x2500;&#x2502;&#x2510;  &#x2502;Virtual Machine 2&#x2502;</span><br><span class="line">&#x2502; &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;    &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518; &#x2502;   &#x2502;                 &#x2502;</span><br><span class="line">&#x2502; &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;              &#x2502;&#x2514; &#x2500;&#x2502;   &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;      &#x2502;</span><br><span class="line">&#x2502; &#x2502; em1  &#x2502;              &#x2502;   &#x2502;   &#x2502; br0  &#x2502;      &#x2502;</span><br><span class="line">&#x2502; &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;              &#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;      &#x2502;</span><br><span class="line">&#x2502; &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;              &#x2502;   &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;</span><br><span class="line">&#x2502; &#x2502; em2  &#x2502;              &#x2502;</span><br><span class="line">&#x2502; &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;              &#x2502;</span><br><span class="line">&#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;</span><br></pre></td></tr></table></figure>

<p>&#x4ECE;&#x56FE;&#x4E0A;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x865A;&#x62DF;&#x63A5;&#x53E3;&#x548C;&#x7269;&#x7406;&#x63A5;&#x53E3;&#x4E4B;&#x95F4;&#x6CA1;&#x6709;&#x8FDE;&#x63A5;&#x5173;&#x7CFB;&#xFF0C;&#x6240;&#x4EE5;&#x865A;&#x62DF;&#x673A;&#x53EA;&#x80FD;&#x5728;&#x901A;&#x8FC7;&#x865A;&#x62DF;&#x7684;&#x7F51;&#x7EDC;&#x8BBF;&#x95EE;&#x5916;&#x90E8;&#x4E16;&#x754C;&#xFF0C;&#x65E0;&#x6CD5;&#x4ECE;&#x7F51;&#x7EDC;&#x4E0A;&#x5B9A;&#x4F4D;&#x548C;&#x8BBF;&#x95EE;&#x865A;&#x62DF;&#x4E3B;&#x673A;&#x3002;</p>
<p>virbr0&#x662F;&#x4E00;&#x4E2A;&#x6865;&#x63A5;&#x5668;&#xFF0C;&#x63A5;&#x6536;&#x6240;&#x6709;&#x5230;&#x7F51;&#x7EDC;192.168.122.*&#x7684;&#x5185;&#x5BB9;&#x3002;&#x4ECE;&#x4E0B;&#x9762;&#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x9A8C;&#x8BC1;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">brctl show</span><br><span class="line"><span class="comment"># &#x8F93;&#x51FA;&#x7ED3;&#x679C;</span></span><br><span class="line"><span class="comment"># ---------------------</span></span><br><span class="line"><span class="comment"># bridge name bridge id   STP enabled interfaces</span></span><br><span class="line"><span class="comment"># br0   8000.3863bb44cf6c no    eno1</span></span><br><span class="line"><span class="comment">#               vnet0</span></span><br><span class="line"><span class="comment"># virbr0    8000.525400193f0f yes   virbr0-nic</span></span><br><span class="line"></span><br><span class="line">ip route</span><br><span class="line"><span class="comment">#default via 10.10.16.254 dev br0 </span></span><br><span class="line"><span class="comment">#10.10.16.0/22 dev br0 proto kernel scope link src 10.10.16.182 </span></span><br><span class="line"><span class="comment">#169.254.0.0/16 dev br0 scope link metric 1014 </span></span><br><span class="line"><span class="comment">#192.168.122.0/24 dev virbr0 proto kernel scope link src 192.168.122.1</span></span><br></pre></td></tr></table></figure>

<p>&#x540C;&#x65F6;&#xFF0C;&#x865A;&#x62DF;&#x673A;&#x652F;&#x6301;&#x6A21;&#x5757;&#x4F1A;&#x4FEE;&#x6539;iptables&#x89C4;&#x5219;&#xFF0C;&#x901A;&#x8FC7;&#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -L -nv</span><br><span class="line">iptables -t filter -L -nv</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x679C;&#x6CA1;&#x6709;default&#x7684;&#x8BDD;&#xFF0C;&#x6216;&#x8005;&#x9700;&#x8981;&#x6269;&#x5C55;&#x81EA;&#x5DF1;&#x7684;&#x865A;&#x62DF;&#x7F51;&#x7EDC;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#x91CD;&#x65B0;&#x5B89;&#x88C5;NAT&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virsh net-define /usr/share/libvirt/networks/default.xml</span><br></pre></td></tr></table></figure>

<p>&#x6B64;&#x547D;&#x4EE4;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x865A;&#x62DF;&#x7F51;&#x7EDC;&#xFF0C;default.xml&#x7684;&#x5185;&#x5BB9;&#xFF1A;</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">network</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bridge</span> <span class="attr">name</span>=<span class="string">&quot;virbr0&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">forward</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ip</span> <span class="attr">address</span>=<span class="string">&quot;192.168.122.1&quot;</span> <span class="attr">netmask</span>=<span class="string">&quot;255.255.255.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dhcp</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">range</span> <span class="attr">start</span>=<span class="string">&quot;192.168.122.2&quot;</span> <span class="attr">end</span>=<span class="string">&quot;192.168.122.254&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dhcp</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">network</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&#x4E5F;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;xml&#xFF0C;&#x521B;&#x5EFA;&#x81EA;&#x5DF1;&#x7684;&#x865A;&#x62DF;&#x7F51;&#x7EDC;&#x3002;</p>
<p>&#x91CD;&#x65B0;&#x52A0;&#x8F7D;&#x548C;&#x6FC0;&#x6D3B;&#x914D;&#x7F6E;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virsh  net-define /etc/libvirt/qemu/networks/default.xml</span><br></pre></td></tr></table></figure>

<p>&#x6807;&#x8BB0;&#x4E3A;&#x81EA;&#x52A8;&#x542F;&#x52A8;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">virsh net-autostart default</span><br><span class="line"><span class="comment"># Network default marked as autostarted</span></span><br><span class="line"></span><br><span class="line">virsh net-start default</span><br></pre></td></tr></table></figure>

<p>&#x542F;&#x52A8;&#x7F51;&#x7EDC;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">virsh net-start default</span><br><span class="line"><span class="comment"># Network default started</span></span><br></pre></td></tr></table></figure>

<p>&#x7F51;&#x7EDC;&#x542F;&#x52A8;&#x540E;&#x53EF;&#x4EE5;&#x7528;&#x547D;&#x4EE4;brctl show &#x67E5;&#x770B;&#x548C;&#x9A8C;&#x8BC1;&#x3002;</p>
<p>&#x4FEE;&#x6539;<code>vi /etc/sysctl.conf</code>&#x4E2D;&#x53C2;&#x6570;&#xFF0C;&#x5141;&#x8BB8;ip&#x8F6C;&#x53D1;&#xFF0C;CentOS7&#x662F;&#x5728;<code>vi /usr/lib/sysctl.d/00-system.conf</code> &#x8FD9;&#x91CC;&#x9762;&#x4FEE;&#x6539;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.ip_forward=1</span><br></pre></td></tr></table></figure>

<p>&#x901A;&#x8FC7; <code>sysctl -p</code> &#x67E5;&#x770B;&#x4FEE;&#x6539;&#x7ED3;&#x679C;</p>
<h3 id="&#x81EA;&#x5B9A;&#x4E49;NAT&#x7F51;&#x7EDC;"><a href="#&#x81EA;&#x5B9A;&#x4E49;NAT&#x7F51;&#x7EDC;" class="headerlink" title="&#x81EA;&#x5B9A;&#x4E49;NAT&#x7F51;&#x7EDC;"></a>&#x81EA;&#x5B9A;&#x4E49;NAT&#x7F51;&#x7EDC;</h3><p>&#x521B;&#x5EFA;&#x540D;&#x4E3A;<code>management</code>&#x7684;NAT&#x7F51;&#x7EDC;&#xFF0C;<code>vi  /usr/share/libvirt/networks/management.xml</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">network</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>management<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bridge</span> <span class="attr">name</span>=<span class="string">&quot;virbr1&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">forward</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ip</span> <span class="attr">address</span>=<span class="string">&quot;192.168.123.1&quot;</span> <span class="attr">netmask</span>=<span class="string">&quot;255.255.255.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dhcp</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">range</span> <span class="attr">start</span>=<span class="string">&quot;192.168.123.2&quot;</span> <span class="attr">end</span>=<span class="string">&quot;192.168.123.254&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dhcp</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">network</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&#x542F;&#x7528;&#x65B0;&#x5EFA;&#x7684;NAT&#x7F51;&#x7EDC;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">virsh net-define /usr/share/libvirt/networks/management.xml</span><br><span class="line">virsh net-start management</span><br><span class="line">virsh net-autostart management</span><br></pre></td></tr></table></figure>

<p>&#x9A8C;&#x8BC1;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">brctl show</span><br><span class="line"><span class="comment">#bridge name	bridge id		STP enabled	interfaces</span></span><br><span class="line"><span class="comment">#br0		8000.0026b94213ce	no		em1</span></span><br><span class="line"><span class="comment">#virbr0		8000.5254005d08e8	yes		virbr0-nic</span></span><br><span class="line">							vnet0</span><br><span class="line"><span class="comment">#virbr1		8000.5254006cc02d	yes		virbr1-nic</span></span><br><span class="line"></span><br><span class="line">virsh net-list --all</span><br><span class="line"><span class="comment">#  Name                 State      Autostart     Persistent</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------</span></span><br><span class="line"><span class="comment">#  default              active     no            no</span></span><br><span class="line"><span class="comment">#  management           active     yes           yes</span></span><br></pre></td></tr></table></figure>

<h3 id="&#x9000;&#x51FA;&#x865A;&#x62DF;&#x673A;"><a href="#&#x9000;&#x51FA;&#x865A;&#x62DF;&#x673A;" class="headerlink" title="&#x9000;&#x51FA;&#x865A;&#x62DF;&#x673A;"></a>&#x9000;&#x51FA;&#x865A;&#x62DF;&#x673A;</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exit</span> <span class="comment"># &#x9000;&#x51FA;&#x7CFB;&#x7EDF;&#x5230;&#x767B;&#x5F55;&#x754C;&#x9762;</span></span><br><span class="line"></span><br><span class="line">Ctrl+5 <span class="comment"># &#x4ECE;&#x865A;&#x62DF;&#x673A;&#x767B;&#x5F55;&#x9875;&#x9762;&#xFF0C;&#x9000;&#x51FA;&#x5230;&#x5BBF;&#x4E3B;&#x673A;&#x547D;&#x4EE4;&#x884C;&#x9875;&#x9762;</span></span><br><span class="line">Ctrl+] <span class="comment"># &#x6216;&#x8005;&#x4E0B;&#x9762;</span></span><br></pre></td></tr></table></figure>

<h2 id="&#x4FEE;&#x6539;&#x865A;&#x62DF;&#x673A;&#x914D;&#x7F6E;&#x4FE1;&#x606F;"><a href="#&#x4FEE;&#x6539;&#x865A;&#x62DF;&#x673A;&#x914D;&#x7F6E;&#x4FE1;&#x606F;" class="headerlink" title="&#x4FEE;&#x6539;&#x865A;&#x62DF;&#x673A;&#x914D;&#x7F6E;&#x4FE1;&#x606F;"></a>&#x4FEE;&#x6539;&#x865A;&#x62DF;&#x673A;&#x914D;&#x7F6E;&#x4FE1;&#x606F;</h2><p>&#x76F4;&#x63A5;&#x901A;&#x8FC7;vim&#x547D;&#x4EE4;&#x4FEE;&#x6539;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim  /etc/libvirt/qemu/vm1.xml</span><br></pre></td></tr></table></figure>

<p>&#x901A;&#x8FC7;virsh&#x547D;&#x4EE4;&#x4FEE;&#x6539;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virsh edit vm1</span><br></pre></td></tr></table></figure>

<h2 id="&#x514B;&#x9686;&#x865A;&#x62DF;&#x673A;"><a href="#&#x514B;&#x9686;&#x865A;&#x62DF;&#x673A;" class="headerlink" title="&#x514B;&#x9686;&#x865A;&#x62DF;&#x673A;"></a>&#x514B;&#x9686;&#x865A;&#x62DF;&#x673A;</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x6682;&#x505C;&#x539F;&#x59CB;&#x865A;&#x62DF;&#x673A;</span></span><br><span class="line">virsh shutdown vm1</span><br><span class="line">virt-clone -o vm1 -n vm2 -f /opt/vms/vm2.qcow2</span><br></pre></td></tr></table></figure>

<p><code>virt-clone</code> &#x53C2;&#x6570;&#x4ECB;&#x7ECD;</p>
<ul>
<li><code>--version</code> &#x67E5;&#x770B;&#x7248;&#x672C;&#x3002;</li>
<li><code>-h&#xFF0C;--help</code> &#x67E5;&#x770B;&#x5E2E;&#x52A9;&#x4FE1;&#x606F;&#x3002;</li>
<li><code>--connect=URI</code> &#x8FDE;&#x63A5;&#x5230;&#x865A;&#x62DF;&#x673A;&#x7BA1;&#x7406;&#x7A0B;&#x5E8F; libvirt &#x7684;URI&#x3002;</li>
<li><code>-o &#x539F;&#x59CB;&#x865A;&#x62DF;&#x673A;&#x540D;&#x79F0;</code> &#x539F;&#x59CB;&#x865A;&#x62DF;&#x673A;&#x540D;&#x79F0;&#xFF0C;&#x5FC5;&#x987B;&#x4E3A;&#x5173;&#x95ED;&#x6216;&#x8005;&#x6682;&#x505C;&#x72B6;&#x6001;&#x3002;</li>
<li><code>-n &#x65B0;&#x865A;&#x62DF;&#x673A;&#x540D;&#x79F0;</code> &#x2013;name &#x65B0;&#x865A;&#x62DF;&#x673A;&#x540D;&#x79F0;&#x3002;</li>
<li><code>--auto-clone</code> &#x4ECE;&#x539F;&#x6765;&#x7684;&#x865A;&#x62DF;&#x673A;&#x914D;&#x7F6E;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x514B;&#x9686;&#x540D;&#x79F0;&#x548C;&#x5B58;&#x50A8;&#x8DEF;&#x5F84;&#x3002;</li>
<li><code>-u NEW_UUID, --uuid=NEW_UUID</code> &#x514B;&#x9686;&#x865A;&#x62DF;&#x673A;&#x7684;&#x65B0;&#x7684;UUID&#xFF0C;&#x9ED8;&#x8BA4;&#x503C;&#x662F;&#x4E00;&#x4E2A;&#x968F;&#x673A;&#x751F;&#x6210;&#x7684;UUID&#x3002;</li>
<li><code>-m NEW_MAC, --mac=NEW_MAC</code> &#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x65B0;&#x7684;mac&#x5730;&#x5740;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;&#x968F;&#x673A;&#x751F;&#x6210; MAC&#x3002;</li>
<li><code>-f NEW_DISKFILE, --file=NEW_DISKFILE</code> &#x4E3A;&#x65B0;&#x5BA2;&#x6237;&#x673A;&#x4F7F;&#x7528;&#x65B0;&#x7684;&#x78C1;&#x76D8;&#x955C;&#x50CF;&#x6587;&#x4EF6;&#x5730;&#x5740;&#x3002;</li>
<li><code>--force-copy=TARGET</code> &#x5F3A;&#x5236;&#x590D;&#x5236;&#x8BBE;&#x5907;&#x3002;</li>
<li><code>--nonsparse</code> &#x4E0D;&#x4F7F;&#x7528;&#x7A00;&#x758F;&#x6587;&#x4EF6;&#x590D;&#x5236;&#x78C1;&#x76D8;&#x6620;&#x50CF;&#x3002;</li>
</ul>
<h2 id="&#x901A;&#x8FC7;&#x955C;&#x50CF;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;"><a href="#&#x901A;&#x8FC7;&#x955C;&#x50CF;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;" class="headerlink" title="&#x901A;&#x8FC7;&#x955C;&#x50CF;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;"></a>&#x901A;&#x8FC7;&#x955C;&#x50CF;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;</h2><p>&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x955C;&#x50CF;&#x6587;&#x4EF6;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x590D;&#x5236;&#x7B2C;&#x4E00;&#x6B21;&#x5B89;&#x88C5;&#x7684;&#x5E72;&#x51C0;&#x7CFB;&#x7EDF;&#x955C;&#x50CF;&#xFF0C;&#x4F5C;&#x4E3A;&#x57FA;&#x7840;&#x955C;&#x50CF;&#x6587;&#x4EF6;&#xFF0C;</span></span><br><span class="line"><span class="comment"># &#x540E;&#x9762;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x57FA;&#x7840;&#x955C;&#x50CF;</span></span><br><span class="line">cp /opt/vms/vm1.qcow2 /opt/vms/base.qcow2</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x4F7F;&#x7528;&#x57FA;&#x7840;&#x955C;&#x50CF;&#x6587;&#x4EF6;&#xFF0C;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x865A;&#x62DF;&#x673A;&#x955C;&#x50CF;</span></span><br><span class="line">cp /opt/vms/base.qcow2 /opt/vms/vm2.qcow2</span><br></pre></td></tr></table></figure>

<p>&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x673A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x590D;&#x5236;&#x7B2C;&#x4E00;&#x6B21;&#x5B89;&#x88C5;&#x7684;&#x5E72;&#x51C0;&#x7CFB;&#x7EDF;&#x955C;&#x50CF;&#xFF0C;&#x4F5C;&#x4E3A;&#x57FA;&#x7840;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;</span></span><br><span class="line">virsh dumpxml vm1 &gt; /opt/vms/base.xml</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x4F7F;&#x7528;&#x57FA;&#x7840;&#x865A;&#x62DF;&#x673A;&#x955C;&#x50CF;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x865A;&#x62DF;&#x673A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</span></span><br><span class="line">cp /opt/vms/base.xml /opt/vms/vm2.xml</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x7F16;&#x8F91;&#x65B0;&#x865A;&#x62DF;&#x673A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</span></span><br><span class="line">vi /opt/vms/vm2.xml</span><br></pre></td></tr></table></figure>

<p>&#x4E3B;&#x8981;&#x662F;&#x4FEE;&#x6539;&#x865A;&#x62DF;&#x673A;&#x6587;&#x4EF6;&#x540D;&#xFF0C;UUID&#xFF0C;&#x955C;&#x50CF;&#x5730;&#x5740;&#x548C;&#x7F51;&#x5361;&#x5730;&#x5740;&#xFF0C;&#x5176;&#x4E2D; UUID &#x5728; Linux &#x4E0B;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>uuidgen</code> &#x547D;&#x4EE4;&#x751F;&#x6210;</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">domain</span> <span class="attr">type</span>=<span class="string">&apos;kvm&apos;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>vm2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">uuid</span>&gt;</span>1e86167a-33a9-4ce8-929e-58013fbf9122<span class="tag">&lt;/<span class="name">uuid</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">devices</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">disk</span> <span class="attr">type</span>=<span class="string">&apos;file&apos;</span> <span class="attr">device</span>=<span class="string">&apos;disk&apos;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">source</span> <span class="attr">file</span>=<span class="string">&apos;/opt/vms/vm2.img&apos;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">disk</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">interface</span> <span class="attr">type</span>=<span class="string">&apos;bridge&apos;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mac</span> <span class="attr">address</span>=<span class="string">&apos;00:00:00:00:00:04&apos;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">interface</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">devices</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">domain</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">virsh define /opt/vms/vm2.xml</span><br><span class="line"><span class="comment"># Domain vm2 defined from /opt/vms/vm2.xml</span></span><br></pre></td></tr></table></figure>

<h2 id="&#x52A8;&#x6001;&#x66F4;&#x6539;cpu&#x6570;&#x91CF;&#x548C;&#x5185;&#x5B58;&#x5927;&#x5C0F;"><a href="#&#x52A8;&#x6001;&#x66F4;&#x6539;cpu&#x6570;&#x91CF;&#x548C;&#x5185;&#x5B58;&#x5927;&#x5C0F;" class="headerlink" title="&#x52A8;&#x6001;&#x66F4;&#x6539;cpu&#x6570;&#x91CF;&#x548C;&#x5185;&#x5B58;&#x5927;&#x5C0F;"></a>&#x52A8;&#x6001;&#x66F4;&#x6539;cpu&#x6570;&#x91CF;&#x548C;&#x5185;&#x5B58;&#x5927;&#x5C0F;</h2><p>&#x52A8;&#x6001;&#x8C03;&#x6574;&#xFF0C;&#x5982;&#x679C;&#x8D85;&#x8FC7;&#x7ED9;&#x865A;&#x62DF;&#x673A;&#x5206;&#x914D;&#x7684;&#x6700;&#x5927;&#x5185;&#x5B58;&#xFF0C;&#x9700;&#x8981;&#x91CD;&#x542F;&#x865A;&#x62DF;&#x673A;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">virsh list --all</span><br><span class="line"><span class="comment">#  Id    &#x540D;&#x79F0;                         &#x72B6;&#x6001;</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------</span></span><br><span class="line"><span class="comment">#  2     vm2                     running</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x66F4;&#x6539;CPU</span></span><br><span class="line">virsh setvcpus vm2 --maximum 4 --config</span><br><span class="line"><span class="comment"># &#x66F4;&#x6539;&#x5185;&#x5B58;</span></span><br><span class="line">virsh setmaxmem vm2 1048576 --config</span><br><span class="line"><span class="comment"># &#x67E5;&#x770B;&#x4FE1;&#x606F;</span></span><br><span class="line">virsh dominfo vm2</span><br></pre></td></tr></table></figure>

<h2 id="&#x6302;&#x8F7D;&#x65B0;&#x78C1;&#x76D8;"><a href="#&#x6302;&#x8F7D;&#x65B0;&#x78C1;&#x76D8;" class="headerlink" title="&#x6302;&#x8F7D;&#x65B0;&#x78C1;&#x76D8;"></a>&#x6302;&#x8F7D;&#x65B0;&#x78C1;&#x76D8;</h2><h3 id="&#x521B;&#x5EFA;&#x78C1;&#x76D8;"><a href="#&#x521B;&#x5EFA;&#x78C1;&#x76D8;" class="headerlink" title="&#x521B;&#x5EFA;&#x78C1;&#x76D8;"></a>&#x521B;&#x5EFA;&#x78C1;&#x76D8;</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qemu-img create -f qcow2 /opt/vms/vm-bridge-disk2.img 100G</span><br></pre></td></tr></table></figure>

<h3 id="&#x67E5;&#x770B;&#x78C1;&#x76D8;&#x4FE1;&#x606F;"><a href="#&#x67E5;&#x770B;&#x78C1;&#x76D8;&#x4FE1;&#x606F;" class="headerlink" title="&#x67E5;&#x770B;&#x78C1;&#x76D8;&#x4FE1;&#x606F;"></a>&#x67E5;&#x770B;&#x78C1;&#x76D8;&#x4FE1;&#x606F;</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">qemu-img info vm-bridge-disk.img</span><br><span class="line"></span><br><span class="line">image: vm-bridge-disk.img</span><br><span class="line">file format: qcow2</span><br><span class="line">virtual size: 100G (107374182400 bytes)</span><br><span class="line">disk size: 196K</span><br><span class="line">cluster_size: 65536</span><br><span class="line">Format specific information:</span><br><span class="line">    compat: 1.1</span><br><span class="line">    lazy refcounts: <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h3 id="&#x6302;&#x8F7D;&#x78C1;&#x76D8;"><a href="#&#x6302;&#x8F7D;&#x78C1;&#x76D8;" class="headerlink" title="&#x6302;&#x8F7D;&#x78C1;&#x76D8;"></a>&#x6302;&#x8F7D;&#x78C1;&#x76D8;</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virsh attach-disk vm-bridge /opt/vms/vm-bridge-disk.img vdb --subdriver=qcow2</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x9700;&#x8981;&#x4F7F;&#x7528;&#x2013;subdriver&#x6307;&#x5B9A;&#x78C1;&#x76D8;&#x6587;&#x4EF6;&#x683C;&#x5F0F;&#xFF08;&#x9ED8;&#x8BA4;&#x4E3A;raw&#xFF09;&#xFF0C;&#x5426;&#x5219;&#x7CFB;&#x7EDF;&#x5185;&#x8BC6;&#x522B;&#x7684;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;0</p>
</blockquote>
<p>&#x7CFB;&#x7EDF;&#x91CC;&#x67E5;&#x770B;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">fdisk -l</span><br><span class="line"></span><br><span class="line">Disk /dev/vda: 42.9 GB, 42949672960 bytes, 83886080 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label <span class="built_in">type</span>: dos</span><br><span class="line">Disk identifier: 0x000ac494</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/vda1   *        2048     2099199     1048576   83  Linux</span><br><span class="line">/dev/vda2         2099200    83886079    40893440   8e  Linux LVM</span><br><span class="line"></span><br><span class="line">Disk /dev/mapper/centos-root: 37.7 GB, 37706792960 bytes, 73646080 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line"></span><br><span class="line">Disk /dev/mapper/centos-swap: 4160 MB, 4160749568 bytes, 8126464 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line"></span><br><span class="line">Disk /dev/vdb: 107.4 GB, 107374182400 bytes, 209715200 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br></pre></td></tr></table></figure>

<h2 id="&#x6269;&#x5BB9;&#x78C1;&#x76D8;"><a href="#&#x6269;&#x5BB9;&#x78C1;&#x76D8;" class="headerlink" title="&#x6269;&#x5BB9;&#x78C1;&#x76D8;"></a>&#x6269;&#x5BB9;&#x78C1;&#x76D8;</h2><h3 id="&#x78C1;&#x76D8;&#x4FE1;&#x606F;"><a href="#&#x78C1;&#x76D8;&#x4FE1;&#x606F;" class="headerlink" title="&#x78C1;&#x76D8;&#x4FE1;&#x606F;"></a>&#x78C1;&#x76D8;&#x4FE1;&#x606F;</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /opt/vms</span><br></pre></td></tr></table></figure>

<p>&#x67E5;&#x770B;&#x955C;&#x50CF;&#x4FE1;&#x606F;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">virt-filesystems --long --parts --blkdevs -h -a vm2.qcow2</span><br><span class="line"></span><br><span class="line"><span class="comment"># Name       Type       Size  Parent</span></span><br><span class="line"><span class="comment"># /dev/sda1  partition  200M  /dev/sda</span></span><br><span class="line"><span class="comment"># /dev/sda2  partition  9.8G  /dev/sda</span></span><br><span class="line"><span class="comment"># /dev/sda   device     10G   -</span></span><br><span class="line"></span><br><span class="line">qemu-img info vm2.qcow2</span><br><span class="line"></span><br><span class="line"><span class="comment"># image: vm2.qcow2</span></span><br><span class="line"><span class="comment"># file format: qcow2</span></span><br><span class="line"><span class="comment"># virtual size: 140G (150323855360 bytes)</span></span><br><span class="line"><span class="comment"># disk size: 33G</span></span><br><span class="line"><span class="comment"># cluster_size: 65536</span></span><br><span class="line"><span class="comment"># Format specific information:</span></span><br><span class="line"><span class="comment">#     compat: 1.1</span></span><br><span class="line"><span class="comment">#     lazy refcounts: true</span></span><br></pre></td></tr></table></figure>

<p>&#x7ED9;&#x865A;&#x62DF;&#x673A;&#x955C;&#x50CF;&#x6DFB;&#x52A0;<code>200G</code>&#x5927;&#x5C0F;&#xFF0C;&#x6CE8;&#x610F;&#x9700;&#x8981;&#x505C;&#x6B62;<code>vm2</code>&#x865A;&#x62DF;&#x673A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">qemu-img resize vm2.qcow2 +200G</span><br><span class="line"><span class="comment"># Image resized.</span></span><br></pre></td></tr></table></figure>

<p>&#x9996;&#x5148;&#xFF0C;&#x6211;&#x4EEC;&#x5236;&#x4F5C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#x7684;&#x78C1;&#x76D8;&#x7684;&#x5907;&#x4EFD;&#x526F;&#x672C;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp vm2.qcow2 vm2-orig.qcow2</span><br></pre></td></tr></table></figure>

<p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x8FD0;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x6765;&#x589E;&#x52A0; <code>/dev/sda</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virt-resize --expand /dev/sda1 vm2-orig.qcow2 vm2.qcow2</span><br></pre></td></tr></table></figure>

<p>&#x67E5;&#x770B;&#x955C;&#x50CF;&#x4FE1;&#x606F;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">qemu-img info vm2.qcow2</span><br><span class="line"><span class="comment"># image: vm2.qcow2</span></span><br><span class="line"><span class="comment"># file format: qcow2</span></span><br><span class="line"><span class="comment"># virtual size: 140G (150323855360 bytes)</span></span><br><span class="line"><span class="comment"># disk size: 33G</span></span><br><span class="line"><span class="comment"># cluster_size: 65536</span></span><br><span class="line"><span class="comment"># Format specific information:</span></span><br><span class="line"><span class="comment">#     compat: 1.1</span></span><br><span class="line"><span class="comment">#     lazy refcounts: true</span></span><br></pre></td></tr></table></figure>

<p>&#x8FDB;&#x5165;&#x865A;&#x62DF;&#x673A;`virsh console vm2&#x67E5;&#x770B;&#x4FE1;&#x606F;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vgdisplay <span class="comment"># &#x663E;&#x793A;&#x5377;&#x7EC4;&#x5927;&#x5C0F;</span></span><br><span class="line">lvdisplay <span class="comment"># &#x663E;&#x793A;&#x903B;&#x8F91;&#x5377;&#x5927;&#x5C0F;</span></span><br></pre></td></tr></table></figure>

<p>&#x5377;&#x7EC4;&#x5927;&#x5C0F;&#x5DF2;&#x589E;&#x52A0;&#xFF0C;&#x4E0B;&#x9762;&#x9700;&#x8981;&#x5206;&#x914D;&#x5BB9;&#x91CF;&#x7ED9;&#x903B;&#x8F91;&#x5377;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lvextend -L +60G /dev/centos/root</span><br></pre></td></tr></table></figure>

<p>&#x8FD8;&#x6709;&#x6700;&#x540E;&#x4E00;&#x6B65;&#xFF0C;&#x5206;&#x914D;&#x597D;&#x4E86;&#x9700;&#x8981;&#x505A;&#x7CFB;&#x7EDF;&#x8C03;&#x6574;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ext &#x7CFB;&#x7EDF;&#x683C;&#x5F0F;&#x4F7F;&#x7528;&#xFF1A;</span></span><br><span class="line">resize2fs /dev/centos/root</span><br><span class="line"><span class="comment"># xfs &#x7CFB;&#x7EDF;&#x683C;&#x5F0F;&#x4F7F;&#x7528;&#x4E0B;&#x9762;&#x547D;&#x4EE4;</span></span><br><span class="line">xfs_growfs /dev/centos/root</span><br></pre></td></tr></table></figure>

<h2 id="&#x5E38;&#x7528;&#x547D;&#x4EE4;&#x8BF4;&#x660E;"><a href="#&#x5E38;&#x7528;&#x547D;&#x4EE4;&#x8BF4;&#x660E;" class="headerlink" title="&#x5E38;&#x7528;&#x547D;&#x4EE4;&#x8BF4;&#x660E;"></a>&#x5E38;&#x7528;&#x547D;&#x4EE4;&#x8BF4;&#x660E;</h2><h3 id="virt-install"><a href="#virt-install" class="headerlink" title="virt-install"></a>virt-install</h3><p>&#x5E38;&#x7528;&#x53C2;&#x6570;&#x8BF4;&#x660E;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#x2013;name&#x6307;&#x5B9A;&#x865A;&#x62DF;&#x673A;&#x540D;&#x79F0;</span><br><span class="line">&#x2013;memory&#x5206;&#x914D;&#x5185;&#x5B58;&#x5927;&#x5C0F;&#x3002;</span><br><span class="line">&#x2013;vcpus&#x5206;&#x914D;CPU&#x6838;&#x5FC3;&#x6570;&#xFF0C;&#x6700;&#x5927;&#x4E0E;&#x5B9E;&#x4F53;&#x673A;CPU&#x6838;&#x5FC3;&#x6570;&#x76F8;&#x540C;</span><br><span class="line">&#x2013;disk&#x6307;&#x5B9A;&#x865A;&#x62DF;&#x673A;&#x955C;&#x50CF;&#xFF0C;size&#x6307;&#x5B9A;&#x5206;&#x914D;&#x5927;&#x5C0F;&#x5355;&#x4F4D;&#x4E3A;G&#x3002;</span><br><span class="line">&#x2013;network&#x7F51;&#x7EDC;&#x7C7B;&#x578B;&#xFF0C;&#x6B64;&#x5904;&#x7528;&#x7684;&#x662F;&#x9ED8;&#x8BA4;&#xFF0C;&#x4E00;&#x822C;&#x7528;&#x7684;&#x5E94;&#x8BE5;&#x662F;bridge&#x6865;&#x63A5;&#x3002;</span><br><span class="line">&#x2013;accelerate&#x52A0;&#x901F;</span><br><span class="line">&#x2013;cdrom&#x6307;&#x5B9A;&#x5B89;&#x88C5;&#x955C;&#x50CF;iso</span><br><span class="line">&#x2013;vnc&#x542F;&#x7528;VNC&#x8FDC;&#x7A0B;&#x7BA1;&#x7406;&#xFF0C;&#x4E00;&#x822C;&#x5B89;&#x88C5;&#x7CFB;&#x7EDF;&#x90FD;&#x8981;&#x542F;&#x7528;&#x3002;</span><br><span class="line">&#x2013;vncport&#x6307;&#x5B9A;VNC&#x76D1;&#x63A7;&#x7AEF;&#x53E3;&#xFF0C;&#x9ED8;&#x8BA4;&#x7AEF;&#x53E3;&#x4E3A;5900&#xFF0C;&#x7AEF;&#x53E3;&#x4E0D;&#x80FD;&#x91CD;&#x590D;&#x3002;</span><br><span class="line">&#x2013;vnclisten&#x6307;&#x5B9A;VNC&#x7ED1;&#x5B9A;IP&#xFF0C;&#x9ED8;&#x8BA4;&#x7ED1;&#x5B9A;127.0.0.1&#xFF0C;&#x8FD9;&#x91CC;&#x6539;&#x4E3A;0.0.0.0&#x3002;</span><br><span class="line">&#x2013;os-type=linux,windows</span><br><span class="line">&#x2013;os-variant=rhel6</span><br><span class="line"></span><br><span class="line">--name      &#x6307;&#x5B9A;&#x865A;&#x62DF;&#x673A;&#x540D;&#x79F0;</span><br><span class="line">--ram       &#x865A;&#x62DF;&#x673A;&#x5185;&#x5B58;&#x5927;&#x5C0F;&#xFF0C;&#x4EE5; MB &#x4E3A;&#x5355;&#x4F4D;</span><br><span class="line">--vcpus     &#x5206;&#x914D;CPU&#x6838;&#x5FC3;&#x6570;&#xFF0C;&#x6700;&#x5927;&#x4E0E;&#x5B9E;&#x4F53;&#x673A;CPU&#x6838;&#x5FC3;&#x6570;&#x76F8;&#x540C;</span><br><span class="line">&#x2013;-vnc       &#x542F;&#x7528;VNC&#x8FDC;&#x7A0B;&#x7BA1;&#x7406;&#xFF0C;&#x4E00;&#x822C;&#x5B89;&#x88C5;&#x7CFB;&#x7EDF;&#x90FD;&#x8981;&#x542F;&#x7528;&#x3002;</span><br><span class="line">&#x2013;-vncport   &#x6307;&#x5B9A;VNC&#x76D1;&#x63A7;&#x7AEF;&#x53E3;&#xFF0C;&#x9ED8;&#x8BA4;&#x7AEF;&#x53E3;&#x4E3A;5900&#xFF0C;&#x7AEF;&#x53E3;&#x4E0D;&#x80FD;&#x91CD;&#x590D;&#x3002;</span><br><span class="line">&#x2013;-vnclisten  &#x6307;&#x5B9A;VNC&#x7ED1;&#x5B9A;IP&#xFF0C;&#x9ED8;&#x8BA4;&#x7ED1;&#x5B9A;127.0.0.1&#xFF0C;&#x8FD9;&#x91CC;&#x6539;&#x4E3A;0.0.0.0&#x3002;</span><br><span class="line">--network   &#x865A;&#x62DF;&#x673A;&#x7F51;&#x7EDC;&#x914D;&#x7F6E;</span><br><span class="line">  <span class="comment"># &#x5176;&#x4E2D;&#x5B50;&#x9009;&#x9879;&#xFF0C;bridge=br0 &#x6307;&#x5B9A;&#x6865;&#x63A5;&#x7F51;&#x5361;&#x7684;&#x540D;&#x79F0;&#x3002;</span></span><br><span class="line"></span><br><span class="line">&#x2013;os-type=linux,windows</span><br><span class="line">&#x2013;os-variant=rhel7.2</span><br><span class="line"></span><br><span class="line">--disk &#x6307;&#x5B9A;&#x865A;&#x62DF;&#x673A;&#x7684;&#x78C1;&#x76D8;&#x5B58;&#x50A8;&#x4F4D;&#x7F6E;</span><br><span class="line">  <span class="comment"># size&#xFF0C;&#x521D;&#x59CB;&#x78C1;&#x76D8;&#x5927;&#x5C0F;&#xFF0C;&#x4EE5; GB &#x4E3A;&#x5355;&#x4F4D;&#x3002;</span></span><br><span class="line"></span><br><span class="line">--location &#x6307;&#x5B9A;&#x5B89;&#x88C5;&#x4ECB;&#x8D28;&#x8DEF;&#x5F84;&#xFF0C;&#x5982;&#x5149;&#x76D8;&#x955C;&#x50CF;&#x7684;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x3002;</span><br><span class="line">--graphics &#x56FE;&#x5F62;&#x5316;&#x663E;&#x793A;&#x914D;&#x7F6E;</span><br><span class="line">  <span class="comment"># &#x5168;&#x65B0;&#x5B89;&#x88C5;&#x865A;&#x62DF;&#x673A;&#x8FC7;&#x7A0B;&#x4E2D;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x5F88;&#x591A;&#x4EA4;&#x4E92;&#x64CD;&#x4F5C;&#xFF0C;&#x6BD4;&#x5982;&#x8BBE;&#x7F6E;&#x8BED;&#x8A00;&#xFF0C;&#x521D;&#x59CB;&#x5316; root &#x5BC6;&#x7801;&#x7B49;&#x7B49;&#x3002;</span></span><br><span class="line">  <span class="comment"># graphics &#x9009;&#x9879;&#x7684;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x914D;&#x7F6E;&#x56FE;&#x5F62;&#x5316;&#x7684;&#x4EA4;&#x4E92;&#x65B9;&#x5F0F;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; vnc&#xFF08;&#x4E00;&#x79CD;&#x8FDC;&#x7A0B;&#x684C;&#x9762;&#x8F6F;&#x4EF6;&#xFF09;&#x8FDB;&#x884C;&#x94FE;&#x63A5;&#x3002;</span></span><br><span class="line">  <span class="comment"># &#x6211;&#x4EEC;&#x8FD9;&#x5217;&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#x884C;&#x7684;&#x65B9;&#x5F0F;&#x5B89;&#x88C5;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x8981;&#x8BBE;&#x7F6E;&#x4E3A; none&#xFF0C;&#x4F46;&#x8981;&#x901A;&#x8FC7; --extra-args &#x9009;&#x9879;&#x6307;&#x5B9A;&#x7EC8;&#x7AEF;&#x4FE1;&#x606F;&#xFF0C;</span></span><br><span class="line">  <span class="comment"># &#x8FD9;&#x6837;&#x624D;&#x80FD;&#x5C06;&#x5B89;&#x88C5;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x4EA4;&#x4E92;&#x4FE1;&#x606F;&#x8F93;&#x51FA;&#x5230;&#x5F53;&#x524D;&#x63A7;&#x5236;&#x53F0;&#x3002;</span></span><br><span class="line">--extra-args &#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;&#x5B89;&#x88C5;&#x65B9;&#x5F0F;&#x8BBE;&#x7F6E;&#x4E0D;&#x540C;&#x7684;&#x989D;&#x5916;&#x9009;&#x9879;</span><br></pre></td></tr></table></figure>

<h3 id="virsh"><a href="#virsh" class="headerlink" title="virsh"></a>virsh</h3><p>&#x57FA;&#x7840;&#x547D;&#x4EE4;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">virsh list --all           <span class="comment"># &#x67E5;&#x770B;&#x6240;&#x6709;&#x8FD0;&#x884C;&#x548C;&#x6CA1;&#x6709;&#x8FD0;&#x884C;&#x7684;&#x865A;&#x62DF;&#x673A;</span></span><br><span class="line">virsh list                 <span class="comment"># &#x67E5;&#x770B;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x865A;&#x62DF;&#x673A;</span></span><br><span class="line">virsh dumpxml vm-name      <span class="comment"># &#x67E5;&#x770B;kvm&#x865A;&#x62DF;&#x673A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</span></span><br><span class="line">virsh start vm-name        <span class="comment"># &#x542F;&#x52A8;kvm&#x865A;&#x62DF;&#x673A;</span></span><br><span class="line">virsh shutdown vm-name     <span class="comment"># &#x6B63;&#x5E38;&#x5173;&#x673A;</span></span><br><span class="line"></span><br><span class="line">virsh destroy vm-name      <span class="comment"># &#x975E;&#x6B63;&#x5E38;&#x5173;&#x673A;&#xFF0C;&#x5F3A;&#x5236;&#x5173;&#x95ED;&#x865A;&#x62DF;&#x673A;&#xFF08;&#x76F8;&#x5F53;&#x4E8E;&#x7269;&#x7406;&#x673A;&#x76F4;&#x63A5;&#x62D4;&#x6389;&#x7535;&#x6E90;&#xFF09;</span></span><br><span class="line">virsh undefine vm-name     <span class="comment"># &#x5220;&#x9664;vm&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</span></span><br><span class="line"></span><br><span class="line">ls /etc/libvirt/qemu</span><br><span class="line"><span class="comment"># &#x67E5;&#x770B;&#x5220;&#x9664;&#x7ED3;&#x679C;&#xFF0C;Centos-6.6&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x88AB;&#x5220;&#x9664;&#xFF0C;&#x4F46;&#x78C1;&#x76D8;&#x6587;&#x4EF6;&#x4E0D;&#x4F1A;&#x88AB;&#x5220;&#x9664;</span></span><br><span class="line"></span><br><span class="line">virsh define file-name.xml <span class="comment"># &#x6839;&#x636E;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5B9A;&#x4E49;&#x865A;&#x62DF;&#x673A;</span></span><br><span class="line">virsh <span class="built_in">suspend</span> vm-name      <span class="comment"># &#x6302;&#x8D77;&#xFF0C;&#x7EC8;&#x6B62;</span></span><br><span class="line">virsh resumed vm-name      <span class="comment"># &#x6062;&#x590D;&#x88AB;&#x6302;&#x8D77;&#x7684;&#x865A;&#x62DF;&#x673A;</span></span><br><span class="line">virsh autostart vm-name    <span class="comment"># &#x5F00;&#x673A;&#x81EA;&#x542F;&#x52A8;vm</span></span><br><span class="line">virsh console &lt;&#x865A;&#x62DF;&#x673A;&#x540D;&#x79F0;&gt;   <span class="comment"># &#x8FDE;&#x63A5;&#x865A;&#x62DF;&#x673A;</span></span><br></pre></td></tr></table></figure>

<h2 id="&#x53C2;&#x8003;&#x6587;&#x7AE0;"><a href="#&#x53C2;&#x8003;&#x6587;&#x7AE0;" class="headerlink" title="&#x53C2;&#x8003;&#x6587;&#x7AE0;"></a>&#x53C2;&#x8003;&#x6587;&#x7AE0;</h2><ul>
<li><a href="https://www.linux-kvm.org/page/Main_Page" target="_blank" rel="noopener">KVM&#x5B98;&#x65B9;&#x7F51;&#x7AD9;</a></li>
<li><a href="http://www.cnblogs.com/ilanni/p/3878151.html" target="_blank" rel="noopener">KVM&#x865A;&#x62DF;&#x673A;Linux&#x7CFB;&#x7EDF;&#x589E;&#x52A0;&#x786C;&#x76D8;</a></li>
<li><a href="https://www.ibm.com/support/knowledgecenter/zh/linuxonibm/liaat/liaatvirtinstalloptions.htm" target="_blank" rel="noopener">virt-install &#x547D;&#x4EE4;&#x53C2;&#x6570;&#x8BE6;&#x89E3;</a></li>
<li><a href="https://raymii.org/s/articles/virt-install_introduction_and_copy_paste_distro_install_commands.html" target="_blank" rel="noopener">&#x4F7F;&#x7528;virt-install&#x5B89;&#x88C5;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x53D1;&#x884C;&#x7248;&#x5B89;&#x88C5;&#x4EE3;&#x7801;&#x76F4;&#x63A5;&#x590D;&#x5236;&#x8FD0;&#x884C;</a></li>
<li><a href="http://blog.oneiroi.co.uk/linux/kvm/virt-resize/RHEL/LVM/kvm-linux-expanding-a-lvm-guest-file-system-using-virt-resize/" target="_blank" rel="noopener">KVM Linux - Expanding a Guest LVM File System Using Virt-resize</a></li>
</ul>

    </div>

    
    
    
      

        
      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/kvm/" rel="tag"><i class="fa fa-tag"></i> kvm</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2019/09/12/Prometheus格式化告警数值/" rel="next" title="Prometheus格式化告警数值">
                  <i class="fa fa-chevron-left"></i> Prometheus格式化告警数值
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          
    
    <div class="comments" id="gitalk-container"></div>
  

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#检测服务器是否支持KVM"><span class="nav-number">1.</span> <span class="nav-text">检测服务器是否支持KVM</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装-KVM-环境"><span class="nav-number">2.</span> <span class="nav-text">安装 KVM 环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装虚拟机"><span class="nav-number">3.</span> <span class="nav-text">安装虚拟机</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#命令行配置系统"><span class="nav-number">3.1.</span> <span class="nav-text">命令行配置系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#连接虚拟机"><span class="nav-number">3.2.</span> <span class="nav-text">连接虚拟机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#虚拟机其它管理"><span class="nav-number">3.3.</span> <span class="nav-text">虚拟机其它管理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#端口转发"><span class="nav-number">4.</span> <span class="nav-text">端口转发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#公网访问虚拟机"><span class="nav-number">5.</span> <span class="nav-text">公网访问虚拟机</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置宿主机网络"><span class="nav-number">6.</span> <span class="nav-text">配置宿主机网络</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Bridge模式配置"><span class="nav-number">6.1.</span> <span class="nav-text">Bridge模式配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#安装Bridge模式的虚拟机"><span class="nav-number">6.1.1.</span> <span class="nav-text">安装Bridge模式的虚拟机</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NAT模式"><span class="nav-number">6.2.</span> <span class="nav-text">NAT模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义NAT网络"><span class="nav-number">6.3.</span> <span class="nav-text">自定义NAT网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#退出虚拟机"><span class="nav-number">6.4.</span> <span class="nav-text">退出虚拟机</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#修改虚拟机配置信息"><span class="nav-number">7.</span> <span class="nav-text">修改虚拟机配置信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#克隆虚拟机"><span class="nav-number">8.</span> <span class="nav-text">克隆虚拟机</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#通过镜像创建虚拟机"><span class="nav-number">9.</span> <span class="nav-text">通过镜像创建虚拟机</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#动态更改cpu数量和内存大小"><span class="nav-number">10.</span> <span class="nav-text">动态更改cpu数量和内存大小</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#挂载新磁盘"><span class="nav-number">11.</span> <span class="nav-text">挂载新磁盘</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建磁盘"><span class="nav-number">11.1.</span> <span class="nav-text">创建磁盘</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看磁盘信息"><span class="nav-number">11.2.</span> <span class="nav-text">查看磁盘信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#挂载磁盘"><span class="nav-number">11.3.</span> <span class="nav-text">挂载磁盘</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#扩容磁盘"><span class="nav-number">12.</span> <span class="nav-text">扩容磁盘</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#磁盘信息"><span class="nav-number">12.1.</span> <span class="nav-text">磁盘信息</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#常用命令说明"><span class="nav-number">13.</span> <span class="nav-text">常用命令说明</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#virt-install"><span class="nav-number">13.1.</span> <span class="nav-text">virt-install</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#virsh"><span class="nav-number">13.2.</span> <span class="nav-text">virsh</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考文章"><span class="nav-number">14.</span> <span class="nav-text">参考文章</span></a></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/avatar.jpg"
      alt="csz">
  <p class="site-author-name" itemprop="name">csz</p>
  <div class="site-description" itemprop="description"></div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">62</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        <span class="site-state-item-count">30</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/cszhi" title="GitHub &rarr; https://github.com/cszhi" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="mailto:cszhi@cszhi.com" title="E-Mail &rarr; mailto:cszhi@cszhi.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
    
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2011 – <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">csz</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">403k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">16:47</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  
    <span class="post-meta-divider">|</span>
  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>












        
      </div>
    </footer>
  </div>

  


  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
<script src="/js/utils.js?v=7.4.0"></script>
<script src="/js/schemes/pisces.js?v=7.4.0"></script>

<script src="/js/next-boot.js?v=7.4.0"></script>



  








  <script src="/js/local-search.js?v=7.4.0"></script>














  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '091529c38ad591e045ce',
      clientSecret: 'b66b5ffda0604e75b3d6d4e74d8658e8dfea76a4',
      repo: 'cszhi.github.io',
      owner: 'cszhi',
      admin: ['cszhi'],
      id: 'cdbc7efde2cb164585ffe104e60e5c92',
        language: 'zh-CN',
      
      distractionFreeMode: 'false'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
</script>

</body>
</html>
